<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Theory meets practice...</title>
    <description>A blog about statistics in theory and practice. Not always serious, not always flawless, but definitely a statistically flavoured bean.
</description>
    <link>https://mhoehle.github.io/blog/</link>
    <atom:link href="https://mhoehle.github.io/blog/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 21 Feb 2025 16:15:42 +0100</pubDate>
    <lastBuildDate>Fri, 21 Feb 2025 16:15:42 +0100</lastBuildDate>
    <generator>Jekyll v4.4.1</generator>
    
      <item>
        <title>Risky Risk Results</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We determine the probabilities of winning battles in the dice-based
board game &lt;strong&gt;Risk&lt;/strong&gt; by counting and using Markov chains.
The results show that if the battle is executed with 5 or more armies,
the attacker has a slight advantage when both the attacker and defender
start with the same number of armies.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2025-02-21-risk/Risk-dice-example.jpg&quot; /&gt;
&lt;br&gt; Image source: &lt;a
href=&quot;https://en.wikipedia.org/wiki/Image:Risk-dice-example.jpg&quot;&gt;Wikipedia&lt;/a&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/mhoehle/mhoehle.github.io/master/_source/2025-02-21-risk.Rmd&quot;&gt;R-markdown
source code of this blog&lt;/a&gt; is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;While watching yet another &lt;a
href=&quot;https://www.youtube.com/watch?v=RdooKXXcWWc&quot;&gt;episode of
Numberphile&lt;/a&gt;, I was puzzled by a statement from &lt;a
href=&quot;https://www.simonyi.ox.ac.uk/&quot;&gt;Marcus du Sautoy&lt;/a&gt; about how
people initially got the analysis of probabilities in the &lt;a
href=&quot;https://en.wikipedia.org/wiki/Risk_(game)&quot;&gt;game of Risk&lt;/a&gt; wrong.
Digging a little deeper, &lt;span class=&quot;citation&quot;
data-cites=&quot;dusautoy2023&quot;&gt;du Sautoy (2023)&lt;/span&gt; on pp. 306-307 refers
to erroneous probability calculations made by &lt;span class=&quot;citation&quot;
data-cites=&quot;tan1997&quot;&gt;Tan (1997)&lt;/span&gt;, which were subsequently
corrected by &lt;span class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne
(2003)&lt;/span&gt; using counting techniques. What surprised me was that
&lt;span class=&quot;citation&quot; data-cites=&quot;tan1997&quot;&gt;Tan (1997)&lt;/span&gt; could have
easily spotted the error with a simple Monte Carlo simulation (see
Appendix 1). This story about risky risk results for Risk has become a
motivating example in my &lt;em&gt;Probability 101&lt;/em&gt; class on why Monte
Carlo simulations are important.&lt;/p&gt;
&lt;p&gt;In what follows, I shall focus on computing the necessary
probabilities by counting. Several literature sources, including the
aforementioned &lt;span class=&quot;citation&quot; data-cites=&quot;tan1997&quot;&gt;Tan
(1997)&lt;/span&gt;, &lt;span class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne
(2003)&lt;/span&gt;, as well as &lt;span class=&quot;citation&quot;
data-cites=&quot;pierce_wooster2015&quot;&gt;Pierce and Wooster (2015)&lt;/span&gt; and
&lt;span class=&quot;citation&quot; data-cites=&quot;hendel_etal2015&quot;&gt;Hendel et al.
(2015)&lt;/span&gt;, calculate the probabilities. However, I was not able to
find any publicly available programming code to verify their claims.
Hence, the goal of this post is to provide literate programming style
documented open-source R code to compute these probabilities.&lt;/p&gt;
&lt;h2 id=&quot;mathematical-description-of-a-single-battle&quot;&gt;Mathematical
Description of a Single Battle&lt;/h2&gt;
&lt;p&gt;In the &lt;a href=&quot;https://en.wikipedia.org/wiki/Risk_(game)&quot;&gt;Game of
Risk&lt;/a&gt; a single battle between &lt;span class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt;
attacking armies and &lt;span class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt; defending
armies is carried out as follows: Both the attacker and the defender
roll one six-sided die for each of their armies inolved in the battle.
The highest die of the attacker is then compared to the highest die of
the defender. If the attacker’s die is higher, then the defender loses
one army, otherwise the attacker loses one army. If both the attacker
and the defender use more than one army, the next-highest dice are
compared, and the process is repeated. The game imposes the restrictions
&lt;span class=&quot;math inline&quot;&gt;\(a \in {1,2,3}\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(d \in {1,2}\)&lt;/span&gt; for a single battle.&lt;/p&gt;
&lt;p&gt;Denote by &lt;span class=&quot;math inline&quot;&gt;\(Y_{1}, \ldots, Y_{a}\)&lt;/span&gt;
independent random variables representing the outcomes of the &lt;span
class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt; dice rolled by the attacker. Similarly,
denote by &lt;span class=&quot;math inline&quot;&gt;\(Z_{1}, \ldots, Z_{d}\)&lt;/span&gt;
independent random variables representing the outcomes of the defender’s
&lt;span class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt; dice. Each of these &lt;span
class=&quot;math inline&quot;&gt;\(a+d\)&lt;/span&gt; random variables follows a discrete
uniform distribution, i.e. &lt;span
class=&quot;math inline&quot;&gt;\(U(\{1,\ldots,6\})\)&lt;/span&gt;. Furthermore, let &lt;span
class=&quot;math inline&quot;&gt;\(Y_{(1)}\geq \cdots \geq Y_{(a)}\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(Z_{(1)}\geq \cdots \geq Z_{(d)}\)&lt;/span&gt; denote
the ordered outcomes of the attacker’s and defender’s dice,
respectively.&lt;/p&gt;
&lt;p&gt;The result of the first comparison is that the defender loses an
army, if &lt;span class=&quot;math inline&quot;&gt;\(Y_{(1)}&amp;gt;Z_{(1)}\)&lt;/span&gt;;
otherwise, the attacker loses an army. If a second comparison is to be
made – that is, if &lt;span class=&quot;math inline&quot;&gt;\(\min(a,d)=2\)&lt;/span&gt; –
then the defender loses an army if &lt;span
class=&quot;math inline&quot;&gt;\(Y_{(2)}&amp;gt;Z_{(2)}\)&lt;/span&gt;; otherwise the
attacker loses an army. Hence, a random variable describing the number
of armies the defender loses in an &lt;span
class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt; vs. &lt;span
class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt; battle is &lt;span class=&quot;math display&quot;&gt;\[
D = \sum_{i=1}^{\min(a,d)} I(Y_{(i)}&amp;gt;Z_{(i)}),
\]&lt;/span&gt; where &lt;span class=&quot;math inline&quot;&gt;\(I(\cdot)\)&lt;/span&gt; is an
indicator function that equals 1 if its argument is true and 0
otherwise. The variable &lt;span class=&quot;math inline&quot;&gt;\(D\)&lt;/span&gt; has
support on the integer values &lt;span
class=&quot;math inline&quot;&gt;\(0,\ldots,\min(a,d)\)&lt;/span&gt;. Similarly, the number
of armies the attacker loses is &lt;span class=&quot;math inline&quot;&gt;\(A =
\min(a,d) - D\)&lt;/span&gt;. Example: In the splash picture of the abstract,
the attacker rolled 4,3,3 (red dice) and the defender 3,2 (white dice).
Since &lt;span class=&quot;math inline&quot;&gt;\(4&amp;gt;3\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(3&amp;gt;2\)&lt;/span&gt;, the defender loses two armies in
this specific battle.&lt;/p&gt;
&lt;p&gt;Denote by &lt;span class=&quot;math inline&quot;&gt;\(p_{adk}\)&lt;/span&gt; the
probability that a single battle between &lt;span
class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt; attacking armies and &lt;span
class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt; defending armies results in the
defender losing &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; armies, &lt;span
class=&quot;math inline&quot;&gt;\(k=0,\ldots,\min(a,d)\)&lt;/span&gt;. This probability
can be computed by dividing the number of favourable outcomes by the
total number of possible outcomes:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[\begin{align}  
p_{adk} = \frac{1}{6^{a+d}}\sum_{y_1=0}^6 \cdots \sum_{y_a=0}^6
\sum_{z_1=0}^6 \cdots \sum_{z_d=0}^6
I\left(\left\{\sum_{j=1}^{\min(a,d)} I(y_{(j)}&amp;gt;z_{(j)})\right\} =
k\right)
\end{align}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Although this formula may look involved, the &lt;span
class=&quot;math inline&quot;&gt;\(6^{a+d}\)&lt;/span&gt; is just the number of possible
outcomes when throwing &lt;span class=&quot;math inline&quot;&gt;\(a+d\)&lt;/span&gt; dice and
the summation over the indicator function is just a way to count all
favourable configurations in the Cartesian product sample space &lt;span
class=&quot;math inline&quot;&gt;\(\{1,\ldots,6\}^{a+d}\)&lt;/span&gt;. Since the maximum
values for &lt;span class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt; in Risk are 3 and 2, respectively, the
dimension of the product space will be no larger than &lt;span
class=&quot;math inline&quot;&gt;\(6^5=`6^5`\)&lt;/span&gt;, which is tractable.&lt;/p&gt;
&lt;h2 id=&quot;computation&quot;&gt;Computation&lt;/h2&gt;
&lt;p&gt;We start the R code by defining that we look at outcomes of the dice
D6, i.e. the sample space of one dice is &lt;span
class=&quot;math inline&quot;&gt;\(\Omega = \{1,\ldots,6\}\)&lt;/span&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Sample space for one dice throw&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;Omega &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We then write a function, which uses the &lt;code&gt;expand_grid()&lt;/code&gt;
function repeatedly in order to generate the Cartesian product &lt;span
class=&quot;math inline&quot;&gt;\(\Omega^\text{nDice}\)&lt;/span&gt; for &lt;span
class=&quot;math inline&quot;&gt;\(\text{nDice}\in\mathbb{N}\)&lt;/span&gt; dice.
Furthermore, we add a column containing the probability for each element
in this sample space, i.e. the probability is &lt;span
class=&quot;math inline&quot;&gt;\(1/|\Omega|^{\text{nDice}}=1/6^{\text{nDice}}\)&lt;/span&gt;,
since the dice are assumed to be fair.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Do expand_grid on the \Omega set sequentially a given number of nDice times. &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# At the end we have nDice columns.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# @param nDice (integer) We compute \Omega_{dice}^{nDice}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# @param Omega (vector of integers) The faces on the dice.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# @return Tibble with nDice columns containing all |\Omega_{dice}|^{nDice} possible outcomes and a column stating the probability of each element in this sample space, i.e. 1/|\Omega_{dice}^{nDice}|.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;sample_space &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(nDice, &lt;span class=&quot;at&quot;&gt;Omega=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;fu&quot;&gt;expand_grid&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;!!!&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;replicate&lt;/span&gt;(nDice, Omega, &lt;span class=&quot;at&quot;&gt;simplify =&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;D&amp;quot;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;nDice)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(Omega)&lt;span class=&quot;sc&quot;&gt;^&lt;/span&gt;nDice))&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Instead of calculating a matrix containing all possible outcomes of
the &lt;span class=&quot;math inline&quot;&gt;\(a+d\)&lt;/span&gt; dice, as in the sum-formula
above, and then handling the sorting, we divide the problem into two
tasks:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Calculate all possible outcomes and their probabilities when sorting
the outcome of the attacker’s &lt;span class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt;
dices&lt;/li&gt;
&lt;li&gt;Calculate all possible outcomes and their probabilities when sorting
the outcome of the attacker’s &lt;span class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt;
dices&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since the dice throws of the attacker and defender are independent,
we can then compute the required joint distribution by multiplying the
two marginal distributions found in 1. and 2.&lt;/p&gt;
&lt;p&gt;As a consequence we write a function that returns all possible
outcomes of &lt;span class=&quot;math inline&quot;&gt;\(Y_{(1)} \leq \ldots \leq
Y_{(\text{nCompare})}\)&lt;/span&gt; obtained after ordering the outcome of
dice, i.e. &lt;span class=&quot;math inline&quot;&gt;\(Y_{(1)} \leq \ldots \leq
Y_{(\text{nDice})}\)&lt;/span&gt; with &lt;span
class=&quot;math inline&quot;&gt;\(\text{nCompare} \leq \text{nDice}\)&lt;/span&gt;. To be
compatible with the game of risk &lt;span
class=&quot;math inline&quot;&gt;\(\text{nCompare}\in\{1,2\}\)&lt;/span&gt;. We compute the
associated probabilities by adding up the underlying entries of the
Cartesian sample space.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;combos_sorted &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;nDice=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;nCompare=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,nDice), &lt;span class=&quot;at&quot;&gt;base_name =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;y&amp;quot;&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Generate all outcomes and make a label&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# which identifies which of the sorted bins the outcome belongs to&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  combos &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_space&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;nDice=&lt;/span&gt;nDice) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;combo_sorted =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;sort&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c_across&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;all_of&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;paste0&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;D&amp;quot;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;nDice))), &lt;span class=&quot;at&quot;&gt;decreasing=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;at&quot;&gt;combo_label =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_sub&lt;/span&gt;(combo_sorted, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, nCompare)) &lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Count accoring&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-10&quot;&gt;&lt;a href=&quot;#cb3-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  combos_summed &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; combos &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(combo_label) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-11&quot;&gt;&lt;a href=&quot;#cb3-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;n&lt;/span&gt;(), &lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(prob)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-12&quot;&gt;&lt;a href=&quot;#cb3-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;arrange&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;desc&lt;/span&gt;(combo_label)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-13&quot;&gt;&lt;a href=&quot;#cb3-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# We use the notation by Osborn (2009) and denote the columns y^{(1)} \geq y^{(2)} \geq y^{(3)}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-14&quot;&gt;&lt;a href=&quot;#cb3-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;separate_wider_position&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;cols =&lt;/span&gt; combo_label, &lt;span class=&quot;at&quot;&gt;widths =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;set_names&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, nCompare), &lt;span class=&quot;at&quot;&gt;nm=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(base_name, &lt;span class=&quot;st&quot;&gt;&amp;quot;_{(&amp;quot;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;nCompare,&lt;span class=&quot;st&quot;&gt;&amp;quot;)}&amp;quot;&lt;/span&gt;)))&lt;/span&gt;
&lt;span id=&quot;cb3-15&quot;&gt;&lt;a href=&quot;#cb3-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-16&quot;&gt;&lt;a href=&quot;#cb3-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Done&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-17&quot;&gt;&lt;a href=&quot;#cb3-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(combos_summed)&lt;/span&gt;
&lt;span id=&quot;cb3-18&quot;&gt;&lt;a href=&quot;#cb3-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As an example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;combos_sorted&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;nDice=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;nCompare=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 21 × 4
##   `y_{(1)}` `y_{(2)}`     n   prob
##   &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;     &amp;lt;int&amp;gt;  &amp;lt;dbl&amp;gt;
## 1 6         6            16 0.0741
## 2 6         5            27 0.125 
## 3 6         4            21 0.0972
## 4 6         3            15 0.0694
## 5 6         2             9 0.0417
## # ℹ 16 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This can then be combined to obtain the joint distribution of the
sorted dice to be compared.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;joint_combos_sorted &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(a, d) {&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Sort the throws of the attacker and defender&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  Y &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;combos_sorted&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;nDice=&lt;/span&gt;a, &lt;span class=&quot;at&quot;&gt;base_name=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;y&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  Z &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;combos_sorted&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;nDice=&lt;/span&gt;d, &lt;span class=&quot;at&quot;&gt;base_name=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;z&amp;quot;&lt;/span&gt;) &lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Make a tibble with all combinations of the a vs. d armies fight&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-7&quot;&gt;&lt;a href=&quot;#cb6-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  joint &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; Y &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cross_join&lt;/span&gt;(Z) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-8&quot;&gt;&lt;a href=&quot;#cb6-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob =&lt;/span&gt; prob.x &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; prob.y,&lt;/span&gt;
&lt;span id=&quot;cb6-9&quot;&gt;&lt;a href=&quot;#cb6-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;at&quot;&gt;n =&lt;/span&gt; n.x &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; n.y) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb6-10&quot;&gt;&lt;a href=&quot;#cb6-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;n.x, &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;n.y, &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;prob.x, &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;prob.y)&lt;/span&gt;
&lt;span id=&quot;cb6-11&quot;&gt;&lt;a href=&quot;#cb6-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb6-12&quot;&gt;&lt;a href=&quot;#cb6-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;#Done&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-13&quot;&gt;&lt;a href=&quot;#cb6-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(joint)&lt;/span&gt;
&lt;span id=&quot;cb6-14&quot;&gt;&lt;a href=&quot;#cb6-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which for a single &lt;span class=&quot;math inline&quot;&gt;\(a=3\)&lt;/span&gt; vs. &lt;span
class=&quot;math inline&quot;&gt;\(d=2\)&lt;/span&gt; battle would look like:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;joint_combos_sorted&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 × 6
##   `y_{(1)}` `y_{(2)}` `z_{(1)}` `z_{(2)}`    prob     n
##   &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt;
## 1 6         6         6         6         0.00206    16
## 2 6         6         6         5         0.00412    32
## 3 6         6         6         4         0.00412    32&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can now compute &lt;span class=&quot;math inline&quot;&gt;\(p_{adk}\)&lt;/span&gt; by
comparing &lt;span class=&quot;math inline&quot;&gt;\(Y_{(i)}&amp;gt;Z_{(i)}\)&lt;/span&gt; for
all relevant &lt;span class=&quot;math inline&quot;&gt;\(i=1,\ldots,\min(a,d)\)&lt;/span&gt;
and summing all outcomes where the defender loses &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; armies:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;########################################################################&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Distribution over the number of armies that defender is losing,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-3&quot;&gt;&lt;a href=&quot;#cb9-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# when attacker is using A armies and defender is using D armies.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-4&quot;&gt;&lt;a href=&quot;#cb9-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-5&quot;&gt;&lt;a href=&quot;#cb9-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# @param A Number of armies (=dice) the attacker sends into the battle&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-6&quot;&gt;&lt;a href=&quot;#cb9-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# @param D Number of armies (=dice) the defender sends into the fight&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-7&quot;&gt;&lt;a href=&quot;#cb9-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-8&quot;&gt;&lt;a href=&quot;#cb9-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# @return A tibble containing all possible outcomes of the battle in terms&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-9&quot;&gt;&lt;a href=&quot;#cb9-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#         of losses for attacker and defender.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-10&quot;&gt;&lt;a href=&quot;#cb9-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;########################################################################&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-11&quot;&gt;&lt;a href=&quot;#cb9-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;p_lose_ad &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb9-12&quot;&gt;&lt;a href=&quot;#cb9-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# All joint combinations of attacker and defender&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-13&quot;&gt;&lt;a href=&quot;#cb9-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  joint &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;joint_combos_sorted&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;a, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;d)&lt;/span&gt;
&lt;span id=&quot;cb9-14&quot;&gt;&lt;a href=&quot;#cb9-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb9-15&quot;&gt;&lt;a href=&quot;#cb9-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Number of dice to compare&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-16&quot;&gt;&lt;a href=&quot;#cb9-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  nCompare &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pmin&lt;/span&gt;(a, d)&lt;/span&gt;
&lt;span id=&quot;cb9-17&quot;&gt;&lt;a href=&quot;#cb9-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb9-18&quot;&gt;&lt;a href=&quot;#cb9-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# I find this loop version easier to understand&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-19&quot;&gt;&lt;a href=&quot;#cb9-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# than a corresponding tidyverse version&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-20&quot;&gt;&lt;a href=&quot;#cb9-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; (k &lt;span class=&quot;cf&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(nCompare)) {&lt;/span&gt;
&lt;span id=&quot;cb9-21&quot;&gt;&lt;a href=&quot;#cb9-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    joint[, &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;lose_D_pos&amp;quot;&lt;/span&gt;, k)] &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; (joint[,&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;y_{(&amp;quot;&lt;/span&gt;,k,&lt;span class=&quot;st&quot;&gt;&amp;quot;)}&amp;quot;&lt;/span&gt;)] &lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt; joint[,&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;z_{(&amp;quot;&lt;/span&gt;,k,&lt;span class=&quot;st&quot;&gt;&amp;quot;)}&amp;quot;&lt;/span&gt;)])&lt;/span&gt;
&lt;span id=&quot;cb9-22&quot;&gt;&lt;a href=&quot;#cb9-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  }&lt;/span&gt;
&lt;span id=&quot;cb9-23&quot;&gt;&lt;a href=&quot;#cb9-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb9-24&quot;&gt;&lt;a href=&quot;#cb9-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Total sum of armies lost by defender and attacker, respectively&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-25&quot;&gt;&lt;a href=&quot;#cb9-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  joint &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; joint &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-26&quot;&gt;&lt;a href=&quot;#cb9-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;lose_D =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rowSums&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(., &lt;span class=&quot;fu&quot;&gt;matches&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;^lose_D_pos[0-9]+&amp;quot;&lt;/span&gt;))),&lt;/span&gt;
&lt;span id=&quot;cb9-27&quot;&gt;&lt;a href=&quot;#cb9-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;at&quot;&gt;lose_A =&lt;/span&gt; nCompare &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; lose_D)  &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-28&quot;&gt;&lt;a href=&quot;#cb9-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;starts_with&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;y&amp;quot;&lt;/span&gt;), &lt;span class=&quot;fu&quot;&gt;starts_with&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;z&amp;quot;&lt;/span&gt;), prob, lose_A, lose_D) &lt;/span&gt;
&lt;span id=&quot;cb9-29&quot;&gt;&lt;a href=&quot;#cb9-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb9-30&quot;&gt;&lt;a href=&quot;#cb9-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Add up probabilities for all combos yielding a specific&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-31&quot;&gt;&lt;a href=&quot;#cb9-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# lose_A, lose_D combo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-32&quot;&gt;&lt;a href=&quot;#cb9-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  res &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; joint &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(lose_A, lose_D) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-33&quot;&gt;&lt;a href=&quot;#cb9-33&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(prob), &lt;span class=&quot;at&quot;&gt;.groups=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;drop&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-34&quot;&gt;&lt;a href=&quot;#cb9-34&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;arrange&lt;/span&gt;(lose_D)&lt;/span&gt;
&lt;span id=&quot;cb9-35&quot;&gt;&lt;a href=&quot;#cb9-35&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-36&quot;&gt;&lt;a href=&quot;#cb9-36&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Done&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-37&quot;&gt;&lt;a href=&quot;#cb9-37&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb9-38&quot;&gt;&lt;a href=&quot;#cb9-38&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To test the function, we compute &lt;span
class=&quot;math inline&quot;&gt;\((p_{320},p_{321},p_{322})\)&lt;/span&gt;, which &lt;span
class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne (2003)&lt;/span&gt; found to
be &lt;span class=&quot;math inline&quot;&gt;\((2275, 2611,
2890)/7776=(0.293,0.336,0.372)\)&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# 3 vs. 2 battle&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;p_lose_ad&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 × 3
##   lose_A lose_D  prob
##    &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1      2      0 0.293
## 2      1      1 0.336
## 3      0      2 0.372&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Check that p_lose_ad is correct for p_{32k}, k=0,1,2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-2&quot;&gt;&lt;a href=&quot;#cb12-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;all.equal&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;p_lose_ad&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(prob), &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2275&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2611&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2890&lt;/span&gt;)&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;7776&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;An alternative verification is to use the &lt;a
href=&quot;https://topps.diku.dk/torbenm/troll.msp&quot;&gt;Troll dice roller and
probability calculator&lt;/a&gt; by &lt;a
href=&quot;http://hjemmesider.diku.dk/~torbenm/&quot;&gt;Torben Æ. Mogensen&lt;/a&gt; using
the following syntax:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;a:=3d6;b:=2d6;
count {(max a)&amp;gt;(max b),(min largest 2 a)&amp;gt;(min b)}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Troll computes the probability distribution as:&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2025-02-21-risk/troll_riskroll.png&quot; /&gt;
&lt;br&gt; Figure 1: Results for the 3 vs. 2 risk roll in Troll.
&lt;/center&gt;
&lt;p&gt;
&lt;p&gt;Note that for the &lt;span class=&quot;math inline&quot;&gt;\(p_{32k},
k=0,1,2\)&lt;/span&gt; setup, &lt;span class=&quot;citation&quot; data-cites=&quot;tan1997&quot;&gt;Tan
(1997)&lt;/span&gt; instead obtained &lt;span class=&quot;math inline&quot;&gt;\((0.237,
0.504, 0.259)\)&lt;/span&gt;, which differs substantially from the correct
result. See Appendix 2 for a discussion of his calculations.&lt;/p&gt;
&lt;p&gt;The complete table of probabilities for all possible single battle
attacker vs. defender configurations can now be computed as follows:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;state_change &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;expand_grid&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;p_lose_ad&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;a, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;d))) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;unnest&lt;/span&gt;(prob)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## Warning: `...` must be empty in `format.tbl()`
## Caused by error in `format_tbl()`:
## ! `...` must be empty.
## ✖ Problematic argument:
## • row.names = FALSE&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 14 × 4
##        a     d     k  prob
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1     1     1     0 0.583
##  2     1     1     1 0.417
##  3     1     2     0 0.745
##  4     1     2     1 0.255
##  5     2     1     0 0.421
##  6     2     1     1 0.579
##  7     2     2     0 0.448
##  8     2     2     1 0.324
##  9     2     2     2 0.228
## 10     3     1     0 0.340
## 11     3     1     1 0.660
## 12     3     2     0 0.293
## 13     3     2     1 0.336
## 14     3     2     2 0.372&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voila! The values align with those in Table 2 of &lt;span
class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne (2003)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;repeated-battles-using-markov-chains&quot;&gt;Repeated Battles using
Markov Chains&lt;/h2&gt;
&lt;p&gt;Once the probabilities for army losses of a single battle have been
computed, the natural follow-up question is: what happens if the
attacker decides to continue the attack? Assume that the attacker
continues to battle with as many armies as possible until either the
attacker has no armies left to attack with or the defender is destroyed,
i.e. has no armies left. What is the probability of an attacker with
&lt;span class=&quot;math inline&quot;&gt;\(A\geq 1\)&lt;/span&gt; armies winning such a
repeated attack against a defender with &lt;span
class=&quot;math inline&quot;&gt;\(D\geq 1\)&lt;/span&gt; armies?&lt;/p&gt;
&lt;p&gt;As stated in &lt;span class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne
(2003)&lt;/span&gt;, this is elegantly solved using Markov chains. Denote by
&lt;span class=&quot;math inline&quot;&gt;\((A,D)\)&lt;/span&gt; the current state of the
chain with &lt;span class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt; attacking armies and
&lt;span class=&quot;math inline&quot;&gt;\(D\)&lt;/span&gt; defending armies. Assuming that
both attacker and defender use as many dice possible, i.e. &lt;span
class=&quot;math inline&quot;&gt;\(a=\min(3,A)\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(d=\min(2,D)\)&lt;/span&gt;, the next battle would be a 3
vs. 2 battle if &lt;span class=&quot;math inline&quot;&gt;\(A\geq 3\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(D\geq 2\)&lt;/span&gt;. Hence, the attacker can lose
&lt;span class=&quot;math inline&quot;&gt;\(0,1,2\)&lt;/span&gt; armies, while the defender
can lose &lt;span class=&quot;math inline&quot;&gt;\(0,1,2\)&lt;/span&gt; armies. No matter
the outcome, 2 armies will be lost in the battle. Therefore, the new
state is: &lt;span class=&quot;math display&quot;&gt;\[
(A,D) \longrightarrow \left\{
\begin{array}{cl}
(A-2, D) &amp;amp; \text{with probability } \pi_{320} \\
(A-1, D-1) &amp;amp; \text{with probability } \pi_{321} \\
(A, D-2) &amp;amp; \text{with probability } \pi_{322}
\end{array}
\right.
\]&lt;/span&gt; If &lt;span class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt; and/or &lt;span
class=&quot;math inline&quot;&gt;\(D\)&lt;/span&gt; are smaller than 3 and 2 the transition
and its probability changes accordingly. Note that once either &lt;span
class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt; or &lt;span
class=&quot;math inline&quot;&gt;\(D\)&lt;/span&gt; is zero, the state is absorbing,
meaning it is no longer possible to continue the battle, and the state
will remain the same. If after updating &lt;span
class=&quot;math inline&quot;&gt;\(A=0\)&lt;/span&gt;, the attacker has lost the fight&lt;a
href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;. However, if &lt;span
class=&quot;math inline&quot;&gt;\(D = 0\)&lt;/span&gt;, the defender loses, and the
attacker conquers the country.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Armies at the start of the battle&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-2&quot;&gt;&lt;a href=&quot;#cb18-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;A &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-3&quot;&gt;&lt;a href=&quot;#cb18-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;D &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-4&quot;&gt;&lt;a href=&quot;#cb18-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;size_state_space &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; (A&lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;)&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;(D&lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Suppose we start with &lt;span class=&quot;math inline&quot;&gt;\(A=10\)&lt;/span&gt;
attacking armies and &lt;span class=&quot;math inline&quot;&gt;\(D=10\)&lt;/span&gt; defending
armies. The corresponding state space of the Markov chain is &lt;span
class=&quot;math inline&quot;&gt;\(\{(A, D), A\in\{0,\ldots,10\}, D\in
\{0,\ldots,10\}\}\)&lt;/span&gt;. Mapping this to a vector means creating a
vector of length &lt;span class=&quot;math inline&quot;&gt;\(11 \times 11=121\)&lt;/span&gt;.
Hence, the transition matrix &lt;span class=&quot;math inline&quot;&gt;\(P\)&lt;/span&gt; will
be &lt;span class=&quot;math inline&quot;&gt;\((121\times121)\)&lt;/span&gt; matrix. We
implement this in the function &lt;code&gt;transition_matrix(A, D)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The vector representing the situation with &lt;span
class=&quot;math inline&quot;&gt;\(10\)&lt;/span&gt; attacking armies and 10 defending
armies would be &lt;span class=&quot;math inline&quot;&gt;\(\mathbf{x}_0=(0,\ldots,0,
1)^\top\)&lt;/span&gt;. The development in probabilities over the state space
after a single battle can then be represented as &lt;span
class=&quot;math inline&quot;&gt;\(\mathbf{x}_1 =
\mathbf{x}_0^\top\mathbf{P}\)&lt;/span&gt;. Starting in state &lt;span
class=&quot;math inline&quot;&gt;\((10,10)\)&lt;/span&gt; we can thus go to either &lt;span
class=&quot;math inline&quot;&gt;\((8,10)\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\((9,9)\)&lt;/span&gt; or &lt;span
class=&quot;math inline&quot;&gt;\((10,8)\)&lt;/span&gt; and we recognize &lt;span
class=&quot;math inline&quot;&gt;\(p_{320}\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\(p_{321}\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(p_{322}\)&lt;/span&gt; as the transition
probabilities.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb19&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb19-1&quot;&gt;&lt;a href=&quot;#cb19-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;x0 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; states&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;state &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;%2d-%2d&amp;quot;&lt;/span&gt;,A,D) &lt;span class=&quot;co&quot;&gt;# &amp;quot;10-10&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-2&quot;&gt;&lt;a href=&quot;#cb19-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;x1 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;t&lt;/span&gt;(x0) &lt;span class=&quot;sc&quot;&gt;%*%&lt;/span&gt; P&lt;/span&gt;
&lt;span id=&quot;cb19-3&quot;&gt;&lt;a href=&quot;#cb19-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;x1[,x1&lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##     08-10     09-09     10-08 
## 0.2925669 0.3357767 0.3716564&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Subsequent battles are implemented as &lt;span
class=&quot;math inline&quot;&gt;\(\mathbf{x}_{i+1} = \mathbf{x}_{i}^\top
\mathbf{P}\)&lt;/span&gt;. For each single battle, the total number of armies
will decrease by at least 1 army (and most likely 2). Starting with
&lt;span class=&quot;math inline&quot;&gt;\(A+D\)&lt;/span&gt; armies means that after &lt;span
class=&quot;math inline&quot;&gt;\(A+D\)&lt;/span&gt; battles we are guaranteed to have
reached an absorbing state&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot;
id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;. Considering &lt;span
class=&quot;math display&quot;&gt;\[
\mathbf{x}_{A+D} = \mathbf{x}_{0}^\top \mathbf{P}^{A+D} =
\mathbf{x}_{0}^\top \underbrace{\mathbf{P} \cdots
\mathbf{P}}_{\text{$A+D$ times}}
\]&lt;/span&gt; we compute&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb21&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb21-1&quot;&gt;&lt;a href=&quot;#cb21-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;x_AD &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;t&lt;/span&gt;(x0) &lt;span class=&quot;sc&quot;&gt;%*%&lt;/span&gt; (P &lt;span class=&quot;sc&quot;&gt;%^%&lt;/span&gt; (A&lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;D))&lt;/span&gt;
&lt;span id=&quot;cb21-2&quot;&gt;&lt;a href=&quot;#cb21-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;round&lt;/span&gt;(x_AD[,x_AD&lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], &lt;span class=&quot;at&quot;&gt;digits=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## 00-01 00-02 00-03 00-04 00-05 00-06 00-07 00-08 00-09 00-10 01-00 02-00 03-00 04-00 05-00 06-00 07-00 08-00 09-00 10-00 
## 0.042 0.081 0.072 0.070 0.056 0.047 0.031 0.021 0.009 0.003 0.030 0.059 0.092 0.096 0.087 0.077 0.059 0.039 0.021 0.007&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Summing up all probabilities where the defender has zero armies gives
us the probability that the attacker wins the battle, i.e.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb23&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb23-1&quot;&gt;&lt;a href=&quot;#cb23-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(x_AD[,&lt;span class=&quot;fu&quot;&gt;str_detect&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;colnames&lt;/span&gt;(x_AD), &lt;span class=&quot;st&quot;&gt;&amp;quot;-00&amp;quot;&lt;/span&gt;)])&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.5675929&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This probability matches the value 0.568 reported in Table 3 of &lt;span
class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne (2003)&lt;/span&gt;. By
calculating &lt;span class=&quot;math inline&quot;&gt;\(\mathbf{P}^{A+D}\)&lt;/span&gt; once,
we can change the initial state vector &lt;span
class=&quot;math inline&quot;&gt;\(\mathbf{x}_0\)&lt;/span&gt; to compute the probability
of the attacker winning for each of the &lt;span class=&quot;math inline&quot;&gt;\(A
\times D\)&lt;/span&gt; possible initial values. The values match those in
Table 3 of &lt;span class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne
(2003)&lt;/span&gt;.&lt;/p&gt;
&lt;table class=&quot;table table-striped&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;empty-cells: hide;border-bottom:hidden;&quot; colspan=&quot;1&quot;&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;10&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
D
&lt;/div&gt;
&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
A
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
1
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
2
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
3
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
4
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
5
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
6
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
7
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
8
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
9
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
10
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.417&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.106&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.027&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.007&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.002&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.000&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.754&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.363&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.206&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.091&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.049&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.021&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.011&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.005&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.003&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.001&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.916&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.656&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.470&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.315&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.206&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.134&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.084&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.054&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.033&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.021&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.972&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.785&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.642&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.477&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.359&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.253&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.181&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.123&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.086&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.057&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
5
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.990&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.890&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.769&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.638&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.506&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.397&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.297&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.224&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.162&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.118&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.997&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.934&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.857&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.745&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.638&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.521&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.423&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.329&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.258&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.193&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
7
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.999&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.967&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.910&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.834&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.736&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.640&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.536&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.446&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.357&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.287&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
8
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;1.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.980&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.947&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.888&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.818&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.730&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.643&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.547&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.464&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.380&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
9
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;1.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.990&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.967&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.930&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.873&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.808&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.726&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.646&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.558&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;&quot;&gt;0.480&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;width: 1cm; border-right:1px solid;&quot;&gt;
10
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;1.000&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.994&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.981&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.954&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.916&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.861&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.800&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.724&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.650&lt;/span&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:center;width: 3cm; &quot;&gt;
&lt;span
style=&quot;     border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;&quot;&gt;0.568&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;All cells with a probability greater than 0.5 are colored green in
the table. We observe that from 5 and beyond the attacker has a slight
advantage when &lt;span class=&quot;math inline&quot;&gt;\(A=D\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Below, the situation for &lt;span class=&quot;math inline&quot;&gt;\(A,D\)&lt;/span&gt; up
to 50 is illustrated a little differently: for any given value of &lt;span
class=&quot;math inline&quot;&gt;\(D\)&lt;/span&gt;, the image shows in green all values of
&lt;span class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt;, where the probability for the
attacker to win is above 50%.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2025-02-21-risk/BIGTABLE_PLOT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Looking at the smallest &lt;span class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt; with a
win probability of more than 50% for a given &lt;span
class=&quot;math inline&quot;&gt;\(D\)&lt;/span&gt;, we see that this line is below the
&lt;span class=&quot;math inline&quot;&gt;\(A=D\)&lt;/span&gt; line. This shows that the
attacker has a slight advantage. Furthermore, the smallest such &lt;span
class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt; can be found approximately as &lt;span
class=&quot;math inline&quot;&gt;\(A_{\min} \approx 1.2204 + 0.8525\cdot
D\)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Counting is a powerful technique in combinatorics and dice-based
probabilities. The counting can be implemented on a computer by
representing the full sample space using tables or arrays. The risk of
making mistakes when counting in such structures is often lower than in
more involved probability calculations, e.g. order statistics or
conditional distributions. However, in many combinatorical problems the
state space quickly exceeds manageable sizes. Monte Carlo simulation
offers a quick alternative for verifying probability calculations, and
is effective even in untractably large state spaces.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TLDR&lt;/strong&gt;: For situations where &lt;span
class=&quot;math inline&quot;&gt;\(A \geq 5\)&lt;/span&gt;, attack if &lt;span
class=&quot;math inline&quot;&gt;\(A \geq 1.2204 + 0.8525\cdot D\)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;appendix-1-monte-carlo-simulation&quot;&gt;Appendix 1: Monte Carlo
Simulation&lt;/h2&gt;
&lt;p&gt;Just for completeness: Below is a simulation function for determining
the &lt;span class=&quot;math inline&quot;&gt;\(p_{adk}\)&lt;/span&gt; probabilities by Monte
Carlo simulation. It requires little thinking, is fast and accurate
enough to spot the errors in the &lt;span class=&quot;citation&quot;
data-cites=&quot;tan1997&quot;&gt;Tan (1997)&lt;/span&gt; paper:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb25&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb25-1&quot;&gt;&lt;a href=&quot;#cb25-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Simulate a single a vs. d army battle&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-2&quot;&gt;&lt;a href=&quot;#cb25-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;single_battle &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb25-3&quot;&gt;&lt;a href=&quot;#cb25-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Sort the dice&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-4&quot;&gt;&lt;a href=&quot;#cb25-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  y_sorted &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sort&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;sample&lt;/span&gt;(Omega, &lt;span class=&quot;at&quot;&gt;size =&lt;/span&gt; a, &lt;span class=&quot;at&quot;&gt;replace =&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;dec =&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb25-5&quot;&gt;&lt;a href=&quot;#cb25-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z_sorted &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sort&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;sample&lt;/span&gt;(Omega, &lt;span class=&quot;at&quot;&gt;size =&lt;/span&gt; d, &lt;span class=&quot;at&quot;&gt;replace =&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;dec =&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb25-6&quot;&gt;&lt;a href=&quot;#cb25-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-7&quot;&gt;&lt;a href=&quot;#cb25-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Number of comparisons&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-8&quot;&gt;&lt;a href=&quot;#cb25-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  nCompares &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(a, d)&lt;/span&gt;
&lt;span id=&quot;cb25-9&quot;&gt;&lt;a href=&quot;#cb25-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-10&quot;&gt;&lt;a href=&quot;#cb25-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# For each position to compare, see if defender looses an army.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-11&quot;&gt;&lt;a href=&quot;#cb25-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  lose_D &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; (y_sorted[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;nCompares] &lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt; z_sorted[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;nCompares])&lt;/span&gt;
&lt;span id=&quot;cb25-12&quot;&gt;&lt;a href=&quot;#cb25-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-13&quot;&gt;&lt;a href=&quot;#cb25-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(lose_D))&lt;/span&gt;
&lt;span id=&quot;cb25-14&quot;&gt;&lt;a href=&quot;#cb25-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb25-15&quot;&gt;&lt;a href=&quot;#cb25-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-16&quot;&gt;&lt;a href=&quot;#cb25-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Calc p_{32k}, k=0,1,2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-17&quot;&gt;&lt;a href=&quot;#cb25-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;prop.table&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;replicate&lt;/span&gt;(&lt;span class=&quot;fl&quot;&gt;1e5&lt;/span&gt;, &lt;span class=&quot;fu&quot;&gt;single_battle&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## 
##       0       1       2 
## 0.29136 0.33852 0.37012&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;appendix-2&quot;&gt;Appendix 2&lt;/h2&gt;
&lt;p&gt;&lt;span class=&quot;citation&quot; data-cites=&quot;tan1997&quot;&gt;Tan (1997)&lt;/span&gt;
calculated for example &lt;span class=&quot;math display&quot;&gt;\[\begin{align*}
\pi_{322}
&amp;amp;= P(Y_{(1)}&amp;gt;Z_{(1)} \cap Y_{(2)}&amp;gt;Z_{(2)}) \\
&amp;amp;= P(Y_{(1)}&amp;gt;Z_{(1)}) P(Y_{(2)}&amp;gt;Z_{(2)}) \\
&amp;amp;= \cdots,
\end{align*}\]&lt;/span&gt; but the 2nd step is wrong, because it assumes
independence of the events &lt;span
class=&quot;math inline&quot;&gt;\(Y_{(1)}&amp;gt;Z_{(1)}\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(Y_{(2)}&amp;gt;Z_{(2)}\)&lt;/span&gt;. This is not the case,
as seen from the following R output:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb27&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb27-1&quot;&gt;&lt;a href=&quot;#cb27-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Joint distribution of the two events&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-2&quot;&gt;&lt;a href=&quot;#cb27-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;f_Y12Z12 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;joint_combos_sorted&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;a=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;d=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb27-3&quot;&gt;&lt;a href=&quot;#cb27-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(1)}&amp;gt;z_{(1)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(1)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;z_{(1)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;,&lt;/span&gt;
&lt;span id=&quot;cb27-4&quot;&gt;&lt;a href=&quot;#cb27-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(2)}&amp;gt;z_{(2)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(2)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;z_{(2)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb27-5&quot;&gt;&lt;a href=&quot;#cb27-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(1)}&amp;gt;z_{(1)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(2)}&amp;gt;z_{(2)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb27-6&quot;&gt;&lt;a href=&quot;#cb27-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(prob), &lt;span class=&quot;at&quot;&gt;.groups =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;keep&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb27-7&quot;&gt;&lt;a href=&quot;#cb27-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-8&quot;&gt;&lt;a href=&quot;#cb27-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Marginal distribution of each event&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-9&quot;&gt;&lt;a href=&quot;#cb27-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;f_Y1Z1 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; f_Y12Z12 &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(1)}&amp;gt;z_{(1)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(prob))&lt;/span&gt;
&lt;span id=&quot;cb27-10&quot;&gt;&lt;a href=&quot;#cb27-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;f_Y2Z2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; f_Y12Z12 &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;y_{(2)}&amp;gt;z_{(2)}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(prob))&lt;/span&gt;
&lt;span id=&quot;cb27-11&quot;&gt;&lt;a href=&quot;#cb27-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-12&quot;&gt;&lt;a href=&quot;#cb27-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Joint prob when **assuming independence**&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-13&quot;&gt;&lt;a href=&quot;#cb27-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;f_Y12Z12_indep &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cross_join&lt;/span&gt;(f_Y1Z1, f_Y2Z2) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb27-14&quot;&gt;&lt;a href=&quot;#cb27-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;prob_indep =&lt;/span&gt; prob.x &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; prob.y) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb27-15&quot;&gt;&lt;a href=&quot;#cb27-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;prob.x,&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;prob.y)&lt;/span&gt;
&lt;span id=&quot;cb27-16&quot;&gt;&lt;a href=&quot;#cb27-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-17&quot;&gt;&lt;a href=&quot;#cb27-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Compare to the true joint distribution: this is definitely not the same!&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-18&quot;&gt;&lt;a href=&quot;#cb27-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;inner_join&lt;/span&gt;(f_Y12Z12, f_Y12Z12_indep, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;y_{(1)}&amp;gt;z_{(1)}&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;y_{(2)}&amp;gt;z_{(2)}&amp;quot;&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 × 4
## # Groups:   y_{(1)}&amp;gt;z_{(1)}, y_{(2)}&amp;gt;z_{(2)} [4]
##   `y_{(1)}&amp;gt;z_{(1)}` `y_{(2)}&amp;gt;z_{(2)}`   prob prob_indep
##   &amp;lt;lgl&amp;gt;             &amp;lt;lgl&amp;gt;              &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
## 1 FALSE             FALSE             0.293       0.207
## 2 FALSE             TRUE              0.236       0.321
## 3 TRUE              FALSE             0.0999      0.185
## 4 TRUE              TRUE              0.372       0.286&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;From the above output we notice that the correct joint distribution&lt;a
href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; of the two events cannot be computed
by simply multiplying the marginals. Hence, the two events are not
independent.&lt;/p&gt;
&lt;p&gt;The reason is that using order statistics induces dependencies. For
example &lt;span class=&quot;math inline&quot;&gt;\(P(Z_{(1)}=z_1, Z_{(2)}=z_2) \neq
P(Z_{(1)}=z_1) P(Z_{(2)}=z_2)\)&lt;/span&gt;. Although the dice &lt;span
class=&quot;math inline&quot;&gt;\(Z_1\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(Z_2\)&lt;/span&gt; are independent, the corresponding
variables of the order statistics are dependent: knowing something about
the higher of the two dice gives you information about the lower of the
two. For example if you know that &lt;span
class=&quot;math inline&quot;&gt;\(Z_{(1)}=1\)&lt;/span&gt;, then you know for sure that
&lt;span class=&quot;math inline&quot;&gt;\(Z_{(2)}=1\)&lt;/span&gt;. This dependence extends
to comparisons with the attacker’s dice.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-dusautoy2023&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
du Sautoy, M. 2023. &lt;em&gt;Around the World in 80 Games&lt;/em&gt;. 4th Estate.
&lt;a
href=&quot;https://www.simonyi.ox.ac.uk/books/around-the-world-in-80-games/&quot;&gt;https://www.simonyi.ox.ac.uk/books/around-the-world-in-80-games/&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-hendel_etal2015&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Hendel, S., C. Hoffman, C. Manack, and A. Wagaman. 2015. &lt;span&gt;“Taking
the Risk Out of RISK: Conquer Odds in the Board Game RISK.”&lt;/span&gt; &lt;a
href=&quot;https://arxiv.org/abs/1512.04333&quot;&gt;https://arxiv.org/abs/1512.04333&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-osborne2003&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Osborne, Jason A. 2003. &lt;span&gt;“Markov Chains for the RISK Board Game
Revisited.”&lt;/span&gt; &lt;em&gt;Mathematics Magazine&lt;/em&gt; 76 (2): 129–35. &lt;a
href=&quot;http://www.jstor.org/stable/3219306&quot;&gt;http://www.jstor.org/stable/3219306&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-pierce_wooster2015&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Pierce, P., and R. Wooster. 2015. &lt;span&gt;“Conquer the World with Markov
Chains.”&lt;/span&gt; &lt;em&gt;Math Horizons&lt;/em&gt; 22 (4): pp. 18–21. &lt;a
href=&quot;https://www.jstor.org/stable/10.4169/mathhorizons.22.4.18&quot;&gt;https://www.jstor.org/stable/10.4169/mathhorizons.22.4.18&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-tan1997&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Tan, Bariş. 1997. &lt;span&gt;“Markov Chains and the RISK Board Game.”&lt;/span&gt;
&lt;em&gt;Mathematics Magazine&lt;/em&gt; 70 (5): 349–57. &lt;a
href=&quot;http://www.jstor.org/stable/2691171&quot;&gt;http://www.jstor.org/stable/2691171&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;Since the rules of Risk only allow attacking with one
army less than hosted in the country the attack originates from, the
attacker would still have one army left once &lt;span
class=&quot;math inline&quot;&gt;\(A=0\)&lt;/span&gt;. Thus, the country is not yet lost
but could be vulnerable to subsequent attacks in future rounds.&lt;a
href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Note: With this argument we take a more direct route
than &lt;span class=&quot;citation&quot; data-cites=&quot;osborne2003&quot;&gt;Osborne
(2003)&lt;/span&gt;, who also arranges the transition matrix notationally into
absorbing and transient states and looks at the steady state
distribution.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Obtained by counting using the involved
sum-sum-indicator formula from above.&lt;a href=&quot;#fnref3&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Fri, 21 Feb 2025 00:00:00 +0100</pubDate>
        <link>https://mhoehle.github.io/blog/2025/02/21/risk.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2025/02/21/risk.html</guid>
        
        <category>rstats</category>
        
        <category>probability</category>
        
        <category>game theory</category>
        
        
      </item>
    
      <item>
        <title>Guess My Name with Decision Trees</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We use classification trees to determine the optimal sequence of
questions to ask in the game “Guess my name” (Mini Logix series from
Djeco). Aim of the game is to identify wich person, out of 16 possible,
the opponent is. Clasification trees and optimal sequential decision
making in this case have strong similarities with cross-entropy of the
class distribution working as a common metric for quantifying
information gain.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2024-02-12-decisiontree/splash.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/mhoehle/hoehleatsu.github.io/master/_source/2024-02-12-decisiontree.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;As a mathmatician you do not play logic games for fun, you play to
win. So when playing “Guess my name” (Mini Logix series from Djeco),
where the task is to ask your opponent a series of questions in order to
identify which of 16 picture characters they are, you want to devise an
optimal sequence of questions in order to determine your opponent’s
choice. Given a catalogue of possible questions, we use classification
trees to find the optimal sequence of questions to ask.&lt;/p&gt;
&lt;p&gt;The game goes as follows: Each player gets a card with pictures of 16
persons. Each player selects a person of the 16 she wants to be and
writes the name of this person on their card.&lt;/p&gt;
&lt;p&gt;
&lt;center&gt;
&lt;img
src=&quot;/blog/figure/source/2024-02-12-decisiontree/karte-lowres.jpg&quot; /&gt;
&lt;br&gt; Figure 1: Exemplary game card of the “Guess my name” game, Mini
Logix series, Djeco, during gameplay.
&lt;/center&gt;
&lt;p&gt;
&lt;p&gt;The players then take turns to ask the opponent &lt;i&gt;one&lt;/i&gt; question
about their person, for example you could ask &lt;i&gt;Does your person have
glasses?&lt;/i&gt; or &lt;i&gt;Is your person wearing a chef’s hat?&lt;/i&gt;“. Based on
the answer (possible answers are: yes or no) you sequentially rule out
more and more persons on the card until you are ready to guess who the
other person is. The first player to correctly identify the opponent’s
person wins. Note that only questions about the picture of the person
are allowed. In what follows, we shall assume that a third answer
cateogry”unclear” is also possible, because some questions like &lt;i&gt;does
your person have blonde hair&lt;/i&gt; can not be answered when the hair is
not visible on the picture (see for example the picture of Clovis).&lt;/p&gt;
&lt;p&gt;The aim is now to devise a series of questions whick as quickly as
possible can narrow our set of candidate persons down to 1 person. When
only yes or no answers are possible, in the optimal case, each question
reduces the set of possible persons by a factor 2. Hence, &lt;span
class=&quot;math inline&quot;&gt;\(2^x = 16 \Leftrightarrow x = \log_{2}(16) =
4\)&lt;/span&gt; (well chosen) questions are needed to reduce the set of
candidates from 16 to 1. However, it might not be possible to find a
sequence of such optimal questions, because (given the previous set of
questions) the next question might not split the remaining pool of
candidates in two sets of equal cardinality. As a more hands-on approach
we formulate the task as follows: given a set of questions, where we for
each of the 16 persons know the answer to, which questions and in what
sequence should we ask them in order to correctly identity the
opponent’s person.&lt;/p&gt;
&lt;h2 id=&quot;methods&quot;&gt;Methods&lt;/h2&gt;
&lt;h3 id=&quot;question-catalogue&quot;&gt;Question Catalogue&lt;/h3&gt;
To begin with we develop a set of questions and encode the answer of
each of the 16 persons to the question as yes, no or unclear Below we
show an exemplary question catalogue consisting of 12 together with the
answers for 8 out of the 16 persons (full data for all 16 &lt;a
href=&quot;../../../figure/source/2024-02-12-decisiontree/whatismyname.xlsx&quot;&gt;here&lt;/a&gt;).
One can compare the answers with the picture of the above shown game
card.
&lt;p&gt;
&lt;p&gt;
&lt;hr&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Question: Does the person
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Gonzague
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Clovis
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Mounir
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Dan
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Barnabé
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Casimir
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Philippe
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
Max
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have a headgear?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have glasses somewhere?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have a brush behind the ear?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have blonde hair?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
unclear
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
wear a top with no or short sleeves?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have visible eyebrows?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
picture have something red in it?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have a top hat on?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
picture have something green in it?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have blue eyes?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have a chef’s hat on?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
have a V-collar?
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
yes
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
no
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;p&gt;
&lt;h3 id=&quot;decision-trees-as-classification-trees&quot;&gt;Decision Trees as
Classification Trees&lt;/h3&gt;
&lt;p&gt;We use classification trees to represent the sequence of questions to
ask. Our goal is to correctly identify the person at the end of the
sequence, hence, each leave node should assign the correct person with
100% probability. This is somewhat opposite to traditional
classification trees, which inspired by Occam’s razor are kept small and
thus accept a certain misclassification rate on the training data in
order to generalize well to out-of-sample data.&lt;/p&gt;
&lt;p&gt;We address this tweak by working with saturated trees (i.e. no
pruning). Furthermore, we need to shape the questions s.t. they space of
answers allows for a correct partitioning of all 16 persons. For ease of
exposition we assume that each of the 16 persons is equally likely to be
chosen by your opponent, i.e. the prior probability for each person is
1/16. The appendix “Technical Details” contains information about how
the tree is grown. In R, classification trees can be fitted using the
function &lt;code&gt;rpart::rpart()&lt;/code&gt;. We configure the function such
that a saturated tree is grown, if this possible from the question
catalogue. Since training and test data in our case are identical we
want a tree which fits as good as possible on the training data.&lt;/p&gt;
&lt;h2 id=&quot;results&quot;&gt;Results&lt;/h2&gt;
&lt;p&gt;We transpose the question catalogue in order to bring the data into a
shape with columns being the features and one row per person.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Tranpose data to a tibble allowing a fit&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;persons &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; questions &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;pivot_longer&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;Question: Does the person&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;names_to=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;Person&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;pivot_wider&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;id_cols =&lt;/span&gt; Person, &lt;span class=&quot;at&quot;&gt;names_from=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;Question: Does the person&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;,&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                                &lt;span class=&quot;at&quot;&gt;values_from=&lt;/span&gt;value) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;across&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;everything&lt;/span&gt;(), factor))&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt;(persons)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 × 13
##   Person   `have a headgear?` `have glasses somewhere?` have a brush behind the ea…¹ `have blonde hair?` wear a top with no o…² have visible eyebrow…³
##   &amp;lt;fct&amp;gt;    &amp;lt;fct&amp;gt;              &amp;lt;fct&amp;gt;                     &amp;lt;fct&amp;gt;                        &amp;lt;fct&amp;gt;               &amp;lt;fct&amp;gt;                  &amp;lt;fct&amp;gt;                 
## 1 Gonzague no                 yes                       no                           yes                 no                     yes                   
## 2 Clovis   yes                no                        no                           unclear             no                     no                    
## 3 Mounir   yes                no                        no                           no                  no                     yes                   
## 4 Dan      yes                no                        no                           no                  no                     no                    
## 5 Barnabé  no                 yes                       no                           no                  no                     yes                   
## 6 Casimir  yes                no                        no                           no                  yes                    yes                   
## # ℹ abbreviated names: ¹​`have a brush behind the ear?`, ²​`wear a top with no or short sleeves?`, ³​`have visible eyebrows?`
## # ℹ 6 more variables: `picture have something red in it?` &amp;lt;fct&amp;gt;, `have a top hat on?` &amp;lt;fct&amp;gt;, `picture have something green in it?` &amp;lt;fct&amp;gt;,
## #   `have blue eyes?` &amp;lt;fct&amp;gt;, `have a chef&amp;#39;s hat on?` &amp;lt;fct&amp;gt;, `have a V-collar?` &amp;lt;fct&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This format of the data can then be used with
&lt;code&gt;rpart::rpart()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Fit tree using rpart&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Make sure we get a saturated tree&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tree &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rpart&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;formula =&lt;/span&gt; Person &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; ., &lt;span class=&quot;at&quot;&gt;data =&lt;/span&gt; persons, &lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;              &lt;span class=&quot;at&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;class&amp;quot;&lt;/span&gt;,&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;              &lt;span class=&quot;at&quot;&gt;parms=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;split=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;information&amp;quot;&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;              &lt;span class=&quot;at&quot;&gt;control=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rpart.control&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;minbucket=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;xval=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;cp =&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The resulting decision tree is illustrated below. We start at the
root node branching left or right depending on whether the answer to the
question: Does the person have have blonde hair? is “no”. If this is the
case we go left, otherwise (i.e. if the answer is “yes” or “unclear”) we
go right. At a leaf node we classify observations to the class indicated
by the round blue node around the name of the person.&lt;/p&gt;
&lt;div class=&quot;figure&quot; style=&quot;text-align: center&quot;&gt;
&lt;img src=&quot;/blog/figure/source/2024-02-12-decisiontree/RPART_SATURATED_TREE_PLOT-1.png&quot; alt=&quot;Figure 2: Decision tree to correctly identify your opponent with 4 questions.&quot;  /&gt;
&lt;p class=&quot;caption&quot;&gt;
Figure 2: Decision tree to correctly identify your opponent with 4
questions.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We note that the misclassification rate at each terminal leaf is 0,
i.e. if we follow the decision tree we are able to identify the correct
person. Furthermore, the depth of the tree is only 4. Hence, even though
there are 12 questions, the decision trees shows that we can use them in
a clever sequence so that - no matter how the answer is - we correctly
identify the person after 4 questions. Only 9 out of the 12 questions
are used anywhere in the tree.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Finding optimal sequences of question for identification has
application beyond winning logic games. One example is fault tree
diagnosis in reliability assessment, where entropy also plays a central
role in the finding minimal cut set &lt;span class=&quot;citation&quot;
data-cites=&quot;Xiaozhong1991&quot;&gt;(Xiaozhong 1991)&lt;/span&gt;. Troubleshooting
complex technical devices, such as printers, in addition to a dianosis
stage can also model the consequence of any repair actions &lt;span
class=&quot;citation&quot; data-cites=&quot;langseth_jensen2003&quot;&gt;(Langseth and Jensen
2003)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-hastie_etal2017&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Hastie, T., R. Tibshirani, and J. Friedman. 2017. &lt;em&gt;The Elements of
Statistical Learning&lt;/em&gt;. 2nd ed. Springer.
&lt;/div&gt;
&lt;div id=&quot;ref-langseth_jensen2003&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Langseth, H., and F. V. Jensen. 2003. &lt;span&gt;“Decision Theoretic
Troubleshooting of Coherent Systems.”&lt;/span&gt; &lt;em&gt;Reliability Engineering
&amp;amp; System Safety&lt;/em&gt; 80 (1): 49–62. &lt;a
href=&quot;https://doi.org/10.1016/S0951-8320(02)00202-8&quot;&gt;https://doi.org/10.1016/S0951-8320(02)00202-8&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-Xiaozhong1991&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Xiaozhong, W. 1991. &lt;span&gt;“Fault Tree Diagnosis Based on
&lt;span&gt;S&lt;/span&gt;hannon Entropy.”&lt;/span&gt; &lt;em&gt;Reliability Engineering &amp;amp;
System Safety&lt;/em&gt; 34 (2): 143–67. &lt;a
href=&quot;https://doi.org/10.1016/0951-8320(91)90086-M&quot;&gt;https://doi.org/10.1016/0951-8320(91)90086-M&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;
&lt;h2 id=&quot;appendix-technical-details&quot;&gt;Appendix: Technical Details&lt;/h2&gt;
&lt;p&gt;This section discusses the algorithmic details of how classification
trees are grown. For readers without interest in such technical detail
this section can safely be skipped. More details can be found in for
example &lt;span class=&quot;citation&quot; data-cites=&quot;hastie_etal2017&quot;&gt;Hastie,
Tibshirani, and Friedman (2017)&lt;/span&gt;, Sect 9.2.3.&lt;/p&gt;
&lt;p&gt;The number of possible splits for a categorical node with &lt;span
class=&quot;math inline&quot;&gt;\(M\)&lt;/span&gt; unordered categories is &lt;span
class=&quot;math inline&quot;&gt;\(2^{M-1}-1\)&lt;/span&gt;, i.e. for &lt;span
class=&quot;math inline&quot;&gt;\(M=2\)&lt;/span&gt; features there is only one possible
split, whereas &lt;span class=&quot;math inline&quot;&gt;\(K=3\)&lt;/span&gt; features have 3
possible splits. In our case, questions with &lt;span
class=&quot;math inline&quot;&gt;\(M=2\)&lt;/span&gt; have answers &lt;i&gt;yes&lt;/i&gt; and &lt;i&gt;no&lt;/i&gt;
and thus the split is ({yes}, {no}). When &lt;span
class=&quot;math inline&quot;&gt;\(M=3\)&lt;/span&gt; we have answers &lt;i&gt;yes&lt;/i&gt;, &lt;i&gt;no&lt;/i&gt;
and &lt;i&gt;unclear&lt;/i&gt; and consequently the splits are: ({yes}, {no,
unclear}), ({yes, unclear}, {no}), and ({yes,no},{unclear}). Note that
most questions in the question catalogue have &lt;span
class=&quot;math inline&quot;&gt;\(K=2\)&lt;/span&gt; answers:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;persons &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;across&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;Person, n_distinct))  &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;pivot_longer&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;cols=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;everything&lt;/span&gt;(), &lt;span class=&quot;at&quot;&gt;values_to =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;M&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(M) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;no_questions=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;n&lt;/span&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2 × 2
##       M no_questions
##   &amp;lt;int&amp;gt;        &amp;lt;int&amp;gt;
## 1     2           11
## 2     3            1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let the learning set be &lt;span class=&quot;math inline&quot;&gt;\(\mathcal{L}=\{
(\boldsymbol{x}_i, y_i), i=1,\ldots,n\}\)&lt;/span&gt;, where &lt;span
class=&quot;math inline&quot;&gt;\(\boldsymbol{x}_i=(x_{i1},\ldots,x_{ir})^\top\)&lt;/span&gt;
denotes the answers to the &lt;span class=&quot;math inline&quot;&gt;\(r=12\)&lt;/span&gt;
questions for each of the &lt;span class=&quot;math inline&quot;&gt;\(n=16\)&lt;/span&gt;
persons on a game card. For a node &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; in tree &lt;span
class=&quot;math inline&quot;&gt;\(T\)&lt;/span&gt; we use an impurity measure &lt;span
class=&quot;math inline&quot;&gt;\(Q_m(T)\)&lt;/span&gt; to decide which split to use. Let
&lt;span class=&quot;math inline&quot;&gt;\(R_m\)&lt;/span&gt; denote the set of all
observations in the training data, whose feature vector &lt;span
class=&quot;math inline&quot;&gt;\(\boldsymbol{x}_i\)&lt;/span&gt; fulfills all Boolean
conditions posed by following the tree until node &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;. In what follows we shall write &lt;span
class=&quot;math inline&quot;&gt;\(\boldsymbol{x}_i\in R_m\)&lt;/span&gt; if an observation
&lt;span class=&quot;math inline&quot;&gt;\((\boldsymbol{x}_i, y_i)\)&lt;/span&gt; from the
learning data is in &lt;span class=&quot;math inline&quot;&gt;\(R_m\)&lt;/span&gt;.
Furthermore, let &lt;span class=&quot;math inline&quot;&gt;\(n_m=|R_m|\)&lt;/span&gt; denote
the corresponding number of observations in &lt;span
class=&quot;math inline&quot;&gt;\(R_m\)&lt;/span&gt; and let &lt;span class=&quot;math display&quot;&gt;\[
\widehat{p}_{mk}=\frac{1}{n_m} \sum_{\boldsymbol{x}_i\in R_m} I(y_i=k) =
\frac{n_{mk}}{n_m}, \quad k=1,\ldots,K
\]&lt;/span&gt; be the proportion of category &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; observations at node &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;. The &lt;b&gt;cross-entropy impurity
measure&lt;/b&gt; is defined as&lt;/p&gt;
&lt;span class=&quot;math display&quot;&gt;\[
Q_m(T) = - \sum_{k=1}^K \widehat{p}_{mk} \cdot \log(\widehat{p}_{mk}),
\]&lt;/span&gt; where we use the convention that &lt;span
class=&quot;math inline&quot;&gt;\(0\cdot \log(0)=0\)&lt;/span&gt; if some of the
probabilities &lt;span class=&quot;math inline&quot;&gt;\(\widehat{p}_{mk}\)&lt;/span&gt; are
zero. As an example we show a plot of the cross-entropy function for
&lt;span class=&quot;math inline&quot;&gt;\(K=2\)&lt;/span&gt; for varying values of &lt;span
class=&quot;math inline&quot;&gt;\(p_{m1}=p\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(p_{m2}=1-p\)&lt;/span&gt;:
&lt;p&gt;
&lt;img src=&quot;/blog/figure/source/2024-02-12-decisiontree/PLOT_ENTROPY-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;
&lt;p&gt;
&lt;p&gt;The largest value for the impurity &lt;span
class=&quot;math inline&quot;&gt;\(Q_m(T)\)&lt;/span&gt; is obtained when all &lt;span
class=&quot;math inline&quot;&gt;\(K\)&lt;/span&gt; categories are equally likely,
i.e. when &lt;span class=&quot;math inline&quot;&gt;\(p_{mk}=1/K\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\(k=1,\ldots,K\)&lt;/span&gt;. Furthermore, the smallest
value &lt;span class=&quot;math inline&quot;&gt;\(Q_m(T)=0\)&lt;/span&gt; is obtained when one
category, say &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;, has &lt;span
class=&quot;math inline&quot;&gt;\(p_{mk}=1\)&lt;/span&gt; and consequently &lt;span
class=&quot;math inline&quot;&gt;\(p_{mk&amp;#39;}=0\)&lt;/span&gt; for all &lt;span
class=&quot;math inline&quot;&gt;\(k&amp;#39; \neq k\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;For a node &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; and unordered
categorical feature &lt;span class=&quot;math inline&quot;&gt;\(x_j\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\(j=1,\ldots,r\)&lt;/span&gt; we can now investigate the
set of possible splits &lt;span class=&quot;math inline&quot;&gt;\(S_j\)&lt;/span&gt; of &lt;span
class=&quot;math inline&quot;&gt;\(x_j\)&lt;/span&gt; by looking at the gain in impurity
for each split &lt;span class=&quot;math inline&quot;&gt;\(s\in S_j\)&lt;/span&gt;. A split
&lt;span class=&quot;math inline&quot;&gt;\(s=(s_L, s_R)\)&lt;/span&gt; of &lt;span
class=&quot;math inline&quot;&gt;\(x_j\)&lt;/span&gt; is characterised by a partition of
the labels of &lt;span class=&quot;math inline&quot;&gt;\(x_j\)&lt;/span&gt; in two disjoint
sets, &lt;span class=&quot;math inline&quot;&gt;\(s_L\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(s_R\)&lt;/span&gt;. For example, if &lt;span
class=&quot;math inline&quot;&gt;\(x_j\)&lt;/span&gt; has &lt;span
class=&quot;math inline&quot;&gt;\(M=3\)&lt;/span&gt; levels (yes, no, unclear) one
possible split could be &lt;span
class=&quot;math inline&quot;&gt;\(s_L=\{\text{yes\}}\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(s_R=\{\text{no,unclear}\}\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;If we split &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; according to the
rule &lt;span class=&quot;math inline&quot;&gt;\(s\in S_j\)&lt;/span&gt; we obtain two
sub-nodes &lt;span class=&quot;math inline&quot;&gt;\(m_L\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m_R\)&lt;/span&gt;, where &lt;span
class=&quot;math inline&quot;&gt;\(R_{m_L} = \{ \boldsymbol{x}_i \in R_m : x_{ij} \in
s_L\}\)&lt;/span&gt; and &lt;span class=&quot;math inline&quot;&gt;\(R_{m_R} = \{
\boldsymbol{x}_i \in R_m : x_{ij} \in s_R\}\)&lt;/span&gt;. The impurity of
&lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; in a tree &lt;span
class=&quot;math inline&quot;&gt;\(T_s\)&lt;/span&gt; implementing the split &lt;span
class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt;, and thus having additional subnodes
&lt;span class=&quot;math inline&quot;&gt;\(m_L\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m_R\)&lt;/span&gt;, is then calculated as &lt;span
class=&quot;math display&quot;&gt;\[
Q_m(T_s) = \frac{n_{m_L}}{n_m} Q_{m_L}(T_s) + \frac{n_{m_R}}{n_m}
Q_{m_R}(T_s).
\]&lt;/span&gt; Note that the probabilities to be used in the computation of
the subnodes’ cross-entropy are, e.g., &lt;span
class=&quot;math inline&quot;&gt;\(\widehat{p}_{m_L k} = n_{m_L k}/n_{m_L}\)&lt;/span&gt;.
We select the split, which minimizes the impurity. If we also let the
feature &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; vary we thus select &lt;span
class=&quot;math display&quot;&gt;\[
(j,s)=\DeclareMathOperator*{\argmin}{arg\,min}
\argmin_{j\in\{1,\ldots,r\},\&amp;gt; s\in S_j} Q_m(T_s).
\]&lt;/span&gt; As a simple example for our data: assume that the current tree
consists of just a root node &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;,
i.e. &lt;span class=&quot;math inline&quot;&gt;\(R_m\)&lt;/span&gt; consists of all &lt;span
class=&quot;math inline&quot;&gt;\(n=16\)&lt;/span&gt; observations.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Compute impurity of root&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(Q_root &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cross_entropy&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2.772589&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Determine if split on feature j&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;best_split &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt; (j, Rm) {&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# We know |S|=2^{M-1}-1 and define the split by the set consisting of&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# just ONE level (if |S|=1 we know yes/no and would not need the other level.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-5&quot;&gt;&lt;a href=&quot;#cb8-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# We can just pick one of them&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-6&quot;&gt;&lt;a href=&quot;#cb8-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  S &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;levels&lt;/span&gt;(persons[,j][[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]])&lt;/span&gt;
&lt;span id=&quot;cb8-7&quot;&gt;&lt;a href=&quot;#cb8-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(S) &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) S &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; S[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb8-8&quot;&gt;&lt;a href=&quot;#cb8-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(S) &lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;stop&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;M&amp;gt;3 currently not supported.&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb8-9&quot;&gt;&lt;a href=&quot;#cb8-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  S&lt;/span&gt;
&lt;span id=&quot;cb8-10&quot;&gt;&lt;a href=&quot;#cb8-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Try out all splits&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-11&quot;&gt;&lt;a href=&quot;#cb8-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  Q_s &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sapply&lt;/span&gt;(S, &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(s) {&lt;/span&gt;
&lt;span id=&quot;cb8-12&quot;&gt;&lt;a href=&quot;#cb8-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    R_mL &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; Rm[Rm[,j][[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]] &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; s,]&lt;/span&gt;
&lt;span id=&quot;cb8-13&quot;&gt;&lt;a href=&quot;#cb8-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    R_mR &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; Rm[Rm[,j][[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]] &lt;span class=&quot;sc&quot;&gt;!=&lt;/span&gt; s,]&lt;/span&gt;
&lt;span id=&quot;cb8-14&quot;&gt;&lt;a href=&quot;#cb8-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_m &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(Rm)&lt;/span&gt;
&lt;span id=&quot;cb8-15&quot;&gt;&lt;a href=&quot;#cb8-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_mL &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(R_mL&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;Person)&lt;/span&gt;
&lt;span id=&quot;cb8-16&quot;&gt;&lt;a href=&quot;#cb8-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_mR &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(R_mR&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;Person)&lt;/span&gt;
&lt;span id=&quot;cb8-17&quot;&gt;&lt;a href=&quot;#cb8-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    p_mL &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; n_mL &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(n_mL)&lt;/span&gt;
&lt;span id=&quot;cb8-18&quot;&gt;&lt;a href=&quot;#cb8-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    p_mR &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; n_mR &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(n_mR)&lt;/span&gt;
&lt;span id=&quot;cb8-19&quot;&gt;&lt;a href=&quot;#cb8-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    Q_s &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(n_mL)&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;n_m &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cross_entropy&lt;/span&gt;(p_mL) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(n_mR)&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;n_m &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cross_entropy&lt;/span&gt;(p_mR)&lt;/span&gt;
&lt;span id=&quot;cb8-20&quot;&gt;&lt;a href=&quot;#cb8-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(Q_s)&lt;/span&gt;
&lt;span id=&quot;cb8-21&quot;&gt;&lt;a href=&quot;#cb8-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  }) &lt;/span&gt;
&lt;span id=&quot;cb8-22&quot;&gt;&lt;a href=&quot;#cb8-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;name =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;names&lt;/span&gt;(Rm)[j], &lt;span class=&quot;at&quot;&gt;split=&lt;/span&gt;S[&lt;span class=&quot;fu&quot;&gt;which.min&lt;/span&gt;(Q_s)], &lt;span class=&quot;at&quot;&gt;Q=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(Q_s))&lt;/span&gt;
&lt;span id=&quot;cb8-23&quot;&gt;&lt;a href=&quot;#cb8-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb8-24&quot;&gt;&lt;a href=&quot;#cb8-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-25&quot;&gt;&lt;a href=&quot;#cb8-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Columns of the data frame where the questions are located&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-26&quot;&gt;&lt;a href=&quot;#cb8-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;question_col_idx &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;ncol&lt;/span&gt;(persons))[&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb8-27&quot;&gt;&lt;a href=&quot;#cb8-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;e &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(question_col_idx, best_split, &lt;span class=&quot;at&quot;&gt;Rm=&lt;/span&gt;persons) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;arrange&lt;/span&gt;(Q)&lt;/span&gt;
&lt;span id=&quot;cb8-28&quot;&gt;&lt;a href=&quot;#cb8-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt;(e)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 × 3
##   name                                 split     Q
##   &amp;lt;chr&amp;gt;                                &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt;
## 1 have blonde hair?                    no     2.08
## 2 picture have something red in it?    yes    2.09
## 3 have a headgear?                     yes    2.15
## 4 wear a top with no or short sleeves? yes    2.15
## 5 have visible eyebrows?               yes    2.15
## 6 have blue eyes?                      yes    2.15&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If we are to build the tree only with one additional node we would
thus use the &lt;i&gt;Does the person have blonde hair?&lt;/i&gt; question and would
put the &lt;i&gt;no&lt;/i&gt; answers in one branch the &lt;i&gt;yes&lt;/i&gt; and
&lt;i&gt;unclear&lt;/i&gt; answers on the other branch.&lt;/p&gt;
&lt;p&gt;The same computations can be done with the
&lt;code&gt;rpart::rpart()&lt;/code&gt; function. We set the control parameters s.t.
the tree can consist only of one split (&lt;code&gt;maxdepth=1&lt;/code&gt;).
Furthermore, we lower the minimum number of observations one split can
produce in one branch from the default value of 20. Otherwise, with only
16 observations no split would be attempted.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tree_onesplit &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rpart&lt;/span&gt;(Person &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; ., &lt;span class=&quot;at&quot;&gt;data =&lt;/span&gt; persons, &lt;span class=&quot;at&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;class&amp;quot;&lt;/span&gt;,&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;               &lt;span class=&quot;at&quot;&gt;parms=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;split=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;information&amp;quot;&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;               &lt;span class=&quot;at&quot;&gt;control=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rpart.control&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;minsplit=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,  &lt;span class=&quot;at&quot;&gt;maxdepth=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb10-4&quot;&gt;&lt;a href=&quot;#cb10-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;rpart.plot&lt;/span&gt;(tree_onesplit, &lt;span class=&quot;at&quot;&gt;under=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;extra=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;box.palette=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;Blues&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2024-02-12-decisiontree/RPART_ONESPLIT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;The graph of the decision tree in each node contains the most likely
class. The number below the most likely class specifies the
misclassification rate from this choice. As all classes are initially
equally likely, choosing “Barnabé” at the root node (i.e. if it is not
possible to ask further question) is just the first alphabetical choice
- selecting any of the 15 other persons would have resulted in the same
misclassification error. Similarly, choosing “Barnabé” among those with
no blonde hair (somewhat confusingly this corresponds to the branch
labelled “yes” of the logical condition: &lt;i&gt;Does the person have blonde
hair = no&lt;/i&gt;) is again just for alphabetical reasons. Equally probable
classifications would have been Mounir, Dan, Barnabé, Casimir, Max, Bob,
Mathis and Mikis. This is also reflected by the misclassification rate
in that leaf node, which is 7/8.&lt;/p&gt;
&lt;p&gt;Assume now that we picked the blonde hair question and are ready to
add an additional sub-node to each of the two branches: Which question
should we choose in each case?&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;R_L &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; persons &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;have blonde hair?&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;no&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(question_col_idx, best_split, &lt;span class=&quot;at&quot;&gt;Rm=&lt;/span&gt;R_L) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_min&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;order_by=&lt;/span&gt;Q)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 × 3
##   name                              split     Q
##   &amp;lt;chr&amp;gt;                             &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt;
## 1 picture have something red in it? yes    1.39&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;R_R &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; persons &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;have blonde hair?&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;no&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(question_col_idx, best_split, &lt;span class=&quot;at&quot;&gt;Rm=&lt;/span&gt;R_R) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_min&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;order_by=&lt;/span&gt;Q)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 × 3
##   name                                split     Q
##   &amp;lt;chr&amp;gt;                               &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt;
## 1 picture have something green in it? yes    1.39&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In other words, for the branch where
&lt;code&gt;have blonde hair? == &quot;no&quot;&lt;/code&gt; we ask, whether the person’s
picture has something red in it, whereas we for those with blonde or
unclear hair color ask, if there is something green in the person’s
picture. Again, we can reproduce this directly using
&lt;code&gt;rpart::rpart()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tree_twosplit &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rpart&lt;/span&gt;(Person &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; ., &lt;span class=&quot;at&quot;&gt;data =&lt;/span&gt; persons, &lt;span class=&quot;at&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;class&amp;quot;&lt;/span&gt;,&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;               &lt;span class=&quot;at&quot;&gt;parms=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;split=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;information&amp;quot;&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;               &lt;span class=&quot;at&quot;&gt;control=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rpart.control&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;minsplit=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;maxdepth=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2024-02-12-decisiontree/RPART_TWOSPLIT_PLOT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;As before, the selected person at each node is again a purely
alphabetical choice, e.g. at the leftmost leaf node (Bob) equally
probable choices would have been Dan, Casimir, Max and Bob. The above
classification tree is of course still not perfect with
misclassification rates of 3/4 at each leaf node. In the main section of
the blog post we compute a more elaborate decision tree with a depth of
4 having zero misclassification rate at each leaf node.&lt;/p&gt;
</description>
        <pubDate>Mon, 12 Feb 2024 00:00:00 +0100</pubDate>
        <link>https://mhoehle.github.io/blog/2024/02/12/decisiontree.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2024/02/12/decisiontree.html</guid>
        
        <category>rstats</category>
        
        <category>python</category>
        
        <category>reinforcement learning</category>
        
        <category>game theory</category>
        
        
      </item>
    
      <item>
        <title>Dynamic Programming for Super Six</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We use dynamic programming to find the optimal strategy for playing
Super Six when there are 2 players. To test the cross-language
capabilities of Rmarkdown we solve the task by embedding our Python
implementation of the value iteration algorithm using the reticulate
R-package.&lt;/p&gt;
&lt;center&gt;
&lt;img
src=&quot;/blog/figure/source/2023-03-20-dynprog/optim_strategy-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/mhoehle/hoehleatsu.github.io/master/_source/2023-03-20-dynprog.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The present post finds the optimal game strategy for playing the dice
game of Super Six with two players by using dynamic programming to solve
the corresponding Markov Decision Process (MDP). We use the
&lt;code&gt;reticulate&lt;/code&gt; R package to run our Python implementation of
the value iteration algorithm within the Rmarkdown document.&lt;/p&gt;
&lt;p&gt;For more details about Super Six, see the previous Blog post &lt;a
href=&quot;https://mhoehle.github.io/blog/2023/03/13/super6.html&quot;&gt;&lt;em&gt;How to
Win a Game (or More) of Super Six&lt;/em&gt;&lt;/a&gt;. Appendix 1 of the post
discussed optimal strategies. The present post is a natural successor of
this post, because it shows the details of calculating optimal
strategies for two player games by value iteration &lt;span
class=&quot;citation&quot; data-cites=&quot;russell_norvig2020&quot;&gt;Sutton and Barto
(2020)&lt;/span&gt;. This provides a clearer way to get to the strategy than,
e.g., &lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn (2021)&lt;/span&gt; or
the C++ program by &lt;a
href=&quot;https://github.com/mhoehle/mhoehle.github.io/blob/main/blog/figure/source/2023-03-13-super6/hultberg2.cpp&quot;&gt;Nuno
Hulthberg&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;notation&quot;&gt;Notation&lt;/h2&gt;
&lt;p&gt;In mathematical notation the current state &lt;span
class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; corresponds to the &lt;span
class=&quot;math inline&quot;&gt;\(i/j/k\)&lt;/span&gt; situation, with &lt;span
class=&quot;math inline&quot;&gt;\(0\leq i\leq 5\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\(j\geq 0\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(k\geq 0\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;In order to distinguish between the first turn of a player in a round
(where the dice has to be thrown) and the subsequent turns, where the
player can decide whether to throw the dice or stop, we add a fourth
component &lt;span class=&quot;math inline&quot;&gt;\(l\in \{0,1\}\)&lt;/span&gt; to the
state, which is a binary indicator whether the move is a forced moved
(1) or not (0). The action space for a state &lt;span
class=&quot;math inline&quot;&gt;\(i/j/k/l\)&lt;/span&gt; with &lt;span
class=&quot;math inline&quot;&gt;\(l=1\)&lt;/span&gt; is &lt;span
class=&quot;math inline&quot;&gt;\(\mathcal{A}(s) = \{\texttt{throw}\}\)&lt;/span&gt;,
whereas for &lt;span class=&quot;math inline&quot;&gt;\(l=0\)&lt;/span&gt; it is &lt;span
class=&quot;math inline&quot;&gt;\(\mathcal{A}(s) =
\{\texttt{throw},\texttt{stop}\}\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;If &lt;span class=&quot;math inline&quot;&gt;\(j=0\)&lt;/span&gt; while &lt;span
class=&quot;math inline&quot;&gt;\(k&amp;gt;0\)&lt;/span&gt; then Player 1 won. If &lt;span
class=&quot;math inline&quot;&gt;\(k=0\)&lt;/span&gt; while &lt;span
class=&quot;math inline&quot;&gt;\(i&amp;gt;0\)&lt;/span&gt; then Player 2 won. In order to
handle this &lt;em&gt;episodic task&lt;/em&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;sutton_burto2020&quot;&gt;(Sutton and Barto 2020)&lt;/span&gt; we
introduce an terminal state, which provides no additional future
reward.&lt;/p&gt;
&lt;h3 id=&quot;state-transition&quot;&gt;State Transition&lt;/h3&gt;
&lt;p&gt;The state transition probabilities of the Markov decision process are
given as follows. For each throw of the dice from an &lt;span
class=&quot;math inline&quot;&gt;\(i/j/k/l\)&lt;/span&gt; state there are three cases to
consider when throwing the dice:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;you roll a six (probability &lt;span
class=&quot;math inline&quot;&gt;\(\frac{1}{6}\)&lt;/span&gt;) and move to the &lt;span
class=&quot;math inline&quot;&gt;\(i/(j-1)/k/0\)&lt;/span&gt; state&lt;/li&gt;
&lt;li&gt;(if &lt;span class=&quot;math inline&quot;&gt;\(0\leq i&amp;lt; 5\)&lt;/span&gt;) you hit a
free spot (probability &lt;span
class=&quot;math inline&quot;&gt;\(\frac{5-i}{6}\)&lt;/span&gt;) and move to the &lt;span
class=&quot;math inline&quot;&gt;\((i+1)/j/k/0\)&lt;/span&gt; state&lt;/li&gt;
&lt;li&gt;(if &lt;span class=&quot;math inline&quot;&gt;\(0&amp;lt;i\leq 5\)&lt;/span&gt;) you hit an
already occupied spot (probability &lt;span
class=&quot;math inline&quot;&gt;\(\frac{i}{6}\)&lt;/span&gt;) and it is your opponents
turn to play from an &lt;span
class=&quot;math inline&quot;&gt;\((i-1)/k/(j+1)/1\)&lt;/span&gt; position&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you decide to stop throwing (only possible if &lt;span
class=&quot;math inline&quot;&gt;\(l=0\)&lt;/span&gt;) then it is the opponent’s turn to
play from an &lt;span class=&quot;math inline&quot;&gt;\(i/k/j/1\)&lt;/span&gt; position.&lt;/p&gt;
&lt;p&gt;As part of the calculations one needs to know what happens if Player
1 looses their turn (i.e. either by hitting an occupied spot or by
voluntarily deciding to stop) This depends on the strategy played by
Player 2. For simplicity we will assume that Player 2 plays the same
optimal strategy as Player 1. This also means that rewards in this
situation are just minus the rewards obtained from the corresponding
position.&lt;/p&gt;
&lt;h3 id=&quot;reward&quot;&gt;Reward&lt;/h3&gt;
&lt;p&gt;Eventually, the game will finish. Let &lt;span
class=&quot;math inline&quot;&gt;\(R(s,a,s&amp;#39;)\)&lt;/span&gt; be the reward function,
where action &lt;span class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt; moves the decision
maker from state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; to &lt;span
class=&quot;math inline&quot;&gt;\(s&amp;#39;\)&lt;/span&gt;. In our problem, the reward will
only depend on &lt;span class=&quot;math inline&quot;&gt;\(s&amp;#39;\)&lt;/span&gt;. We have
&lt;span class=&quot;math display&quot;&gt;\[
R(s&amp;#39;=(i,j,k,l)) = \left\{
\begin{array}{cl}
1 &amp;amp; \text{if $j=0$ and $k&amp;gt;0$} \\
-1 &amp;amp; \text{if $k=0$ and $j&amp;gt;0$} \\
0 &amp;amp; \text{otherwise}
\end{array}
\right.
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Side note: Since linear transformations of the reward function leave
the optimal strategy unchanged &lt;span class=&quot;citation&quot;
data-cites=&quot;russell_norvig2020&quot;&gt;(Sect. 17.1.3, Russell and Norvig
2020)&lt;/span&gt;, it is equally possible to work with rewards &lt;span
class=&quot;math inline&quot;&gt;\(R^*(s&amp;#39;=(i,j,k,l)) =
\frac{1}{2}R(s&amp;#39;=(i,j,k,l)) + \frac{1}{2}\)&lt;/span&gt;. This would imply
values 1 for winning and 0 for loosing and translates directly the
expected reward computations into computing expected probabilities for
winning, which is what &lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn
(2021)&lt;/span&gt; computed.&lt;/p&gt;
&lt;h3 id=&quot;bellman-equations&quot;&gt;Bellman equations&lt;/h3&gt;
&lt;p&gt;The expected utility obtained from following stragy &lt;span
class=&quot;math inline&quot;&gt;\(\pi\)&lt;/span&gt; is defined as &lt;span
class=&quot;math display&quot;&gt;\[
U^{\pi}(s) = E\left[ \sum_{t=0}^\infty R(S_t, \pi(S_t), S_{t+1})\right]
\]&lt;/span&gt; The terminal state with future reward 0 ensures that &lt;span
class=&quot;math inline&quot;&gt;\(U^\pi(s)&amp;lt;\infty\)&lt;/span&gt;. No discounting of the
rewards is thus used in our approach. Our aim is now to find a strategy
&lt;span class=&quot;math inline&quot;&gt;\(\pi^*(s)\)&lt;/span&gt;, which optimizes this
expected utility, i.e. &lt;span class=&quot;math display&quot;&gt;\[
\pi_s^* = \operatorname{argmax}_{\pi} U^{\pi}(s)
\]&lt;/span&gt; For state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; we thus
choose the action that maximizes the reward for the next step plus the
expected utility of the subsequent states: &lt;span class=&quot;math display&quot;&gt;\[
\pi^*(s) = \operatorname{argmax}_{a\in \mathcal{A}(s)}
\sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[ R(s,a,s&amp;#39;) +  \max_{a&amp;#39;}
U(s&amp;#39;) \right]
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This expressions for a state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt;
is also called the &lt;strong&gt;Bellman equation&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[\begin{align*}
U(s)
&amp;amp;=\max_{a\in \mathcal{A}(s)} \sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[
R(s,a,s&amp;#39;) + U(s&amp;#39;)
\right]
\end{align*}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Hence, for a state &lt;span class=&quot;math inline&quot;&gt;\(i/j/k/0\)&lt;/span&gt; the
action “continue” leads to to the following expansion of the sum term in
the above equation:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
\begin{align*}
&amp;amp; \underbrace{\frac{1}{6} [R(i/j-1/k/0) +
U(i/j-1/k/0)]}_{\text{stick into hole}} \\
&amp;amp;+ \underbrace{\frac{5-i}{6} [R(i+1/j-1/k/0)
+  U(i+1/j-1/k/0)]}_{\text{put stick into lid}}\\
&amp;amp;- \underbrace{\frac{i}{6} [R(i-1/k/j+1/1)
+  U(i-1/k/j+1/1)]}_{\text{take stick from lid}}
\end{align*}
\]&lt;/span&gt; and the action to stop has value &lt;span
class=&quot;math inline&quot;&gt;\(R(i-1/k/j+1/1) +  U(i-1/k/j+1/1)\)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;value-iteration&quot;&gt;Value Iteration&lt;/h2&gt;
&lt;p&gt;We use &lt;strong&gt;value iteration&lt;/strong&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;russell_norvig2020&quot;&gt;(Sect. 17.2.1, Russell and Norvig
2020)&lt;/span&gt;, &lt;span class=&quot;citation&quot; data-cites=&quot;sutton_burto2020&quot;&gt;(Sect
4.4, Sutton and Barto 2020)&lt;/span&gt; to solve the MDP. Let &lt;span
class=&quot;math inline&quot;&gt;\(U(s)\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(U&amp;#39;\)&lt;/span&gt; be collections, which contain the
value function for each &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; in the
state space. We initialize &lt;span
class=&quot;math inline&quot;&gt;\(U(s)=U&amp;#39;(s)=0\)&lt;/span&gt; for all states and
proceed by the following algorithm:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;Algorithm 1&lt;/strong&gt;: Value iteration&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;repeat&lt;/strong&gt;&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(U \gets U&amp;#39;; \delta \gets
0\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;For all&lt;/strong&gt; states &lt;span
class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; &lt;strong&gt;do&lt;/strong&gt;
&lt;ol type=&quot;a&quot;&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(U&amp;#39;(s) \gets \max_{a\in
\mathcal{A}(s)} \sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[ R(s,a,s&amp;#39;) +
U(s&amp;#39;) \right]\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;if&lt;/strong&gt; &lt;span class=&quot;math inline&quot;&gt;\(|U(s&amp;#39;)-U(s)|
&amp;gt; \delta\)&lt;/span&gt; &lt;strong&gt;then&lt;/strong&gt; &lt;span
class=&quot;math inline&quot;&gt;\(\delta \gets |U(s&amp;#39;)-U(s)|\)&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;until&lt;/strong&gt; &lt;span class=&quot;math inline&quot;&gt;\(\delta \leq
\epsilon\)&lt;/span&gt;;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;
&lt;p&gt;The optimal action for state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt;
is thus the action maximing the sum term in Step 2a, i.e. &lt;span
class=&quot;math inline&quot;&gt;\(\pi(s) = \operatorname{argmax}_{a\in
\mathcal{A}(s)} \sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[ R(s,a,s&amp;#39;)
+  \max_{a&amp;#39;} U(s&amp;#39;) \right]\)&lt;/span&gt;. Either one computes this at
the end of the algorithm or one adds this book-keeping step as part of
step 2a in the value iteration algorithm. Technically, &lt;span
class=&quot;math inline&quot;&gt;\(\pi\approx \pi^*\)&lt;/span&gt;, i.e. we only obtain an
estimate of the optimal strategy, because of the iterative nature of the
algorithm. However, one can show that with sufficient iterations we
converge towards &lt;span class=&quot;math inline&quot;&gt;\(\pi^*\)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;results&quot;&gt;Results&lt;/h2&gt;
&lt;p&gt;Applying the value iteration Python code for &lt;span
class=&quot;math inline&quot;&gt;\(n=7\)&lt;/span&gt; (see code in the Appendix) gives the
optimal strategy. Furthermore, we also obtain the probabilities to win
from each state. We show the result for all states with at least 3
sticks in the lid. With less than 3 sticks the decision is always to
continue throwing.&lt;/p&gt;
&lt;p&gt;In the output, the column &lt;code&gt;strategy&lt;/code&gt; shows whether to
continue throwing the dice (&lt;code&gt;TRUE&lt;/code&gt;) or not
(&lt;code&gt;FALSE&lt;/code&gt;); the column &lt;code&gt;value&lt;/code&gt; shows the expected
value &lt;span class=&quot;math inline&quot;&gt;\(U(s)\)&lt;/span&gt; and &lt;code&gt;prob&lt;/code&gt;
shows the expected probability to win the game given that the opponent
also follows the same optimal strategy. Note that for states with &lt;span
class=&quot;math inline&quot;&gt;\(l=1\)&lt;/span&gt;, no choice is possible, i.e. one has
to continue no matter what. For these states the strategy column is
always &lt;code&gt;TRUE&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;##    i j k l       value strategy      prob
## 1  5 1 1 1 -0.09741652     TRUE 0.4512917
## 2  5 1 1 0  0.09741652    FALSE 0.5487083
## 3  4 2 1 1 -0.36297663     TRUE 0.3185117
## 4  4 2 1 0 -0.31689982    FALSE 0.3415501
## 5  4 1 2 1  0.31689982     TRUE 0.6584499
## 6  4 1 2 0  0.36297663    FALSE 0.6814883
## 7  4 1 1 1  0.04845936     TRUE 0.5242297
## 8  4 1 1 0  0.04845936     TRUE 0.5242297
## 9  3 3 1 1 -0.52748432     TRUE 0.2362578
## 10 3 3 1 0 -0.52748432     TRUE 0.2362578
## 11 3 2 2 1  0.02465027     TRUE 0.5123251
## 12 3 2 2 0  0.02465027     TRUE 0.5123251
## 13 3 2 1 1 -0.27737920     TRUE 0.3613104
## 14 3 2 1 0 -0.27737920     TRUE 0.3613104
## 15 3 1 3 1  0.58093392     TRUE 0.7904670
## 16 3 1 3 0  0.58093392     TRUE 0.7904670
## 17 3 1 2 1  0.42731097     TRUE 0.7136555
## 18 3 1 2 0  0.42731097     TRUE 0.7136555
## 19 3 1 1 1  0.22509739     TRUE 0.6125487
## 20 3 1 1 0  0.22509739     TRUE 0.6125487&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;One can, e.g., compare the results with the numbers in Fig. 4 of
&lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn (2021)&lt;/span&gt;. The
optimal strategy for a two player game is thus to continue as long as
only three pits are filled. If four slots are filled, one would only
continue, if the situation is 4/1/1. If 5 pits are filled, one should
always stop (if possible). The figure below illustrates the strategy for
all &lt;span class=&quot;math inline&quot;&gt;\(l=0\)&lt;/span&gt; states graphically: the
y-axis gives &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt;, whereas the label
of each box is &lt;span class=&quot;math inline&quot;&gt;\(j/k\)&lt;/span&gt; followed by the
expected probability (with just 2 decimals) to win from this state:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2023-03-20-dynprog/optim_strategy-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h3 id=&quot;probability-to-win-as-start-player&quot;&gt;Probability to Win as
Start-Player&lt;/h3&gt;
&lt;p&gt;One surprising finding from the simulations in &lt;a
href=&quot;https://mhoehle.github.io/blog/2023/03/13/super6.html&quot;&gt;How to Win
a Game (or More) of Super Six&lt;/a&gt; was that the start player had a big
winning advantage. We use the above algorithm to analytically calculate
the probability that the starting players wins the game in a situation
where each player initially has 4 sticks.&lt;/p&gt;
&lt;p&gt;To compute the winning probability we need to keep in mind that in
round 1 we have the additional restriction that only one throw of the
dice is allowed for each player. As a consequence, we need to treat the
outcome of round 1 separately. There are four possible states that
Player 1 starts from in round 2:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Both players throw a 6 (&lt;span
class=&quot;math inline&quot;&gt;\(p=\frac{1}{36}\)&lt;/span&gt;) in round 1; round 2
continues from state &lt;span class=&quot;math inline&quot;&gt;\(0/3/3/1\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;One of the players (but not both!) throws a six (&lt;span
class=&quot;math inline&quot;&gt;\(p=\frac{10}{36}\)&lt;/span&gt;), round 2 continues from
state &lt;span class=&quot;math inline&quot;&gt;\(1/3/3/1\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Both sticks from round 1 end up in the lid (&lt;span
class=&quot;math inline&quot;&gt;\(p=\frac{5}{6}\frac{4}{6}=\frac{20}{36}\)&lt;/span&gt;);
round 2 continues from state &lt;span
class=&quot;math inline&quot;&gt;\(2/3/3/1\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Player 1 throws anything but a 6 and Player 2 throws the same (&lt;span
class=&quot;math inline&quot;&gt;\(p=\frac{5}{6}\frac{1}{6}=\frac{5}{36}\)&lt;/span&gt;);
round 2 continues from state &lt;span
class=&quot;math inline&quot;&gt;\(0/3/5/1\)&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We can thus calculate the probability to win as start player in a
4-stick game (assuming both players follow the optimal winning strategy)
as&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
\frac{1}{36} p_{\text{win}}^{\pi^*}(0/3/3/1) + \frac{10}{36}
p_{\text{win}}^{\pi^*}(1/3/3/1) + \frac{20}{36}
p_{\text{win}}^{\pi^*}(2/3/3/1) + \frac{5}{36}
p_{\text{win}}^{\pi^*}(0/3/5/1).
\]&lt;/span&gt; We compute this in R with reticulate calls to the Python
function calculating the winning probability for a given state:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# States and their probabilities after round 1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;round2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;at&quot;&gt;state =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;), &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;), &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;), &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;)),&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;at&quot;&gt;prob =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;36&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Compute the probability to win from round 2 on for a given state&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;p_win &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(s) {&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  py&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;optimal_strategy&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.integer&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(s))) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;             &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;( i &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; s[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt;  j &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; s[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;] &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt;  &lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                     k &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; s[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;] &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt;  l &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; s[&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;]) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;             &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(prob)&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;} &lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-15&quot;&gt;&lt;a href=&quot;#cb2-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Compute winning probabilities for each state and do the weighted&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-16&quot;&gt;&lt;a href=&quot;#cb2-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# sum to get the overall probability to win as start player&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-17&quot;&gt;&lt;a href=&quot;#cb2-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(res &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; round2 &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-18&quot;&gt;&lt;a href=&quot;#cb2-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-19&quot;&gt;&lt;a href=&quot;#cb2-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_win =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;p_win&lt;/span&gt;(state)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-20&quot;&gt;&lt;a href=&quot;#cb2-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;ungroup&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-21&quot;&gt;&lt;a href=&quot;#cb2-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;#unnest_wider(col=state, names_sep=&amp;quot;.&amp;quot;) %&amp;gt;% &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-22&quot;&gt;&lt;a href=&quot;#cb2-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_win =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(prob&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;p_win)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 × 1
##   p_win
##   &amp;lt;dbl&amp;gt;
## 1 0.602&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This corroborates the previous finding that the start player has a
60% probability to win the game when both players play the optimal
strategy.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Dynamic programming is an important foundation for reinforcement
learning. We can use it to find optimal strategies in fully observable
stochastic environments. For environments with reasonable sized state
spaces and with a known stochastic model for the transitions between
states, dynamic programming is a direct method to get exact solutions.
No complex approximate solutions, as e.g. discussed in Part 2 of &lt;span
class=&quot;citation&quot; data-cites=&quot;sutton_burto2020&quot;&gt;Sutton and Barto
(2020)&lt;/span&gt;, are needed.&lt;/p&gt;
&lt;h2 id=&quot;appendix-python-code&quot;&gt;Appendix: Python code&lt;/h2&gt;
&lt;p&gt;The Python code for value iteration can be found as &lt;a
href=&quot;/blog/figure/source/2023-03-20-dynprog/value_iteration.py&quot;&gt;&lt;code&gt;value_iteration.py&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre
class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Python implementation of value iteration to find the optimal strategy in Super Six  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Author: Michael Höhle&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Date:   2023-03-16&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Semi-manual translation of the R code in value_iteration.R to python with the &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# help of OpenAI&amp;#39;s text-davinci-003 API playground feature https://platform.openai.com/playground/p/default-text-to-command?model=text-davinci-003.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-9&quot;&gt;&lt;a href=&quot;#cb4-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; np&lt;/span&gt;
&lt;span id=&quot;cb4-10&quot;&gt;&lt;a href=&quot;#cb4-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; pandas &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; pd&lt;/span&gt;
&lt;span id=&quot;cb4-11&quot;&gt;&lt;a href=&quot;#cb4-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-12&quot;&gt;&lt;a href=&quot;#cb4-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; make_situations(n):&lt;/span&gt;
&lt;span id=&quot;cb4-13&quot;&gt;&lt;a href=&quot;#cb4-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;Returns all situations in a game with n sticks left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-14&quot;&gt;&lt;a href=&quot;#cb4-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-15&quot;&gt;&lt;a href=&quot;#cb4-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-16&quot;&gt;&lt;a href=&quot;#cb4-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-17&quot;&gt;&lt;a href=&quot;#cb4-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    n : int&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-18&quot;&gt;&lt;a href=&quot;#cb4-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The number of sticks left in the game&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-19&quot;&gt;&lt;a href=&quot;#cb4-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-20&quot;&gt;&lt;a href=&quot;#cb4-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-21&quot;&gt;&lt;a href=&quot;#cb4-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-22&quot;&gt;&lt;a href=&quot;#cb4-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-23&quot;&gt;&lt;a href=&quot;#cb4-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        a list of with entries [i,j,k] &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-24&quot;&gt;&lt;a href=&quot;#cb4-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-25&quot;&gt;&lt;a href=&quot;#cb4-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb4-26&quot;&gt;&lt;a href=&quot;#cb4-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Number of sticks in the lid&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-27&quot;&gt;&lt;a href=&quot;#cb4-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;min&lt;/span&gt;(n,&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;),&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-28&quot;&gt;&lt;a href=&quot;#cb4-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Number of sticks of player 1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-29&quot;&gt;&lt;a href=&quot;#cb4-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(n,&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-30&quot;&gt;&lt;a href=&quot;#cb4-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Number of sticks of player 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-31&quot;&gt;&lt;a href=&quot;#cb4-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            k &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; n &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; i &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; j&lt;/span&gt;
&lt;span id=&quot;cb4-32&quot;&gt;&lt;a href=&quot;#cb4-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Only add valid states&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-33&quot;&gt;&lt;a href=&quot;#cb4-33&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (i&lt;span class=&quot;op&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; (j&lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;or&lt;/span&gt; k&lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)):&lt;/span&gt;
&lt;span id=&quot;cb4-34&quot;&gt;&lt;a href=&quot;#cb4-34&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                &lt;span class=&quot;co&quot;&gt;# Append the state as an array [i,j,k]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-35&quot;&gt;&lt;a href=&quot;#cb4-35&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                res.append([i,j,k])&lt;/span&gt;
&lt;span id=&quot;cb4-36&quot;&gt;&lt;a href=&quot;#cb4-36&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb4-37&quot;&gt;&lt;a href=&quot;#cb4-37&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-38&quot;&gt;&lt;a href=&quot;#cb4-38&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-39&quot;&gt;&lt;a href=&quot;#cb4-39&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; make_states(n):&lt;/span&gt;
&lt;span id=&quot;cb4-40&quot;&gt;&lt;a href=&quot;#cb4-40&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;All states when there are n sticks in the game left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-41&quot;&gt;&lt;a href=&quot;#cb4-41&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-42&quot;&gt;&lt;a href=&quot;#cb4-42&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    We distinguish between states with a choice if to throw the dice and those without&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-43&quot;&gt;&lt;a href=&quot;#cb4-43&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-44&quot;&gt;&lt;a href=&quot;#cb4-44&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-45&quot;&gt;&lt;a href=&quot;#cb4-45&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-46&quot;&gt;&lt;a href=&quot;#cb4-46&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    n : int&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-47&quot;&gt;&lt;a href=&quot;#cb4-47&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The number of sticks left in the game&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-48&quot;&gt;&lt;a href=&quot;#cb4-48&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-49&quot;&gt;&lt;a href=&quot;#cb4-49&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-50&quot;&gt;&lt;a href=&quot;#cb4-50&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-51&quot;&gt;&lt;a href=&quot;#cb4-51&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-52&quot;&gt;&lt;a href=&quot;#cb4-52&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        a list of with entries [i,j,k] &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-53&quot;&gt;&lt;a href=&quot;#cb4-53&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;   &lt;/span&gt;
&lt;span id=&quot;cb4-54&quot;&gt;&lt;a href=&quot;#cb4-54&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    states &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb4-55&quot;&gt;&lt;a href=&quot;#cb4-55&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,n&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-56&quot;&gt;&lt;a href=&quot;#cb4-56&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        s &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; make_situations(i)&lt;/span&gt;
&lt;span id=&quot;cb4-57&quot;&gt;&lt;a href=&quot;#cb4-57&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Make list comprehension which adds a fourth component indicating if the move is forced (0=no, 1=yes)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-58&quot;&gt;&lt;a href=&quot;#cb4-58&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-59&quot;&gt;&lt;a href=&quot;#cb4-59&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            states.extend([x &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; [j] &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; x &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; s])&lt;/span&gt;
&lt;span id=&quot;cb4-60&quot;&gt;&lt;a href=&quot;#cb4-60&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Sort the list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-61&quot;&gt;&lt;a href=&quot;#cb4-61&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    states.sort(reverse&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-62&quot;&gt;&lt;a href=&quot;#cb4-62&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(states)&lt;/span&gt;
&lt;span id=&quot;cb4-63&quot;&gt;&lt;a href=&quot;#cb4-63&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-64&quot;&gt;&lt;a href=&quot;#cb4-64&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; swap(state, forced_move &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-65&quot;&gt;&lt;a href=&quot;#cb4-65&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-66&quot;&gt;&lt;a href=&quot;#cb4-66&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Swap the number of sticks of player 1 and 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-67&quot;&gt;&lt;a href=&quot;#cb4-67&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-68&quot;&gt;&lt;a href=&quot;#cb4-68&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-69&quot;&gt;&lt;a href=&quot;#cb4-69&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-70&quot;&gt;&lt;a href=&quot;#cb4-70&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    state : vector of length 4&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-71&quot;&gt;&lt;a href=&quot;#cb4-71&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The state of the game as a vector with 4 components&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-72&quot;&gt;&lt;a href=&quot;#cb4-72&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-73&quot;&gt;&lt;a href=&quot;#cb4-73&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    forced_move : bool&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-74&quot;&gt;&lt;a href=&quot;#cb4-74&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        If the move is forced (i.e. the player has to swap the sticks)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-75&quot;&gt;&lt;a href=&quot;#cb4-75&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-76&quot;&gt;&lt;a href=&quot;#cb4-76&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-77&quot;&gt;&lt;a href=&quot;#cb4-77&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-78&quot;&gt;&lt;a href=&quot;#cb4-78&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The new state as a vector of length 4&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-79&quot;&gt;&lt;a href=&quot;#cb4-79&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-80&quot;&gt;&lt;a href=&quot;#cb4-80&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [state[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], state[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;], state[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;], state[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;]]&lt;/span&gt;
&lt;span id=&quot;cb4-81&quot;&gt;&lt;a href=&quot;#cb4-81&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (forced_move &lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-82&quot;&gt;&lt;a href=&quot;#cb4-82&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        res[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; forced_move&lt;/span&gt;
&lt;span id=&quot;cb4-83&quot;&gt;&lt;a href=&quot;#cb4-83&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb4-84&quot;&gt;&lt;a href=&quot;#cb4-84&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-85&quot;&gt;&lt;a href=&quot;#cb4-85&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; add_state(state, Delta, forced_move &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-86&quot;&gt;&lt;a href=&quot;#cb4-86&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;bu&quot;&gt;sum&lt;/span&gt;(x) &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; x &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;zip&lt;/span&gt;(state, Delta)]&lt;/span&gt;
&lt;span id=&quot;cb4-87&quot;&gt;&lt;a href=&quot;#cb4-87&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (forced_move &lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-88&quot;&gt;&lt;a href=&quot;#cb4-88&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        res[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; forced_move&lt;/span&gt;
&lt;span id=&quot;cb4-89&quot;&gt;&lt;a href=&quot;#cb4-89&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb4-90&quot;&gt;&lt;a href=&quot;#cb4-90&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-91&quot;&gt;&lt;a href=&quot;#cb4-91&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-92&quot;&gt;&lt;a href=&quot;#cb4-92&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; R(state):&lt;/span&gt;
&lt;span id=&quot;cb4-93&quot;&gt;&lt;a href=&quot;#cb4-93&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;The immediate reward function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-94&quot;&gt;&lt;a href=&quot;#cb4-94&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-95&quot;&gt;&lt;a href=&quot;#cb4-95&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-96&quot;&gt;&lt;a href=&quot;#cb4-96&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-97&quot;&gt;&lt;a href=&quot;#cb4-97&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    state : list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-98&quot;&gt;&lt;a href=&quot;#cb4-98&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The state of the game as a vector with 4 components&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-99&quot;&gt;&lt;a href=&quot;#cb4-99&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-100&quot;&gt;&lt;a href=&quot;#cb4-100&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-101&quot;&gt;&lt;a href=&quot;#cb4-101&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-102&quot;&gt;&lt;a href=&quot;#cb4-102&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    double The reward R(state), i.e. 1 if player 1 wins, -1 if player 2 wins, 0 otherwise&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-103&quot;&gt;&lt;a href=&quot;#cb4-103&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-104&quot;&gt;&lt;a href=&quot;#cb4-104&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-105&quot;&gt;&lt;a href=&quot;#cb4-105&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# A terminal state (player 1 = 0)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-106&quot;&gt;&lt;a href=&quot;#cb4-106&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; state[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb4-107&quot;&gt;&lt;a href=&quot;#cb4-107&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-108&quot;&gt;&lt;a href=&quot;#cb4-108&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# A terminal state (player 2 = 0)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-109&quot;&gt;&lt;a href=&quot;#cb4-109&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; state[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb4-110&quot;&gt;&lt;a href=&quot;#cb4-110&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-111&quot;&gt;&lt;a href=&quot;#cb4-111&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Other state (nothing)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-112&quot;&gt;&lt;a href=&quot;#cb4-112&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-113&quot;&gt;&lt;a href=&quot;#cb4-113&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-114&quot;&gt;&lt;a href=&quot;#cb4-114&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; optimal_strategy(n, debug&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-115&quot;&gt;&lt;a href=&quot;#cb4-115&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&amp;quot;Find the optimal strategy for a game with n sticks left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-116&quot;&gt;&lt;a href=&quot;#cb4-116&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-117&quot;&gt;&lt;a href=&quot;#cb4-117&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-118&quot;&gt;&lt;a href=&quot;#cb4-118&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Define local variables for the function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-119&quot;&gt;&lt;a href=&quot;#cb4-119&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    states &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; make_states(n)&lt;/span&gt;
&lt;span id=&quot;cb4-120&quot;&gt;&lt;a href=&quot;#cb4-120&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_states &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;len&lt;/span&gt;(states)&lt;/span&gt;
&lt;span id=&quot;cb4-121&quot;&gt;&lt;a href=&quot;#cb4-121&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;## Storage of the value function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-122&quot;&gt;&lt;a href=&quot;#cb4-122&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    U_vec &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.zeros(n_states)&lt;/span&gt;
&lt;span id=&quot;cb4-123&quot;&gt;&lt;a href=&quot;#cb4-123&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    U_vec_prime &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.zeros(n_states)&lt;/span&gt;
&lt;span id=&quot;cb4-124&quot;&gt;&lt;a href=&quot;#cb4-124&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;## Storage of the policy/strategy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-125&quot;&gt;&lt;a href=&quot;#cb4-125&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    pi &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.full(n_states, np.nan)&lt;/span&gt;
&lt;span id=&quot;cb4-126&quot;&gt;&lt;a href=&quot;#cb4-126&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-127&quot;&gt;&lt;a href=&quot;#cb4-127&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Future reward function.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-128&quot;&gt;&lt;a href=&quot;#cb4-128&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Note terminating states (i=0 or j=0) have zero future reward.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-129&quot;&gt;&lt;a href=&quot;#cb4-129&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# The function uses a local variable states and the value function uvec. Might want to add this to the arguments&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-130&quot;&gt;&lt;a href=&quot;#cb4-130&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; U(state):&lt;/span&gt;
&lt;span id=&quot;cb4-131&quot;&gt;&lt;a href=&quot;#cb4-131&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Terminal state (no future returns)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-132&quot;&gt;&lt;a href=&quot;#cb4-132&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (state[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-133&quot;&gt;&lt;a href=&quot;#cb4-133&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-134&quot;&gt;&lt;a href=&quot;#cb4-134&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (state[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-135&quot;&gt;&lt;a href=&quot;#cb4-135&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-136&quot;&gt;&lt;a href=&quot;#cb4-136&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Find index of the element matching in states vector&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-137&quot;&gt;&lt;a href=&quot;#cb4-137&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        idx &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; states.index(state)&lt;/span&gt;
&lt;span id=&quot;cb4-138&quot;&gt;&lt;a href=&quot;#cb4-138&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Return value function of the state&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-139&quot;&gt;&lt;a href=&quot;#cb4-139&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; U_vec[idx]&lt;/span&gt;
&lt;span id=&quot;cb4-140&quot;&gt;&lt;a href=&quot;#cb4-140&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-141&quot;&gt;&lt;a href=&quot;#cb4-141&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;## Loop controls&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-142&quot;&gt;&lt;a href=&quot;#cb4-142&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    stop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-143&quot;&gt;&lt;a href=&quot;#cb4-143&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    epsilon &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fl&quot;&gt;1e-10&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-144&quot;&gt;&lt;a href=&quot;#cb4-144&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;bu&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-145&quot;&gt;&lt;a href=&quot;#cb4-145&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-146&quot;&gt;&lt;a href=&quot;#cb4-146&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Value iteration &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-147&quot;&gt;&lt;a href=&quot;#cb4-147&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;while&lt;/span&gt; (stop &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-148&quot;&gt;&lt;a href=&quot;#cb4-148&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;bu&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-149&quot;&gt;&lt;a href=&quot;#cb4-149&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        Delta &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-150&quot;&gt;&lt;a href=&quot;#cb4-150&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; idx &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(n_states):&lt;/span&gt;
&lt;span id=&quot;cb4-151&quot;&gt;&lt;a href=&quot;#cb4-151&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Translate to integer configuration&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-152&quot;&gt;&lt;a href=&quot;#cb4-152&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; states[idx]&lt;/span&gt;
&lt;span id=&quot;cb4-153&quot;&gt;&lt;a href=&quot;#cb4-153&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-154&quot;&gt;&lt;a href=&quot;#cb4-154&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# The 4 possible moves&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-155&quot;&gt;&lt;a href=&quot;#cb4-155&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-156&quot;&gt;&lt;a href=&quot;#cb4-156&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Do vector addition of the variable state and [0, -1, 0, 0]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-157&quot;&gt;&lt;a href=&quot;#cb4-157&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_six &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; add_state(state,  [&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-158&quot;&gt;&lt;a href=&quot;#cb4-158&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_free &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; add_state(state, [&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;)       &lt;/span&gt;
&lt;span id=&quot;cb4-159&quot;&gt;&lt;a href=&quot;#cb4-159&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_occupied &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; swap(add_state(state, [&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb4-160&quot;&gt;&lt;a href=&quot;#cb4-160&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_swap     &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; swap(state, forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;)                 &lt;/span&gt;
&lt;span id=&quot;cb4-161&quot;&gt;&lt;a href=&quot;#cb4-161&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;/span&gt;
&lt;span id=&quot;cb4-162&quot;&gt;&lt;a href=&quot;#cb4-162&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Number of sticks in the lid&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-163&quot;&gt;&lt;a href=&quot;#cb4-163&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            i &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; state[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb4-164&quot;&gt;&lt;a href=&quot;#cb4-164&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-165&quot;&gt;&lt;a href=&quot;#cb4-165&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;#Q(s, continue)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-166&quot;&gt;&lt;a href=&quot;#cb4-166&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            qs_continue &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; (&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;  &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; (R(state_six)  &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;  U(state_six))) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-167&quot;&gt;&lt;a href=&quot;#cb4-167&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        ((&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;i)&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; (R(state_free) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;  U(state_free)) &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-168&quot;&gt;&lt;a href=&quot;#cb4-168&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        (i&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;     &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; (R(state_occupied) &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; U(state_occupied)) &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-169&quot;&gt;&lt;a href=&quot;#cb4-169&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-170&quot;&gt;&lt;a href=&quot;#cb4-170&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;#Q(s, stop)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-171&quot;&gt;&lt;a href=&quot;#cb4-171&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            qs_stop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;(R(state_swap) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; U(state_swap))&lt;/span&gt;
&lt;span id=&quot;cb4-172&quot;&gt;&lt;a href=&quot;#cb4-172&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-173&quot;&gt;&lt;a href=&quot;#cb4-173&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Updated value &amp;amp; strategy if there is a choice.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-174&quot;&gt;&lt;a href=&quot;#cb4-174&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (state[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;]&lt;span class=&quot;op&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb4-175&quot;&gt;&lt;a href=&quot;#cb4-175&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                U_vec_prime[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;max&lt;/span&gt;(qs_continue, qs_stop)&lt;/span&gt;
&lt;span id=&quot;cb4-176&quot;&gt;&lt;a href=&quot;#cb4-176&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                pi[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; qs_continue &lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; qs_stop&lt;/span&gt;
&lt;span id=&quot;cb4-177&quot;&gt;&lt;a href=&quot;#cb4-177&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt;: &lt;span class=&quot;co&quot;&gt;#no choice&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-178&quot;&gt;&lt;a href=&quot;#cb4-178&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                U_vec_prime[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; qs_continue&lt;/span&gt;
&lt;span id=&quot;cb4-179&quot;&gt;&lt;a href=&quot;#cb4-179&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                pi[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-180&quot;&gt;&lt;a href=&quot;#cb4-180&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-181&quot;&gt;&lt;a href=&quot;#cb4-181&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Discrepancy  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-182&quot;&gt;&lt;a href=&quot;#cb4-182&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            Delta &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;max&lt;/span&gt;(Delta, &lt;span class=&quot;bu&quot;&gt;abs&lt;/span&gt;(U_vec[idx] &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; U_vec_prime[idx]))&lt;/span&gt;
&lt;span id=&quot;cb4-183&quot;&gt;&lt;a href=&quot;#cb4-183&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-184&quot;&gt;&lt;a href=&quot;#cb4-184&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Update the value function by copying the new values&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-185&quot;&gt;&lt;a href=&quot;#cb4-185&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Note: In NumPy, using &amp;quot;=&amp;quot; would only make a reference to the new vector&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-186&quot;&gt;&lt;a href=&quot;#cb4-186&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# See https://www.geeksforgeeks.org/array-copying-in-python/&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-187&quot;&gt;&lt;a href=&quot;#cb4-187&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        U_vec &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; U_vec_prime.copy()&lt;/span&gt;
&lt;span id=&quot;cb4-188&quot;&gt;&lt;a href=&quot;#cb4-188&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-189&quot;&gt;&lt;a href=&quot;#cb4-189&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Continue the value iteration?  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-190&quot;&gt;&lt;a href=&quot;#cb4-190&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (debug):&lt;/span&gt;
&lt;span id=&quot;cb4-191&quot;&gt;&lt;a href=&quot;#cb4-191&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;iter = &amp;quot;&lt;/span&gt;, &lt;span class=&quot;bu&quot;&gt;iter&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;, Delta =&amp;quot;&lt;/span&gt;, Delta)  &lt;/span&gt;
&lt;span id=&quot;cb4-192&quot;&gt;&lt;a href=&quot;#cb4-192&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        stop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; (Delta &lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt; epsilon)&lt;/span&gt;
&lt;span id=&quot;cb4-193&quot;&gt;&lt;a href=&quot;#cb4-193&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-194&quot;&gt;&lt;a href=&quot;#cb4-194&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Make a tibble containing the strategy  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-195&quot;&gt;&lt;a href=&quot;#cb4-195&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame({&lt;span class=&quot;st&quot;&gt;&amp;#39;state&amp;#39;&lt;/span&gt;: states, &lt;span class=&quot;st&quot;&gt;&amp;#39;value&amp;#39;&lt;/span&gt;: U_vec, &lt;span class=&quot;st&quot;&gt;&amp;#39;strategy&amp;#39;&lt;/span&gt;: pi, &lt;span class=&quot;st&quot;&gt;&amp;#39;prob&amp;#39;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;U_vec&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;})  &lt;/span&gt;
&lt;span id=&quot;cb4-196&quot;&gt;&lt;a href=&quot;#cb4-196&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Split state column into 4 separate columns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-197&quot;&gt;&lt;a href=&quot;#cb4-197&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy[[&lt;span class=&quot;st&quot;&gt;&amp;#39;i&amp;#39;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;#39;j&amp;#39;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;#39;k&amp;#39;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;]] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame(strategy.state.tolist(), index&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy.index) &lt;/span&gt;
&lt;span id=&quot;cb4-198&quot;&gt;&lt;a href=&quot;#cb4-198&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Drop the state column&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-199&quot;&gt;&lt;a href=&quot;#cb4-199&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy.drop(columns&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;state&amp;#39;&lt;/span&gt;])&lt;/span&gt;
&lt;span id=&quot;cb4-200&quot;&gt;&lt;a href=&quot;#cb4-200&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Convert strategy to boolean&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-201&quot;&gt;&lt;a href=&quot;#cb4-201&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy[&lt;span class=&quot;st&quot;&gt;&amp;#39;strategy&amp;#39;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy[&lt;span class=&quot;st&quot;&gt;&amp;#39;strategy&amp;#39;&lt;/span&gt;].astype(&lt;span class=&quot;bu&quot;&gt;bool&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-202&quot;&gt;&lt;a href=&quot;#cb4-202&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Change the order such that the i,j,k,forced_move columns are shown first&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-203&quot;&gt;&lt;a href=&quot;#cb4-203&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    cols &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy.columns.tolist()&lt;/span&gt;
&lt;span id=&quot;cb4-204&quot;&gt;&lt;a href=&quot;#cb4-204&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    cols &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; cols[&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;:] &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; cols[:&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb4-205&quot;&gt;&lt;a href=&quot;#cb4-205&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy[cols]&lt;/span&gt;
&lt;span id=&quot;cb4-206&quot;&gt;&lt;a href=&quot;#cb4-206&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-207&quot;&gt;&lt;a href=&quot;#cb4-207&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(strategy)&lt;/span&gt;
&lt;span id=&quot;cb4-208&quot;&gt;&lt;a href=&quot;#cb4-208&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-209&quot;&gt;&lt;a href=&quot;#cb4-209&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-210&quot;&gt;&lt;a href=&quot;#cb4-210&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#Test function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-211&quot;&gt;&lt;a href=&quot;#cb4-211&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#make_situations(6)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-212&quot;&gt;&lt;a href=&quot;#cb4-212&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-213&quot;&gt;&lt;a href=&quot;#cb4-213&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Find optimal strategy for game with 6 sticks left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-214&quot;&gt;&lt;a href=&quot;#cb4-214&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;s_best &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; optimal_strategy(&lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-215&quot;&gt;&lt;a href=&quot;#cb4-215&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Print full strategy without row number, https://stackoverflow.com/questions/52396477/printing-a-pandas-dataframe-without-row-number-index&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-216&quot;&gt;&lt;a href=&quot;#cb4-216&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# pd.set_option(&amp;#39;display.max_rows&amp;#39;, None)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-217&quot;&gt;&lt;a href=&quot;#cb4-217&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# print(s_best.to_string(index=False))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-jehn2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Jehn, Rüdiger. 2021. &lt;span&gt;“Optimum Strategies for the Game Super
Six.”&lt;/span&gt; arXiv. &lt;a
href=&quot;https://doi.org/10.48550/ARXIV.2109.10700&quot;&gt;https://doi.org/10.48550/ARXIV.2109.10700&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-russell_norvig2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Russell, S. J., and P. Norvig. 2020. &lt;em&gt;Artificial Intelligence: A
Modern Approach&lt;/em&gt;. Pearson Series in Artificial Intelligence.
Pearson.
&lt;/div&gt;
&lt;div id=&quot;ref-sutton_burto2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Sutton, Richard S., and Andrew G. Barto. 2020. &lt;em&gt;Reinforcement
Learning - an Introduction&lt;/em&gt;. 2nd ed. The MIT Press.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 20 Mar 2023 00:00:00 +0100</pubDate>
        <link>https://mhoehle.github.io/blog/2023/03/20/dynprog.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2023/03/20/dynprog.html</guid>
        
        <category>rstats</category>
        
        <category>python</category>
        
        <category>dynamic programming</category>
        
        <category>reinforcement learning</category>
        
        <category>game theory</category>
        
        
      </item>
    
      <item>
        <title>How to Win a Game (or More) of Super Six</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We use simulation to analyse the family dicing game “Super Six”. In
particular we show that the person starting the game has a very high
chance of winning the game. Furthermore, a robust strategy to play
during the game is to keep throwing the dice regardless of the number of
free pits. In a mixed strategy landscape with more than two players this
seems to do better than a strategy extrapolated from the analytically
derived optimal strategy for the two player case.&lt;/p&gt;
&lt;center&gt;
&lt;img
src=&quot;/blog/figure/source/2023-03-13-super6/plot_favor_factor-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2023-03-13-super6.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://de-m-wikipedia-org.translate.goog/wiki/Super_Six_(Spiel)?_x_tr_sl=auto&amp;amp;_x_tr_tl=en&amp;amp;_x_tr_hl=de&amp;amp;_x_tr_pto=wapp&quot;&gt;&lt;strong&gt;Super
Six&lt;/strong&gt;&lt;/a&gt; is a dice game which can be played at all ages. It
consists of a container where the lid has 5 pits (labelled 1-5) and one
hole (labelled 6). Furthermore, each player gets a predetermined number
of sticks and a dice (see Fig.1). If a stick is put into pit 6 (the
hole) it falls into container and stays there.&lt;/p&gt;
&lt;center&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/figure/source/2023-03-13-super6/super6.jpg&quot;
alt=&quot;Figure 1: A snapshot of a Super 6 game with 2 players, who both initially started with 4 sticks.&quot; /&gt;
&lt;figcaption aria-hidden=&quot;true&quot;&gt;Figure 1: A snapshot of a Super 6 game
with 2 players, who both initially started with 4 sticks.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/center&gt;
&lt;p&gt;The rules of the games are as follows: The sticks are distributed
among the players so that each player has exactly the same number of
sticks (say: 4). Each player throws the dice in turn going round in
clockwise direction. If a player throws a number and the corresponding
pit is empty, then he/she can insert one of his/her sticks into it. If
the pit is already occupied, however, then he/she must take the stick
and and add it to his/her own pile of sticks. The number 6 is a “lucky
throw”. With a 6, one can always place a stick into the hole labelled
No. 6 and it stays there. &lt;strong&gt;Note:&lt;/strong&gt; &lt;em&gt;During the first
round, each player is only allowed to throw the dice once. From the
second round on, each player can throw the dice as often as desired,
provided that one always managed to hit an empty pit. As soon as one
throws the number of an occupied pit, one must take the stick that is
located there and it is then the next players turn. Each player most
throw the dice at least once per round, but after the first throw he/she
can decide to stop throwing at any time in that round (that is also
before hitting an occupied pit). Once a player has no sticks left, the
game is over and he/she is the winner.&lt;/em&gt; This &lt;a
href=&quot;https://www.youtube.com/watch?v=yrYybddqRQs&quot;&gt;YouTube&lt;/a&gt; video by
&lt;a href=&quot;https://www.researchgate.net/profile/Ruediger-Jehn&quot;&gt;Rüdiger
Jehn&lt;/a&gt; shows a exemplary game play of Super Six.&lt;/p&gt;
&lt;p&gt;Empirical experience from playing a lot of Super 6 with the kids
raises the question if the game is really fair: Does the player starting
the game have a winning advantage? Furthermore, interest is in the
optimal strategy to play: Should one always continue to throw the dice
until one hits an occupied pit or should one stop playing once there are
only &lt;span class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; out of the 5 pits free (with
&lt;span class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; being either 1 or 2)? In what
follows we shall use simulation to get an approximate answer to these
questions in a realistic environment with different players following
different strategies. For a two player situation analytic results exist
&lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;(Jehn 2021)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;simulating-super-6&quot;&gt;Simulating Super 6&lt;/h2&gt;
&lt;p&gt;The file &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/figure/source/2023-03-13-super6/super6.R&quot;&gt;&lt;code&gt;super6.R&lt;/code&gt;&lt;/a&gt;
contains a function &lt;code&gt;simulate_super6&lt;/code&gt; with arguments
&lt;code&gt;players_strategy&lt;/code&gt; and &lt;code&gt;sticks&lt;/code&gt; to simulate a game
of Super 6 for &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;=&lt;code&gt;length(players_strategy)&lt;/code&gt;
players each initially having &lt;code&gt;sticks&lt;/code&gt; number of sticks. The
named list &lt;code&gt;players_strategy&lt;/code&gt; contains each player’s strategy
as a &lt;code&gt;tibble&lt;/code&gt;, mapping the number of free pits
(i.e. 0,1,2,3,4,5) to a probability to continue throwing the dice. If
this probability is either 0 or 1 then we have a deterministic strategy.
As an example the &lt;code&gt;always&lt;/code&gt; strategy describes a behaviour
where one keeps throwing the dice independent of the number of free
pits:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(always &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,   &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 × 2
##   filled_holes continue_prob
##          &amp;lt;int&amp;gt;         &amp;lt;dbl&amp;gt;
## 1            0             1
## 2            1             1
## 3            2             1
## 4            3             1
## 5            4             1
## 6            5             1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As an example: To simulate a single game of Super 6 with three
players, A, B and C, each playing the “always” strategy with initially 4
sticks we call&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;h &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;simulate_super6&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;A=&lt;/span&gt;always, &lt;span class=&quot;at&quot;&gt;B=&lt;/span&gt;always, &lt;span class=&quot;at&quot;&gt;C=&lt;/span&gt;always), &lt;span class=&quot;at&quot;&gt;sticks=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The resulting trajectory of state and actions of the game are
returned by the function:&lt;/p&gt;
&lt;p&gt;
&lt;table class=&quot;table table-striped&quot; style=&quot;font-size: 14px; margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;4&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Gameplay
&lt;/div&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;6&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Pit Status
&lt;/div&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;3&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Player Status
&lt;/div&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;1&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Game Status
&lt;/div&gt;
&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
round
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
player
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
turn
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
dice
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.1
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.2
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.3
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.4
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.5
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.6
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
sticks.A
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
sticks.B
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
sticks.C
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
decision
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
C
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
stop turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
A
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
stop turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
stop turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
C
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
lost turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
A
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
continue turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
A
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
lost turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
5
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
continue turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
continue turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
game over
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;Note that in the above game the player to start is randomly selected.
The players then each take turns in the pre-determined order. The order
of the rows in the table corresponds to the sequence of actions in the
game. The column &lt;code&gt;turn&lt;/code&gt; is a counter indicating how many
times the player has thrown the dice during his/her round. The columns
&lt;code&gt;hole.1&lt;/code&gt;-&lt;code&gt;hole.5&lt;/code&gt; are binary indicators whether
the respective pit is currently filled with a stick (FALSE=0, TRUE=1).
Finally, a column counts for each player the current number of remaining
sticks (initially equal to 4). The last column, &lt;code&gt;decision&lt;/code&gt;
contains information about the player’s action and its consequences.
Here, “stop turn” is a forced decision in round 1, because each player
can only throw the dice once in round 1. Furthermore, “lost turn”
indicates the situation that the pit indicated by the dice throw was
already occupied and “continue turn” means that the player based on
his/her strategy decided to throw again. Finally, “game over” means that
one player reduced their number of sticks to zero and the game thus
ends. The winner of the shown game shown is B.&lt;/p&gt;
&lt;h2 id=&quot;analysis&quot;&gt;Analysis&lt;/h2&gt;
&lt;p&gt;We can use the above simulation function to analyse different
strategies for games with 4 initial sticks. Consider the four additional
strategies:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;go50 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,   &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;(filled_holes&lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;go67 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,   &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;(filled_holes&lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;random &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;random2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;,&lt;span class=&quot;fl&quot;&gt;0.25&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s assume that Agneta is playing the &lt;code&gt;always&lt;/code&gt; strategy
and that Bertil, Cecilia, Dagmar and Emil each are playing one of the
four other strategies.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;player_list &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;Agneta=&lt;/span&gt; always,&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Birger=&lt;/span&gt; go50,&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Carin=&lt;/span&gt;  go67,&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Dagmar=&lt;/span&gt; random,&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Emil=&lt;/span&gt;   random2)&lt;/span&gt;
&lt;span id=&quot;cb5-6&quot;&gt;&lt;a href=&quot;#cb5-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;player_names &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;names&lt;/span&gt;(player_list)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We now consider all possible matches of these players. This can be
games ranging from just 2 of the players to all 5 of them.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_players &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(player_names)&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;matches &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(n_players, &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(m) {&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  utils&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;combn&lt;/span&gt;(player_names, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m, &lt;span class=&quot;at&quot;&gt;simplify=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(n_players)&lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_combos &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(matches, length)&lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_combos &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;unlist&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##  2  3  4  5 
## 10 10  5  1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To ensure that the we consider an equal amount of games for every
number of players, we simulate &lt;code&gt;n_games&lt;/code&gt; games for each
number of players (2-5). The games to play are then distributed equal
among the different pairings with that number of players. For this
reason, &lt;code&gt;n_games&lt;/code&gt; has to be divisible by 5 and 10.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_games &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Parallelize analysis using the future-verse&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;plan&lt;/span&gt;(multisession, &lt;span class=&quot;at&quot;&gt;workers =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb8-5&quot;&gt;&lt;a href=&quot;#cb8-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-6&quot;&gt;&lt;a href=&quot;#cb8-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Play the games&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-7&quot;&gt;&lt;a href=&quot;#cb8-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;all_games &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;future_map2&lt;/span&gt;(matches, n_combos,  &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(names, combos) {&lt;/span&gt;
&lt;span id=&quot;cb8-8&quot;&gt;&lt;a href=&quot;#cb8-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(names, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; {&lt;/span&gt;
&lt;span id=&quot;cb8-9&quot;&gt;&lt;a href=&quot;#cb8-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    the_players_strategy &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; player_list[.x]&lt;/span&gt;
&lt;span id=&quot;cb8-10&quot;&gt;&lt;a href=&quot;#cb8-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Divide the n_games equal among the possible combinations&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-11&quot;&gt;&lt;a href=&quot;#cb8-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_games_each_combo &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; n_games &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; combos&lt;/span&gt;
&lt;span id=&quot;cb8-12&quot;&gt;&lt;a href=&quot;#cb8-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n_games_each_combo), &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-13&quot;&gt;&lt;a href=&quot;#cb8-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;fu&quot;&gt;simulate_super6&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;players_strategy=&lt;/span&gt;the_players_strategy, &lt;span class=&quot;at&quot;&gt;sticks=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb8-14&quot;&gt;&lt;a href=&quot;#cb8-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    )&lt;/span&gt;
&lt;span id=&quot;cb8-15&quot;&gt;&lt;a href=&quot;#cb8-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  }) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(names, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(.x, &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;-&amp;quot;&lt;/span&gt;)))&lt;/span&gt;
&lt;span id=&quot;cb8-16&quot;&gt;&lt;a href=&quot;#cb8-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}, &lt;span class=&quot;at&quot;&gt;.options=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;furrr_options&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;seed=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This provides a nested list structure, where the top-most level
contains the number of players of the game, the 2nd level contains the
name of the participating players and the 3rd level the recordings of
every game played of the respective player combination (organised as a
tibble). The recordings/history of each game is organised as a data
frame with columns closely related to the above game description. As an
example, a total of&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;all_games[[&lt;span class=&quot;st&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;]][[&lt;span class=&quot;st&quot;&gt;&amp;quot;Agneta-Birger-Carin&amp;quot;&lt;/span&gt;]] &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1000&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;games (=10000/10) are played between the players Agneta, Birger and
Carin.&lt;/p&gt;
&lt;p&gt;We now use this nested list structure of simulated games to answer
our questions of interest. The traversing of the list is done by purrr.
As an example we determine the total number of games as follows:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(n_total_games &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(all_games, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(.x, length)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;unlist&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 40000&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;beginner-is-winner&quot;&gt;Beginner is Winner?&lt;/h3&gt;
&lt;p&gt;We now investigate the probability to win the starting player. Let
&lt;code&gt;h&lt;/code&gt; denote the tibble describing the history of a game (such
as shown above). We will write a function, which given the history of a
game returns the player name who won the game.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;winner &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(h) {&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  h &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_tail&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(player)&lt;/span&gt;
&lt;span id=&quot;cb13-3&quot;&gt;&lt;a href=&quot;#cb13-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb13-4&quot;&gt;&lt;a href=&quot;#cb13-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-5&quot;&gt;&lt;a href=&quot;#cb13-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Test the function on the above shown trajectory&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-6&quot;&gt;&lt;a href=&quot;#cb13-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;winner&lt;/span&gt;(h)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;B&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can use the function to determine the probability that the player
starting the game also becomes the winner of the game. To take into
account a possible dependence on the number of players we shall stratify
our analysis by the number of players in the game.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;games_summary &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map2_df&lt;/span&gt;(all_games, n_players, &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(games, players) {&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(games, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(.x, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n_players=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(players), &lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        &lt;span class=&quot;at&quot;&gt;beginner=&lt;/span&gt;.x &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_head&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(player),&lt;/span&gt;
&lt;span id=&quot;cb15-4&quot;&gt;&lt;a href=&quot;#cb15-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                          &lt;span class=&quot;at&quot;&gt;winner=&lt;/span&gt;.x &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_tail&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(player))))&lt;/span&gt;
&lt;span id=&quot;cb15-5&quot;&gt;&lt;a href=&quot;#cb15-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;})&lt;/span&gt;
&lt;span id=&quot;cb15-6&quot;&gt;&lt;a href=&quot;#cb15-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-7&quot;&gt;&lt;a href=&quot;#cb15-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tab &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; games_summary &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(n_players) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-8&quot;&gt;&lt;a href=&quot;#cb15-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_initial_winner=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;mean&lt;/span&gt;(beginner&lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt;winner)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-9&quot;&gt;&lt;a href=&quot;#cb15-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_random =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;n_players,&lt;/span&gt;
&lt;span id=&quot;cb15-10&quot;&gt;&lt;a href=&quot;#cb15-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;at&quot;&gt;favor_factor =&lt;/span&gt; p_initial_winner &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; p_random) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
n_players
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
p_initial_winner
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
p_random
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
favor_factor
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.6009
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.5000000
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.2018
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.4438
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.3333333
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.3314
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.3527
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.2500000
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.4108
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
5
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.2970
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.2000000
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.4850
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2023-03-13-super6/plot_favor_factor-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;The empirical probability that the initial player wins is always
higher than the probability &lt;span class=&quot;math inline&quot;&gt;\(1/n\)&lt;/span&gt;
that one of the &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; players in the
game wins at random. The larger the number of players the bigger the
relative advantage of beginning seems. Note that our analysis averages
over the all strategies so it also contains start players using an
otherwise sub-optimal playing strategy. This might bias the analysis
slightly, but a small sensitivity analysis letting all 5 players play
the &lt;code&gt;always&lt;/code&gt; strategy, showed that results did not change
substantially.&lt;/p&gt;
&lt;h3 id=&quot;best-strategy&quot;&gt;Best strategy&lt;/h3&gt;
&lt;p&gt;We can now compute for each player (i.e. strategy) the number of wins
out of the 40000 games:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb16&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb16-1&quot;&gt;&lt;a href=&quot;#cb16-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(league_table &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(all_games, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(.x, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(.x, winner))) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb16-2&quot;&gt;&lt;a href=&quot;#cb16-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;unlist&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb16-3&quot;&gt;&lt;a href=&quot;#cb16-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;as_tibble&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-4&quot;&gt;&lt;a href=&quot;#cb16-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rename&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;player =&lt;/span&gt; value) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-5&quot;&gt;&lt;a href=&quot;#cb16-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(player) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-6&quot;&gt;&lt;a href=&quot;#cb16-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;wins=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;n&lt;/span&gt;()) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-7&quot;&gt;&lt;a href=&quot;#cb16-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;arrange&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;desc&lt;/span&gt;(wins)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5 × 2
##   player  wins
##   &amp;lt;chr&amp;gt;  &amp;lt;int&amp;gt;
## 1 Birger  8800
## 2 Carin   8593
## 3 Emil    8520
## 4 Agneta  8419
## 5 Dagmar  5668&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This shows that the &lt;code&gt;always&lt;/code&gt; strategy appears to do best
among those strategies investigated. It is no surprise that the worst
strategy is the purely random strategy &lt;code&gt;random&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We analysed aspects of how to win a game (or more) of Super Six.
Important factors for winning in a multi-player mixed strategy landscape
are&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;To start the game&lt;/li&gt;
&lt;li&gt;To keep throwing the dice&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A little surprising is that the best strategy (among those
investigated) is to keep throwing the dice regardless of the number of
free pits. The optimal strategy may in part depend on how the other
players play, but our conclusions appear sufficiently robust, because
the simulation study investigated a mixed strategy player field with two
to five players. A limitation of our analysis is that we only considered
games where each player initially holds 4 sticks.&lt;/p&gt;
&lt;p&gt;It is worth pointing out that the best strategy we found is not
optimal. As an example, &lt;span class=&quot;citation&quot;
data-cites=&quot;jehn2021&quot;&gt;Jehn (2021)&lt;/span&gt; analytically finds the optimal
strategy for the &lt;span class=&quot;math inline&quot;&gt;\(n=2\)&lt;/span&gt; player
situation. It depends on the number of sticks left in the game and the
number of sticks each player has. In most cases the strategy stops if
more than 3 pits are occupied – see Appendix 1 for details. This
dependence on the other player’s hand is likely to carry forward to the
&lt;span class=&quot;math inline&quot;&gt;\(n&amp;gt;2\)&lt;/span&gt; player situation. However,
analytic results for &lt;span class=&quot;math inline&quot;&gt;\(n&amp;gt;2\)&lt;/span&gt; will be
extremely difficult to obtain, but it makes intuitive sense to be more
aggressive when there are more players, because there are more
contestants for the win.&lt;/p&gt;
&lt;p&gt;Did the game developers realize that the start player has such a high
probability of winning the game? It seems advisable to accompany game
development by simulations and mathematical calculations at the design
stage. In practice, one should randomize the start player to enhance
fairness.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Final note&lt;/strong&gt;: This will be the last post of &lt;em&gt;Theory
Meets Practice&lt;/em&gt; Blog in its current form. As of Jan 2023 I am
working as full professor in Statistics and Data Science at the &lt;a
href=&quot;https://math-inf.uni-greifswald.de/en/michael-hoehle/&quot;&gt;University
of Greifswald&lt;/a&gt;, Germany. For both technical and time reasons a new
setup is thus needed.&lt;/p&gt;
&lt;h2 id=&quot;appendix-1&quot;&gt;Appendix 1&lt;/h2&gt;
&lt;p&gt;The work of &lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn
(2021)&lt;/span&gt; shows the derivation of the optimal strategies encoded in
&lt;a href=&quot;https://oeis.org/A345383&quot;&gt;A345383&lt;/a&gt; for a game with 2 players
and a situation where &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; pits
occupied, the first player (our player of interest) has &lt;span
class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; sticks in hand and the second player
has &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; sticks. This state is denoted
as &lt;span class=&quot;math inline&quot;&gt;\(i/j/k\)&lt;/span&gt;. For example &lt;span
class=&quot;math inline&quot;&gt;\(2/1/1\)&lt;/span&gt; denotes the situation where there
are 2 pits occupied in the lid and each player has one stick.&lt;/p&gt;
&lt;p&gt;A small helper function gives all states where a continue vs. stop
choice needs to be made. It is assumed that if there are no sticks in
the lid, we always continue:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Find all situations where a continue vs. stop choice is to be made&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-2&quot;&gt;&lt;a href=&quot;#cb18-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; for player 1.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-3&quot;&gt;&lt;a href=&quot;#cb18-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-4&quot;&gt;&lt;a href=&quot;#cb18-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; See Jehn (2021), https://arxiv.org/pdf/2109.10700.pdf, for details.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-5&quot;&gt;&lt;a href=&quot;#cb18-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-6&quot;&gt;&lt;a href=&quot;#cb18-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param n Total number of sticks currently (i+j+k)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-7&quot;&gt;&lt;a href=&quot;#cb18-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return A vector of strings describing the situations in i/j/k notation&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-8&quot;&gt;&lt;a href=&quot;#cb18-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; where i is the number of occupied pits in the lid, j is the number of&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-9&quot;&gt;&lt;a href=&quot;#cb18-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; sticks player 1 has and k is the number of sticks player 2 has. Note&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-10&quot;&gt;&lt;a href=&quot;#cb18-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; i+j+k = n&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-11&quot;&gt;&lt;a href=&quot;#cb18-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-12&quot;&gt;&lt;a href=&quot;#cb18-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;situations &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(n) {&lt;/span&gt;
&lt;span id=&quot;cb18-13&quot;&gt;&lt;a href=&quot;#cb18-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  res &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;NULL&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-14&quot;&gt;&lt;a href=&quot;#cb18-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Sticks in the Lid&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-15&quot;&gt;&lt;a href=&quot;#cb18-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; (i &lt;span class=&quot;cf&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(n,&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;)&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb18-16&quot;&gt;&lt;a href=&quot;#cb18-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Sticks Player 1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-17&quot;&gt;&lt;a href=&quot;#cb18-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; (j &lt;span class=&quot;cf&quot;&gt;in&lt;/span&gt; n&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb18-18&quot;&gt;&lt;a href=&quot;#cb18-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;co&quot;&gt;# Sticks Player 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-19&quot;&gt;&lt;a href=&quot;#cb18-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      k &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; n &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; i &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; j&lt;/span&gt;
&lt;span id=&quot;cb18-20&quot;&gt;&lt;a href=&quot;#cb18-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;co&quot;&gt;# Don&amp;#39;t consider impossible situations or situations without a choice&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-21&quot;&gt;&lt;a href=&quot;#cb18-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (k&lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;!&lt;/span&gt;(i&lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt; j&lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt;k)) {&lt;/span&gt;
&lt;span id=&quot;cb18-22&quot;&gt;&lt;a href=&quot;#cb18-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        res &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;append&lt;/span&gt;(res, &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(i,j,k), &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb18-23&quot;&gt;&lt;a href=&quot;#cb18-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      }&lt;/span&gt;
&lt;span id=&quot;cb18-24&quot;&gt;&lt;a href=&quot;#cb18-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    }&lt;/span&gt;
&lt;span id=&quot;cb18-25&quot;&gt;&lt;a href=&quot;#cb18-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  }&lt;/span&gt;
&lt;span id=&quot;cb18-26&quot;&gt;&lt;a href=&quot;#cb18-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb18-27&quot;&gt;&lt;a href=&quot;#cb18-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb18-28&quot;&gt;&lt;a href=&quot;#cb18-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-29&quot;&gt;&lt;a href=&quot;#cb18-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# All situations when there are 7 sticks left in the game&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-30&quot;&gt;&lt;a href=&quot;#cb18-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;situations&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;5/1/1&amp;quot; &amp;quot;4/2/1&amp;quot; &amp;quot;4/1/2&amp;quot; &amp;quot;3/3/1&amp;quot; &amp;quot;3/2/2&amp;quot; &amp;quot;3/1/3&amp;quot; &amp;quot;2/4/1&amp;quot; &amp;quot;2/3/2&amp;quot; &amp;quot;2/2/3&amp;quot; &amp;quot;2/1/4&amp;quot; &amp;quot;1/5/1&amp;quot; &amp;quot;1/4/2&amp;quot; &amp;quot;1/3/3&amp;quot; &amp;quot;1/2/4&amp;quot; &amp;quot;1/1/5&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The optimal strategy is encoded in binary and converted to base 10 in
the sequence &lt;a href=&quot;https://oeis.org/A345383&quot;&gt;A345383&lt;/a&gt;. We write a
small R extractor to display the optimal strategy in more readable
form:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb20&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb20-1&quot;&gt;&lt;a href=&quot;#cb20-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Handle the large integers using the GMP library&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-2&quot;&gt;&lt;a href=&quot;#cb20-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;suppressPackageStartupMessages&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(gmp))&lt;/span&gt;
&lt;span id=&quot;cb20-3&quot;&gt;&lt;a href=&quot;#cb20-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-4&quot;&gt;&lt;a href=&quot;#cb20-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Encodes [A345383](https://oeis.org/A345383)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-5&quot;&gt;&lt;a href=&quot;#cb20-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-6&quot;&gt;&lt;a href=&quot;#cb20-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param n Number of sticks&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-7&quot;&gt;&lt;a href=&quot;#cb20-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @returns a(n) from A345383&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-8&quot;&gt;&lt;a href=&quot;#cb20-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-9&quot;&gt;&lt;a href=&quot;#cb20-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;a &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(n) {&lt;/span&gt;
&lt;span id=&quot;cb20-10&quot;&gt;&lt;a href=&quot;#cb20-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  a &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;63&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1023&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;32760&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1048544&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;33554304&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1073741312&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;34359736320&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1099511619584&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;35184370221056&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1125899873681408&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;36028796752101376&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb20-11&quot;&gt;&lt;a href=&quot;#cb20-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (n&lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt; n&lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;15&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(a[n]) &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;cn&quot;&gt;NA&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb20-12&quot;&gt;&lt;a href=&quot;#cb20-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb20-13&quot;&gt;&lt;a href=&quot;#cb20-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-14&quot;&gt;&lt;a href=&quot;#cb20-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Convert a strategy encoded as a 0/1 string to a vector of Booleans&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-15&quot;&gt;&lt;a href=&quot;#cb20-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param s The strategy as a string of 0 and 1&amp;#39;s&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-16&quot;&gt;&lt;a href=&quot;#cb20-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return As a vector&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-17&quot;&gt;&lt;a href=&quot;#cb20-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @examples&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-18&quot;&gt;&lt;a href=&quot;#cb20-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; int_strategy_to_vec(&amp;quot;0011&amp;quot;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-19&quot;&gt;&lt;a href=&quot;#cb20-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;int_strategy_to_vec &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(s) {&lt;/span&gt;
&lt;span id=&quot;cb20-20&quot;&gt;&lt;a href=&quot;#cb20-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;str_split_1&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.character&lt;/span&gt;(s, &lt;span class=&quot;at&quot;&gt;b=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;pattern=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.integer&lt;/span&gt;()&lt;/span&gt;
&lt;span id=&quot;cb20-21&quot;&gt;&lt;a href=&quot;#cb20-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb20-22&quot;&gt;&lt;a href=&quot;#cb20-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb20-23&quot;&gt;&lt;a href=&quot;#cb20-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Show the optimal stragegy for all situations with n sticks&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-24&quot;&gt;&lt;a href=&quot;#cb20-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;optimal_strategy &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(n) {&lt;/span&gt;
&lt;span id=&quot;cb20-25&quot;&gt;&lt;a href=&quot;#cb20-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Make a tibble representing the optimal strategy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-26&quot;&gt;&lt;a href=&quot;#cb20-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;situation=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;situations&lt;/span&gt;(n),&lt;/span&gt;
&lt;span id=&quot;cb20-27&quot;&gt;&lt;a href=&quot;#cb20-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;at&quot;&gt;continue =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rev&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;int_strategy_to_vec&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;a&lt;/span&gt;(n))))&lt;/span&gt;
&lt;span id=&quot;cb20-28&quot;&gt;&lt;a href=&quot;#cb20-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb20-29&quot;&gt;&lt;a href=&quot;#cb20-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-30&quot;&gt;&lt;a href=&quot;#cb20-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;optimal_strategy&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Inf&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 15 × 2
##    situation continue
##    &amp;lt;chr&amp;gt;        &amp;lt;int&amp;gt;
##  1 5/1/1            0
##  2 4/2/1            0
##  3 4/1/2            0
##  4 3/3/1            1
##  5 3/2/2            1
##  6 3/1/3            1
##  7 2/4/1            1
##  8 2/3/2            1
##  9 2/2/3            1
## 10 2/1/4            1
## 11 1/5/1            1
## 12 1/4/2            1
## 13 1/3/3            1
## 14 1/2/4            1
## 15 1/1/5            1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We observe that for situations with 7 sticks we continue to play as
long as only 1-3 pits are filled. If 4 or 5 pits are filled, we don’t
continue. However, in other settings with different number of sticks
left, the optimal strategy can be different. As an example, if there 6
sticks left, the optimal strategy is&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 × 2
##    situation continue
##    &amp;lt;chr&amp;gt;        &amp;lt;int&amp;gt;
##  1 4/1/1            1
##  2 3/2/1            1
##  3 3/1/2            1
##  4 2/3/1            1
##  5 2/2/2            1
##  6 2/1/3            1
##  7 1/4/1            1
##  8 1/3/2            1
##  9 1/2/3            1
## 10 1/1/4            1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which -opposite to the 7 sticks left situation- continues in the 4
pits filled situation, if each player has only one stick left
(4/1/1).&lt;/p&gt;
&lt;p&gt;Finally, we implement a function, which implements Jehn’s optimal
strategy in a way, which can be used by the simulation function
&lt;code&gt;simulate_super6()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb23&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb23-1&quot;&gt;&lt;a href=&quot;#cb23-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Jehn&amp;#39;s optimal strategy for two players&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-2&quot;&gt;&lt;a href=&quot;#cb23-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-3&quot;&gt;&lt;a href=&quot;#cb23-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param player_idx Index of the player in the state_players variable (see simulate_super6 function)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-4&quot;&gt;&lt;a href=&quot;#cb23-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param filled_holes Number of pits filled&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-5&quot;&gt;&lt;a href=&quot;#cb23-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param state_players Vector of length equal to the number of players containing the number of sticks each player has left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-6&quot;&gt;&lt;a href=&quot;#cb23-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return A numeric corresponding to the probability to continue&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-7&quot;&gt;&lt;a href=&quot;#cb23-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-8&quot;&gt;&lt;a href=&quot;#cb23-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;jehn &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(player_idx, filled_holes, state_players) {&lt;/span&gt;
&lt;span id=&quot;cb23-9&quot;&gt;&lt;a href=&quot;#cb23-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Some summaries&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-10&quot;&gt;&lt;a href=&quot;#cb23-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  sticks_left &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; filled_holes &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(state_players)&lt;/span&gt;
&lt;span id=&quot;cb23-11&quot;&gt;&lt;a href=&quot;#cb23-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  my_sticks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; state_players[player_idx]&lt;/span&gt;
&lt;span id=&quot;cb23-12&quot;&gt;&lt;a href=&quot;#cb23-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  other_sticks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; state_players[&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;player_idx]&lt;/span&gt;
&lt;span id=&quot;cb23-13&quot;&gt;&lt;a href=&quot;#cb23-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb23-14&quot;&gt;&lt;a href=&quot;#cb23-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;#Strategy for basic cases&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-15&quot;&gt;&lt;a href=&quot;#cb23-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (filled_holes &lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb23-16&quot;&gt;&lt;a href=&quot;#cb23-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (filled_holes &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb23-17&quot;&gt;&lt;a href=&quot;#cb23-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;#Complicated part of the strategy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-18&quot;&gt;&lt;a href=&quot;#cb23-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  s_best &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;optimal_strategy&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;sticks_left)&lt;/span&gt;
&lt;span id=&quot;cb23-19&quot;&gt;&lt;a href=&quot;#cb23-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  state &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(filled_holes, my_sticks, other_sticks, &lt;span class=&quot;at&quot;&gt;sep=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb23-20&quot;&gt;&lt;a href=&quot;#cb23-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  action &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; s_best &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(situation &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; state) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb23-21&quot;&gt;&lt;a href=&quot;#cb23-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(continue)&lt;/span&gt;
&lt;span id=&quot;cb23-22&quot;&gt;&lt;a href=&quot;#cb23-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-23&quot;&gt;&lt;a href=&quot;#cb23-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Check if output fails (this should not happen).  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-24&quot;&gt;&lt;a href=&quot;#cb23-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(action) &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) { &lt;span class=&quot;fu&quot;&gt;browser&lt;/span&gt;()}&lt;/span&gt;
&lt;span id=&quot;cb23-25&quot;&gt;&lt;a href=&quot;#cb23-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;sc&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;is.numeric&lt;/span&gt;(action)) { &lt;span class=&quot;fu&quot;&gt;browser&lt;/span&gt;()}&lt;/span&gt;
&lt;span id=&quot;cb23-26&quot;&gt;&lt;a href=&quot;#cb23-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb23-27&quot;&gt;&lt;a href=&quot;#cb23-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Done&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-28&quot;&gt;&lt;a href=&quot;#cb23-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(action)&lt;/span&gt;
&lt;span id=&quot;cb23-29&quot;&gt;&lt;a href=&quot;#cb23-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;} &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This allows us to test, if there is a winning advantage, despite both
players playing the optimal strategy (see &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2023-03-13-super6.Rmd&quot;&gt;source
code&lt;/a&gt; for details).&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 × 1
##   p_win_beginner
##            &amp;lt;dbl&amp;gt;
## 1          0.596&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The answer is thus: Yes! In 60% of the games the starting player
wins. Thus, the winning advantage of the beginner in the &lt;span
class=&quot;math inline&quot;&gt;\(n=2\)&lt;/span&gt; scenario remains even when both
players use the &lt;code&gt;jehn&lt;/code&gt; optimal winning strategy.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-jehn2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Jehn, Rüdiger. 2021. &lt;span&gt;“Optimum Strategies for the Game Super
Six.”&lt;/span&gt; arXiv. &lt;a
href=&quot;https://doi.org/10.48550/ARXIV.2109.10700&quot;&gt;https://doi.org/10.48550/ARXIV.2109.10700&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 13 Mar 2023 00:00:00 +0100</pubDate>
        <link>https://mhoehle.github.io/blog/2023/03/13/super6.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2023/03/13/super6.html</guid>
        
        <category>rstats</category>
        
        <category>stats</category>
        
        <category>simulation</category>
        
        <category>game theory</category>
        
        
      </item>
    
      <item>
        <title>Tupper&apos;s Self Referential Formula in R</title>
        <description>&lt;p&gt;&lt;!-- bibliography: /Users/hoehle/Literature/Bibtex/jabref.bib --&gt;&lt;/p&gt;
&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We implement Tupper’s self-referencing formula in R. This has been
done before by others, but the joy was to be able to learn how to do it
yourself using the tidyverse.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/plot_tupper-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2022-10-17-tupper.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://en.wikipedia.org/wiki/Tupper%27s_self-referential_formula%20#&quot;&gt;Tupper’s
self-referencial formula&lt;/a&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;tupper2001&quot;&gt;(Tupper 2001)&lt;/span&gt; is an equation which maps a
2D &lt;span class=&quot;math inline&quot;&gt;\((x,y)\)&lt;/span&gt; coordinate to an &lt;span
class=&quot;math inline&quot;&gt;\(\{\text{FALSE},\text{TRUE}\}\)&lt;/span&gt; value. If
&lt;span class=&quot;math inline&quot;&gt;\((x,y)\)&lt;/span&gt; represent pixel locations,
the output over a grid of values can thought of as a black &amp;amp; white
image where the true/false values are mapped to &lt;span
class=&quot;math inline&quot;&gt;\(\{0,1\}\)&lt;/span&gt; in the usual way. Tupper’s
formula is &lt;span class=&quot;math inline&quot;&gt;\(f(x,y) =\)&lt;/span&gt; &lt;span
class=&quot;math display&quot;&gt;\[
\frac{1}{2} &amp;lt; \left\lfloor \operatorname{mod}\left(
\left\lfloor\frac{y}{17}\right\rfloor\cdot 2^{-17\lfloor x \rfloor -
\operatorname{mod}(\lfloor y \rfloor, 17)}, 2\right)\right\rfloor.
\]&lt;/span&gt; We note that if one evaluates the function for all integers
&lt;span class=&quot;math inline&quot;&gt;\((x,y)\)&lt;/span&gt; for &lt;span
class=&quot;math inline&quot;&gt;\(0 \leq x \leq 105\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(k\leq y\leq k+16\)&lt;/span&gt;, where &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; is a fixed constant, then one gets a
binary image with 106x17 pixels. The entire magic of Tupper’s formula is
that it’s just unpacking an encoding of that 106x17 grid by representing
it as a 1802 long binary number which is then converted from base-2 into
base-10. For some (not so obvious) reason this number is then multiplied
by 17 to yield the final value of &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;
(in base-10)&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We also note that since the right-hand side of Tupper’s equation will
always be 0 or 1, the comparison with &lt;span
class=&quot;math inline&quot;&gt;\(\frac{1}{2}\)&lt;/span&gt; appears superfluous and seems
to be just a way to get a Boolean instead of a 0/1. Furthermore, since
we will be using only integer values for &lt;span
class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt;, the floor operators around &lt;span
class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt; are not really needed either.&lt;/p&gt;
&lt;h3 id=&quot;more-background&quot;&gt;More Background&lt;/h3&gt;
&lt;p&gt;Initially, I learned about the formula from a twitter post:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot;&gt;
&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
Tupper&apos;s self-referential formula is a formula that visually represents
itself when graphed at a specific location in the (x, y) plane.
&lt;a href=&quot;https://t.co/wAUVahJ9Dq&quot;&gt;pic.twitter.com/wAUVahJ9Dq&lt;/a&gt;
&lt;/p&gt;
— Fermat&apos;s Library (&lt;span class=&quot;citation&quot;
data-cites=&quot;fermatslibrary&quot;&gt;(&lt;strong&gt;fermatslibrary?&lt;/strong&gt;)&lt;/span&gt;)
&lt;a href=&quot;https://twitter.com/fermatslibrary/status/960154478224793600?ref_src=twsrc%5Etfw&quot;&gt;February
4, 2018&lt;/a&gt;
&lt;/blockquote&gt;
&lt;script async src=&quot;https://platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;p&gt;A nice Numberphile video has also been dedicated to the formula.
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/_s5RFgd59ao&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;h2 id=&quot;r-implementation&quot;&gt;R Implementation&lt;/h2&gt;
&lt;p&gt;One challenge of implementing Tupper’s formula in R is that &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; will be a very large integer (~500
digits). Hence, one needs a special purpose library to handle these
large numbers. StaTEAstics in their 2013 &lt;a
href=&quot;https://www.r-bloggers.com/2013/03/tuppers-self-referential-formula/&quot;&gt;R
blog post on Tupper’s formula&lt;/a&gt; use the GNU Multiple Precision
Arithmetic Library for this purpose and is interfaced in the &lt;a
href=&quot;https://cran.r-project.org/web/packages/gmp/index.html&quot;&gt;&lt;code&gt;gmp&lt;/code&gt;
R package&lt;/a&gt;. We follow their implementation:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;##  GNU Multiple Precision Arithmetic Library) for handling the long integers&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(gmp)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Define the constant k&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;k &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;960939379918958884971672962127852754715004339660129306651505519271702802395266424689642842174350718121267153782770623355993237280874144307891325963941337723487857735749823926629715517173716995165232890538221612403238855866184013235585136048828693337902491454229288667081096184496091705183454067827731551705405381627380967602565625016981482083418783163849115590225610003652351370343874461848378737238198224849863465033159410054974700593138339226497249461751545728366702369745461014655997933798537483143786841806593422227898388722980000748404719&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thus an R function implementing Tupper’s formula is:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tupper &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(x, y, k) {&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z1 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(y &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; k)&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigq&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(z1&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z3 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;^&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(x) &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(z1) &lt;span class=&quot;sc&quot;&gt;%%&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(z2 &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; z3) &lt;span class=&quot;sc&quot;&gt;%%&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we have used &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; explicitly
in order to have &lt;span class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt; run from 0 to
16, which is easier for the subsequent plotting. Applying the R function
to an appropriate grid of values (and reversing the index directions to
account for the horizontal plotting direction):&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;im &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;expand_grid&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;105&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;L&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;y=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;L&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;z=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tupper&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;105&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;x, &lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;y, &lt;span class=&quot;at&quot;&gt;k=&lt;/span&gt;k))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The result can then easily plotted:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plot_tupper &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(im, &lt;span class=&quot;at&quot;&gt;palette=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;darkblue&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;lightgray&amp;quot;&lt;/span&gt;)) {&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;ggplot&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;data=&lt;/span&gt;im, &lt;span class=&quot;fu&quot;&gt;aes&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;x,&lt;span class=&quot;at&quot;&gt;y=&lt;/span&gt;y,&lt;span class=&quot;at&quot;&gt;fill=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;as.factor&lt;/span&gt;(z))) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;geom_tile&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;scale_fill_manual&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;values=&lt;/span&gt;palette) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;theme_void&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;theme&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;legend.position=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;none&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;coord_equal&lt;/span&gt;()&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;plot_tupper&lt;/span&gt;(im)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/plot_tupper-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;behind-the-scenes&quot;&gt;Behind the Scenes&lt;/h2&gt;
&lt;p&gt;To check the underlying binary representation we convert &lt;span
class=&quot;math inline&quot;&gt;\(k/17\)&lt;/span&gt; to base-2 notation. However, the
multiplication by 17 (10001 in base-2) not only ensures that taking
&lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; modulo the height of the image
starts at zero, but it is also helpful to keep possible trailing zeroes
in the encoding of the image. Since we know the image size has to be
&lt;span class=&quot;math inline&quot;&gt;\(17\times 106=1802\)&lt;/span&gt; we simply fill
the trailing zeroes, if the base-2 converted result of &lt;span
class=&quot;math inline&quot;&gt;\(k/17\)&lt;/span&gt; does not have a length of 1802.&lt;/p&gt;
&lt;p&gt;Convert to base-2 number of length 1802 and visualize the number:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;char &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.character&lt;/span&gt;(k&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;b=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Add trailing zeroes, which are missing coz the first two pixel are 0.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;char &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;0&amp;quot;&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;106&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_length&lt;/span&gt;(char)), &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;), char)&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt;(char)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;00110010101000100001010101011111000010010010100000000000000000000000000000001000000000000000101000000000000010001000000000000000000000001111111111111111110000000000000000100000111100000000000000001000000000000011100000000000000000100000000000001110000000000000000000000000000000011000000000000001001000000000000010010000000000000011000000000000000000000000000000001100000000000000100100000000000001001000000000000011111100000000000000000000000000011111110000000111000000011100110000000000000110000000000000000011111111111111110100000000000000001011111010000000000000000101011000001100101001000001000111010001100010000000000000000111111111111111100000000000000000000000011001000000000000101001000000000001001010000000000010001000100000000000000001000000000000000000000000000000011111000000000000000000000000000001100100000000000000111000000000000000000000000001111111100000000010000000000000000100101000000000000000100000000000010010100000000000100000000000000001111111100000000000000000000000000000001000000000000000010000000000000000000000000000000111000000000000000010000000000000011100000000000000001000000000000001100000000000000000000000000000000111000000000000001010000000000000011100000000000000000000000000000001110000000000000010100000000000000111110000000000000000000000000000111100000000000110000110000000000000000000000000011111111000000000100000000000000001010110000000000000010000000000000100011000000000001000000000000000011111111000000000000000000000000001000000000000000001100000000000000000000000000000000001111100000000000000000000000000000110010000000000000011100000000000000000000000000110000110001000000011110000001100000000000000000000000000000000001100100000000000010100100000000000100101000001100001000100001100111000000011100100001111111000001000000000000000011111111111111111&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;str_length&lt;/span&gt;(char)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;[1] 1802&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Shown splitted into chunks of 17 and for better plotting replacing 0
with ” ” and 1 with “█”&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;char_split &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;stri_sub&lt;/span&gt;(char, &lt;span class=&quot;fu&quot;&gt;seq&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, stringi&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;stri_length&lt;/span&gt;(char),&lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;length=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plot_string &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(char_split, &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-3&quot;&gt;&lt;a href=&quot;#cb9-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;str_replace_all&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;0&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-4&quot;&gt;&lt;a href=&quot;#cb9-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;str_replace_all&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;█&amp;quot;&lt;/span&gt;) &lt;/span&gt;
&lt;span id=&quot;cb9-5&quot;&gt;&lt;a href=&quot;#cb9-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt;(plot_string)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;  ██  █ █ █   █  
  █ █ █ █ █████  
  █  █  █ █      
                 
        █        
       █ █       
      █   █      
                 
█████████████████
█                
█     ████       
         █       
      ███        
         █       
      ███        
                 
       ██        
      █  █       
      █  █       
       ██        
                 
       ██        
      █  █       
      █  █       
      ██████     
                 
     ███████     
  ███       ███  
██             ██
                 
████████████████ 
█                
█ █████ █        
        █ █ ██   
  ██  █ █  █     
█   ███ █   ██   
█                
████████████████ 
                 
      ██  █      
      █ █  █     
      █  █ █     
      █   █   █  
              █  
                 
            █████
                 
            ██  █
              ███
                 
         ████████
         █       
         █  █ █  
             █   
         █  █ █  
         █       
         ████████
                 
              █  
              █  
                 
            ███  
              █  
            ███  
              █  
            ██   
                 
            ███  
            █ █  
            ███  
                 
            ███  
            █ █  
            █████
                 
           ████  
         ██    ██
                 
         ████████
         █       
         █ █ ██  
            █    
         █   ██  
         █       
         ████████
                 
         █       
          ██     
                 
            █████
                 
            ██  █
              ███
                 
         ██    ██
   █       ████  
    ██           
                 
      ██  █      
      █ █  █     
      █  █ █     
██    █   █    ██
  ███       ███  
█    ███████     
█                
█████████████████&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or somewhat better visible as a plot:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Convert to image data.frame&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;im2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;expand_grid&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;105&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;y=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;im2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; im2 &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;idx =&lt;/span&gt; y &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; (x&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;value_str =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_sub&lt;/span&gt;(char, &lt;span class=&quot;at&quot;&gt;start=&lt;/span&gt;idx, &lt;span class=&quot;at&quot;&gt;end=&lt;/span&gt;idx),&lt;/span&gt;
&lt;span id=&quot;cb11-5&quot;&gt;&lt;a href=&quot;#cb11-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;at&quot;&gt;value =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(value_str)) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/show_pixels-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;
We find the above binary number by starting in the (0,0) cell and
reading upwards in the &lt;span class=&quot;math inline&quot;&gt;\(x=0\)&lt;/span&gt;
column.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Given the entire “magic” of Tupper’s formula is in &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;, this &lt;a
href=&quot;https://keelyhill.github.io/tuppers-formula&quot;&gt;site&lt;/a&gt; allows you
to upload a raw 106x17 image and get the corresponding &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; for use in the formula. With &lt;a
href=&quot;https://www.gimp.org/&quot;&gt;Gimp&lt;/a&gt;’s PBM export functionality it’s
thus easy to make your own plotting, e.g. with &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; equal to&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;186884211780601757089521467754254266534847988959618908270134320886923032590936706609566110951773945064529540811157829398942842590351995031478543240582993263095682288889081666401727057238884719133521833705371096422637085577259001963761107220646739852199923964701689237214047197937015515747842387117086366819859986916183575585602891273928856883765838042528273754853751383296206633974324557163987001300322007312244691824532706662875082651525203923748809153375012301876787226286483554151163460581654755346590825663755194466304&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;we get
&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/discussion_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;
Happy self-referential plotting!&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-tupper2001&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Tupper, Jeff. 2001. &lt;span&gt;“Reliable Two-Dimensional Graphing Methods for
Mathematical Formulae with Two Free Variables.”&lt;/span&gt; In
&lt;em&gt;Proceedings of the 28th Annual Conference on Computer Graphics and
Interactive Techniques&lt;/em&gt;, 77–86. SIGGRAPH ’01. New York, NY, USA:
Association for Computing Machinery. &lt;a
href=&quot;https://doi.org/10.1145/383259.383267&quot;&gt;https://doi.org/10.1145/383259.383267&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;For details about why the multiplication with the height
is done, see Arvind Narayanan’s post &lt;a
href=&quot;https://web.archive.org/web/20150424181239/http://arvindn.livejournal.com/132943.html&quot;&gt;Tupper’s
Self-Referential Formula Debunked&lt;/a&gt;.&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Mon, 17 Oct 2022 00:00:00 +0200</pubDate>
        <link>https://mhoehle.github.io/blog/2022/10/17/tupper.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2022/10/17/tupper.html</guid>
        
        <category>rstats</category>
        
        <category>stats</category>
        
        <category>obesity</category>
        
        <category>nonparametrics</category>
        
        
      </item>
    
      <item>
        <title>Anthropometric Birthday Cards</title>
        <description>&lt;p&gt;&lt;!-- bibliography: /Users/hoehle/Literature/Bibtex/jabref.bib --&gt;&lt;/p&gt;
&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We visualize children reference populations for height, weight and
body mass index by plotting percentiles of the population as a function
of age. Besides the epidemiological interest in these anthropometric
curves, they have dual-use potential for reproducible birthday
cards.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_bmi_plot-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2022-06-11-refpop.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Percentiles of a reference population at a given age are often used
to assess under- and overweight of children. As an example, the WHO
defines obesity for children under 5 years of age when the &lt;a
href=&quot;https://cdn.who.int/media/docs/default-source/child-growth/child-growth-standards/indicators/weight-for-length-height/cht-wfl-girls-z-0-2.pdf?sfvrsn=a683172c_11&quot;&gt;weight-for-height&lt;/a&gt;
of a child is greater than 3 standard deviations above &lt;a
href=&quot;https://www.who.int/news-room/fact-sheets/detail/obesity-and-overweight&quot;&gt;WHO
Child Growth Standards median for that age&lt;/a&gt; (see also the WHO R
package &lt;a
href=&quot;https://cran.r-project.org/web/packages/anthro/index.html&quot;&gt;anthro&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;In order to estimate these percentiles, data from a sample of the
reference population is often fitted using flexible regression models
such as GAMLSS &lt;span class=&quot;citation&quot;
data-cites=&quot;rigby_stasinopoulos2005&quot;&gt;(Rigby and Stasinopoulos
2005)&lt;/span&gt; or quantile regression &lt;span class=&quot;citation&quot;
data-cites=&quot;koenker2005&quot;&gt;(Koenker 2005)&lt;/span&gt;. This allows for a
flexible modelling of the percentiles as smooth functions of age &lt;span
class=&quot;citation&quot; data-cites=&quot;fenske_etal2013&quot;&gt;(Fenske et al.
2013)&lt;/span&gt;. The reference curves used in Germany are based on the
Box-Cox Cole and Green distribution &lt;span class=&quot;citation&quot;
data-cites=&quot;KromeyerHauschild_etal2001&quot;&gt;(Kromeyer-Hauschild et al.
2001)&lt;/span&gt; (aka. the LMS method). The &lt;a
href=&quot;https://cran.r-project.org/web/packages/childsds/index.html&quot;&gt;childsds&lt;/a&gt;
R package contains an implementation of these curves as
&lt;code&gt;data(kro.ref)&lt;/code&gt;. Furthermore, the package contains similar
reference curves for several other countries as well as the WHO
reference.&lt;/p&gt;
&lt;p&gt;In what follows, we will re-purpose the package as work-horse for
generating individualized birthday cards for children.&lt;/p&gt;
&lt;h2 id=&quot;results&quot;&gt;Results&lt;/h2&gt;
&lt;p&gt;Quantiles of the reference population are obtained with the
&lt;code&gt;childsds::make_percentile_tab&lt;/code&gt; function. As an example,
let’s get the 5th, 50th and 95th percentile of the height distribution
for the population of girls in Germany aged 0 and 4 years,
respectively.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(childsds)&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;data&lt;/span&gt;(kro.ref)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;childsds&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;make_percentile_tab&lt;/span&gt;(&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;at&quot;&gt;ref =&lt;/span&gt; kro.ref, &lt;span class=&quot;at&quot;&gt;item =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;height&amp;quot;&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;age=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;at&quot;&gt;perc=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;50&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;95&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;include.pars=&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(sex &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;female&amp;quot;&lt;/span&gt;) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##      sex age perc_05_0 perc_50_0 perc_95_0
## 1 female   0  47.39498   51.1112  54.82742
## 2 female   4  96.33650  103.6051 110.87370&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The main result of this short blog post is a &lt;a
href=&quot;https://github.com/hoehleatsu/hoehleatsu.github.io/blob/master/figure/source/2022-06-11-refpop/birth_stats.Rmd&quot;&gt;Rmd
file&lt;/a&gt;, which contains a visualization of an imaginary child’s growth
trajectory: Albert B. Cook born on 2018-06-11. The data of Albert are
stored in a &lt;a
href=&quot;/blog/figure/source/2022-06-11-refpop/kid_measurements.csv&quot;&gt;CSV
file&lt;/a&gt;. We show the trajectories for height, weight and BMI and
compare to 5 quantiles of the German reference population, i.e. the
2.5%, 5%, 50%, 95% and 97.5% quantile. The resulting visualization looks
as follows:&lt;/p&gt;
&lt;hr&gt;
&lt;!--
---
title: &quot;Birth statistics&quot;
author: &quot;&quot;
date: &apos;2024-02-13&apos;
output:
  html_document: default
  pdf_document: default
editor_options:
 chunk_output_type: console
---
--&gt;
&lt;!-- 
Remove above comment to make this into an Rmd file. This was commented in order
     for Jekyll not to accidently process the page when creating the blog
--&gt;
&lt;h1 id=&quot;albert-b.-cook&quot;&gt;Albert B. Cook&lt;/h1&gt;
&lt;p&gt;Let’s look at how Albert relates to the population of children in
Germany&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; as implemented in the &lt;a
href=&quot;https://cran.r-project.org/web/packages/childsds/index.html&quot;&gt;childsds&lt;/a&gt;
R package&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;height&quot;&gt;Height&lt;/h2&gt;
&lt;p&gt;Albert’s height of 108 cm at age 4.0 years corresponds to the 81.4%
quantile among boys in Germany of that age.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_height_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;weight&quot;&gt;Weight&lt;/h2&gt;
&lt;p&gt;Albert’s weight of 19,100 g at age 4.0 years corresponds to the 82.6%
quantile among boys in Germany of that age.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_weight_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;bmi&quot;&gt;BMI&lt;/h2&gt;
&lt;p&gt;Albert’s BMI of 16.4 kg/m² at age 4.0 years corresponds to the 73.3%
quantile among boys in Germany of that age.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_bmi_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;The Rmd file can be obtained from GitHub and serves as a template for
creating &lt;a
href=&quot;/blog/figure/source/2022-06-11-refpop/birth_stats.html&quot;&gt;html based
congratulation cards&lt;/a&gt; in response to news of newborn (which usually
are annotated with birth height and birth weight) or to track the growth
of your own kids.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Percentile curves for longitudinal trajectories in populations can
also be used in very different contexts than anthropometry. As an
example consider the development of your &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2019/05/06/wcamining.html&quot;&gt;solve
time for the 3x3x3 Rubik’s cube as a function of time since first WCA
competition&lt;/a&gt;.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-fenske_etal2013&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Fenske, N., L. Fahrmeir, P. Rzehak, and M. Höhle. 2013. &lt;span&gt;“Boosting
Structured Additive Quantile Regression for Longitudinal Childhood
Obesity Data.”&lt;/span&gt; &lt;em&gt;Int J Biostat&lt;/em&gt; 9 (1): 1–18. &lt;a
href=&quot;https://www.degruyter.com/document/doi/10.1515/ijb-2012-0035/html&quot;&gt;https://www.degruyter.com/document/doi/10.1515/ijb-2012-0035/html&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-koenker2005&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Koenker, Roger. 2005. &lt;em&gt;Quantile Regression&lt;/em&gt;. Cambridge University
Press.
&lt;/div&gt;
&lt;div id=&quot;ref-KromeyerHauschild_etal2001&quot; class=&quot;csl-entry&quot;
role=&quot;listitem&quot;&gt;
Kromeyer-Hauschild, K., M. Wabitsch, D. Kunze, F. Geller, H. C. Geiß, V.
Hesse, A. von Hippel, et al. 2001. &lt;span&gt;“Perzentile f&lt;span&gt;ü&lt;/span&gt;r
Den Body-Mass-Index f&lt;span&gt;ü&lt;/span&gt;r Das Kindes- Und Jugendalter Unter
Heranziehung Verschiedener Deutscher Stichproben.”&lt;/span&gt;
&lt;em&gt;Monatsschrift Kinderheilkunde&lt;/em&gt; 149 (8): 807–18.
&lt;/div&gt;
&lt;div id=&quot;ref-rigby_stasinopoulos2005&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Rigby, R. A., and D. M. Stasinopoulos. 2005. &lt;span&gt;“Generalized Additive
Models for Location, Scale and Shape (with Discussion).”&lt;/span&gt;
&lt;em&gt;Applied Statistics&lt;/em&gt; 54: 1–38.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;According to Kromeyer-Hauschild, K., Wabitsch, M.,
Kunze, D. et al. Perzentile für den Body-mass-Index für das Kindes- und
Jugendalter unter Heranziehung verschiedener deutscher Stichproben.
&lt;em&gt;Monatsschr Kinderheilkd&lt;/em&gt; 149, 807–818 (2001).
https://doi.org/10.1007/s001120170107&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;Vogel M (2022). &lt;em&gt;childsds: Data and Methods Around
Reference Values in Pediatrics&lt;/em&gt;. R package version 0.8.0, &lt;a
href=&quot;https://CRAN.R-project.org/package=childsds&quot;
class=&quot;uri&quot;&gt;https://CRAN.R-project.org/package=childsds&lt;/a&gt;.
&lt;hr&gt;
&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Sat, 11 Jun 2022 00:00:00 +0200</pubDate>
        <link>https://mhoehle.github.io/blog/2022/06/11/refpop.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2022/06/11/refpop.html</guid>
        
        <category>rstats</category>
        
        <category>stats</category>
        
        <category>obesity</category>
        
        <category>nonparametrics</category>
        
        
      </item>
    
      <item>
        <title>An R Package for Social Roulette </title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We introduce the R package socialroulette, which is a lightweight
package for handling the recurrent problem of assigning individuals into
groups of a fixed size. In order to minimize reunions, we provide an
algorithm to solve the task as an instance of the maximally diverse
grouping problem.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2021-05-12-socroulette/roulette-1003120_640.jpg&quot; width=&quot;350&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/mhoehle/mhoehle.github.io/master/_source/2021-05-12-socroulette.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Groupings are relevant when breakout rooms, mystery lunch partitions
or student peer review groups are made. My last blog post &lt;a
href=&quot;https://mhoehle.github.io/blog/2021/04/04/socialsamp.html&quot;&gt;Long
time, no see: Virtual Lunch Roulette&lt;/a&gt; considered the probability of
being assigned into the same group as someone, you already were in the
same group with the last time (aka. a re-union) when using simple random
sampling to assign the groups. This probability proved to be
surprisingly high.&lt;/p&gt;
&lt;p&gt;In this post we develop the subject further by introducing the R
package &lt;a
href=&quot;https://mhoehle.github.io/socialroulette/&quot;&gt;&lt;code&gt;socialroulette&lt;/code&gt;&lt;/a&gt;,
which aims at being helpful in making better group assignments based on
solutions of the &lt;a
href=&quot;http://grafo.etsii.urjc.es/optsicom/mdgp/&quot;&gt;&lt;strong&gt;maximally
diverse grouping problem&lt;/strong&gt;&lt;/a&gt; (MDGP) known from operations
research.&lt;/p&gt;
&lt;h3 id=&quot;the-problem&quot;&gt;The Problem&lt;/h3&gt;
&lt;p&gt;The aim is to partition &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;
participants into groups of size at least &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;. We shall denote the resulting
groupings a &lt;a
href=&quot;https://en.wikipedia.org/wiki/Partition_of_a_set&quot;&gt;&lt;strong&gt;partition&lt;/strong&gt;&lt;/a&gt;
of the set of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; participants. If
&lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; is not a divisor of &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; then some of the groups have to contain
more than &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; participants. As an
example consider the case that 5 individuals are to be divided into
groups of size at least 2. We shall adopt the convention, that group
size shall be as close to &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; as
possible and the group sizes should be as equal as possible. In the
specific toy example this means that we will need 2 groups, one with 3
participants and one with 2 participants.&lt;/p&gt;
&lt;p&gt;When assigning such groups repeatedly, e.g. one a weekly basis, an
additional criterion can be to form the groups, such that as few
participants as possible are assigned into groups with individuals they
were already in the same group with previously. This can, e.g., be done
by rejection sampling. However, as situations can occur where such
re-unions are unavoidable, it can instead be natural to formulate a
metric to maximize, which quantifies penalities due to such re-unions.
As an example: If one has to decide between assigning two individuals to
the same group who met 7 days or 14 days ago, it might be preferable to
choose the pair which met 14 days ago. Such optimization is known as
solving the &lt;a
href=&quot;http://grafo.etsii.urjc.es/optsicom/mdgp/&quot;&gt;&lt;strong&gt;maximally
diverse grouping problem&lt;/strong&gt;&lt;/a&gt; (see appendix).&lt;/p&gt;
&lt;h2 id=&quot;the-r-package-socialroulette&quot;&gt;The R package socialroulette&lt;/h2&gt;
&lt;p&gt;We illustrate the package by considering a use-case, where a class of
students repeatably for every lecture have be assigned into breakout
rooms. First, we install and load the &lt;a
href=&quot;https://mhoehle.github.io/socialroulette/&quot;&gt;&lt;code&gt;socialroulette&lt;/code&gt;&lt;/a&gt;
package available from &lt;a
href=&quot;https://github.com/mhoehle/socialroulette/&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Install package&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;devtools&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;install_github&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;mhoehle/socialroulette&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(socialroulette)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note: A binary package version is available from my &lt;a
href=&quot;https://mhoehle.r-universe.dev&quot;&gt;r-universe&lt;/a&gt;, which is a
pipeline automatically compiling the package through GitHub actions.&lt;/p&gt;
&lt;p&gt;Say the class consists of 100 students, which for a weekly virtual
lab exercise class need to be divided into groups of at least 4. Since
for various reasons not all students show up for each class, the
sampling frame of individuals to be partitioned each week changes
accordingly. Still, we would like to make the partitioning of the
current week s.t. students get as many new acquaintances as
possible.&lt;/p&gt;
&lt;p&gt;We first create a history of the previous 4 weeks’ groupings as well
as the frame of participants for the current lecture.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Class of 100 students with 4 previous lectures&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;students &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; tibble&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;id%.3d@student.su.se&amp;quot;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;partition_dates &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;seq&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2021-03-31&amp;quot;&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;1 week&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Simulate changing participation each week for the last 4 weeks (70% attendance)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;frames &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;( partition_dates, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            students &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_sample&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rbinom&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(.), &lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.7&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                         &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;date=&lt;/span&gt;.x))&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Generate some past partitions using simple random sampling&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;past_partitions &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; frames &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;group_split&lt;/span&gt;(date) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rsocialroulette&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;current_frame=&lt;/span&gt;.x, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;algorithm=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;srs&amp;quot;&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(partition_dates)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## Partitioning 72 individuals into groups of at least 4 (no past partitions).
## Created 18 groups of sizes 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4.
## Partitioning 74 individuals into groups of at least 4 (no past partitions).
## Created 18 groups of sizes 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4.
## Partitioning 71 individuals into groups of at least 4 (no past partitions).
## Created 17 groups of sizes 5 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4.
## Partitioning 69 individuals into groups of at least 4 (no past partitions).
## Created 17 groups of sizes 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We pretend that each of the above previous partitions has been saved
as a .csv file. For example like:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Simulate the storage of each partition as a .csv file to disk&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# with 3 columns: date, id1 and id2, i.e. all pairs&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;temp_dir &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tempdir&lt;/span&gt;() &lt;span class=&quot;co&quot;&gt;#adjust path to your setting if needed&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partitions_to_pairs&lt;/span&gt;( past_partitions ) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_split&lt;/span&gt;(date) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;walk&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;  &lt;span class=&quot;fu&quot;&gt;write_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;.x, &lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;file.path&lt;/span&gt;(temp_dir, stringr&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;socialroulette-&amp;quot;&lt;/span&gt;, .&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;date[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;], &lt;span class=&quot;st&quot;&gt;&amp;quot;.csv&amp;quot;&lt;/span&gt;))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We thus read the partitions from disk and convert from the stored
pair-format (i.e. a &lt;code&gt;data.frame&lt;/code&gt; listing each pair being in
the same group as &lt;code&gt;id1&lt;/code&gt;, &lt;code&gt;id2&lt;/code&gt; together with the
corresponding &lt;code&gt;date&lt;/code&gt; of the partition) back to the
list-format (i.e. a list of character vectors, where each vector denotes
a group and the vector contains the ids of all members of that group).
This can be done as follows:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Read again from file&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;pairs &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;list.files&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;path=&lt;/span&gt;temp_dir, &lt;span class=&quot;at&quot;&gt;pattern=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;socialroulette.*&amp;quot;&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;full.names=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;), &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;read_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;.x))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As a next step we sample the students who are in the next class to
group.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;current_frame &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt;  students &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;slice_sample&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rbinom&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(.), &lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.7&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;date=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;max&lt;/span&gt;(partition_dates) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;diff&lt;/span&gt;(partition_dates) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;mean&lt;/span&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our goal is now to partition the 79 students in
&lt;code&gt;current_frame&lt;/code&gt;. For each of the &lt;span
class=&quot;math inline&quot;&gt;\({79  \choose 2 }= 3081\)&lt;/span&gt; possible pairs of
students in that class, we determine how long ago it has been, since
they were in the same group the last time. This can be done using the
internal package function &lt;code&gt;partitions_to_distance&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dist &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partitions_to_distance&lt;/span&gt;(current_frame, past_partitions)&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dist &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 × 4
##   id1                 id2                 date        dist
##   &amp;lt;chr&amp;gt;               &amp;lt;chr&amp;gt;               &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;
## 1 id076@student.su.se id095@student.su.se 2021-04-28    35
## 2 id076@student.su.se id088@student.su.se 2021-04-28    35
## 3 id076@student.su.se id085@student.su.se 2021-04-28    35
## 4 id076@student.su.se id081@student.su.se 2021-04-28    35
## 5 id076@student.su.se id078@student.su.se 2021-04-28    35
## 6 id076@student.su.se id092@student.su.se 2021-04-28    35&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-05-12-socroulette/unnamed-chunk-11-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Since the past partitions contain the last 4 weeks, students who have
not been in a group so far are assigned a value of one time difference
more than the last possible meeting opportunity. In the specific example
this corresponds to &lt;span class=&quot;math inline&quot;&gt;\(7\cdot (4 + 1) =
35\)&lt;/span&gt; days. It thus seems natural to choose the groups, s.t. they
do not contain pairs, which have already met in the past. However, for
given size of the population, group sizes and meeting histories, this
might not be possible to achieve altogether, so a more flexible
criterion is to maximize the sum of distance since the last meet over
all pairs in the same group.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Make the partition using a mdgp solver&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;partition &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt;  &lt;span class=&quot;fu&quot;&gt;rsocialroulette&lt;/span&gt;(current_frame, past_partitions, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;algorithm=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;mdgp&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The partition can be visualized using the &lt;code&gt;igraph&lt;/code&gt;
package:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-05-12-socroulette/unnamed-chunk-14-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Of course the partition can also be stored to file as before, in
order to include it in the set of past partitions when doing the
partitioning next week:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(partition) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(current_frame &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(date)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partitions_to_pairs&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb10-4&quot;&gt;&lt;a href=&quot;#cb10-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;write_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;file.path&lt;/span&gt;(temp_dir, stringr&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;socialroulette-&amp;quot;&lt;/span&gt;, .&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;date[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;],&lt;span class=&quot;st&quot;&gt;&amp;quot;.csv&amp;quot;&lt;/span&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;or can be stored in a Zoom compatible breakout room specification
format:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;partition &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partition_to_frame&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rename&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;email=&lt;/span&gt;id) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;room =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;room%.03d&amp;quot;&lt;/span&gt;,group)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-5&quot;&gt;&lt;a href=&quot;#cb11-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(room, email) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-6&quot;&gt;&lt;a href=&quot;#cb11-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;write_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;file.path&lt;/span&gt;(temp_dir, stringr&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;zoom-breakoutrooms.csv&amp;quot;&lt;/span&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We provide functionality to create better groupings than obtained by
simple random sampling. However, as mathematically convincing the MDGP
solution might be, reunions can have their charm.&lt;/p&gt;
&lt;h3 id=&quot;acknowledgements&quot;&gt;Acknowledgements&lt;/h3&gt;
&lt;p&gt;We thank Xiangjing Lai and &lt;a
href=&quot;http://www.info.univ-angers.fr/pub/hao/&quot;&gt;Jin-Kao Hao&lt;/a&gt; for
contributing their C++ source code of the MDGP solver in &lt;span
class=&quot;citation&quot; data-cites=&quot;lai_hao2016&quot;&gt;Lai and Hao (2016)&lt;/span&gt;
under a GPL-3 license for the &lt;a
href=&quot;https://mhoehle.github.io/socialroulette/&quot;&gt;&lt;code&gt;socialroulette&lt;/code&gt;&lt;/a&gt;
package.&lt;/p&gt;
&lt;h2 id=&quot;appendix-maximally-diverse-grouping-problem&quot;&gt;Appendix: Maximally
diverse grouping problem&lt;/h2&gt;
&lt;p&gt;In this appendix we provide a few more mathematically details about
the maximally diverse grouping problem, which is about partitioning
&lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into groups of size
at least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; while maximizing a sum
of utility values computed by summing the utility &lt;span
class=&quot;math inline&quot;&gt;\(u(i,j)\)&lt;/span&gt; over all individuals &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt;
partitioned into the same group.&lt;/p&gt;
&lt;p&gt;More formally, let &lt;span class=&quot;math inline&quot;&gt;\(d_{ij}\)&lt;/span&gt; denote
the number of time units (typically days) ago, that individual &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; were in the same group. Note: This
distance is derived by looking at the previous partitions. It is a
matter of definition what this value should be, if &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; have not previously been in the same
group. Let &lt;span class=&quot;math inline&quot;&gt;\(G=n\&amp;gt; \text{div}\&amp;gt;
m\)&lt;/span&gt; denote the resulting number of groups where &lt;span
class=&quot;math inline&quot;&gt;\(\text{div}\)&lt;/span&gt; denotes integer division. For
a given partition let &lt;span class=&quot;math inline&quot;&gt;\(x_{ig}\)&lt;/span&gt; be an
indicator variable, which is 1, if &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; is assigned into group &lt;span
class=&quot;math inline&quot;&gt;\(g\)&lt;/span&gt; and zero otherwise.&lt;/p&gt;
&lt;p&gt;A solver of the maximally diverse grouping problem now tries to
maximize &lt;span class=&quot;math display&quot;&gt;\[
\sum_{g=1}^G \sum_{i=1}^n \sum_{j=i+1}^n d_{ij} x_{ig} x_{jg},
\]&lt;/span&gt; subject to the conditions &lt;span class=&quot;math display&quot;&gt;\[
\begin{align*}
&amp;amp;\sum_{g=1}^{G} x_{ig} = 1,&amp;amp;&amp;amp;  i=1,\ldots,n, \\
&amp;amp;\sum_{i=1}^n x_{ig} = n_g,&amp;amp;&amp;amp; g=1,\ldots,G, \\
&amp;amp;x_{ig} \in \{0,1\}, &amp;amp;&amp;amp; i=1,\ldots,n;\quad g=1,\ldots,G, \\
\end{align*}
\]&lt;/span&gt; where &lt;span class=&quot;math inline&quot;&gt;\(n_g\)&lt;/span&gt; is the size of
group &lt;span class=&quot;math inline&quot;&gt;\(g\)&lt;/span&gt;, i.e. &lt;span
class=&quot;math inline&quot;&gt;\(\sum_{g=1}^G n_g = n\)&lt;/span&gt;. We shall adopt the
convention that group sizes are determined by assigning the labels &lt;span
class=&quot;math inline&quot;&gt;\(1,\ldots,G\)&lt;/span&gt; to the participants by
starting from the first to the last, e.g., as &lt;span
class=&quot;math inline&quot;&gt;\(((\text{index} - 1) \&amp;gt; \text{mod}\&amp;gt; m) +
1\)&lt;/span&gt; and then count how often each label occurs. This means, e.g.,
that for &lt;span class=&quot;math inline&quot;&gt;\(n=7\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt; we get &lt;span
class=&quot;math inline&quot;&gt;\(n_g=7\&amp;gt; \text{div}\&amp;gt; 4=1\)&lt;/span&gt; group with
7 members.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;socialroulette&lt;/code&gt; package uses as backend a C++
implementation of MDGP solver of &lt;span class=&quot;citation&quot;
data-cites=&quot;lai_hao2016&quot;&gt;Lai and Hao (2016)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-lai_hao2016&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Lai, Xiangjing, and Jin-Kao Hao. 2016. &lt;span&gt;“Iterated Maxima Search for
the Maximally Diverse Grouping Problem.”&lt;/span&gt; &lt;em&gt;European Journal of
Operational Research&lt;/em&gt; 254 (3): 780–800. https://doi.org/&lt;a
href=&quot;https://doi.org/10.1016/j.ejor.2016.05.018&quot;&gt;https://doi.org/10.1016/j.ejor.2016.05.018&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Wed, 12 May 2021 00:00:00 +0200</pubDate>
        <link>https://mhoehle.github.io/blog/2021/05/12/socroulette.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2021/05/12/socroulette.html</guid>
        
        <category>rstats</category>
        
        <category>combinatorics</category>
        
        <category>R</category>
        
        
      </item>
    
      <item>
        <title>Long time, no see: Virtual Lunch Roulette</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;When distributing individuals into groups every week for a virtual
social mixer, e.g. using Zoom breakout rooms, it’s boring to end up in a
group with someone, who you already met last week. We compute the
probility for this to happen and state a simple rejection sampling
proposal for how to increase social diversity in such groupings.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_meetagain-1.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;As a pandemic replacement for the cross-division-chance-encounter in
the coffee kitchen, it has become common to use a virtual social mixer
format, where the &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; participants
are randomly divided into groups of at least &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; people, e.g., for a video meeting or
Zoom breakout rooms. Software exists to institutionalize such &lt;a
href=&quot;https://de.wikipedia.org/wiki/Random_Lunch&quot;&gt;Random Lunches&lt;/a&gt;
for, e.g., &lt;a href=&quot;https://lunchroulette.co/&quot;&gt;Slack&lt;/a&gt;. In this post
we shall be interested in the properties of such group assignment
algorithms.&lt;/p&gt;
&lt;p&gt;A practical experience is that all too often, the algorithm assigns
me to a group where at least one of the participants was already in my
group the last time. Before accusing the programmers of writing a poor
grouping algorithm: can we determine mathematically what the probability
for such a “reunion” is? How can we modify the algorithm to avoid
this?&lt;/p&gt;
&lt;h4 id=&quot;survey-of-the-field&quot;&gt;Survey of the field&lt;/h4&gt;
&lt;p&gt;Arranging a fixed set of &lt;span class=&quot;math inline&quot;&gt;\(n=k\times
m\)&lt;/span&gt; individuals into &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;
groups of size &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; in subsequent
rounds ensuring that no overlap occurs between the groups for as many
rounds as possible is also known as the &lt;a
href=&quot;http://www.mathpuzzle.com/MAA/54-Golf%20Tournaments/mathgames_08_14_07.html&quot;&gt;social
golfer problem&lt;/a&gt; or round robin scheduling in combinatorics - and can
be solved using &lt;a href=&quot;https://www.metalevel.at/mst.pdf&quot;&gt;constraint
programming&lt;/a&gt;. Compared to the social golfer problem, we have the
additional challenge that the group of people between rounds may be
subject to change. Furthermore, &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;
might not be a divisor of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;. Hence,
somewhat closer to our problem is the so called &lt;a
href=&quot;http://grafo.etsii.urjc.es/index.php/category/maximally-diverse-grouping/&quot;&gt;maximally
diverse grouping problem&lt;/a&gt;, where the grouping is to be done such that
the requirements on group size are met and a diversity score over the
elements in each group is maximized. For our setup, the score could,
e.g., be time since the last meet between individuals. Integer
programming can be used to solve the NP-complete problem.&lt;/p&gt;
&lt;p&gt;However, in our application we will either ignore the diversity score
altogether (i.e. set it to 1 always) or use a 0/1 diversity score (met
last time or not). Furthermore, we are interested in random assignment
algorithms selecting uniformly among the valid configurations. As a
consequence, we choose a more probabilistic approach and instead use a
custom group assignment algorithm as described in the next section.&lt;/p&gt;
&lt;h3 id=&quot;the-grouping&quot;&gt;The Grouping&lt;/h3&gt;
&lt;p&gt;We want to split the &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;
individuals into groups of preferably &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; members. However, if &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; is not a divisor of &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; then after making &lt;span
class=&quot;math inline&quot;&gt;\(\lfloor n/m \rfloor\)&lt;/span&gt; groups of &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; members we would have &lt;span
class=&quot;math inline&quot;&gt;\(l = n - \lfloor n/m \rfloor\)&lt;/span&gt; individuals
left. Instead of assigning these to a single leftover group, which would
be of size less than &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;
(particularly critical is size 1), we assign the remaining individuals
to the &lt;span class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; groups in round robin
fashion. This ensures that each group has size at least &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;. Note: Depending on &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; the resulting sizes might be larger
&lt;span class=&quot;math inline&quot;&gt;\(m+1\)&lt;/span&gt;, but the difference in the
resulting group size will never be larger than 1&lt;a href=&quot;#fn1&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.
Let &lt;code&gt;people&lt;/code&gt; be a tibble with a column &lt;code&gt;id&lt;/code&gt;
denoting a primary identifier key - this could, e.g., be the people’s
email address. An R function to perform a random assignment of the &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;=&lt;code&gt;nrow(people)&lt;/code&gt; individuals
into groups of at least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; could
look like:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Sample people into groups (original algorithm)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param people tibble containing name and email of available ppl&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param m requested group size. If m not a divisor of nrow(people) then put leftovers in existing groups&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return A list of vectors where each vector containing the ids (row number in ppl) of those belonging to the same group&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;sample_groups &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(people, m) {&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Number of groups needed&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  n_g &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(people) &lt;span class=&quot;sc&quot;&gt;%/%&lt;/span&gt; m&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Group membership indicator&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  g &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n_g), &lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(people))&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Permutation order&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  perm &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(people)))&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb1-16&quot;&gt;&lt;a href=&quot;#cb1-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Make a list of ids in each group&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-17&quot;&gt;&lt;a href=&quot;#cb1-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  groups &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n_g), &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(i) {&lt;/span&gt;
&lt;span id=&quot;cb1-18&quot;&gt;&lt;a href=&quot;#cb1-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    idx &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; perm[&lt;span class=&quot;fu&quot;&gt;which&lt;/span&gt;(g &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; i)]&lt;/span&gt;
&lt;span id=&quot;cb1-19&quot;&gt;&lt;a href=&quot;#cb1-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    people &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice&lt;/span&gt;(idx) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(id)&lt;/span&gt;
&lt;span id=&quot;cb1-20&quot;&gt;&lt;a href=&quot;#cb1-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  })&lt;/span&gt;
&lt;span id=&quot;cb1-21&quot;&gt;&lt;a href=&quot;#cb1-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb1-22&quot;&gt;&lt;a href=&quot;#cb1-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(groups)&lt;/span&gt;
&lt;span id=&quot;cb1-23&quot;&gt;&lt;a href=&quot;#cb1-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Example: Let &lt;code&gt;people&lt;/code&gt; denote the population of 47
individuals to be assigned into groups of at least &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt; according to the above
description.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;47&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;people &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;id =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;%0.2d&amp;quot;&lt;/span&gt;,&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n)))) &lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;m &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;groups &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_groups&lt;/span&gt;(people, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This leads to 11 groups with between 4 and 5 members. We can
visualize the group allocation as a graph, where each group will
correspond to a fully connected sub-graph, but with no connections
between the sub-graphs.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/unnamed-chunk-4-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h3 id=&quot;mathematical-formulation&quot;&gt;Mathematical Formulation&lt;/h3&gt;
&lt;p&gt;The mathematical question is now: Given you were in the group with
&lt;span class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; other persons the last time, what
is the probability that after assigning &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into groups of preferred
size &lt;span class=&quot;math inline&quot;&gt;\(m\geq 2\)&lt;/span&gt;, that you will be in
the same group with at least one of them again this time&lt;a href=&quot;#fn2&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.
Let &lt;span class=&quot;math inline&quot;&gt;\(m \leq k\)&lt;/span&gt; be the size of your
group in the current assignment. Combinatorical considerations tell us
the probability to meet at least one of the &lt;span
class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; persons again is:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
p(k, l, n) = 1 - \frac{1\cdot\prod_{i=2}^{k}
(n-(l+i-1))}{1\cdot\prod_{i=2}^{k} (n-i+1)}.
\]&lt;/span&gt; In order to determine the overall probability for a reunion
after assignment, we need to determine the PMF &lt;span
class=&quot;math inline&quot;&gt;\(f_{n,m}\)&lt;/span&gt; of the group size, i.e. what is
the probability that the algorithm dividing &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into groups of size at
least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; will assign me to a group
of size &lt;span class=&quot;math inline&quot;&gt;\(k, k\geq m\)&lt;/span&gt;. The probability
of interest is then: &lt;span class=&quot;math display&quot;&gt;\[
p(n,m,l) = \sum_{k=1}^\infty p(k,l,n) f_{n,m}(k)
\]&lt;/span&gt; Note: Even though we write the summation to be from 1 to &lt;span
class=&quot;math inline&quot;&gt;\(\infty\)&lt;/span&gt;, the PMF will only have support on
at most two integers.&lt;/p&gt;
&lt;p&gt;The calculations in R and verified by 1000 Monte Carlo
simulations:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Group membership indicator for the n individuals&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;g &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n &lt;span class=&quot;sc&quot;&gt;%/%&lt;/span&gt; m), &lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;n)&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Which previous group sizes to consider. Note:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# can be way beyond m, even if m was selected&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;p_groupsize &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;prop.table&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(g)))&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;p_kln &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sapply&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;names&lt;/span&gt;(p_groupsize)), prob_reunion, &lt;span class=&quot;at&quot;&gt;l=&lt;/span&gt;l, &lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;n)&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_analytical =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(p_kln &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; p_groupsize), &lt;span class=&quot;at&quot;&gt;p_mc =&lt;/span&gt; p_reunion_mc) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## p_analytical         p_mc 
##    0.2024913    0.2010000&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can illustrate this reunion probability as a function of &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_reunion-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;As a next step we need to marginalise out the previous group size
&lt;span class=&quot;math inline&quot;&gt;\(l+1\)&lt;/span&gt;. For simplicity, we will assume
that exactly the same participants participate in each round. Hence, we
can use the same group size PMF as before when summing out &lt;span
class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt;: &lt;span class=&quot;math display&quot;&gt;\[
p(n,m) = \sum_{l=1}^\infty \sum_{k=1}^\infty p(k,l,n) f_{n,m}(k)
f_{n,m}(l+1)
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The result thus denotes the probability that you in two consecutive
assigments of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into
groups of at least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; individuals
will be in the same group with someone twice. We will denote this the
&lt;em&gt;reunion probability&lt;/em&gt;. The graph below shows this probability as
a function of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; and is also available in a &lt;a
href=&quot;/blog/figure/source/2021-04-04-socialsamp/p_meetagain_log.png&quot;&gt;log-x
axis version&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_meetagain-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Why are the curves not decreasing monotonically?&lt;a href=&quot;#fn3&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref3&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;
This is due to the minimum size &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;
restriction on the group size. If &lt;span
class=&quot;math inline&quot;&gt;\(m=6\)&lt;/span&gt; and you have &lt;span
class=&quot;math inline&quot;&gt;\(n=12\)&lt;/span&gt; people then there are two groups.
But if &lt;span class=&quot;math inline&quot;&gt;\(n=17\)&lt;/span&gt; while &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; is still 6, then we will still only
have two groups as one would need 18 people for 3 groups. However, there
are now 8 and 9 people in the two groups instead of 6 and 6 so the
probability of reunion increases. Altogether, the probability increases
from 12 and 17 until it decreases again at &lt;span
class=&quot;math inline&quot;&gt;\(n=18\)&lt;/span&gt;. Consequently, for &lt;span
class=&quot;math inline&quot;&gt;\(m=2\)&lt;/span&gt; the peaks would be at the even &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; and the troughs would be the odd &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Given our &lt;span class=&quot;math inline&quot;&gt;\(n=47\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt; we also note the high probability of
22% for a reunion, which confirms our empirical experience. Thus there
seems to be a need to impose some additional constraints on the grouping
in order to optimize social diversity. For a translation of &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; into the number of breakout rooms used
in Zoom, see Appendix A.&lt;/p&gt;
&lt;h3 id=&quot;grouping-with-avoidance&quot;&gt;Grouping with avoidance&lt;/h3&gt;
&lt;p&gt;Let &lt;code&gt;pairs&lt;/code&gt; be a tibble with columns &lt;code&gt;id1&lt;/code&gt; and
&lt;code&gt;id2&lt;/code&gt; denoting all pairs of individuals who were placed in
the same group the last time. We now want to enhance our group
allocation algorithm to only assign people into groups, if they were not
in the same group the last time. We do this by a simple rejection
sampling algorithm, where we draw a configuration with
&lt;code&gt;sample_groups&lt;/code&gt;, check if it has overlaps with the last
allocation, and if so, draw again. This method is not very efficient and
might take a while. Even worse: it might not finish at all, if no
configuration satisfying the constraint exist. An example is, if 9
individuals are to be divided into groups of at least 4 two times
without any reunions. The corresponding code of such a
&lt;code&gt;sample_groups_avoid&lt;/code&gt; function is available in the &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;R
code&lt;/a&gt; from GitHub. This can then be used to generate the desired
grouping without reunions:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Sampling in round1 and round2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;groups_r1 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_groups&lt;/span&gt;(people, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m)&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;groups_r2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_groups_avoid&lt;/span&gt;(people, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m, &lt;span class=&quot;at&quot;&gt;avoid_pairs =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;make_pairs&lt;/span&gt;(groups_r1))&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Check if there are any re-unions. Note: There should be none.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-6&quot;&gt;&lt;a href=&quot;#cb5-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;inner_join&lt;/span&gt;( &lt;span class=&quot;fu&quot;&gt;make_pairs&lt;/span&gt;(groups_r1) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(hash), &lt;span class=&quot;fu&quot;&gt;make_pairs&lt;/span&gt;(groups_r2) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(hash), &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;hash&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 0 x 1
## # … with 1 variable: hash &amp;lt;chr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In other words: No reunions, just as we wanted.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We considered random groupings used, e.g., in lunch roulette or when
distributing students into breakout rooms. Depending on the number of
people to group and the anticipated group size the probability for a
reunion with somebody from last weeks grouping is surprisingly high.
Hence, we use rejection sampling to propose a configuration, where no
reunion occurs. The resulting grouping can easily be exported to a CSV
file for import when making &lt;a
href=&quot;https://support.zoom.us/hc/en-us/articles/360032752671-Pre-assigning-Participants-to-Breakout-Rooms&quot;&gt;pre-assigned
Zoom breakout rooms&lt;/a&gt; (example in the &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;R
code&lt;/a&gt; on GitHub). Even better allocations might be possible as part
of solving the maximally diverse grouping problem. For further
combinatorics posts, see also my work on the &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2017/02/13/bday.html&quot;&gt;birthday
problem with unequal probabilities&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&quot;acknowledgments&quot;&gt;Acknowledgments&lt;/h4&gt;
&lt;p&gt;Thanks to Dirk, Titus and Filip for the challenge.&lt;/p&gt;
&lt;h2 id=&quot;appendix-a&quot;&gt;Appendix A&lt;/h2&gt;
&lt;p&gt;Since the Zoom grouping does not work by specifying the number of
individuals in each group, but instead the number of groups, we show an
equivalent representation of the reunion probability graph as a function
of the number of groups, i.e. &lt;span class=&quot;math inline&quot;&gt;\(\lfloor
n/m\rfloor\)&lt;/span&gt;. Since we did the math in &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;, not every breakout room size is found.
This also means that the shown graph is only an approximation, because
the Zoom allocation algorithm is likely to work slightly different to
our proposed &lt;code&gt;sample_groups&lt;/code&gt; algorithm.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_breakout_rooms-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-b&quot;&gt;Appendix B&lt;/h2&gt;
&lt;p&gt;As a consequence from the calculation and functions from this post we
can now answer the following question from our &lt;a
href=&quot;https://www.math.su.se/english/research/research-groups/research-group-in-mathematical-statistics-1.330441&quot;&gt;SU
Mathematical Statistics&lt;/a&gt; Zoom Christmas Party announcement:&lt;/p&gt;
&lt;div class=&quot;framedbox&quot;&gt;
&lt;em&gt;At 15:00 We will use the breakout room Zoom function that randomly
divides the participants into smaller groups (5 persons). At 15:15 and
15:30 we will randomize to form new groups. The natural question that
arises is: what is the probability that you and some other colleague
spend the entire 45 minutes together?&lt;/em&gt;
&lt;/div&gt;
&lt;p&gt;
&lt;p&gt;Through simulations (details in the &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;code&lt;/a&gt;)
built on top of the &lt;code&gt;sample_groups&lt;/code&gt; function we determine
that the requested probability when &lt;span
class=&quot;math inline&quot;&gt;\(n=30\)&lt;/span&gt; participate in the X-mas party is
7.6%.&lt;/p&gt;
&lt;h2 id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;As an example consider the case &lt;span
class=&quot;math inline&quot;&gt;\(n=7\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt;, where we according to our
specification would form 1 group with 7 members.&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;We will assume that the &lt;span
class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; individuals you met last week all
participate again this week.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Thanks to &lt;a
href=&quot;https://www.reddit.com/r/math/comments/mjy7nx/probability_to_meet_someone_again_when_assigning/gtd33xi?utm_source=share&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;u/antichain&lt;/a&gt;
for the question and to &lt;a
href=&quot;https://www.reddit.com/r/math/comments/mjy7nx/probability_to_meet_someone_again_when_assigning/gtd4c8t?utm_source=share&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;u/assiraN&lt;/a&gt;
for the nice answer with examples, which I’ve integrated into the
post.&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Sun, 04 Apr 2021 00:00:00 +0200</pubDate>
        <link>https://mhoehle.github.io/blog/2021/04/04/socialsamp.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2021/04/04/socialsamp.html</guid>
        
        <category>rstats</category>
        
        <category>combinatorics</category>
        
        <category>R</category>
        
        
      </item>
    
      <item>
        <title>Age-Structure Adjusted All-Cause Mortality</title>
        <description>&lt;!-- bibliography: ~/Literature/Bibtex/jabref.bib --&gt;
&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;This page is an updated version of the 2020-12-28 blog post &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2020/12/28/mort.html&quot;&gt;Age
Stratified All-Cause and COVID-19 Associated Mortality&lt;/a&gt;. The post
considers the age stratified all-cause and COVID-19 associated mortality
in Germany during 2020 based on numbers provided by the Federal
Statistical Office and the Robert Koch Institute. Important extensions
compared to the original post are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;an improved population adjusted expected mortality calculation&lt;/li&gt;
&lt;li&gt;an update of the analysis containing the 2020 numbers as of
2021-03-13&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note: The present analyses were previously kept in a separate updated
R-Markdown file, which was updated until 2021-01-29. The present text is
a conversion of this document into a blog post including a treamtnet of
week 53, but does not contain any updated interpretations compared to
the 2021-01-29 version.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/sterbefaelle_incidence.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-03-01-mortadj.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;All-cause mortality is one of indicators used to measure the impact
of the COVID-19 pandemic, because this indicator is less biased by the
testing strategy needed to identify cases to have died while having a
recent COVID-19 diagnosis. Several ressources (&lt;a
href=&quot;https://ourworldindata.org/covid-excess-mortality&quot;&gt;OurWorldInData&lt;/a&gt;,
&lt;a
href=&quot;https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938&quot;&gt;Financial
Times&lt;/a&gt;, &lt;span class=&quot;citation&quot; data-cites=&quot;aburto_etal2021&quot;&gt;Aburto et
al. (2021)&lt;/span&gt;) have used this indicator to compare the COVID-19
response between countries. Since both death and COVID-19 have a strong
age component, it appears crucial to take an age-stratified view on both
all-cause mortality as well as deaths associated with COVID-19. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-03-01-mortadj.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;age-stratified-mortality&quot;&gt;Age Stratified Mortality&lt;/h2&gt;
&lt;p&gt;Real-time mortality monitoring is not common in Germany, as can be
seen from the coverage of the &lt;a
href=&quot;https://www.euromomo.eu/&quot;&gt;EuroMoMo monitoring&lt;/a&gt; for Germany,
where only the two federal states Hesse and Berlin participate. However,
as part of the COVID-19 response, the Federal Statistical Office
(Destatis) now provides weekly updated &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Querschnitt/Corona/Gesellschaft/kontextinformationen-gesellschaft.html#Sterbe&quot;&gt;preliminary
mortality statistics of all-cause mortality in 2020&lt;/a&gt;. The methodology
behind the numbers as well as age-stratified additional analyses are
described in an accompanying &lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;publication&lt;/a&gt;
&lt;span class=&quot;citation&quot; data-cites=&quot;zurnieden_etal2020&quot;&gt;(zur Nieden,
Sommer, and Lüken 2020)&lt;/span&gt;. The age-stratified analyses are
unfortunately not continuously updated, however, up-to-date data are
made publicly &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Gesellschaft-Umwelt/Bevoelkerung/Sterbefaelle-Lebenserwartung/Tabellen/sonderauswertung-sterbefaelle.html?nn=209016&quot;&gt;available&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The age-stratified reported COVID-19 associated deaths (by week of
death) are obtained from an &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;export
of the RKI&lt;/a&gt;. In order to compensate for reporting delays of deaths,
the Destatis analysis only goes until 4 weeks before the time point of
analysis, but in this post we shall only be interested in the 2020
results. As additional data source we use the &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;age-stratified
weekly time series by time of death&lt;/a&gt; reported by RKI.&lt;/p&gt;
&lt;h2 id=&quot;preliminary-destatis-mortality-data&quot;&gt;Preliminary Destatis
Mortality Data&lt;/h2&gt;
&lt;p&gt;Available all-cause deaths (by week of death) are available from &lt;a
href=&quot;https://www.destatis.de/EN/Home/_node.html&quot;&gt;Destatis&lt;/a&gt; until
2021-W07. Hwoever, we will only use the data until the end of 2020 in
this post. Note that Destatis stresses the &lt;a
href=&quot;https://twitter.com/FlorianBurg2/status/1343903541849681922?s=20&quot;&gt;preliminary
character of the data&lt;/a&gt; - the numbers might change as further deaths
arrive, however, as of 2021-03-13 changes are expected to be small.
Stratified by age the times series for 2020 compared to the years
2016-2019 looks as follows - please beware of the different y-axes for
the age-groups in the plot:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/AGEMORT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Note: Because the years 2016-2019 do not contain a week 53, we obtain
a hypothetical week 53 value for year &lt;span class=&quot;math inline&quot;&gt;\(Y,
Y=2016,\ldots, 2019\)&lt;/span&gt;, for comparison in the plot by averaging
the observed counts in &lt;span class=&quot;math inline&quot;&gt;\(Y\)&lt;/span&gt;-W52 and
&lt;span class=&quot;math inline&quot;&gt;\((Y+1)\)&lt;/span&gt;-W01.&lt;/p&gt;
&lt;p&gt;Since the age-groups contain different population sizes and - as
pointed out by &lt;span class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz
(2021)&lt;/span&gt; - population sizes of the age-groups changed relevantly
2016-2019, a better comparison between age-groups instead of absolute
numbers is by &lt;a href=&quot;sterbefaelle_incidence.png&quot;&gt;incidence rate&lt;/a&gt;
(i.e. deaths per 100,000 population in the age group). For this, the
yearly Destatis &lt;a
href=&quot;https://www-genesis.destatis.de/genesis//online?operation=table&amp;amp;code=12411-0012&amp;amp;bypass=true&amp;amp;levelindex=0&amp;amp;levelid=1610148266727#abreadcrumb&quot;&gt;age-specific
population data&lt;/a&gt; available for the cut-off-date Dec 31st for
2015-2019 are linearly interpolated for the weeks. An estimate of the
2020 population is obtained from the 2020 value of the &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Gesellschaft-Umwelt/Bevoelkerung/Bevoelkerungsvorausberechnung/Publikationen/Downloads-Vorausberechnung/bevoelkerung-bundeslaender-2060-5124205199024.html&quot;&gt;destatis
population projection&lt;/a&gt; (Variant G2-L2-W2).&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/POPDYNAMICS-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;We notice the strong increase in size of the [80,90) year old age
group (increase by 26%) and the noticable decline in the groups of
[40,50) (-12%) and [70,80) (-9%) in just 5 years. Although not large in
absolute size compared to the other age groups, the [90,Inf) group
increased by 18%. These changes, and in particular those in the higher
age groups, will be relevant for the analysis of excess mortality.&lt;/p&gt;
&lt;p&gt;Once we have the weekly age-specific population estimates available
we can compute the incidence per week and age-group. Below the weekly
mortality incidence rate (per 100 000 population) is shown for 2020
compared to the minimum, mean and maximum of the corresponding week for
the years 2016-2019.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/AGEMORTINC-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Compared to the graphic with the absolute number of deaths, one
notices that the population adjustment leads to a smaller excess in the
[80-90) group (because the population in this group became larger). On
the other hand, the Nov-Dec 2020 curve in the [70-80) group now is
clearer in excess of the expected. For further insights see also &lt;span
class=&quot;citation&quot; data-cites=&quot;kauermann_etal2021&quot;&gt;Kauermann et al.
(2021)&lt;/span&gt; and &lt;span class=&quot;citation&quot;
data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz (2021)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;To underline the age-gradient of all-cause mortality: 56% of the
deaths 2016-2019 occured in the age group of 80+ years (90% in the age
group of 60+). It becomes clear that the 2020 mortality in the 80+ age
groups was rather low during the first 10-12 weeks and then had a spike
in connection with the first COVID-19 wave (March-April). Subsequently,
a summer peak (possibly associated with heat) is followed by an
increasing and ongoing upward trend in December. One challenge for a
statistical analysis of these numbers is to figure out how much of the
upward trend is “catch-up mortality” due to the lower mortality in the
beginning of the year and how much is excess related to COVID-19.
However, both &lt;span class=&quot;citation&quot;
data-cites=&quot;kauermann_etal2021&quot;&gt;Kauermann et al. (2021)&lt;/span&gt; and &lt;span
class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz (2021)&lt;/span&gt; show
that the excess can be well explained by COVID-19 associated deaths.&lt;/p&gt;
&lt;p&gt;An initial analysis of this question consists of summing the
all-cause mortalities from W1 until W53 for 2020 (observed) and compare
this to the summation of the weekly mean of 2016-2019 for the
corresponding time period (expected). Since both 2021-W01 and 2020-W53
contains days outside the year 2020 we weight these two weeks in the
summation according to the number of days in 2020 (i.e. 5/7 and 4/7). As
a consequence, our number of deaths deviates slightly against a more
exact calculation based on daily deaths (which however does not have
age-strata publically available). Note: This calculation method ignores
the population changes in the years 2016-2020. Furthermore:&lt;/p&gt;
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;border-bottom: 0;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Age group
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
observed_2020
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
expected_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Percent change
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
min_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
max_20162019
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[00,30)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7285
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7781
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7508
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
8116
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[30,40)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6811
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6445
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6371
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6512
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[40,50)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15658
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
16917
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-7%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15505
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
18557
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[50,60)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
57485
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
58060
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-1%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
56823
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
58943
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[60,70)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
118313
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
111742
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
107755
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
114922
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[70,80)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
201411
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
211212
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-5%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
202435
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
216055
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[80,90)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
378011
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
340670
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
11%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
325392
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
349797
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[90,Inf)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
199646
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
178355
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
12%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
165384
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
185617
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr grouplength=&quot;1&quot;&gt;
&lt;td colspan=&quot;6&quot; style=&quot;border-bottom: 0;&quot;&gt;
&lt;strong&gt;Total&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;padding-left: 2em;color: black !important;background-color: lightgray !important;&quot; indentlevel=&quot;1&quot;&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
984621
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
931182
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
906309
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
984621
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&quot;padding: 0; &quot; colspan=&quot;100%&quot;&gt;
&lt;sup&gt;a&lt;/sup&gt; Min and max for row ‘Total’ is obtained by first summing
each of the years 2016-2019 and then take the min and max.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;Note: The exact mortality count for 2020 by Destatis using daily data
is 985145, hence, the weighted weekly summation does produce a small
discrepancy from this value. The total proportion of 2020-W1 to 2020-W53
mortalities in the 80+ age group is currently 59%, i.e. a slightly
higher proportion than in the previous years.&lt;/p&gt;
&lt;p&gt;A population age-structure adjusted estimate can be obtained using an
indirect standardization approach &lt;span class=&quot;citation&quot;
data-cites=&quot;keiding_clayton2014&quot;&gt;(Keiding and Clayton 2014)&lt;/span&gt;: For
each age group we compute the weekly incidence rates 2016-2019, then for
each week we take the min, mean and max of the 2016-2020 incidences. If
we for a given age-group and week want an expected number of deaths
based on the 2016-2019 data, we would multiply the 2016-2019 mean
incidence on the corresponding 2020 population in order to get the
expected number of deaths in the corresponding age-group and week of
2020. Because the estimated incidence rates for 2016-2019 are based on
slightly different population sizes, one could acknowledge this in the
mean-calculation by instead computing an inverse variance weighted mean
(or use logistic regression). However, numerical differences are
neglible so we proceed with the equal weighting of the mean. The
computations lead to the following table for the age-population adjusted
2020 mortality:&lt;/p&gt;
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Age group
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
observed_2020
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
expected_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Percent change
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[00,30)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7285
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7770
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-6%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[30,40)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6811
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6732
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
1%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[40,50)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15658
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15990
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-2%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[50,60)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
57485
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
58709
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-2%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[60,70)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
118313
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
118596
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
0%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[70,80)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
201411
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
202851
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-1%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[80,90)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
378011
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
387314
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-2%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[90,Inf)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
199646
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
194453
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
3%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr grouplength=&quot;1&quot;&gt;
&lt;td colspan=&quot;4&quot; style=&quot;border-bottom: 0;&quot;&gt;
&lt;strong&gt;Total&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;padding-left: 2em;color: black !important;background-color: lightgray !important;&quot; indentlevel=&quot;1&quot;&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
984621
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
992416
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
-1%
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;What looked like a small excess in the raw calculations becomes a
small negative excess after population adjustment by the proposed
method. This shows the importance of computing the expected number of
cases in a population adjustment way, which was the point of &lt;span
class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz (2021)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/weekly_smr-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Altogether, the mild mortality in the older age groups during the
first weeks (e.g. due to a mild influenza season) so far balances the
continuing excess in the higher age-groups since Mar-Apr, which
coincides with the start of the COVID-19 pandemic. If one is interested
in COVID-19 associated deaths an alternative might be to focus on the
period since Mar 2020, but then one would ignore the low influenza
season in the beginning of the year, which is IMO relevant for all-cause
mortality excess analysis. For comparison, excess mortality computations
for influenza are in the northern hemisphere often done not by calendar
year but by season, i.e. for the period from July in Year &lt;span
class=&quot;math inline&quot;&gt;\(X\)&lt;/span&gt; to June in Year &lt;span
class=&quot;math inline&quot;&gt;\(X+1\)&lt;/span&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;nielsen_etal2011&quot;&gt;(Nielsen et al. 2011)&lt;/span&gt;. In this case
one would associate the first COVID-19 peak to the analysis of the
season 2019/2020 and the ongoing 2nd wave to an analysis of the ongoing
season 2020/2021. The present analysis, however, focused on the calendar
year 2020 following the Destatis presentation of the data.&lt;/p&gt;
&lt;p&gt;When interpreting the above results it is important to realize that
the 2020 population numbers are currently projections. In a recent &lt;a
href=&quot;https://www.destatis.de/DE/Presse/Pressemitteilungen/2021/01/PD21_016_12411.html&quot;&gt;press
release&lt;/a&gt; Destatis announced that the population in 2020 might not
have increases as projected, because of a smaller migration surplus,
higher mortality and lower birth numbers. As a consequence, Destatis now
estimates that the 2020 population consisted of 83.20 mio (no population
increase compared to 2019) individuals whereas in the G2-L2-W2
projection variant the projection was 83.38 mio (population increase by
0.3% compared to 2019). Final figures, including more detailed
age-stratified data, will be available mid 2021 and it will be
interesting to see how these impact the excess mortality
calculations.&lt;/p&gt;
&lt;p&gt;Furthermore, it is important to realize that the current observed
2020 mortality numbers contain the consequences of all type of effects
from the pandemic management, which includes changes in the population
behavior due to interventions. Disentangling the complex effects of
all-cause mortality and the COVID-19 pandemic is a delicate matter,
which takes experts in several disciplines (demographers, statisticians,
epidemiologists) to solve. However, should you based on the above
numbers happen to think that COVID-19 is not a serious problem, it is
insightful to think about the &lt;a
href=&quot;https://en.wikipedia.org/wiki/Prevention_paradox&quot;&gt;prevention
paradox&lt;/a&gt; and take a look at the &lt;a
href=&quot;https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938&quot;&gt;all-cause
mortality statistics&lt;/a&gt; from other countries and consider a more
regional analysis as done in the next section.&lt;/p&gt;
&lt;h3 id=&quot;analysis-for-the-16-federal-states&quot;&gt;Analysis for the 16 Federal
States&lt;/h3&gt;
&lt;p&gt;The preliminary all-cause mortality data are also available for each
of the 16 federal states, however, with a coarser age discretization. We
show for each of the two age-groups the weekly population adjusted
mortality relative to the same week in 2016-2019. Note that since the
age-groups are also coarser, i.e. the data contains only the two groups
[00,65) and [65,Inf), the effect of the changing populations on the
estimates is less pronounced.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/MORTBLREL-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
The plot can also be compared to the recently introduced &lt;a
href=&quot;https://service.destatis.de/DE/bevoelkerung/sterbefallzahlen_bundeslaender.html&quot;&gt;Destatis
visualization of absolute case numbers on state level&lt;/a&gt;. We note the
strong regional differences in the plot. As an example, the highest
mortality in the 65+ age-group occurs in 2020-W52 in the federal state
of Sachsen, where the poulation adjusted mortality is 122% above the
mean of 2016-2019. Note that for Sachsen, even the &amp;lt;65 age-group has
a visible excess. The 3 federal states with the highest excess mortality
week in the 65+ age-group are:
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Federal state
&lt;/th&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Week
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Excess mortality
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
Sachsen
&lt;/td&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
2020-W52
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
122%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
Brandenburg
&lt;/td&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
2020-W53
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
72%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
Thüringen
&lt;/td&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
2020-W52
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
68%
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;!-- Furthermore, for the [00,65) series for Berlin it looks like not all all cases up to week W53 are available. This underlines the preliminary character of the Destatis data. --&gt;
&lt;h3 id=&quot;all-cause-mortality-and-covid-19-associated-deaths&quot;&gt;All-Cause
Mortality and COVID-19 Associated Deaths&lt;/h3&gt;
&lt;p&gt;To see, how much of the all-cause mortality is directly contributed
by deaths in association with COVID-19, we match the age-stratified
all-cause mortality data with the age-stratified COVID-19 deaths
reported by the RKI. As of 2020-01-14 the RKI provides &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;weekly
time series of date of death in age groups of 10 years&lt;/a&gt;. Hence, the
previous rough extrapolation from day of report used in the original
blog post is not needed anymore.&lt;/p&gt;
&lt;p&gt;We note that a large part of the increase in mortality can be
explained by COVID-19, i.e. after subtracting the COVID-19 associated
deaths the remainder of the mortality seems comparable with previous
years. This is good news, because deviations would be early signs of
possible secondary adverse health effects due to the COVID-19 pandemic,
i.e. patients trying to avoid the hospital, or care for emergencies
which cannot be given due to lack of ressources.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/AGEMORTWCOVID-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;We note that the COVID-19 associated deaths in the most recent weeks
in the [80,90) age groups make up approximately &lt;a
href=&quot;deaths_covid19_proportion.png&quot;&gt;25% of all deaths reported in the
week&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Considering all-cause mortality and COVID-19 associated mortality as
a measure for the impact of an pandemic is a rather simplistic view of
the pandemic. COVID-19 infections can be very mild, but complicated
progressions can occur without leading to death (see, e.g., &lt;a
href=&quot;https://en.wikipedia.org/wiki/Long_COVID&quot;&gt;long COVID&lt;/a&gt;). Looking
at mortality also ignores the complex interplay between age-groups,
where it can be beneficial to reduce infections in a
not-so-affected-by-the-disease age-group in order to protect the
higher-risk groups. The motivation of this post was primarily to put
COVID-19 associated mortality in relation to all-cause mortality in
order to get a better understanding of the daily number of COVID-19
deaths. An age-stratified view is necessary for this. Furthermore, as
pointed out by &lt;span class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz
(2021)&lt;/span&gt;, excess mortality calculations should take the changing
population structure into account.&lt;/p&gt;
&lt;p&gt;For a more modelling based analysis of the German COVID-19 associated
mortality data based on reported infections see also the work by &lt;span
class=&quot;citation&quot; data-cites=&quot;linden_etal2020&quot;&gt;Linden et al.
(2020)&lt;/span&gt; (&lt;a
href=&quot;https://twitter.com/matthiaslinden/status/1344088091020165125?s=20&quot;&gt;updated
analysis&lt;/a&gt;). More information on real-time mortality monitoring can be
obtained from the &lt;a
href=&quot;https://www.euromomo.eu/how-it-works/methods/&quot;&gt;EuroMoMo
methodology&lt;/a&gt; page or &lt;span class=&quot;citation&quot;
data-cites=&quot;hoehle_mazick2010&quot;&gt;Höhle and Mazick (2010)&lt;/span&gt;. Comments
and feedback to the analysis in this blog post are much appretiated.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-aburto_etal2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Aburto, José Manuel, Jonas Schöley, Luyin Zhang, Ilya Kashnitsky,
Charles Rahal, Trifon I. Missov, Melinda C. Mills, Jennifer B. Dowd, and
Ridhi Kashyap. 2021. &lt;span&gt;“Recent Gains in Life Expectancy Reversed by
the COVID-19 Pandemic.”&lt;/span&gt; &lt;em&gt;medRxiv&lt;/em&gt;. &lt;a
href=&quot;https://doi.org/10.1101/2021.03.02.21252772&quot;&gt;https://doi.org/10.1101/2021.03.02.21252772&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-hoehle_mazick2010&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Höhle, M., and A. Mazick. 2010. &lt;span&gt;“Aberration Detection in
&lt;span&gt;R&lt;/span&gt; Illustrated by &lt;span&gt;D&lt;/span&gt;anish Mortality
Monitoring.”&lt;/span&gt; In &lt;em&gt;Biosurveillance: A Health Protection
Priority&lt;/em&gt;, edited by T. Kass-Hout and X. Zhang, 215–38. CRC Press.
&lt;a
href=&quot;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&quot;&gt;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-kauermann_etal2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Kauermann, G., M. Schneble, G. De Nicola, and U. Berger. 2021.
&lt;span&gt;“Übersterblichkeit in Deutschland - Große Unterschiede Zwischen
Den Bundesländern- in Sachsen Sehr Starke Übersterblichkeit Mit Und Ohne
Corona-Todesfälle.”&lt;/span&gt; Department of Statistics, University of
Munich. &lt;a
href=&quot;https://www.covid19.statistik.uni-muenchen.de/pdfs/codag_bericht_6.pdf&quot;&gt;https://www.covid19.statistik.uni-muenchen.de/pdfs/codag_bericht_6.pdf&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-keiding_clayton2014&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Keiding, N., and D. Clayton. 2014. &lt;span&gt;“Standardization and Control
for Confounding in Observational Studies: A Historical
Perspective.”&lt;/span&gt; &lt;em&gt;Statistical Science&lt;/em&gt; 29 (4): 529–58. &lt;a
href=&quot;http://www.jstor.org/stable/43288498&quot;&gt;http://www.jstor.org/stable/43288498&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-linden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Linden, M., J Dehning, SB Mohr, J Mohring, M Meyer-Hermann, I Pigeot, A
Schöbel, and V Priesemann. 2020. &lt;span&gt;“Case Numbers Beyond Contact
Tracing Capacity Are Endangering the Containment of COVID-19.”&lt;/span&gt;
&lt;em&gt;Dtsch Arztebl Int&lt;/em&gt; 117: 790–91. &lt;a
href=&quot;https://doi.org/10.3238/arztebl.2020.0790&quot;&gt;https://doi.org/10.3238/arztebl.2020.0790&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-nielsen_etal2011&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Nielsen, J., A. Mazick, S. Glismann, and K. Mølbak. 2011. &lt;span&gt;“Excess
Mortality Related to Seasonal Influenza and Extreme Temperatures in
Denmark, 1994-2010.”&lt;/span&gt; &lt;em&gt;BMC Infectious Diseases&lt;/em&gt; 11 (1):
350.
&lt;/div&gt;
&lt;div id=&quot;ref-ragnitz2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Ragnitz, J. 2021. &lt;span&gt;“Hat Die Corona-Pandemie Zu Einer
Übersterblichkeit in Deutschland Geführt? - Aktualisierung
15.1.2020.”&lt;/span&gt; ifo Institute. &lt;a
href=&quot;https://www.ifo.de/publikationen/2021/monographie-autorenschaft/corona-pandemie-uebersterblichkeit-aktualisierung&quot;&gt;https://www.ifo.de/publikationen/2021/monographie-autorenschaft/corona-pandemie-uebersterblichkeit-aktualisierung&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-zurnieden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
zur Nieden, F., B. Sommer, and S. Lüken. 2020. &lt;span&gt;“Sonderauswertung
Der Sterbefallzahlen 2020.”&lt;/span&gt; &lt;em&gt;WISTA – Wirtschaft Und Statistik
– Amtliche Statistik in Zeiten von Corona&lt;/em&gt;, no. 4 (August): 38–50.
&lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 01 Mar 2021 00:00:00 +0100</pubDate>
        <link>https://mhoehle.github.io/blog/2021/03/01/mortadj.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2021/03/01/mortadj.html</guid>
        
        <category>rstats</category>
        
        <category>dataviz</category>
        
        <category>R</category>
        
        <category>COVID-19</category>
        
        <category>SARS-CoV-2</category>
        
        <category>demography</category>
        
        
      </item>
    
      <item>
        <title>Age Stratified All-Cause and COVID-19 Associated Mortality</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We consider the age stratified all-cause and COVID-19 associated
mortality in Germany during 2020 based on numbers provided by the
Federal Statistical Office and the Robert Koch Institute.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 2021-03-01&lt;/strong&gt;: An up-to-date and methodologocial
improved version of the post, including population adjusted excess
mortality calculations for 2020 based on the most recent Destatis and
RKI data is available &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2021/03/01/mortadj.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/AGEMORTWCOVID-1.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The
markdown+Rknitr source code of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from github.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;All-cause mortality is one of indicators used to measure the impact
of the COVID-19 pandemic, because this indicator is less biased by the
testing strategy needed to identify cases to have died while having a
recent COVID-19 diagnosis. Since both death and COVID-19 have a strong
age component, it appears crucial to take an age-stratified view on both
all-cause mortality as well as deaths associated with COVID-19. This
will also help to put age-related COVID-19 mortality in a bigger
picture.&lt;/p&gt;
&lt;h2 id=&quot;age-stratified-mortality&quot;&gt;Age Stratified Mortality&lt;/h2&gt;
&lt;p&gt;Real-time mortality monitoring is not common in Germany, as can be
seen from the coverage of the &lt;a
href=&quot;https://www.euromomo.eu/&quot;&gt;EuroMoMo monitoring&lt;/a&gt; for Germany,
where only the two federal states Hesse and Berlin participate. However,
as part of the COVID-19 response, the Federal Statistical Office
(Destatis) now provides weekly updated &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Querschnitt/Corona/Gesellschaft/kontextinformationen-gesellschaft.html#Sterbe&quot;&gt;preliminary
mortality statistics of all-cause mortality in 2020&lt;/a&gt;. The methodology
behind the numbers as well as age-stratified additional analyses are
described in an accompanying &lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;publication&lt;/a&gt;
&lt;span class=&quot;citation&quot; data-cites=&quot;zurnieden_etal2020&quot;&gt;(zur Nieden,
Sommer, and Lüken 2020)&lt;/span&gt;. The age-stratified analyses are
unfortunately not continuously updated, however, up-to-date data are
made publicly &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Gesellschaft-Umwelt/Bevoelkerung/Sterbefaelle-Lebenserwartung/Tabellen/sonderauswertung-sterbefaelle.html?nn=209016&quot;&gt;available&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/destatis.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;The reported COVID-19 associated deaths (by week of death) are
obtained from an &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;export
of the RKI&lt;/a&gt;. However, the COVID-19 deaths are not available in
age-stratified form. Furthermore, in order to compensate for reporting
delays of deaths, the Destatis analysis only goes until 4 weeks before
the time point of analysis, i.e. the 2020-12-18 version shown in the
above image only reaches ISO week 47 (spanning the time period
2020-11-16 - 2020-11-22).&lt;/p&gt;
&lt;p&gt;The aim of the present blog post is to provide an &lt;strong&gt;up-to-date
age-stratified view including COVID-19 associated deaths&lt;/strong&gt;. As
additional data source we use the age-stratified cumulative number of
deaths reported every Tuesday in the RKI &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Situationsberichte/Dez_2020/2020-12-22-en.pdf?__blob=publicationFile&quot;&gt;situational
report&lt;/a&gt; (p.7).&lt;/p&gt;
&lt;h2 id=&quot;data-io&quot;&gt;Data I/O&lt;/h2&gt;
&lt;p&gt;This section consists of data wrangling the above mentioned data
sources. One challenge is for example to align the age classes used in
the different sources. See the R code on &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2020-12-28-mort.Rmd&quot;&gt;GitHub&lt;/a&gt;
for the gory details.&lt;/p&gt;
&lt;h2 id=&quot;up-to-date-age-stratified-all-cause-mortality&quot;&gt;Up-to-date
age-stratified all-cause mortality&lt;/h2&gt;
&lt;p&gt;Available all-cause deaths (by week of death) are available until
2020-W47. Note that Destatis stresses the &lt;a
href=&quot;https://twitter.com/FlorianBurg2/status/1343903541849681922?s=20&quot;&gt;preliminary
character of the data&lt;/a&gt; - the numbers might change as further deaths
arrive. Stratified by age the times series for 2020 compared to the
years 2016-2019 looks as follows - please beware of the different y-axes
for the age-groups in the plot:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/AGEMORT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Since the age-groups also contain different population sizes, a
better comparison between age-groups instead of absolute numbers is by
&lt;a
href=&quot;/blog/figure/source/2020-12-28-mort/sterbefaelle_incidence.png&quot;&gt;incidence
rate&lt;/a&gt; (i.e. deaths per 100,000 population in the age group). To
underline the age-gradient of mortality: 56% of the deaths 2016-2019
occured in the age group of 80+ years (90% in the age group of 60+). It
becomes clear that 2020 mortality in the 80+ age groups was rather low
during the first 10-12 weeks and then had a spike in connection with the
first COVID-19 wave (March-April). Subsequently, a summer peak (possibly
associated with heat) is followed by an increasing and ongoing upward
trend. One challenge for a statistical analysis of these numbers is to
figure out how much of the upwards trend is “catch-up mortality” due to
the lower mortality in the beginning of the year and how much is excess
related to COVID-19.&lt;/p&gt;
&lt;p&gt;An initial analysis of this question consists of summing the
all-cause mortalities from W1 until W47 for 2020 (observed) and compare
this to the summation of the weekly mean of 2016-2019 for the
corresponding time period (expected)&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot;
id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;. When we do this by
age-group we obtain:&lt;/p&gt;
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;border-bottom: 0;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Age group
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
observed
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
expected_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Percent change
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
min_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
max_20162019
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[00,30)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6533
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7057
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-7%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6802
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7346
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[30,40)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6053
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
5829
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
4%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
5755
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
5869
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[40,50)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
13976
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15348
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-9%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
14093
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
16766
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[50,60)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
51060
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
52527
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-3%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
51445
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
53455
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[60,70)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
104426
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
100734
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
4%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
96860
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
104023
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[70,80)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
176047
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
190420
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-8%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
182443
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
193917
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[80,90)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
325530
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
306112
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
290587
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
315843
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[90,Inf)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
171684
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
160108
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
147177
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
167511
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr grouplength=&quot;1&quot;&gt;
&lt;td colspan=&quot;6&quot; style=&quot;border-bottom: 0;&quot;&gt;
&lt;strong&gt;Total&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left; padding-left:  2em;&quot; indentlevel=&quot;1&quot;&gt;
Total
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
855309
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
838136
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
2%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
811365
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
860975
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&quot;padding: 0; &quot; colspan=&quot;100%&quot;&gt;
&lt;sup&gt;a&lt;/sup&gt; Min and max for row ‘Total’ is obtained by first summing
each of the years 2016-2019 and then take the min and max.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;So in these numbers the mild mortality in the older age groups during
the first weeks balances some, but not all, of the excess in these
age-groups since Mar-Apr. The total proportion of 2020-W1 to 2020-W47
mortalities in the 80+ age group is currently 58%. However, it is also
important to realize that the current observed 2020 numbers contain the
consequences of all type of effects from the pandemic management, which
includes changes in the population behavior due to interventions.
Disentangling the complex effects of all-cause mortality and the
COVID-19 pandemic is a delicate matter, which takes experts in several
disciplines (demographers, statisticians, epidemiologists) to solve.
However, should you based on the above numbers happen to think that
COVID-19 is not a serious problem, it is insightful to think about the
&lt;a href=&quot;https://en.wikipedia.org/wiki/Prevention_paradox&quot;&gt;prevention
paradox&lt;/a&gt; and take a look at the &lt;a
href=&quot;https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938&quot;&gt;all-cause
mortality statistics&lt;/a&gt; from other countries.&lt;/p&gt;
&lt;h3 id=&quot;all-cause-mortality-and-covid-19-associated-deaths&quot;&gt;All-Cause
Mortality and COVID-19 Associated Deaths&lt;/h3&gt;
&lt;p&gt;To see, how much of the all-cause mortality is directly contributed
by deaths in association with COVID-19, we match the age-stratified
all-cause mortality data with the age-stratified COVID-19 deaths
reported by the RKI since Sep 2020 (2020-W35). One complication of this
matching is that the RKI deaths are reported by the week that the
information about the death reached the RKI and not the week of death.
In order to match it with the Destatis all-cause mortality time series,
we extrapolate week of death from the week of report by the simple
assumption that the death occurred 2 weeks before the report&lt;a
href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Furthermore, to avoid a downward bias in the observed numbers by
observed-but-not-yet-reported deaths, the previously shown Destatis
analyses of all-cause mortality does not include the most recent weeks,
where COVID-19 associated mortality increased substantially in Germany:
the analysis is only done until 2020-W47, even though the date of
analysis was 2020-12-18. At this time the RKI in their situational
report of 2020-12-22 already reported a total of 26964 COVID-19
associated deaths - only 15686 have their time of death up to 2020-W47.
We thus expect the reported excess mortality to increase within the
coming weeks. As a simple extrapolation, we assume that all COVID-19
associated mortality in the subsequent weeks above the level in
2020-W47, is directly summable to the 2020 all-cause mortality&lt;a
href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;. With this simple extrapolation, the
excess mortality computations can be extended until 2020-W50 and leads
to the following predictions:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/AGEMORTWCOVID-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;We note that the COVID-19 associated deaths in the most recent weeks
in the 80+ age groups make up more than &lt;a
href=&quot;/blog/figure/source/2020-12-28-mort/deaths_covid19_proportion.png&quot;&gt;30%
of all deaths reported on average over the years 2016-2019&lt;/a&gt;. This
would mean an excess of mortality for the period of 2020-W01 to 2020-W50
of 5%, which is likely to increase even further as the remaining weeks
of 2020 are added&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Considering all-cause mortality and COVID-19 associated mortality as
a measure for the impact of an pandemic is a rather simplistic view of
the pandemic. COVID-19 infections can be very mild, but complicated
progressions can occur without leading to death (see, e.g., &lt;a
href=&quot;https://en.wikipedia.org/wiki/Long_COVID&quot;&gt;long COVID&lt;/a&gt;). Looking
at mortality also ignores the complex interplay between age-groups,
where it can be beneficial to reduce infections in a
not-so-affected-by-the-disease age-group in order to protect the
higher-risk groups. The motivation of this post was primarily to put
COVID-19 associated mortality in relation to all-cause mortality in
order to get a better understanding of the daily number of COVID-19
deaths. An age-stratified view is necessary for this.&lt;/p&gt;
&lt;p&gt;We showed that the Destatis reported excess-mortality are expected to
increase in the coming weeks. The extrapolations used in the present
analysis are simplistic and could be improved by a &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2016/07/19/nowCast.html&quot;&gt;nowcasting
approach&lt;/a&gt;, which extrapolates not-yet-reported deaths from knowledge
about the reporting delay &lt;span class=&quot;citation&quot;
data-cites=&quot;schneble_etal2020&quot;&gt;(Schneble et al. 2020)&lt;/span&gt;. For a more
modelling based analysis of the German COVID-19 associated mortality
data see also the work by &lt;span class=&quot;citation&quot;
data-cites=&quot;linden_etal2020&quot;&gt;Linden et al. (2020)&lt;/span&gt; (&lt;a
href=&quot;https://twitter.com/matthiaslinden/status/1338984728209338369?s=20&quot;&gt;updated
analysis&lt;/a&gt;). More information on real-time mortality monitoring can be
obtained from the &lt;a
href=&quot;https://www.euromomo.eu/how-it-works/methods/&quot;&gt;EuroMoMo
methodology&lt;/a&gt; page or &lt;span class=&quot;citation&quot;
data-cites=&quot;hoehle_mazick2010&quot;&gt;Höhle and Mazick (2010)&lt;/span&gt;. Comments
and feedback to the analysis in this blog post are much appretiated.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 2020-03-01&lt;/strong&gt;: An up-to-date version of this
post, including an analysis of the most recent Destatis and RKI data is
available &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2021/03/01/mortadj.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
data-entry-spacing=&quot;0&quot; role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-hoehle_mazick2010&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Höhle, M., and A. Mazick. 2010. &lt;span&gt;“Aberration Detection in
&lt;span&gt;R&lt;/span&gt; Illustrated by &lt;span&gt;D&lt;/span&gt;anish Mortality
Monitoring.”&lt;/span&gt; In &lt;em&gt;Biosurveillance: A Health Protection
Priority&lt;/em&gt;, edited by T. Kass-Hout and X. Zhang, 215–38. CRC Press.
&lt;a
href=&quot;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&quot;&gt;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-linden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Linden, M., J Dehning, SB Mohr, J Mohring, M Meyer-Hermann, I Pigeot, A
Schöbel, and V Priesemann. 2020. &lt;span&gt;“Case Numbers Beyond Contact
Tracing Capacity Are Endangering the Containment of COVID-19.”&lt;/span&gt;
&lt;em&gt;Dtsch Arztebl Int&lt;/em&gt; 117: 790–91. &lt;a
href=&quot;https://doi.org/10.3238/arztebl.2020.0790&quot;&gt;https://doi.org/10.3238/arztebl.2020.0790&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-schneble_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Schneble, M., G. De Nicola G, G. Kauermann, and U. Berger. 2020.
&lt;span&gt;“Nowcasting Fatal COVID-19 Infections on a Regional Level in
Germany.”&lt;/span&gt; &lt;em&gt;Biometrical Journal&lt;/em&gt;. &lt;a
href=&quot;https://doi.org/10.1002/bimj.202000143&quot;&gt;https://doi.org/10.1002/bimj.202000143&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-zurnieden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
zur Nieden, F., B. Sommer, and S. Lüken. 2020. &lt;span&gt;“Sonderauswertung
Der Sterbefallzahlen 2020.”&lt;/span&gt; &lt;em&gt;WISTA – Wirtschaft Und Statistik
– Amtliche Statistik in Zeiten von Corona&lt;/em&gt;, no. 4 (August): 38–50.
&lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;More involved ways to compute excess-mortality are
imaginable.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Using two weeks provided the best fit to the
unstratified number of observed cases by week of death. More advanced
transformation schemes than simply subtracting two week are
imaginable.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Note: This is really a guesstimate and might produce a
slight excess, because some of the individuals who would have died in
this week in a COVID-free year, by chance now happen to die this week
with COVID-19. However, part of inferential statistics is to make
predictions (which can be wrong) in timely fashion. If you want the
&lt;em&gt;true numbers&lt;/em&gt;, you will have to wait to end of Jan 2021 or even
to mid-2021 (when the official mortality statistics is released). This
is not helpful for situational awareness during a pandemic.&lt;a
href=&quot;#fnref3&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;Note that 2020 has an ISO week 53 spanning 2020-12-28 to
2021-01-03, whereas none of years 2016-2019 had an ISO week 53. It will
be interesting to see how this week will be handled by Destatis for the
excess mortality calculations.&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Mon, 28 Dec 2020 00:00:00 +0100</pubDate>
        <link>https://mhoehle.github.io/blog/2020/12/28/mort.html</link>
        <guid isPermaLink="true">https://mhoehle.github.io/blog/2020/12/28/mort.html</guid>
        
        <category>rstats</category>
        
        <category>dataviz</category>
        
        <category>R</category>
        
        <category>COVID-19</category>
        
        <category>SARS-CoV-2</category>
        
        <category>demography</category>
        
        
      </item>
    
  </channel>
</rss>
