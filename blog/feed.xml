<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Theory meets practice...</title>
    <description>A blog about statistics in theory and practice. Not always serious, not always flawless, but definitely a statistically flavoured bean.
</description>
    <link>http://mhoehle.github.io/blog/</link>
    <atom:link href="http://mhoehle.github.io/blog/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 20 Mar 2023 15:21:34 +0100</pubDate>
    <lastBuildDate>Mon, 20 Mar 2023 15:21:34 +0100</lastBuildDate>
    <generator>Jekyll v4.2.2</generator>
    
      <item>
        <title>Dynamic Programming for Super Six</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We use dynamic programming to find the optimal strategy for playing
Super Six when there are 2 players. To test the cross-language
capabilities of rmarkdown we solve the task by embedding our Python
implementation of the value iteration algorithm using the reticulate
R-package.&lt;/p&gt;
&lt;center&gt;
&lt;img
src=&quot;/blog/figure/source/2023-03-20-dynprog/optim_strategy-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/mhoehle/mhoehle.github.io/master/_source/blog2023-03-20-dynprog.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The present post finds the optimal game strategy for playing the dice
game of Super Six with two players using dynamic programming to solve
the corresponding Markov Decision Process (MDP). We use the
&lt;code&gt;reticulate&lt;/code&gt; R package to run our Python implementation of
value iteration within the rmarkdown document.&lt;/p&gt;
&lt;p&gt;For more details about Super Six, see the previous Blog post &lt;a
href=&quot;https://mhoehle.github.io/blog/2023/03/13/super6.html&quot;&gt;&lt;em&gt;How to
Win a Game (or More) of Super Six&lt;/em&gt;&lt;/a&gt; for a description of the
game. Appendix 1 of the post discussed optimal strategies. The present
post is a natural sucessor of this post, because it shows the details of
how to calculate an the optimal strategies for two player games by using
value iteration &lt;span class=&quot;citation&quot;
data-cites=&quot;russell_norvig2020&quot;&gt;Sutton and Barto (2020)&lt;/span&gt;. This IMO
provides a clearer way to get to the strategy than, e.g., &lt;span
class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn (2021)&lt;/span&gt; or the C++
program by &lt;a
href=&quot;https://github.com/mhoehle/mhoehle.github.io/blob/main/blog/figure/source/2023-03-13-super6/hultberg2.cpp&quot;&gt;Nuno
Hulthberg&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;notation&quot;&gt;Notation&lt;/h2&gt;
&lt;p&gt;In mathematical notation the current state &lt;span
class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; corresponds to the &lt;span
class=&quot;math inline&quot;&gt;\(i/j/k\)&lt;/span&gt; situation, with &lt;span
class=&quot;math inline&quot;&gt;\(0\leq i\leq 5\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\(j\geq 0\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(k\geq 0\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;In order to distinguish between the first turn of a player in a round
(where the dice has to be thrown) and the subsequent turns, where the
player can decide whether to throw the dice or stop, we add a fourth
component &lt;span class=&quot;math inline&quot;&gt;\(l\in \{0,1\}\)&lt;/span&gt; to the
state, which is a binary indicator whether the move is a forced moved
(1) or not (0). The action space for a state &lt;span
class=&quot;math inline&quot;&gt;\(i/j/k/l\)&lt;/span&gt; with &lt;span
class=&quot;math inline&quot;&gt;\(l=1\)&lt;/span&gt; is &lt;span
class=&quot;math inline&quot;&gt;\(\mathcal{A}(s) = \{\texttt{throw}\}\)&lt;/span&gt;,
whereas for &lt;span class=&quot;math inline&quot;&gt;\(l=0\)&lt;/span&gt; it is &lt;span
class=&quot;math inline&quot;&gt;\(\mathcal{A}(s) =
\{\texttt{throw},\texttt{stop}\}\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;If &lt;span class=&quot;math inline&quot;&gt;\(j=0\)&lt;/span&gt; while &lt;span
class=&quot;math inline&quot;&gt;\(k&amp;gt;0\)&lt;/span&gt; then Player 1 won. If &lt;span
class=&quot;math inline&quot;&gt;\(k=0\)&lt;/span&gt; while &lt;span
class=&quot;math inline&quot;&gt;\(i&amp;gt;0\)&lt;/span&gt; then Player 2 won. In order to
handle this &lt;em&gt;episodic task&lt;/em&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;sutton_burto2020&quot;&gt;(Sutton and Barto 2020)&lt;/span&gt; we
introduce an terminal state, which provides no additional future
reward.&lt;/p&gt;
&lt;h3 id=&quot;state-transition&quot;&gt;State Transition&lt;/h3&gt;
&lt;p&gt;The state transition probabilities of the Markov decision process are
given as follows. For each throw of the dice from an &lt;span
class=&quot;math inline&quot;&gt;\(i/j/k/l\)&lt;/span&gt; state there are three cases to
consider when throwing the dice:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;you roll a six (probability &lt;span
class=&quot;math inline&quot;&gt;\(\frac{1}{6}\)&lt;/span&gt;) and move to the &lt;span
class=&quot;math inline&quot;&gt;\(i/(j-1)/k/0\)&lt;/span&gt; state&lt;/li&gt;
&lt;li&gt;(if &lt;span class=&quot;math inline&quot;&gt;\(0\leq i&amp;lt; 5\)&lt;/span&gt;) you hit a
free spot (probability &lt;span
class=&quot;math inline&quot;&gt;\(\frac{5-i}{6}\)&lt;/span&gt;) and move to the &lt;span
class=&quot;math inline&quot;&gt;\((i+1)/j/k/0\)&lt;/span&gt; state&lt;/li&gt;
&lt;li&gt;(if &lt;span class=&quot;math inline&quot;&gt;\(0&amp;lt;i\leq 5\)&lt;/span&gt;) you hit an
already occupied spot (probability &lt;span
class=&quot;math inline&quot;&gt;\(\frac{i}{6}\)&lt;/span&gt;) and it is your opponents
turn to play from an &lt;span
class=&quot;math inline&quot;&gt;\((i-1)/k/(j+1)/1\)&lt;/span&gt; position&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you decide to stop throwing (only possible if &lt;span
class=&quot;math inline&quot;&gt;\(l=0\)&lt;/span&gt;) then it is the opponent’s turn to
play from an &lt;span class=&quot;math inline&quot;&gt;\(i/k/j/1\)&lt;/span&gt; position.&lt;/p&gt;
&lt;p&gt;As part of the calculations one needs to know what happens if Player
1 looses their turn (i.e. either by hitting an occupied spot or by
voluntarily deciding to stop) This depends on the strategy played by
Player 2. For simplicity we will assume that Player 2 plays the same
optimal strategy as Player 1. This also means that rewards in this
situation are just minus the rewards obtained from the corresponding
position.&lt;/p&gt;
&lt;h3 id=&quot;reward&quot;&gt;Reward&lt;/h3&gt;
&lt;p&gt;Eventually, the game will finish. Let &lt;span
class=&quot;math inline&quot;&gt;\(R(s,a,s&amp;#39;)\)&lt;/span&gt; be the reward function,
where action &lt;span class=&quot;math inline&quot;&gt;\(a\)&lt;/span&gt; moves the decision
maker from state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; to &lt;span
class=&quot;math inline&quot;&gt;\(s&amp;#39;\)&lt;/span&gt;. In our problem, the reward will
only depend on &lt;span class=&quot;math inline&quot;&gt;\(s&amp;#39;\)&lt;/span&gt;. We have
&lt;span class=&quot;math display&quot;&gt;\[
R(s&amp;#39;=(i,j,k,l)) = \left\{
\begin{array}{cl}
1 &amp;amp; \text{if $j=0$ and $k&amp;gt;0$} \\
-1 &amp;amp; \text{if $k=0$ and $j&amp;gt;0$} \\
0 &amp;amp; \text{otherwise}
\end{array}
\right.
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Side note: Since linear transformations of the reward function leave
the optimal strategy unchanged &lt;span class=&quot;citation&quot;
data-cites=&quot;russell_norvig2020&quot;&gt;(Sect. 17.1.3, Russell and Norvig
2020)&lt;/span&gt;, it is equally possible to work with rewards &lt;span
class=&quot;math inline&quot;&gt;\(R^*(s&amp;#39;=(i,j,k,l)) =
\frac{1}{2}R(s&amp;#39;=(i,j,k,l)) + \frac{1}{2}\)&lt;/span&gt;. This would imply
values 1 for winning and 0 for loosing and translates directly the
expected reward computations into computing expected probabilities for
winning, which is what &lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn
(2021)&lt;/span&gt; computed.&lt;/p&gt;
&lt;h3 id=&quot;bellman-equations&quot;&gt;Bellman equations&lt;/h3&gt;
&lt;p&gt;The expected utility obtained from following stragy &lt;span
class=&quot;math inline&quot;&gt;\(\pi\)&lt;/span&gt; is defined as &lt;span
class=&quot;math display&quot;&gt;\[
U^{\pi}(s) = E\left[ \sum_{t=0}^\infty R(S_t, \pi(S_t), S_{t+1})\right]
\]&lt;/span&gt; The terminal state with future reward 0 ensures that &lt;span
class=&quot;math inline&quot;&gt;\(U^\pi(s)&amp;lt;\infty\)&lt;/span&gt;. No discounting of the
rewards is thus used in our approach. Our aim is now to find a strategy
&lt;span class=&quot;math inline&quot;&gt;\(\pi^*(s)\)&lt;/span&gt;, which optimizes this
expected utility, i.e. &lt;span class=&quot;math display&quot;&gt;\[
\pi_s^* = \operatorname{argmax}_{\pi} U^{\pi}(s)
\]&lt;/span&gt; For state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; we thus
choose the action that maximizes the reward for the next step plus the
expected utility of the subsequent states: &lt;span class=&quot;math display&quot;&gt;\[
\pi^*(s) = \operatorname{argmax}_{a\in \mathcal{A}(s)}
\sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[ R(s,a,s&amp;#39;) +  \max_{a&amp;#39;}
U(s&amp;#39;) \right]
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This expressions for a state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt;
is also called the &lt;strong&gt;Bellman equation&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[\begin{align*}
U(s)
&amp;amp;=\max_{a\in \mathcal{A}(s)} \sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[
R(s,a,s&amp;#39;) + U(s&amp;#39;)
\right]
\end{align*}\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Hence, for a state &lt;span class=&quot;math inline&quot;&gt;\(i/j/k/0\)&lt;/span&gt; the
action “continue” leads to to the following expansion of the sum term in
the above equation:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
\begin{align*}
&amp;amp; \underbrace{\frac{1}{6} [R(i/j-1/k/0) +
U(i/j-1/k/0)]}_{\text{stick into hole}} \\
&amp;amp;+ \underbrace{\frac{5-i}{6} [R(i+1/j-1/k/0)
+  U(i+1/j-1/k/0)]}_{\text{put stick into lid}}\\
&amp;amp;- \underbrace{\frac{i}{6} [R(i-1/k/j+1/1)
+  U(i-1/k/j+1/1)]}_{\text{take stick from lid}}
\end{align*}
\]&lt;/span&gt; and the action to stop has value &lt;span
class=&quot;math inline&quot;&gt;\(R(i-1/k/j+1/1) + U(i-1/k/j+1/1)\)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;value-iteration&quot;&gt;Value Iteration&lt;/h2&gt;
&lt;p&gt;We use &lt;strong&gt;value iteration&lt;/strong&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;russell_norvig2020&quot;&gt;(Sect. 17.2.1, Russell and Norvig
2020)&lt;/span&gt;, &lt;span class=&quot;citation&quot; data-cites=&quot;sutton_burto2020&quot;&gt;(Sect
4.4, Sutton and Barto 2020)&lt;/span&gt; to solve the MDP. Let &lt;span
class=&quot;math inline&quot;&gt;\(U(s)\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(U&amp;#39;\)&lt;/span&gt; be collections, which contain the
value function for each &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; in the
state space. We initialize &lt;span
class=&quot;math inline&quot;&gt;\(U(s)=U&amp;#39;(s)=0\)&lt;/span&gt; for all states and
proceed by the following algorithm:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;Algorithm 1&lt;/strong&gt;: Value iteration&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;repeat&lt;/strong&gt;&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(U \gets U&amp;#39;; \delta \gets
0\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;For all&lt;/strong&gt; states &lt;span
class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt; &lt;strong&gt;do&lt;/strong&gt;
&lt;ol type=&quot;a&quot;&gt;
&lt;li&gt;&lt;span class=&quot;math inline&quot;&gt;\(U&amp;#39;(s) \gets \max_{a\in
\mathcal{A}(s)} \sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[ R(s,a,s&amp;#39;) +
U(s&amp;#39;) \right]\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;if&lt;/strong&gt; &lt;span class=&quot;math inline&quot;&gt;\(|U(s&amp;#39;)-U(s)|
&amp;gt; \delta\)&lt;/span&gt; &lt;strong&gt;then&lt;/strong&gt; &lt;span
class=&quot;math inline&quot;&gt;\(\delta \gets |U(s&amp;#39;)-U(s)|\)&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;until&lt;/strong&gt; &lt;span class=&quot;math inline&quot;&gt;\(\delta \leq
\epsilon\)&lt;/span&gt;;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;
&lt;p&gt;The optimal action for state &lt;span class=&quot;math inline&quot;&gt;\(s\)&lt;/span&gt;
is thus the action maximing the sum term in Step 2a, i.e. &lt;span
class=&quot;math inline&quot;&gt;\(\pi(s) = \operatorname{argmax}_{a\in
\mathcal{A}(s)} \sum_{s&amp;#39;}P(s&amp;#39;| s,a) \left[ R(s,a,s&amp;#39;) +
\max_{a&amp;#39;} U(s&amp;#39;) \right]\)&lt;/span&gt;. Either one computes this at
the end of the algorithm or one adds this book-keeping step as part of
step 2a in the value iteration algorithm. Technically, &lt;span
class=&quot;math inline&quot;&gt;\(\pi\approx \pi^*\)&lt;/span&gt;, i.e. we only obtain an
estimate of the optimal strategy, because of the iterative nature of the
algorithm. However, one can show that with sufficient iterations we
converge towards &lt;span class=&quot;math inline&quot;&gt;\(\pi^*\)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;results&quot;&gt;Results&lt;/h2&gt;
&lt;p&gt;Applying the value iteration Python code for &lt;span
class=&quot;math inline&quot;&gt;\(n=7\)&lt;/span&gt; (see code in the Appendix) gives the
optimal strategy. Furthermore, we also obtain the probabilities to win
from each state. We show the result for all states with at least 3
sticks in the lid. With less than 3 sticks the decision is always to
continue throwing.&lt;/p&gt;
&lt;p&gt;In the output, the column &lt;code&gt;strategy&lt;/code&gt; shows whether to
continue throwing the dice (&lt;code&gt;TRUE&lt;/code&gt;) or not
(&lt;code&gt;FALSE&lt;/code&gt;); the column &lt;code&gt;value&lt;/code&gt; shows the expected
value &lt;span class=&quot;math inline&quot;&gt;\(U(s)\)&lt;/span&gt; and &lt;code&gt;prob&lt;/code&gt;
shows the expected probability to win the game given that the opponent
also follows the same optimal strategy. Note that for states with &lt;span
class=&quot;math inline&quot;&gt;\(l=1\)&lt;/span&gt;, no choice is possible, i.e. one has
to continue no matter what. For these states the strategy column is
always &lt;code&gt;TRUE&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;##    i j k l       value strategy      prob
## 1  5 1 1 1 -0.09741652     TRUE 0.4512917
## 2  5 1 1 0  0.09741652    FALSE 0.5487083
## 3  4 2 1 1 -0.36297663     TRUE 0.3185117
## 4  4 2 1 0 -0.31689982    FALSE 0.3415501
## 5  4 1 2 1  0.31689982     TRUE 0.6584499
## 6  4 1 2 0  0.36297663    FALSE 0.6814883
## 7  4 1 1 1  0.04845936     TRUE 0.5242297
## 8  4 1 1 0  0.04845936     TRUE 0.5242297
## 9  3 3 1 1 -0.52748432     TRUE 0.2362578
## 10 3 3 1 0 -0.52748432     TRUE 0.2362578
## 11 3 2 2 1  0.02465027     TRUE 0.5123251
## 12 3 2 2 0  0.02465027     TRUE 0.5123251
## 13 3 2 1 1 -0.27737920     TRUE 0.3613104
## 14 3 2 1 0 -0.27737920     TRUE 0.3613104
## 15 3 1 3 1  0.58093392     TRUE 0.7904670
## 16 3 1 3 0  0.58093392     TRUE 0.7904670
## 17 3 1 2 1  0.42731097     TRUE 0.7136555
## 18 3 1 2 0  0.42731097     TRUE 0.7136555
## 19 3 1 1 1  0.22509739     TRUE 0.6125487
## 20 3 1 1 0  0.22509739     TRUE 0.6125487&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;One can, e.g., compare the results with the numbers in Fig. 4 of
&lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn (2021)&lt;/span&gt;. The
optimal strategy for a two player game is thus to continue as long as
only three pits are filled. If four slots are filled, one would only
continue, if the situation is 4/1/1. If 5 pits are filled, one should
always stop (if possible). The figure below illustrates the strategy for
all &lt;span class=&quot;math inline&quot;&gt;\(l=0\)&lt;/span&gt; states graphically: the
y-axis gives &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; whereas the label of
each box is &lt;span class=&quot;math inline&quot;&gt;\(j/k\)&lt;/span&gt; above the expected
probability to win from this state (with 2 decimals):&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2023-03-20-dynprog/optim_strategy-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Dynamic programming is an important foundation for reinforcement
learning. We can use it to find optimal strategies in fully observable
stochastic environments. For environments with reasonable sized state
spaces and with a known stochastic model for the transitions between
states, dynamic programming is a direct method to get exact solutions.
No complex approximate solutions, as e.g. discussed in Part 2 of &lt;span
class=&quot;citation&quot; data-cites=&quot;sutton_burto2020&quot;&gt;Sutton and Barto
(2020)&lt;/span&gt;, are needed.&lt;/p&gt;
&lt;h2 id=&quot;appendix-python-code&quot;&gt;Appendix: Python code&lt;/h2&gt;
&lt;p&gt;The Python code for value iteration can be found as &lt;a
href=&quot;/Users/hoehle/Sandbox/Blog/figure/source/2023-03-20-dynprog/value_iteration.py&quot;&gt;&lt;code&gt;value_iteration.py&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre
class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Python implementation of value iteration to find the optimal strategy in Super Six  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Author: Michael Höhle&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Date:   2023-03-16&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Semi-manual translation of the R code in value_iteration.R to python with the &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# help of OpenAI&amp;#39;s text-davinci-003 API playground feature https://platform.openai.com/playground/p/default-text-to-command?model=text-davinci-003.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; np&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; pandas &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; pd&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; make_situations(n):&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;Returns all situations in a game with n sticks left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-15&quot;&gt;&lt;a href=&quot;#cb2-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-16&quot;&gt;&lt;a href=&quot;#cb2-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-17&quot;&gt;&lt;a href=&quot;#cb2-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    n : int&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-18&quot;&gt;&lt;a href=&quot;#cb2-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The number of sticks left in the game&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-19&quot;&gt;&lt;a href=&quot;#cb2-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-20&quot;&gt;&lt;a href=&quot;#cb2-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-21&quot;&gt;&lt;a href=&quot;#cb2-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-22&quot;&gt;&lt;a href=&quot;#cb2-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-23&quot;&gt;&lt;a href=&quot;#cb2-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        a list of with entries [i,j,k] &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-24&quot;&gt;&lt;a href=&quot;#cb2-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-25&quot;&gt;&lt;a href=&quot;#cb2-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb2-26&quot;&gt;&lt;a href=&quot;#cb2-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Number of sticks in the lid&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-27&quot;&gt;&lt;a href=&quot;#cb2-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;min&lt;/span&gt;(n,&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;),&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-28&quot;&gt;&lt;a href=&quot;#cb2-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Number of sticks of player 1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-29&quot;&gt;&lt;a href=&quot;#cb2-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(n,&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-30&quot;&gt;&lt;a href=&quot;#cb2-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Number of sticks of player 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-31&quot;&gt;&lt;a href=&quot;#cb2-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            k &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; n &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; i &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; j&lt;/span&gt;
&lt;span id=&quot;cb2-32&quot;&gt;&lt;a href=&quot;#cb2-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Only add valid states&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-33&quot;&gt;&lt;a href=&quot;#cb2-33&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (i&lt;span class=&quot;op&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; (j&lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;or&lt;/span&gt; k&lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)):&lt;/span&gt;
&lt;span id=&quot;cb2-34&quot;&gt;&lt;a href=&quot;#cb2-34&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                &lt;span class=&quot;co&quot;&gt;# Append the state as an array [i,j,k]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-35&quot;&gt;&lt;a href=&quot;#cb2-35&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                res.append([i,j,k])&lt;/span&gt;
&lt;span id=&quot;cb2-36&quot;&gt;&lt;a href=&quot;#cb2-36&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb2-37&quot;&gt;&lt;a href=&quot;#cb2-37&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-38&quot;&gt;&lt;a href=&quot;#cb2-38&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-39&quot;&gt;&lt;a href=&quot;#cb2-39&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; make_states(n):&lt;/span&gt;
&lt;span id=&quot;cb2-40&quot;&gt;&lt;a href=&quot;#cb2-40&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;All states when there are n sticks in the game left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-41&quot;&gt;&lt;a href=&quot;#cb2-41&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-42&quot;&gt;&lt;a href=&quot;#cb2-42&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    We distinguish between states with a choice if to throw the dice and those without&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-43&quot;&gt;&lt;a href=&quot;#cb2-43&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-44&quot;&gt;&lt;a href=&quot;#cb2-44&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-45&quot;&gt;&lt;a href=&quot;#cb2-45&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-46&quot;&gt;&lt;a href=&quot;#cb2-46&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    n : int&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-47&quot;&gt;&lt;a href=&quot;#cb2-47&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The number of sticks left in the game&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-48&quot;&gt;&lt;a href=&quot;#cb2-48&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-49&quot;&gt;&lt;a href=&quot;#cb2-49&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-50&quot;&gt;&lt;a href=&quot;#cb2-50&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-51&quot;&gt;&lt;a href=&quot;#cb2-51&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-52&quot;&gt;&lt;a href=&quot;#cb2-52&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        a list of with entries [i,j,k] &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-53&quot;&gt;&lt;a href=&quot;#cb2-53&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;   &lt;/span&gt;
&lt;span id=&quot;cb2-54&quot;&gt;&lt;a href=&quot;#cb2-54&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    states &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb2-55&quot;&gt;&lt;a href=&quot;#cb2-55&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,n&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-56&quot;&gt;&lt;a href=&quot;#cb2-56&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        s &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; make_situations(i)&lt;/span&gt;
&lt;span id=&quot;cb2-57&quot;&gt;&lt;a href=&quot;#cb2-57&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Make list comprehension which adds a fourth component indicating if the move is forced (0=no, 1=yes)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-58&quot;&gt;&lt;a href=&quot;#cb2-58&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-59&quot;&gt;&lt;a href=&quot;#cb2-59&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            states.extend([x &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; [j] &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; x &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; s])&lt;/span&gt;
&lt;span id=&quot;cb2-60&quot;&gt;&lt;a href=&quot;#cb2-60&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Sort the list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-61&quot;&gt;&lt;a href=&quot;#cb2-61&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    states.sort(reverse&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-62&quot;&gt;&lt;a href=&quot;#cb2-62&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(states)&lt;/span&gt;
&lt;span id=&quot;cb2-63&quot;&gt;&lt;a href=&quot;#cb2-63&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-64&quot;&gt;&lt;a href=&quot;#cb2-64&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; swap(state, forced_move &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-65&quot;&gt;&lt;a href=&quot;#cb2-65&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-66&quot;&gt;&lt;a href=&quot;#cb2-66&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Swap the number of sticks of player 1 and 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-67&quot;&gt;&lt;a href=&quot;#cb2-67&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-68&quot;&gt;&lt;a href=&quot;#cb2-68&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-69&quot;&gt;&lt;a href=&quot;#cb2-69&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-70&quot;&gt;&lt;a href=&quot;#cb2-70&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    state : vector of length 4&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-71&quot;&gt;&lt;a href=&quot;#cb2-71&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The state of the game as a vector with 4 components&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-72&quot;&gt;&lt;a href=&quot;#cb2-72&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-73&quot;&gt;&lt;a href=&quot;#cb2-73&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    forced_move : bool&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-74&quot;&gt;&lt;a href=&quot;#cb2-74&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        If the move is forced (i.e. the player has to swap the sticks)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-75&quot;&gt;&lt;a href=&quot;#cb2-75&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-76&quot;&gt;&lt;a href=&quot;#cb2-76&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-77&quot;&gt;&lt;a href=&quot;#cb2-77&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-78&quot;&gt;&lt;a href=&quot;#cb2-78&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The new state as a vector of length 4&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-79&quot;&gt;&lt;a href=&quot;#cb2-79&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-80&quot;&gt;&lt;a href=&quot;#cb2-80&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [state[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], state[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;], state[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;], state[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;]]&lt;/span&gt;
&lt;span id=&quot;cb2-81&quot;&gt;&lt;a href=&quot;#cb2-81&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (forced_move &lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-82&quot;&gt;&lt;a href=&quot;#cb2-82&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        res[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; forced_move&lt;/span&gt;
&lt;span id=&quot;cb2-83&quot;&gt;&lt;a href=&quot;#cb2-83&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb2-84&quot;&gt;&lt;a href=&quot;#cb2-84&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-85&quot;&gt;&lt;a href=&quot;#cb2-85&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; add_state(state, Delta, forced_move &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-86&quot;&gt;&lt;a href=&quot;#cb2-86&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;bu&quot;&gt;sum&lt;/span&gt;(x) &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; x &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;zip&lt;/span&gt;(state, Delta)]&lt;/span&gt;
&lt;span id=&quot;cb2-87&quot;&gt;&lt;a href=&quot;#cb2-87&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (forced_move &lt;span class=&quot;op&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;None&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-88&quot;&gt;&lt;a href=&quot;#cb2-88&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        res[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; forced_move&lt;/span&gt;
&lt;span id=&quot;cb2-89&quot;&gt;&lt;a href=&quot;#cb2-89&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb2-90&quot;&gt;&lt;a href=&quot;#cb2-90&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-91&quot;&gt;&lt;a href=&quot;#cb2-91&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-92&quot;&gt;&lt;a href=&quot;#cb2-92&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; R(state):&lt;/span&gt;
&lt;span id=&quot;cb2-93&quot;&gt;&lt;a href=&quot;#cb2-93&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;The immediate reward function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-94&quot;&gt;&lt;a href=&quot;#cb2-94&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-95&quot;&gt;&lt;a href=&quot;#cb2-95&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Parameters&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-96&quot;&gt;&lt;a href=&quot;#cb2-96&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    ----------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-97&quot;&gt;&lt;a href=&quot;#cb2-97&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    state : list&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-98&quot;&gt;&lt;a href=&quot;#cb2-98&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        The state of the game as a vector with 4 components&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-99&quot;&gt;&lt;a href=&quot;#cb2-99&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-100&quot;&gt;&lt;a href=&quot;#cb2-100&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    Returns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-101&quot;&gt;&lt;a href=&quot;#cb2-101&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    -------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-102&quot;&gt;&lt;a href=&quot;#cb2-102&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    double The reward R(state), i.e. 1 if player 1 wins, -1 if player 2 wins, 0 otherwise&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-103&quot;&gt;&lt;a href=&quot;#cb2-103&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-104&quot;&gt;&lt;a href=&quot;#cb2-104&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-105&quot;&gt;&lt;a href=&quot;#cb2-105&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# A terminal state (player 1 = 0)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-106&quot;&gt;&lt;a href=&quot;#cb2-106&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; state[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb2-107&quot;&gt;&lt;a href=&quot;#cb2-107&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-108&quot;&gt;&lt;a href=&quot;#cb2-108&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# A terminal state (player 2 = 0)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-109&quot;&gt;&lt;a href=&quot;#cb2-109&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; state[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb2-110&quot;&gt;&lt;a href=&quot;#cb2-110&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-111&quot;&gt;&lt;a href=&quot;#cb2-111&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Other state (nothing)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-112&quot;&gt;&lt;a href=&quot;#cb2-112&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-113&quot;&gt;&lt;a href=&quot;#cb2-113&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-114&quot;&gt;&lt;a href=&quot;#cb2-114&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; optimal_strategy(n, debug&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-115&quot;&gt;&lt;a href=&quot;#cb2-115&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&amp;quot;Find the optimal strategy for a game with n sticks left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-116&quot;&gt;&lt;a href=&quot;#cb2-116&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-117&quot;&gt;&lt;a href=&quot;#cb2-117&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-118&quot;&gt;&lt;a href=&quot;#cb2-118&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Define local variables for the function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-119&quot;&gt;&lt;a href=&quot;#cb2-119&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    states &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; make_states(n)&lt;/span&gt;
&lt;span id=&quot;cb2-120&quot;&gt;&lt;a href=&quot;#cb2-120&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_states &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;len&lt;/span&gt;(states)&lt;/span&gt;
&lt;span id=&quot;cb2-121&quot;&gt;&lt;a href=&quot;#cb2-121&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;## Storage of the value function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-122&quot;&gt;&lt;a href=&quot;#cb2-122&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    U_vec &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.zeros(n_states)&lt;/span&gt;
&lt;span id=&quot;cb2-123&quot;&gt;&lt;a href=&quot;#cb2-123&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    U_vec_prime &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.zeros(n_states)&lt;/span&gt;
&lt;span id=&quot;cb2-124&quot;&gt;&lt;a href=&quot;#cb2-124&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;## Storage of the policy/strategy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-125&quot;&gt;&lt;a href=&quot;#cb2-125&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    pi &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.full(n_states, np.nan)&lt;/span&gt;
&lt;span id=&quot;cb2-126&quot;&gt;&lt;a href=&quot;#cb2-126&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-127&quot;&gt;&lt;a href=&quot;#cb2-127&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Future reward function.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-128&quot;&gt;&lt;a href=&quot;#cb2-128&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Note terminating states (i=0 or j=0) have zero future reward.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-129&quot;&gt;&lt;a href=&quot;#cb2-129&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# The function uses a local variable states and the value function uvec. Might want to add this to the arguments&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-130&quot;&gt;&lt;a href=&quot;#cb2-130&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; U(state):&lt;/span&gt;
&lt;span id=&quot;cb2-131&quot;&gt;&lt;a href=&quot;#cb2-131&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Terminal state (no future returns)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-132&quot;&gt;&lt;a href=&quot;#cb2-132&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (state[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-133&quot;&gt;&lt;a href=&quot;#cb2-133&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-134&quot;&gt;&lt;a href=&quot;#cb2-134&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (state[&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-135&quot;&gt;&lt;a href=&quot;#cb2-135&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-136&quot;&gt;&lt;a href=&quot;#cb2-136&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Find index of the element matching in states vector&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-137&quot;&gt;&lt;a href=&quot;#cb2-137&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        idx &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; states.index(state)&lt;/span&gt;
&lt;span id=&quot;cb2-138&quot;&gt;&lt;a href=&quot;#cb2-138&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Return value function of the state&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-139&quot;&gt;&lt;a href=&quot;#cb2-139&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; U_vec[idx]&lt;/span&gt;
&lt;span id=&quot;cb2-140&quot;&gt;&lt;a href=&quot;#cb2-140&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-141&quot;&gt;&lt;a href=&quot;#cb2-141&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;## Loop controls&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-142&quot;&gt;&lt;a href=&quot;#cb2-142&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    stop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-143&quot;&gt;&lt;a href=&quot;#cb2-143&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    epsilon &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fl&quot;&gt;1e-10&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-144&quot;&gt;&lt;a href=&quot;#cb2-144&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;bu&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-145&quot;&gt;&lt;a href=&quot;#cb2-145&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-146&quot;&gt;&lt;a href=&quot;#cb2-146&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Value iteration &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-147&quot;&gt;&lt;a href=&quot;#cb2-147&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;while&lt;/span&gt; (stop &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-148&quot;&gt;&lt;a href=&quot;#cb2-148&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;bu&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-149&quot;&gt;&lt;a href=&quot;#cb2-149&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        Delta &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-150&quot;&gt;&lt;a href=&quot;#cb2-150&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; idx &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(n_states):&lt;/span&gt;
&lt;span id=&quot;cb2-151&quot;&gt;&lt;a href=&quot;#cb2-151&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Translate to integer configuration&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-152&quot;&gt;&lt;a href=&quot;#cb2-152&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; states[idx]&lt;/span&gt;
&lt;span id=&quot;cb2-153&quot;&gt;&lt;a href=&quot;#cb2-153&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-154&quot;&gt;&lt;a href=&quot;#cb2-154&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# The 4 possible moves&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-155&quot;&gt;&lt;a href=&quot;#cb2-155&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-156&quot;&gt;&lt;a href=&quot;#cb2-156&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Do vector addition of the variable state and [0, -1, 0, 0]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-157&quot;&gt;&lt;a href=&quot;#cb2-157&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_six &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; add_state(state,  [&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-158&quot;&gt;&lt;a href=&quot;#cb2-158&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_free &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; add_state(state, [&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;)       &lt;/span&gt;
&lt;span id=&quot;cb2-159&quot;&gt;&lt;a href=&quot;#cb2-159&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_occupied &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; swap(add_state(state, [&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;], forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-160&quot;&gt;&lt;a href=&quot;#cb2-160&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            state_swap     &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; swap(state, forced_move&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;)                 &lt;/span&gt;
&lt;span id=&quot;cb2-161&quot;&gt;&lt;a href=&quot;#cb2-161&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;/span&gt;
&lt;span id=&quot;cb2-162&quot;&gt;&lt;a href=&quot;#cb2-162&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Number of sticks in the lid&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-163&quot;&gt;&lt;a href=&quot;#cb2-163&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            i &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; state[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb2-164&quot;&gt;&lt;a href=&quot;#cb2-164&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-165&quot;&gt;&lt;a href=&quot;#cb2-165&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;#Q(s, continue)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-166&quot;&gt;&lt;a href=&quot;#cb2-166&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            qs_continue &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; (&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;  &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; (R(state_six)  &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;  U(state_six))) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-167&quot;&gt;&lt;a href=&quot;#cb2-167&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        ((&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;i)&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; (R(state_free) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;  U(state_free)) &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-168&quot;&gt;&lt;a href=&quot;#cb2-168&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        (i&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;     &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; (R(state_occupied) &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; U(state_occupied)) &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-169&quot;&gt;&lt;a href=&quot;#cb2-169&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-170&quot;&gt;&lt;a href=&quot;#cb2-170&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;#Q(s, stop)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-171&quot;&gt;&lt;a href=&quot;#cb2-171&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            qs_stop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;(R(state_swap) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; U(state_swap))&lt;/span&gt;
&lt;span id=&quot;cb2-172&quot;&gt;&lt;a href=&quot;#cb2-172&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-173&quot;&gt;&lt;a href=&quot;#cb2-173&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Updated value &amp;amp; strategy if there is a choice.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-174&quot;&gt;&lt;a href=&quot;#cb2-174&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (state[&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;]&lt;span class=&quot;op&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;):&lt;/span&gt;
&lt;span id=&quot;cb2-175&quot;&gt;&lt;a href=&quot;#cb2-175&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                U_vec_prime[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;max&lt;/span&gt;(qs_continue, qs_stop)&lt;/span&gt;
&lt;span id=&quot;cb2-176&quot;&gt;&lt;a href=&quot;#cb2-176&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                pi[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; qs_continue &lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; qs_stop&lt;/span&gt;
&lt;span id=&quot;cb2-177&quot;&gt;&lt;a href=&quot;#cb2-177&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt;: &lt;span class=&quot;co&quot;&gt;#no choice&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-178&quot;&gt;&lt;a href=&quot;#cb2-178&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                U_vec_prime[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; qs_continue&lt;/span&gt;
&lt;span id=&quot;cb2-179&quot;&gt;&lt;a href=&quot;#cb2-179&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                pi[idx] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-180&quot;&gt;&lt;a href=&quot;#cb2-180&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-181&quot;&gt;&lt;a href=&quot;#cb2-181&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;co&quot;&gt;# Discrepancy  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-182&quot;&gt;&lt;a href=&quot;#cb2-182&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            Delta &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;max&lt;/span&gt;(Delta, &lt;span class=&quot;bu&quot;&gt;abs&lt;/span&gt;(U_vec[idx] &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; U_vec_prime[idx]))&lt;/span&gt;
&lt;span id=&quot;cb2-183&quot;&gt;&lt;a href=&quot;#cb2-183&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-184&quot;&gt;&lt;a href=&quot;#cb2-184&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Update the value function by copying the new values&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-185&quot;&gt;&lt;a href=&quot;#cb2-185&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Note: In NumPy, using &amp;quot;=&amp;quot; would only make a reference to the new vector&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-186&quot;&gt;&lt;a href=&quot;#cb2-186&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# See https://www.geeksforgeeks.org/array-copying-in-python/&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-187&quot;&gt;&lt;a href=&quot;#cb2-187&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        U_vec &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; U_vec_prime.copy()&lt;/span&gt;
&lt;span id=&quot;cb2-188&quot;&gt;&lt;a href=&quot;#cb2-188&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-189&quot;&gt;&lt;a href=&quot;#cb2-189&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;co&quot;&gt;# Continue the value iteration?  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-190&quot;&gt;&lt;a href=&quot;#cb2-190&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (debug):&lt;/span&gt;
&lt;span id=&quot;cb2-191&quot;&gt;&lt;a href=&quot;#cb2-191&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;iter = &amp;quot;&lt;/span&gt;, &lt;span class=&quot;bu&quot;&gt;iter&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;, Delta =&amp;quot;&lt;/span&gt;, Delta)  &lt;/span&gt;
&lt;span id=&quot;cb2-192&quot;&gt;&lt;a href=&quot;#cb2-192&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        stop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; (Delta &lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt; epsilon)&lt;/span&gt;
&lt;span id=&quot;cb2-193&quot;&gt;&lt;a href=&quot;#cb2-193&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-194&quot;&gt;&lt;a href=&quot;#cb2-194&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Make a tibble containing the strategy  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-195&quot;&gt;&lt;a href=&quot;#cb2-195&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame({&lt;span class=&quot;st&quot;&gt;&amp;#39;state&amp;#39;&lt;/span&gt;: states, &lt;span class=&quot;st&quot;&gt;&amp;#39;value&amp;#39;&lt;/span&gt;: U_vec, &lt;span class=&quot;st&quot;&gt;&amp;#39;strategy&amp;#39;&lt;/span&gt;: pi, &lt;span class=&quot;st&quot;&gt;&amp;#39;prob&amp;#39;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;U_vec&lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;})  &lt;/span&gt;
&lt;span id=&quot;cb2-196&quot;&gt;&lt;a href=&quot;#cb2-196&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Split state column into 4 separate columns&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-197&quot;&gt;&lt;a href=&quot;#cb2-197&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy[[&lt;span class=&quot;st&quot;&gt;&amp;#39;i&amp;#39;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;#39;j&amp;#39;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;#39;k&amp;#39;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;]] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame(strategy.state.tolist(), index&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy.index) &lt;/span&gt;
&lt;span id=&quot;cb2-198&quot;&gt;&lt;a href=&quot;#cb2-198&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Drop the state column&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-199&quot;&gt;&lt;a href=&quot;#cb2-199&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy.drop(columns&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;state&amp;#39;&lt;/span&gt;])&lt;/span&gt;
&lt;span id=&quot;cb2-200&quot;&gt;&lt;a href=&quot;#cb2-200&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Convert strategy to boolean&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-201&quot;&gt;&lt;a href=&quot;#cb2-201&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy[&lt;span class=&quot;st&quot;&gt;&amp;#39;strategy&amp;#39;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy[&lt;span class=&quot;st&quot;&gt;&amp;#39;strategy&amp;#39;&lt;/span&gt;].astype(&lt;span class=&quot;bu&quot;&gt;bool&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-202&quot;&gt;&lt;a href=&quot;#cb2-202&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Change the order such that the i,j,k,forced_move columns are shown first&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-203&quot;&gt;&lt;a href=&quot;#cb2-203&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    cols &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy.columns.tolist()&lt;/span&gt;
&lt;span id=&quot;cb2-204&quot;&gt;&lt;a href=&quot;#cb2-204&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    cols &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; cols[&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;:] &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; cols[:&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb2-205&quot;&gt;&lt;a href=&quot;#cb2-205&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    strategy &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; strategy[cols]&lt;/span&gt;
&lt;span id=&quot;cb2-206&quot;&gt;&lt;a href=&quot;#cb2-206&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-207&quot;&gt;&lt;a href=&quot;#cb2-207&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt;(strategy)&lt;/span&gt;
&lt;span id=&quot;cb2-208&quot;&gt;&lt;a href=&quot;#cb2-208&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-209&quot;&gt;&lt;a href=&quot;#cb2-209&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-210&quot;&gt;&lt;a href=&quot;#cb2-210&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#Test function&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-211&quot;&gt;&lt;a href=&quot;#cb2-211&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#make_situations(6)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-212&quot;&gt;&lt;a href=&quot;#cb2-212&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-213&quot;&gt;&lt;a href=&quot;#cb2-213&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Find optimal strategy for game with 6 sticks left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-214&quot;&gt;&lt;a href=&quot;#cb2-214&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;s_best &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; optimal_strategy(&lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-215&quot;&gt;&lt;a href=&quot;#cb2-215&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Print full strategy without row number, https://stackoverflow.com/questions/52396477/printing-a-pandas-dataframe-without-row-number-index&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-216&quot;&gt;&lt;a href=&quot;#cb2-216&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# pd.set_option(&amp;#39;display.max_rows&amp;#39;, None)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-217&quot;&gt;&lt;a href=&quot;#cb2-217&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# print(s_best.to_string(index=False))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-jehn2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Jehn, Rüdiger. 2021. &lt;span&gt;“Optimum Strategies for the Game Super
Six.”&lt;/span&gt; arXiv. &lt;a
href=&quot;https://doi.org/10.48550/ARXIV.2109.10700&quot;&gt;https://doi.org/10.48550/ARXIV.2109.10700&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-russell_norvig2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Russell, S. J., and P. Norvig. 2020. &lt;em&gt;Artificial Intelligence: A
Modern Approach&lt;/em&gt;. Pearson Series in Artificial Intelligence.
Pearson.
&lt;/div&gt;
&lt;div id=&quot;ref-sutton_burto2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Sutton, Richard S., and Andrew G. Barto. 2020. &lt;em&gt;Reinforcement
Learning - an Introduction&lt;/em&gt;. 2nd ed. The MIT Press.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 20 Mar 2023 00:00:00 +0100</pubDate>
        <link>http://mhoehle.github.io/blog/2023/03/20/dynprog.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2023/03/20/dynprog.html</guid>
        
        <category>rstats</category>
        
        <category>python</category>
        
        <category>dynamic programming</category>
        
        <category>reinforcement learning</category>
        
        <category>game theory</category>
        
        
      </item>
    
      <item>
        <title>How to Win a Game (or More) of Super Six</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We use simulation to analyse the family dicing game “Super Six”. In
particular we show that the person starting the game has a very high
chance of winning the game. Furthermore, a robust strategy to play
during the game is to keep throwing the dice regardless of the number of
free pits. In a mixed strategy landscape with more than two players this
seems to do better than a strategy extrapolated from the analytically
derived optimal strategy for the two player case.&lt;/p&gt;
&lt;center&gt;
&lt;img
src=&quot;/blog/figure/source/2023-03-13-super6/plot_favor_factor-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2023-03-13-super6.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://de-m-wikipedia-org.translate.goog/wiki/Super_Six_(Spiel)?_x_tr_sl=auto&amp;amp;_x_tr_tl=en&amp;amp;_x_tr_hl=de&amp;amp;_x_tr_pto=wapp&quot;&gt;&lt;strong&gt;Super
Six&lt;/strong&gt;&lt;/a&gt; is a dice game which can be played at all ages. It
consists of a container where the lid has 5 pits (labelled 1-5) and one
hole (labelled 6). Furthermore, each player gets a predetermined number
of sticks and a dice (see Fig.1). If a stick is put into pit 6 (the
hole) it falls into container and stays there.&lt;/p&gt;
&lt;center&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/figure/source/2023-03-13-super6/super6.jpg&quot;
alt=&quot;Figure 1: A snapshot of a Super 6 game with 2 players, who both initially started with 4 sticks.&quot; /&gt;
&lt;figcaption aria-hidden=&quot;true&quot;&gt;Figure 1: A snapshot of a Super 6 game
with 2 players, who both initially started with 4 sticks.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/center&gt;
&lt;p&gt;The rules of the games are as follows: The sticks are distributed
among the players so that each player has exactly the same number of
sticks (say: 4). Each player throws the dice in turn going round in
clockwise direction. If a player throws a number and the corresponding
pit is empty, then he/she can insert one of his/her sticks into it. If
the pit is already occupied, however, then he/she must take the stick
and and add it to his/her own pile of sticks. The number 6 is a “lucky
throw”. With a 6, one can always place a stick into the hole labelled
No. 6 and it stays there. &lt;strong&gt;Note:&lt;/strong&gt; &lt;em&gt;During the first
round, each player is only allowed to throw the dice once. From the
second round on, each player can throw the dice as often as desired,
provided that one always managed to hit an empty pit. As soon as one
throws the number of an occupied pit, one must take the stick that is
located there and it is then the next players turn. Each player most
throw the dice at least once per round, but after the first throw he/she
can decide to stop throwing at any time in that round (that is also
before hitting an occupied pit). Once a player has no sticks left, the
game is over and he/she is the winner.&lt;/em&gt; This &lt;a
href=&quot;https://www.youtube.com/watch?v=yrYybddqRQs&quot;&gt;YouTube&lt;/a&gt; video by
&lt;a href=&quot;https://www.researchgate.net/profile/Ruediger-Jehn&quot;&gt;Rüdiger
Jehn&lt;/a&gt; shows a exemplary game play of Super Six.&lt;/p&gt;
&lt;p&gt;Empirical experience from playing a lot of Super 6 with the kids
raises the question if the game is really fair: Does the player starting
the game have a winning advantage? Furthermore, interest is in the
optimal strategy to play: Should one always continue to throw the dice
until one hits an occupied pit or should one stop playing once there are
only &lt;span class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; out of the 5 pits free (with
&lt;span class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; being either 1 or 2)? In what
follows we shall use simulation to get an approximate answer to these
questions in a realistic environment with different players following
different strategies. For a two player situation analytic results exist
&lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;(Jehn 2021)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;simulating-super-6&quot;&gt;Simulating Super 6&lt;/h2&gt;
&lt;p&gt;The file &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/figure/source/2023-03-13-super6/super6.R&quot;&gt;&lt;code&gt;super6.R&lt;/code&gt;&lt;/a&gt;
contains a function &lt;code&gt;simulate_super6&lt;/code&gt; with arguments
&lt;code&gt;players_strategy&lt;/code&gt; and &lt;code&gt;sticks&lt;/code&gt; to simulate a game
of Super 6 for &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;=&lt;code&gt;length(players_strategy)&lt;/code&gt;
players each initially having &lt;code&gt;sticks&lt;/code&gt; number of sticks. The
named list &lt;code&gt;players_strategy&lt;/code&gt; contains each player’s strategy
as a &lt;code&gt;tibble&lt;/code&gt;, mapping the number of free pits
(i.e. 0,1,2,3,4,5) to a probability to continue throwing the dice. If
this probability is either 0 or 1 then we have a deterministic strategy.
As an example the &lt;code&gt;always&lt;/code&gt; strategy describes a behaviour
where one keeps throwing the dice independent of the number of free
pits:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(always &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,   &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 × 2
##   filled_holes continue_prob
##          &amp;lt;int&amp;gt;         &amp;lt;dbl&amp;gt;
## 1            0             1
## 2            1             1
## 3            2             1
## 4            3             1
## 5            4             1
## 6            5             1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As an example: To simulate a single game of Super 6 with three
players, A, B and C, each playing the “always” strategy with initially 4
sticks we call&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;h &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;simulate_super6&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;A=&lt;/span&gt;always, &lt;span class=&quot;at&quot;&gt;B=&lt;/span&gt;always, &lt;span class=&quot;at&quot;&gt;C=&lt;/span&gt;always), &lt;span class=&quot;at&quot;&gt;sticks=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The resulting trajectory of state and actions of the game are
returned by the function:&lt;/p&gt;
&lt;p&gt;
&lt;table class=&quot;table table-striped&quot; style=&quot;font-size: 14px; margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;4&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Gameplay
&lt;/div&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;6&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Pit Status
&lt;/div&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;3&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Player Status
&lt;/div&gt;
&lt;/th&gt;
&lt;th style=&quot;border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; &quot; colspan=&quot;1&quot;&gt;
&lt;div style=&quot;border-bottom: 1px solid #ddd; padding-bottom: 5px; &quot;&gt;
Game Status
&lt;/div&gt;
&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
round
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
player
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
turn
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
dice
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.1
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.2
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.3
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.4
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.5
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
hole.6
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
sticks.A
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
sticks.B
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
sticks.C
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
decision
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
C
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
stop turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
A
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
stop turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
stop turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
C
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
lost turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
A
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
continue turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
A
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
lost turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
5
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
continue turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
continue turn
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
B
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
6
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
game over
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;Note that in the above game the player to start is randomly selected.
The players then each take turns in the pre-determined order. The order
of the rows in the table corresponds to the sequence of actions in the
game. The column &lt;code&gt;turn&lt;/code&gt; is a counter indicating how many
times the player has thrown the dice during his/her round. The columns
&lt;code&gt;hole.1&lt;/code&gt;-&lt;code&gt;hole.5&lt;/code&gt; are binary indicators whether
the respective pit is currently filled with a stick (FALSE=0, TRUE=1).
Finally, a column counts for each player the current number of remaining
sticks (initially equal to 4). The last column, &lt;code&gt;decision&lt;/code&gt;
contains information about the player’s action and its consequences.
Here, “stop turn” is a forced decision in round 1, because each player
can only throw the dice once in round 1. Furthermore, “lost turn”
indicates the situation that the pit indicated by the dice throw was
already occupied and “continue turn” means that the player based on
his/her strategy decided to throw again. Finally, “game over” means that
one player reduced their number of sticks to zero and the game thus
ends. The winner of the shown game shown is B.&lt;/p&gt;
&lt;h2 id=&quot;analysis&quot;&gt;Analysis&lt;/h2&gt;
&lt;p&gt;We can use the above simulation function to analyse different
strategies for games with 4 initial sticks. Consider the four additional
strategies:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;go50 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,   &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;(filled_holes&lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;go67 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,   &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;(filled_holes&lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;random &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;random2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;filled_holes=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;continue_prob=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;,&lt;span class=&quot;fl&quot;&gt;0.25&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s assume that Agneta is playing the &lt;code&gt;always&lt;/code&gt; strategy
and that Bertil, Cecilia, Dagmar and Emil each are playing one of the
four other strategies.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;player_list &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;Agneta=&lt;/span&gt; always,&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Birger=&lt;/span&gt; go50,&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Carin=&lt;/span&gt;  go67,&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Dagmar=&lt;/span&gt; random,&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;at&quot;&gt;Emil=&lt;/span&gt;   random2)&lt;/span&gt;
&lt;span id=&quot;cb5-6&quot;&gt;&lt;a href=&quot;#cb5-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;player_names &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;names&lt;/span&gt;(player_list)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We now consider all possible matches of these players. This can be
games ranging from just 2 of the players to all 5 of them.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_players &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; 2L&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(player_names)&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;matches &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(n_players, &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(m) {&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  utils&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;combn&lt;/span&gt;(player_names, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m, &lt;span class=&quot;at&quot;&gt;simplify=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(n_players)&lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_combos &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(matches, length)&lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_combos &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;unlist&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##  2  3  4  5 
## 10 10  5  1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To ensure that the we consider an equal amount of games for every
number of players, we simulate &lt;code&gt;n_games&lt;/code&gt; games for each
number of players (2-5). The games to play are then distributed equal
among the different pairings with that number of players. For this
reason, &lt;code&gt;n_games&lt;/code&gt; has to be divisible by 5 and 10.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n_games &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Parallelize analysis using the future-verse&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;plan&lt;/span&gt;(multisession, &lt;span class=&quot;at&quot;&gt;workers =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb8-5&quot;&gt;&lt;a href=&quot;#cb8-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-6&quot;&gt;&lt;a href=&quot;#cb8-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Play the games&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-7&quot;&gt;&lt;a href=&quot;#cb8-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;all_games &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;future_map2&lt;/span&gt;(matches, n_combos,  &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(names, combos) {&lt;/span&gt;
&lt;span id=&quot;cb8-8&quot;&gt;&lt;a href=&quot;#cb8-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(names, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; {&lt;/span&gt;
&lt;span id=&quot;cb8-9&quot;&gt;&lt;a href=&quot;#cb8-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    the_players_strategy &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; player_list[.x]&lt;/span&gt;
&lt;span id=&quot;cb8-10&quot;&gt;&lt;a href=&quot;#cb8-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Divide the n_games equal among the possible combinations&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-11&quot;&gt;&lt;a href=&quot;#cb8-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    n_games_each_combo &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; n_games &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; combos&lt;/span&gt;
&lt;span id=&quot;cb8-12&quot;&gt;&lt;a href=&quot;#cb8-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n_games_each_combo), &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-13&quot;&gt;&lt;a href=&quot;#cb8-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;fu&quot;&gt;simulate_super6&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;players_strategy=&lt;/span&gt;the_players_strategy, &lt;span class=&quot;at&quot;&gt;sticks=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb8-14&quot;&gt;&lt;a href=&quot;#cb8-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    )&lt;/span&gt;
&lt;span id=&quot;cb8-15&quot;&gt;&lt;a href=&quot;#cb8-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  }) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(names, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(.x, &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;-&amp;quot;&lt;/span&gt;)))&lt;/span&gt;
&lt;span id=&quot;cb8-16&quot;&gt;&lt;a href=&quot;#cb8-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}, &lt;span class=&quot;at&quot;&gt;.options=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;furrr_options&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;seed=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This provides a nested list structure, where the top-most level
contains the number of players of the game, the 2nd level contains the
name of the participating players and the 3rd level the recordings of
every game played of the respective player combination (organised as a
tibble). The recordings/history of each game is organised as a data
frame with columns closely related to the above game description. As an
example, a total of&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;all_games[[&lt;span class=&quot;st&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;]][[&lt;span class=&quot;st&quot;&gt;&amp;quot;Agneta-Birger-Carin&amp;quot;&lt;/span&gt;]] &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1000&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;games (=10000/10) are played between the players Agneta, Birger and
Carin.&lt;/p&gt;
&lt;p&gt;We now use this nested list structure of simulated games to answer
our questions of interest. The traversing of the list is done by purrr.
As an example we determine the total number of games as follows:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(n_total_games &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(all_games, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(.x, length)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;unlist&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 40000&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;beginner-is-winner&quot;&gt;Beginner is Winner?&lt;/h3&gt;
&lt;p&gt;We now investigate the probability to win the starting player. Let
&lt;code&gt;h&lt;/code&gt; denote the tibble describing the history of a game (such
as shown above). We will write a function, which given the history of a
game returns the player name who won the game.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;winner &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(h) {&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  h &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_tail&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(player)&lt;/span&gt;
&lt;span id=&quot;cb13-3&quot;&gt;&lt;a href=&quot;#cb13-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb13-4&quot;&gt;&lt;a href=&quot;#cb13-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-5&quot;&gt;&lt;a href=&quot;#cb13-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Test the function on the above shown trajectory&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-6&quot;&gt;&lt;a href=&quot;#cb13-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;winner&lt;/span&gt;(h)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;B&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can use the function to determine the probability that the player
starting the game also becomes the winner of the game. To take into
account a possible dependence on the number of players we shall stratify
our analysis by the number of players in the game.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;games_summary &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map2_df&lt;/span&gt;(all_games, n_players, &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(games, players) {&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(games, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(.x, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n_players=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(players), &lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        &lt;span class=&quot;at&quot;&gt;beginner=&lt;/span&gt;.x &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_head&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(player),&lt;/span&gt;
&lt;span id=&quot;cb15-4&quot;&gt;&lt;a href=&quot;#cb15-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                          &lt;span class=&quot;at&quot;&gt;winner=&lt;/span&gt;.x &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_tail&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(player))))&lt;/span&gt;
&lt;span id=&quot;cb15-5&quot;&gt;&lt;a href=&quot;#cb15-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;})&lt;/span&gt;
&lt;span id=&quot;cb15-6&quot;&gt;&lt;a href=&quot;#cb15-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-7&quot;&gt;&lt;a href=&quot;#cb15-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tab &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; games_summary &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(n_players) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-8&quot;&gt;&lt;a href=&quot;#cb15-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_initial_winner=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;mean&lt;/span&gt;(beginner&lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt;winner)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-9&quot;&gt;&lt;a href=&quot;#cb15-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_random =&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;n_players,&lt;/span&gt;
&lt;span id=&quot;cb15-10&quot;&gt;&lt;a href=&quot;#cb15-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;at&quot;&gt;favor_factor =&lt;/span&gt; p_initial_winner &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; p_random) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
n_players
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
p_initial_winner
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
p_random
&lt;/th&gt;
&lt;th style=&quot;text-align:center;&quot;&gt;
favor_factor
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
2
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.6009
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.5000000
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.2018
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
3
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.4438
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.3333333
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.3314
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
4
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.3527
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.2500000
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.4108
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
5
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.2970
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
0.2000000
&lt;/td&gt;
&lt;td style=&quot;text-align:center;&quot;&gt;
1.4850
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2023-03-13-super6/plot_favor_factor-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;The empirical probability that the initial player wins is always
higher than the probability &lt;span class=&quot;math inline&quot;&gt;\(1/n\)&lt;/span&gt;
that one of the &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; players in the
game wins at random. The larger the number of players the bigger the
relative advantage of beginning seems. Note that our analysis averages
over the all strategies so it also contains start players using an
otherwise sub-optimal playing strategy. This might bias the analysis
slightly, but a small sensitivity analysis letting all 5 players play
the &lt;code&gt;always&lt;/code&gt; strategy, showed that results did not change
substantially.&lt;/p&gt;
&lt;h3 id=&quot;best-strategy&quot;&gt;Best strategy&lt;/h3&gt;
&lt;p&gt;We can now compute for each player (i.e. strategy) the number of wins
out of the 40000 games:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb16&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb16-1&quot;&gt;&lt;a href=&quot;#cb16-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(league_table &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(all_games, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(.x, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(.x, winner))) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb16-2&quot;&gt;&lt;a href=&quot;#cb16-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;unlist&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb16-3&quot;&gt;&lt;a href=&quot;#cb16-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;as_tibble&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-4&quot;&gt;&lt;a href=&quot;#cb16-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rename&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;player =&lt;/span&gt; value) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-5&quot;&gt;&lt;a href=&quot;#cb16-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(player) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-6&quot;&gt;&lt;a href=&quot;#cb16-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;wins=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;n&lt;/span&gt;()) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-7&quot;&gt;&lt;a href=&quot;#cb16-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;arrange&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;desc&lt;/span&gt;(wins)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5 × 2
##   player  wins
##   &amp;lt;chr&amp;gt;  &amp;lt;int&amp;gt;
## 1 Birger  8800
## 2 Carin   8593
## 3 Emil    8520
## 4 Agneta  8419
## 5 Dagmar  5668&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This shows that the &lt;code&gt;always&lt;/code&gt; strategy appears to do best
among those strategies investigated. It is no surprise that the worst
strategy is the purely random strategy &lt;code&gt;random&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We analysed aspects of how to win a game (or more) of Super Six.
Important factors for winning in a multi-player mixed strategy landscape
are&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;To start the game&lt;/li&gt;
&lt;li&gt;To keep throwing the dice&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A little surprising is that the best strategy (among those
investigated) is to keep throwing the dice regardless of the number of
free pits. The optimal strategy may in part depend on how the other
players play, but our conclusions appear sufficiently robust, because
the simulation study investigated a mixed strategy player field with two
to five players. A limitation of our analysis is that we only considered
games where each player initially holds 4 sticks.&lt;/p&gt;
&lt;p&gt;It is worth pointing out that the best strategy we found is not
optimal. As an example, &lt;span class=&quot;citation&quot;
data-cites=&quot;jehn2021&quot;&gt;Jehn (2021)&lt;/span&gt; analytically finds the optimal
strategy for the &lt;span class=&quot;math inline&quot;&gt;\(n=2\)&lt;/span&gt; player
situation. It depends on the number of sticks left in the game and the
number of sticks each player has. In most cases the strategy stops if
more than 3 pits are occupied – see Appendix 1 for details. This
dependence on the other player’s hand is likely to carry forward to the
&lt;span class=&quot;math inline&quot;&gt;\(n&amp;gt;2\)&lt;/span&gt; player situation. However,
analytic results for &lt;span class=&quot;math inline&quot;&gt;\(n&amp;gt;2\)&lt;/span&gt; will be
extremely difficult to obtain, but it makes intuitive sense to be more
aggressive when there are more players, because there are more
contestants for the win.&lt;/p&gt;
&lt;p&gt;Did the game developers realize that the start player has such a high
probability of winning the game? It seems advisable to accompany game
development by simulations and mathematical calculations at the design
stage. In practice, one should randomize the start player to enhance
fairness.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Final note&lt;/strong&gt;: This will be the last post of &lt;em&gt;Theory
Meets Practice&lt;/em&gt; Blog in its current form. As of Jan 2023 I am
working as full professor in Statistics and Data Science at the &lt;a
href=&quot;https://math-inf.uni-greifswald.de/en/michael-hoehle/&quot;&gt;University
of Greifswald&lt;/a&gt;, Germany. For both technical and time reasons a new
setup is thus needed.&lt;/p&gt;
&lt;h2 id=&quot;appendix-1&quot;&gt;Appendix 1&lt;/h2&gt;
&lt;p&gt;The work of &lt;span class=&quot;citation&quot; data-cites=&quot;jehn2021&quot;&gt;Jehn
(2021)&lt;/span&gt; shows the derivation of the optimal strategies encoded in
&lt;a href=&quot;https://oeis.org/A345383&quot;&gt;A345383&lt;/a&gt; for a game with 2 players
and a situation where &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; pits
occupied, the first player (our player of interest) has &lt;span
class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; sticks in hand and the second player
has &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; sticks. This state is denoted
as &lt;span class=&quot;math inline&quot;&gt;\(i/j/k\)&lt;/span&gt;. For example &lt;span
class=&quot;math inline&quot;&gt;\(2/1/1\)&lt;/span&gt; denotes the situation where there
are 2 pits occupied in the lid and each player has one stick.&lt;/p&gt;
&lt;p&gt;A small helper function gives all states where a continue vs. stop
choice needs to be made. It is assumed that if there are no sticks in
the lid, we always continue:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Find all situations where a continue vs. stop choice is to be made&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-2&quot;&gt;&lt;a href=&quot;#cb18-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; for player 1.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-3&quot;&gt;&lt;a href=&quot;#cb18-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-4&quot;&gt;&lt;a href=&quot;#cb18-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; See Jehn (2021), https://arxiv.org/pdf/2109.10700.pdf, for details.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-5&quot;&gt;&lt;a href=&quot;#cb18-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-6&quot;&gt;&lt;a href=&quot;#cb18-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param n Total number of sticks currently (i+j+k)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-7&quot;&gt;&lt;a href=&quot;#cb18-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return A vector of strings describing the situations in i/j/k notation&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-8&quot;&gt;&lt;a href=&quot;#cb18-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; where i is the number of occupied pits in the lid, j is the number of&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-9&quot;&gt;&lt;a href=&quot;#cb18-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; sticks player 1 has and k is the number of sticks player 2 has. Note&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-10&quot;&gt;&lt;a href=&quot;#cb18-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; i+j+k = n&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-11&quot;&gt;&lt;a href=&quot;#cb18-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-12&quot;&gt;&lt;a href=&quot;#cb18-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;situations &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(n) {&lt;/span&gt;
&lt;span id=&quot;cb18-13&quot;&gt;&lt;a href=&quot;#cb18-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  res &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;NULL&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-14&quot;&gt;&lt;a href=&quot;#cb18-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Sticks in the Lid&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-15&quot;&gt;&lt;a href=&quot;#cb18-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; (i &lt;span class=&quot;cf&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(n,&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;)&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb18-16&quot;&gt;&lt;a href=&quot;#cb18-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Sticks Player 1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-17&quot;&gt;&lt;a href=&quot;#cb18-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; (j &lt;span class=&quot;cf&quot;&gt;in&lt;/span&gt; n&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) {&lt;/span&gt;
&lt;span id=&quot;cb18-18&quot;&gt;&lt;a href=&quot;#cb18-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;co&quot;&gt;# Sticks Player 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-19&quot;&gt;&lt;a href=&quot;#cb18-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      k &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; n &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; i &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; j&lt;/span&gt;
&lt;span id=&quot;cb18-20&quot;&gt;&lt;a href=&quot;#cb18-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;co&quot;&gt;# Don&amp;#39;t consider impossible situations or situations without a choice&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-21&quot;&gt;&lt;a href=&quot;#cb18-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (k&lt;span class=&quot;sc&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;!&lt;/span&gt;(i&lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt; j&lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt;k)) {&lt;/span&gt;
&lt;span id=&quot;cb18-22&quot;&gt;&lt;a href=&quot;#cb18-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        res &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;append&lt;/span&gt;(res, &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(i,j,k), &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb18-23&quot;&gt;&lt;a href=&quot;#cb18-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      }&lt;/span&gt;
&lt;span id=&quot;cb18-24&quot;&gt;&lt;a href=&quot;#cb18-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    }&lt;/span&gt;
&lt;span id=&quot;cb18-25&quot;&gt;&lt;a href=&quot;#cb18-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  }&lt;/span&gt;
&lt;span id=&quot;cb18-26&quot;&gt;&lt;a href=&quot;#cb18-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(res)&lt;/span&gt;
&lt;span id=&quot;cb18-27&quot;&gt;&lt;a href=&quot;#cb18-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb18-28&quot;&gt;&lt;a href=&quot;#cb18-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-29&quot;&gt;&lt;a href=&quot;#cb18-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# All situations when there are 7 sticks left in the game&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-30&quot;&gt;&lt;a href=&quot;#cb18-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;situations&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;5/1/1&amp;quot; &amp;quot;4/2/1&amp;quot; &amp;quot;4/1/2&amp;quot; &amp;quot;3/3/1&amp;quot; &amp;quot;3/2/2&amp;quot; &amp;quot;3/1/3&amp;quot; &amp;quot;2/4/1&amp;quot; &amp;quot;2/3/2&amp;quot; &amp;quot;2/2/3&amp;quot; &amp;quot;2/1/4&amp;quot; &amp;quot;1/5/1&amp;quot; &amp;quot;1/4/2&amp;quot; &amp;quot;1/3/3&amp;quot; &amp;quot;1/2/4&amp;quot; &amp;quot;1/1/5&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The optimal strategy is encoded in binary and converted to base 10 in
the sequence &lt;a href=&quot;https://oeis.org/A345383&quot;&gt;A345383&lt;/a&gt;. We write a
small R extractor to display the optimal strategy in more readable
form:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb20&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb20-1&quot;&gt;&lt;a href=&quot;#cb20-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Handle the large integers using the GMP library&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-2&quot;&gt;&lt;a href=&quot;#cb20-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;suppressPackageStartupMessages&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(gmp))&lt;/span&gt;
&lt;span id=&quot;cb20-3&quot;&gt;&lt;a href=&quot;#cb20-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-4&quot;&gt;&lt;a href=&quot;#cb20-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Encodes [A345383](https://oeis.org/A345383)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-5&quot;&gt;&lt;a href=&quot;#cb20-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-6&quot;&gt;&lt;a href=&quot;#cb20-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param n Number of sticks&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-7&quot;&gt;&lt;a href=&quot;#cb20-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @returns a(n) from A345383&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-8&quot;&gt;&lt;a href=&quot;#cb20-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-9&quot;&gt;&lt;a href=&quot;#cb20-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;a &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(n) {&lt;/span&gt;
&lt;span id=&quot;cb20-10&quot;&gt;&lt;a href=&quot;#cb20-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  a &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;63&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1023&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;32760&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1048544&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;33554304&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1073741312&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;34359736320&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1099511619584&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;35184370221056&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1125899873681408&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;36028796752101376&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb20-11&quot;&gt;&lt;a href=&quot;#cb20-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (n&lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;amp;&lt;/span&gt; n&lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;15&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(a[n]) &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;cn&quot;&gt;NA&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb20-12&quot;&gt;&lt;a href=&quot;#cb20-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb20-13&quot;&gt;&lt;a href=&quot;#cb20-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-14&quot;&gt;&lt;a href=&quot;#cb20-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Convert a strategy encoded as a 0/1 string to a vector of Booleans&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-15&quot;&gt;&lt;a href=&quot;#cb20-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param s The strategy as a string of 0 and 1&amp;#39;s&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-16&quot;&gt;&lt;a href=&quot;#cb20-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return As a vector&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-17&quot;&gt;&lt;a href=&quot;#cb20-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @examples&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-18&quot;&gt;&lt;a href=&quot;#cb20-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; int_strategy_to_vec(&amp;quot;0011&amp;quot;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-19&quot;&gt;&lt;a href=&quot;#cb20-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;int_strategy_to_vec &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(s) {&lt;/span&gt;
&lt;span id=&quot;cb20-20&quot;&gt;&lt;a href=&quot;#cb20-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;str_split_1&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.character&lt;/span&gt;(s, &lt;span class=&quot;at&quot;&gt;b=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;pattern=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.integer&lt;/span&gt;()&lt;/span&gt;
&lt;span id=&quot;cb20-21&quot;&gt;&lt;a href=&quot;#cb20-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb20-22&quot;&gt;&lt;a href=&quot;#cb20-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb20-23&quot;&gt;&lt;a href=&quot;#cb20-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Show the optimal stragegy for all situations with n sticks&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-24&quot;&gt;&lt;a href=&quot;#cb20-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;optimal_strategy &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(n) {&lt;/span&gt;
&lt;span id=&quot;cb20-25&quot;&gt;&lt;a href=&quot;#cb20-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Make a tibble representing the optimal strategy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-26&quot;&gt;&lt;a href=&quot;#cb20-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;situation=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;situations&lt;/span&gt;(n),&lt;/span&gt;
&lt;span id=&quot;cb20-27&quot;&gt;&lt;a href=&quot;#cb20-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;at&quot;&gt;continue =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rev&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;int_strategy_to_vec&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;a&lt;/span&gt;(n))))&lt;/span&gt;
&lt;span id=&quot;cb20-28&quot;&gt;&lt;a href=&quot;#cb20-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb20-29&quot;&gt;&lt;a href=&quot;#cb20-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-30&quot;&gt;&lt;a href=&quot;#cb20-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;optimal_strategy&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Inf&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 15 × 2
##    situation continue
##    &amp;lt;chr&amp;gt;        &amp;lt;int&amp;gt;
##  1 5/1/1            0
##  2 4/2/1            0
##  3 4/1/2            0
##  4 3/3/1            1
##  5 3/2/2            1
##  6 3/1/3            1
##  7 2/4/1            1
##  8 2/3/2            1
##  9 2/2/3            1
## 10 2/1/4            1
## 11 1/5/1            1
## 12 1/4/2            1
## 13 1/3/3            1
## 14 1/2/4            1
## 15 1/1/5            1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We observe that for situations with 7 sticks we continue to play as
long as only 1-3 pits are filled. If 4 or 5 pits are filled, we don’t
continue. However, in other settings with different number of sticks
left, the optimal strategy can be different. As an example, if there 6
sticks left, the optimal strategy is&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 × 2
##    situation continue
##    &amp;lt;chr&amp;gt;        &amp;lt;int&amp;gt;
##  1 4/1/1            1
##  2 3/2/1            1
##  3 3/1/2            1
##  4 2/3/1            1
##  5 2/2/2            1
##  6 2/1/3            1
##  7 1/4/1            1
##  8 1/3/2            1
##  9 1/2/3            1
## 10 1/1/4            1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which -opposite to the 7 sticks left situation- continues in the 4
pits filled situation, if each player has only one stick left
(4/1/1).&lt;/p&gt;
&lt;p&gt;Finally, we implement a function, which implements Jehn’s optimal
strategy in a way, which can be used by the simulation function
&lt;code&gt;simulate_super6()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb23&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb23-1&quot;&gt;&lt;a href=&quot;#cb23-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Jehn&amp;#39;s optimal strategy for two players&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-2&quot;&gt;&lt;a href=&quot;#cb23-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-3&quot;&gt;&lt;a href=&quot;#cb23-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param player_idx Index of the player in the state_players variable (see simulate_super6 function)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-4&quot;&gt;&lt;a href=&quot;#cb23-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param filled_holes Number of pits filled&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-5&quot;&gt;&lt;a href=&quot;#cb23-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param state_players Vector of length equal to the number of players containing the number of sticks each player has left&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-6&quot;&gt;&lt;a href=&quot;#cb23-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return A numeric corresponding to the probability to continue&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-7&quot;&gt;&lt;a href=&quot;#cb23-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-8&quot;&gt;&lt;a href=&quot;#cb23-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;jehn &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(player_idx, filled_holes, state_players) {&lt;/span&gt;
&lt;span id=&quot;cb23-9&quot;&gt;&lt;a href=&quot;#cb23-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Some summaries&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-10&quot;&gt;&lt;a href=&quot;#cb23-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  sticks_left &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; filled_holes &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(state_players)&lt;/span&gt;
&lt;span id=&quot;cb23-11&quot;&gt;&lt;a href=&quot;#cb23-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  my_sticks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; state_players[player_idx]&lt;/span&gt;
&lt;span id=&quot;cb23-12&quot;&gt;&lt;a href=&quot;#cb23-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  other_sticks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; state_players[&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;player_idx]&lt;/span&gt;
&lt;span id=&quot;cb23-13&quot;&gt;&lt;a href=&quot;#cb23-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb23-14&quot;&gt;&lt;a href=&quot;#cb23-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;#Strategy for basic cases&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-15&quot;&gt;&lt;a href=&quot;#cb23-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (filled_holes &lt;span class=&quot;sc&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb23-16&quot;&gt;&lt;a href=&quot;#cb23-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (filled_holes &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb23-17&quot;&gt;&lt;a href=&quot;#cb23-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;#Complicated part of the strategy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-18&quot;&gt;&lt;a href=&quot;#cb23-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  s_best &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;optimal_strategy&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;sticks_left)&lt;/span&gt;
&lt;span id=&quot;cb23-19&quot;&gt;&lt;a href=&quot;#cb23-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  state &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(filled_holes, my_sticks, other_sticks, &lt;span class=&quot;at&quot;&gt;sep=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb23-20&quot;&gt;&lt;a href=&quot;#cb23-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  action &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; s_best &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(situation &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; state) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb23-21&quot;&gt;&lt;a href=&quot;#cb23-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(continue)&lt;/span&gt;
&lt;span id=&quot;cb23-22&quot;&gt;&lt;a href=&quot;#cb23-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-23&quot;&gt;&lt;a href=&quot;#cb23-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Check if output fails (this should not happen).  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-24&quot;&gt;&lt;a href=&quot;#cb23-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;fu&quot;&gt;length&lt;/span&gt;(action) &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) { &lt;span class=&quot;fu&quot;&gt;browser&lt;/span&gt;()}&lt;/span&gt;
&lt;span id=&quot;cb23-25&quot;&gt;&lt;a href=&quot;#cb23-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;sc&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;is.numeric&lt;/span&gt;(action)) { &lt;span class=&quot;fu&quot;&gt;browser&lt;/span&gt;()}&lt;/span&gt;
&lt;span id=&quot;cb23-26&quot;&gt;&lt;a href=&quot;#cb23-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb23-27&quot;&gt;&lt;a href=&quot;#cb23-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Done&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-28&quot;&gt;&lt;a href=&quot;#cb23-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(action)&lt;/span&gt;
&lt;span id=&quot;cb23-29&quot;&gt;&lt;a href=&quot;#cb23-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;} &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This allows us to test, if there is a winning advantage, despite both
players playing the optimal strategy (see &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2023-03-13-super6.Rmd&quot;&gt;source
code&lt;/a&gt; for details).&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 × 1
##   p_win_beginner
##            &amp;lt;dbl&amp;gt;
## 1          0.596&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The answer is thus: Yes! In 60% of the games the starting player
wins. Thus, the winning advantage of the beginner in the &lt;span
class=&quot;math inline&quot;&gt;\(n=2\)&lt;/span&gt; scenario remains even when both
players use the &lt;code&gt;jehn&lt;/code&gt; optimal winning strategy.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-jehn2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Jehn, Rüdiger. 2021. &lt;span&gt;“Optimum Strategies for the Game Super
Six.”&lt;/span&gt; arXiv. &lt;a
href=&quot;https://doi.org/10.48550/ARXIV.2109.10700&quot;&gt;https://doi.org/10.48550/ARXIV.2109.10700&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 13 Mar 2023 00:00:00 +0100</pubDate>
        <link>http://mhoehle.github.io/blog/2023/03/13/super6.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2023/03/13/super6.html</guid>
        
        <category>rstats</category>
        
        <category>stats</category>
        
        <category>simulation</category>
        
        <category>game theory</category>
        
        
      </item>
    
      <item>
        <title>Tupper&apos;s Self Referential Formula in R</title>
        <description>&lt;p&gt;&lt;!-- bibliography: /Users/hoehle/Literature/Bibtex/jabref.bib --&gt;&lt;/p&gt;
&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We implement Tupper’s self-referencing formula in R. This has been
done before by others, but the joy was to be able to learn how to do it
yourself using the tidyverse.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/plot_tupper-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2022-10-17-tupper.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a
href=&quot;https://en.wikipedia.org/wiki/Tupper%27s_self-referential_formula%20#&quot;&gt;Tupper’s
self-referencial formula&lt;/a&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;tupper2001&quot;&gt;(Tupper 2001)&lt;/span&gt; is an equation which maps a
2D &lt;span class=&quot;math inline&quot;&gt;\((x,y)\)&lt;/span&gt; coordinate to an &lt;span
class=&quot;math inline&quot;&gt;\(\{\text{FALSE},\text{TRUE}\}\)&lt;/span&gt; value. If
&lt;span class=&quot;math inline&quot;&gt;\((x,y)\)&lt;/span&gt; represent pixel locations,
the output over a grid of values can thought of as a black &amp;amp; white
image where the true/false values are mapped to &lt;span
class=&quot;math inline&quot;&gt;\(\{0,1\}\)&lt;/span&gt; in the usual way. Tupper’s
formula is &lt;span class=&quot;math inline&quot;&gt;\(f(x,y) =\)&lt;/span&gt; &lt;span
class=&quot;math display&quot;&gt;\[
\frac{1}{2} &amp;lt; \left\lfloor \operatorname{mod}\left(
\left\lfloor\frac{y}{17}\right\rfloor\cdot 2^{-17\lfloor x \rfloor -
\operatorname{mod}(\lfloor y \rfloor, 17)}, 2\right)\right\rfloor.
\]&lt;/span&gt; We note that if one evaluates the function for all integers
&lt;span class=&quot;math inline&quot;&gt;\((x,y)\)&lt;/span&gt; for &lt;span
class=&quot;math inline&quot;&gt;\(0 \leq x \leq 105\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(k\leq y\leq k+16\)&lt;/span&gt;, where &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; is a fixed constant, then one gets a
binary image with 106x17 pixels. The entire magic of Tupper’s formula is
that it’s just unpacking an encoding of that 106x17 grid by representing
it as a 1802 long binary number which is then converted from base-2 into
base-10. For some (not so obvious) reason this number is then multiplied
by 17 to yield the final value of &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;
(in base-10)&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We also note that since the right-hand side of Tupper’s equation will
always be 0 or 1, the comparison with &lt;span
class=&quot;math inline&quot;&gt;\(\frac{1}{2}\)&lt;/span&gt; appears superfluous and seems
to be just a way to get a Boolean instead of a 0/1. Furthermore, since
we will be using only integer values for &lt;span
class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt;, the floor operators around &lt;span
class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt; are not really needed either.&lt;/p&gt;
&lt;h3 id=&quot;more-background&quot;&gt;More Background&lt;/h3&gt;
&lt;p&gt;Initially, I learned about the formula from a twitter post:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot;&gt;
&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
Tupper&apos;s self-referential formula is a formula that visually represents
itself when graphed at a specific location in the (x, y) plane.
&lt;a href=&quot;https://t.co/wAUVahJ9Dq&quot;&gt;pic.twitter.com/wAUVahJ9Dq&lt;/a&gt;
&lt;/p&gt;
— Fermat&apos;s Library (&lt;span class=&quot;citation&quot;
data-cites=&quot;fermatslibrary&quot;&gt;(&lt;strong&gt;fermatslibrary?&lt;/strong&gt;)&lt;/span&gt;)
&lt;a href=&quot;https://twitter.com/fermatslibrary/status/960154478224793600?ref_src=twsrc%5Etfw&quot;&gt;February
4, 2018&lt;/a&gt;
&lt;/blockquote&gt;
&lt;script async src=&quot;https://platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;p&gt;A nice Numberphile video has also been dedicated to the formula.
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/_s5RFgd59ao&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;h2 id=&quot;r-implementation&quot;&gt;R Implementation&lt;/h2&gt;
&lt;p&gt;One challenge of implementing Tupper’s formula in R is that &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; will be a very large integer (~500
digits). Hence, one needs a special purpose library to handle these
large numbers. StaTEAstics in their 2013 &lt;a
href=&quot;https://www.r-bloggers.com/2013/03/tuppers-self-referential-formula/&quot;&gt;R
blog post on Tupper’s formula&lt;/a&gt; use the GNU Multiple Precision
Arithmetic Library for this purpose and is interfaced in the &lt;a
href=&quot;https://cran.r-project.org/web/packages/gmp/index.html&quot;&gt;&lt;code&gt;gmp&lt;/code&gt;
R package&lt;/a&gt;. We follow their implementation:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;##  GNU Multiple Precision Arithmetic Library) for handling the long integers&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(gmp)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Define the constant k&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;k &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;960939379918958884971672962127852754715004339660129306651505519271702802395266424689642842174350718121267153782770623355993237280874144307891325963941337723487857735749823926629715517173716995165232890538221612403238855866184013235585136048828693337902491454229288667081096184496091705183454067827731551705405381627380967602565625016981482083418783163849115590225610003652351370343874461848378737238198224849863465033159410054974700593138339226497249461751545728366702369745461014655997933798537483143786841806593422227898388722980000748404719&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thus an R function implementing Tupper’s formula is:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;tupper &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(x, y, k) {&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z1 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(y &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; k)&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigq&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(z1&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  z3 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;^&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(x) &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(z1) &lt;span class=&quot;sc&quot;&gt;%%&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;floor&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.bigz&lt;/span&gt;(z2 &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; z3) &lt;span class=&quot;sc&quot;&gt;%%&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we have used &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; explicitly
in order to have &lt;span class=&quot;math inline&quot;&gt;\(y\)&lt;/span&gt; run from 0 to
16, which is easier for the subsequent plotting. Applying the R function
to an appropriate grid of values (and reversing the index directions to
account for the horizontal plotting direction):&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;im &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;expand_grid&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;105L, &lt;span class=&quot;at&quot;&gt;y=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;16L) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;z=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tupper&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;105&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;x, &lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;y, &lt;span class=&quot;at&quot;&gt;k=&lt;/span&gt;k))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The result can then easily plotted:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plot_tupper &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(im, &lt;span class=&quot;at&quot;&gt;palette=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;darkblue&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;lightgray&amp;quot;&lt;/span&gt;)) {&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;ggplot&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;data=&lt;/span&gt;im, &lt;span class=&quot;fu&quot;&gt;aes&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;x,&lt;span class=&quot;at&quot;&gt;y=&lt;/span&gt;y,&lt;span class=&quot;at&quot;&gt;fill=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;as.factor&lt;/span&gt;(z))) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;geom_tile&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;scale_fill_manual&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;values=&lt;/span&gt;palette) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;theme_void&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;theme&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;legend.position=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;none&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;coord_equal&lt;/span&gt;()&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;plot_tupper&lt;/span&gt;(im)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/plot_tupper-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;behind-the-scenes&quot;&gt;Behind the Scenes&lt;/h2&gt;
&lt;p&gt;To check the underlying binary representation we convert &lt;span
class=&quot;math inline&quot;&gt;\(k/17\)&lt;/span&gt; to base-2 notation. However, the
multiplication by 17 (10001 in base-2) not only ensures that taking
&lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; modulo the height of the image
starts at zero, but it is also helpful to keep possible trailing zeroes
in the encoding of the image. Since we know the image size has to be
&lt;span class=&quot;math inline&quot;&gt;\(17\times 106=1802\)&lt;/span&gt; we simply fill
the trailing zeroes, if the base-2 converted result of &lt;span
class=&quot;math inline&quot;&gt;\(k/17\)&lt;/span&gt; does not have a length of 1802.&lt;/p&gt;
&lt;p&gt;Convert to base-2 number of length 1802 and visualize the number:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;char &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.character&lt;/span&gt;(k&lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;b=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Add trailing zeroes, which are missing coz the first two pixel are 0.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;char &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;0&amp;quot;&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;106&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_length&lt;/span&gt;(char)), &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;), char)&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt;(char)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;00110010101000100001010101011111000010010010100000000000000000000000000000001000000000000000101000000000000010001000000000000000000000001111111111111111110000000000000000100000111100000000000000001000000000000011100000000000000000100000000000001110000000000000000000000000000000011000000000000001001000000000000010010000000000000011000000000000000000000000000000001100000000000000100100000000000001001000000000000011111100000000000000000000000000011111110000000111000000011100110000000000000110000000000000000011111111111111110100000000000000001011111010000000000000000101011000001100101001000001000111010001100010000000000000000111111111111111100000000000000000000000011001000000000000101001000000000001001010000000000010001000100000000000000001000000000000000000000000000000011111000000000000000000000000000001100100000000000000111000000000000000000000000001111111100000000010000000000000000100101000000000000000100000000000010010100000000000100000000000000001111111100000000000000000000000000000001000000000000000010000000000000000000000000000000111000000000000000010000000000000011100000000000000001000000000000001100000000000000000000000000000000111000000000000001010000000000000011100000000000000000000000000000001110000000000000010100000000000000111110000000000000000000000000000111100000000000110000110000000000000000000000000011111111000000000100000000000000001010110000000000000010000000000000100011000000000001000000000000000011111111000000000000000000000000001000000000000000001100000000000000000000000000000000001111100000000000000000000000000000110010000000000000011100000000000000000000000000110000110001000000011110000001100000000000000000000000000000000001100100000000000010100100000000000100101000001100001000100001100111000000011100100001111111000001000000000000000011111111111111111&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;str_length&lt;/span&gt;(char)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;[1] 1802&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Shown splitted into chunks of 17 and for better plotting replacing 0
with ” ” and 1 with “█”&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;char_split &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;stri_sub&lt;/span&gt;(char, &lt;span class=&quot;fu&quot;&gt;seq&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, stringi&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;stri_length&lt;/span&gt;(char),&lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;length=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plot_string &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(char_split, &lt;span class=&quot;at&quot;&gt;collapse=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-3&quot;&gt;&lt;a href=&quot;#cb9-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;str_replace_all&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;0&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb9-4&quot;&gt;&lt;a href=&quot;#cb9-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;str_replace_all&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;█&amp;quot;&lt;/span&gt;) &lt;/span&gt;
&lt;span id=&quot;cb9-5&quot;&gt;&lt;a href=&quot;#cb9-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt;(plot_string)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;  ██  █ █ █   █  
  █ █ █ █ █████  
  █  █  █ █      
                 
        █        
       █ █       
      █   █      
                 
█████████████████
█                
█     ████       
         █       
      ███        
         █       
      ███        
                 
       ██        
      █  █       
      █  █       
       ██        
                 
       ██        
      █  █       
      █  █       
      ██████     
                 
     ███████     
  ███       ███  
██             ██
                 
████████████████ 
█                
█ █████ █        
        █ █ ██   
  ██  █ █  █     
█   ███ █   ██   
█                
████████████████ 
                 
      ██  █      
      █ █  █     
      █  █ █     
      █   █   █  
              █  
                 
            █████
                 
            ██  █
              ███
                 
         ████████
         █       
         █  █ █  
             █   
         █  █ █  
         █       
         ████████
                 
              █  
              █  
                 
            ███  
              █  
            ███  
              █  
            ██   
                 
            ███  
            █ █  
            ███  
                 
            ███  
            █ █  
            █████
                 
           ████  
         ██    ██
                 
         ████████
         █       
         █ █ ██  
            █    
         █   ██  
         █       
         ████████
                 
         █       
          ██     
                 
            █████
                 
            ██  █
              ███
                 
         ██    ██
   █       ████  
    ██           
                 
      ██  █      
      █ █  █     
      █  █ █     
██    █   █    ██
  ███       ███  
█    ███████     
█                
█████████████████&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or somewhat better visible as a plot:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Convert to image data.frame&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;im2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;expand_grid&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;105&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;y=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;im2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; im2 &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;idx =&lt;/span&gt; y &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; (x&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;17&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rowwise&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;value_str =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_sub&lt;/span&gt;(char, &lt;span class=&quot;at&quot;&gt;start=&lt;/span&gt;idx, &lt;span class=&quot;at&quot;&gt;end=&lt;/span&gt;idx),&lt;/span&gt;
&lt;span id=&quot;cb11-5&quot;&gt;&lt;a href=&quot;#cb11-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;at&quot;&gt;value =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(value_str)) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/show_pixels-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;
We find the above binary number by starting in the (0,0) cell and
reading upwards in the &lt;span class=&quot;math inline&quot;&gt;\(x=0\)&lt;/span&gt;
column.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Given the entire “magic” of Tupper’s formula is in &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;, this &lt;a
href=&quot;https://keelyhill.github.io/tuppers-formula&quot;&gt;site&lt;/a&gt; allows you
to upload a raw 106x17 image and get the corresponding &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; for use in the formula. With &lt;a
href=&quot;https://www.gimp.org/&quot;&gt;Gimp&lt;/a&gt;’s PBM export functionality it’s
thus easy to make your own plotting, e.g. with &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; equal to&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;186884211780601757089521467754254266534847988959618908270134320886923032590936706609566110951773945064529540811157829398942842590351995031478543240582993263095682288889081666401727057238884719133521833705371096422637085577259001963761107220646739852199923964701689237214047197937015515747842387117086366819859986916183575585602891273928856883765838042528273754853751383296206633974324557163987001300322007312244691824532706662875082651525203923748809153375012301876787226286483554151163460581654755346590825663755194466304&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;we get
&lt;img src=&quot;/blog/figure/source/2022-10-17-tupper/discussion_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;
Happy self-referential plotting!&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-tupper2001&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Tupper, Jeff. 2001. &lt;span&gt;“Reliable Two-Dimensional Graphing Methods for
Mathematical Formulae with Two Free Variables.”&lt;/span&gt; In
&lt;em&gt;Proceedings of the 28th Annual Conference on Computer Graphics and
Interactive Techniques&lt;/em&gt;, 77–86. SIGGRAPH ’01. New York, NY, USA:
Association for Computing Machinery. &lt;a
href=&quot;https://doi.org/10.1145/383259.383267&quot;&gt;https://doi.org/10.1145/383259.383267&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;For details about why the multiplication with the height
is done, see Arvind Narayanan’s post &lt;a
href=&quot;https://web.archive.org/web/20150424181239/http://arvindn.livejournal.com/132943.html&quot;&gt;Tupper’s
Self-Referential Formula Debunked&lt;/a&gt;.&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Mon, 17 Oct 2022 00:00:00 +0200</pubDate>
        <link>http://mhoehle.github.io/blog/2022/10/17/tupper.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2022/10/17/tupper.html</guid>
        
        <category>rstats</category>
        
        <category>stats</category>
        
        <category>obesity</category>
        
        <category>nonparametrics</category>
        
        
      </item>
    
      <item>
        <title>Anthropometric Birthday Cards</title>
        <description>&lt;p&gt;&lt;!-- bibliography: /Users/hoehle/Literature/Bibtex/jabref.bib --&gt;&lt;/p&gt;
&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We visualize children reference populations for height, weight and
body mass index by plotting percentiles of the population as a function
of age. Besides the epidemiological interest in these anthropometric
curves, they have dual-use potential for reproducible birthday
cards.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_bmi_plot-1.png&quot; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2022-06-11-refpop.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Percentiles of a reference population at a given age are often used
to assess under- and overweight of children. As an example, the WHO
defines obesity for children under 5 years of age when the &lt;a
href=&quot;https://cdn.who.int/media/docs/default-source/child-growth/child-growth-standards/indicators/weight-for-length-height/cht-wfl-girls-z-0-2.pdf?sfvrsn=a683172c_11&quot;&gt;weight-for-height&lt;/a&gt;
of a child is greater than 3 standard deviations above WHO Child Growth
Standards median for that
age](https://www.who.int/news-room/fact-sheets/detail/obesity-and-overweight)
(see also the WHO R package &lt;a
href=&quot;https://cran.r-project.org/web/packages/anthro/index.html&quot;&gt;anthro&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In order to estimate these percentiles, data from a sample of the
reference population is often fitted using flexible regression models
such as GAMLSS &lt;span class=&quot;citation&quot;
data-cites=&quot;rigby_stasinopoulos2005&quot;&gt;(Rigby and Stasinopoulos
2005)&lt;/span&gt; or quantile regression &lt;span class=&quot;citation&quot;
data-cites=&quot;koenker2005&quot;&gt;(Koenker 2005)&lt;/span&gt;. This allows for a
flexible modelling of the percentiles as smooth functions of age &lt;span
class=&quot;citation&quot; data-cites=&quot;fenske_etal2013&quot;&gt;(Fenske et al.
2013)&lt;/span&gt;. The reference curves used in Germany are based on the
Box-Cox Cole and Green distribution &lt;span class=&quot;citation&quot;
data-cites=&quot;KromeyerHauschild_etal2001&quot;&gt;(Kromeyer-Hauschild et al.
2001)&lt;/span&gt; (aka. the LMS method). The &lt;a
href=&quot;https://cran.r-project.org/web/packages/childsds/index.html&quot;&gt;childsds&lt;/a&gt;
R package contains an implementation of these curves as
&lt;code&gt;data(kro.ref)&lt;/code&gt;. Furthermore, the package contains similar
reference curves for several other countries as well as the WHO
reference.&lt;/p&gt;
&lt;p&gt;In what follows, we will re-purpose the package as work-horse for
generating individualized birthday cards for children.&lt;/p&gt;
&lt;h2 id=&quot;results&quot;&gt;Results&lt;/h2&gt;
&lt;p&gt;Quantiles of the reference population are obtained with the
&lt;code&gt;childsds::make_percentile_tab&lt;/code&gt; function. As an example,
let’s get the 5th, 50th and 95th percentile of the height distribution
for the population of girls in Germany aged 0 and 4 years,
respectively.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(childsds)&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;data&lt;/span&gt;(kro.ref)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;childsds&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;make_percentile_tab&lt;/span&gt;(&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;at&quot;&gt;ref =&lt;/span&gt; kro.ref, &lt;span class=&quot;at&quot;&gt;item =&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;height&amp;quot;&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;age=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;at&quot;&gt;perc=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;50&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;95&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;include.pars=&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(sex &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;female&amp;quot;&lt;/span&gt;) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;##      sex age perc_05_0 perc_50_0 perc_95_0
## 1 female   0  47.39498   51.1112  54.82742
## 2 female   4  96.33650  103.6051 110.87370&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The main result of this short blog post is a &lt;a
href=&quot;https://github.com/hoehleatsu/hoehleatsu.github.io/blob/master/figure/source/2022-06-11-refpop/birth_stats.Rmd&quot;&gt;Rmd
file&lt;/a&gt;, which contains a visualization of an imaginary child’s growth
trajectory: Albert B. Cook born on 2018-06-11. The data of Albert are
stored in a &lt;a
href=&quot;/blog/figure/source/2022-06-11-refpop/kid_measurements.csv&quot;&gt;CSV
file&lt;/a&gt;. We show the trajectories for height, weight and BMI and
compare to 5 quantiles of the German reference population, i.e. the
2.5%, 5%, 50%, 95% and 97.5% quantile. The resulting visualization looks
as follows:&lt;/p&gt;
&lt;hr&gt;
&lt;!--
---
title: &quot;Birth statistics&quot;
author: &quot;&quot;
date: &apos;2022-06-11&apos;
output:
  html_document: default
  pdf_document: default
editor_options:
 chunk_output_type: console
---
--&gt;
&lt;!-- 
Remove above comment to make this into an Rmd file. This was commented in order
     for Jekyll not to accidently process the page when creating the blog
--&gt;
&lt;h1 id=&quot;albert-b.-cook&quot;&gt;Albert B. Cook&lt;/h1&gt;
&lt;p&gt;Let’s look at how Albert relates to the population of children in
Germany&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; as implemented in the &lt;a
href=&quot;https://cran.r-project.org/web/packages/childsds/index.html&quot;&gt;childsds&lt;/a&gt;
R package&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;height&quot;&gt;Height&lt;/h2&gt;
&lt;p&gt;Albert’s height of 108 cm at age 4.0 years corresponds to the 81.4%
quantile among boys in Germany of that age.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_height_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;weight&quot;&gt;Weight&lt;/h2&gt;
&lt;p&gt;Albert’s weight of 19,100 g at age 4.0 years corresponds to the 82.6%
quantile among boys in Germany of that age.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_weight_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;bmi&quot;&gt;BMI&lt;/h2&gt;
&lt;p&gt;Albert’s BMI of 16.4 kg/m² at age 4.0 years corresponds to the 73.3%
quantile among boys in Germany of that age.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2022-06-11-refpop/make_bmi_plot-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;The Rmd file can be obtained from GitHub and serves as a template for
creating &lt;a
href=&quot;/blog/figure/source/2022-06-11-refpop/birth_stats.html&quot;&gt;html based
congratulation cards&lt;/a&gt; in response to news of newborn (which usually
are annotated with birth height and birth weight) or to track the growth
of your own kids.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Percentile curves for longitudinal trajectories in populations can
also be used in very different contexts than anthropometry. As an
example consider the development of your &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2019/05/06/wcamining.html&quot;&gt;solve
time for the 3x3x3 Rubik’s cube as a function of time since first WCA
competition&lt;/a&gt;.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-fenske_etal2013&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Fenske, N., L. Fahrmeir, P. Rzehak, and M. Höhle. 2013. &lt;span&gt;“Boosting
Structured Additive Quantile Regression for Longitudinal Childhood
Obesity Data.”&lt;/span&gt; &lt;em&gt;Int J Biostat&lt;/em&gt; 9 (1): 1–18. &lt;a
href=&quot;https://www.degruyter.com/document/doi/10.1515/ijb-2012-0035/html&quot;&gt;https://www.degruyter.com/document/doi/10.1515/ijb-2012-0035/html&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-koenker2005&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Koenker, Roger. 2005. &lt;em&gt;Quantile Regression&lt;/em&gt;. Cambridge University
Press.
&lt;/div&gt;
&lt;div id=&quot;ref-KromeyerHauschild_etal2001&quot; class=&quot;csl-entry&quot;
role=&quot;listitem&quot;&gt;
Kromeyer-Hauschild, K., M. Wabitsch, D. Kunze, F. Geller, H. C. Geiß, V.
Hesse, A. von Hippel, et al. 2001. &lt;span&gt;“Perzentile f&lt;span&gt;ü&lt;/span&gt;r
Den Body-Mass-Index f&lt;span&gt;ü&lt;/span&gt;r Das Kindes- Und Jugendalter Unter
Heranziehung Verschiedener Deutscher Stichproben.”&lt;/span&gt;
&lt;em&gt;Monatsschrift Kinderheilkunde&lt;/em&gt; 149 (8): 807–18.
&lt;/div&gt;
&lt;div id=&quot;ref-rigby_stasinopoulos2005&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Rigby, R. A., and D. M. Stasinopoulos. 2005. &lt;span&gt;“Generalized Additive
Models for Location, Scale and Shape (with Discussion).”&lt;/span&gt;
&lt;em&gt;Applied Statistics&lt;/em&gt; 54: 1–38.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;According to Kromeyer-Hauschild, K., Wabitsch, M.,
Kunze, D. et al. Perzentile für den Body-mass-Index für das Kindes- und
Jugendalter unter Heranziehung verschiedener deutscher Stichproben.
&lt;em&gt;Monatsschr Kinderheilkd&lt;/em&gt; 149, 807–818 (2001).
https://doi.org/10.1007/s001120170107&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;Vogel M (2022). &lt;em&gt;childsds: Data and Methods Around
Reference Values in Pediatrics&lt;/em&gt;. R package version 0.8.0, &lt;a
href=&quot;https://CRAN.R-project.org/package=childsds&quot;
class=&quot;uri&quot;&gt;https://CRAN.R-project.org/package=childsds&lt;/a&gt;.
&lt;hr&gt;
&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Sat, 11 Jun 2022 00:00:00 +0200</pubDate>
        <link>http://mhoehle.github.io/blog/2022/06/11/refpop.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2022/06/11/refpop.html</guid>
        
        <category>rstats</category>
        
        <category>stats</category>
        
        <category>obesity</category>
        
        <category>nonparametrics</category>
        
        
      </item>
    
      <item>
        <title>An R Package for Social Roulette </title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We introduce the R package socialroulette, which is a lightweight
package for handling the recurrent problem of assigning individuals into
groups of a fixed size. In order to minimize reunions, we provide an
algorithm to solve the task as an instance of the maximally diverse
grouping problem.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2021-05-12-socroulette/roulette-1003120_640.jpg&quot; width=&quot;350&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-05-12-socroulette.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Groupings are relevant when breakout rooms, mystery lunch partitions
or student peer review groups are made. My last blog post &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2021/04/04/socialsamp.html&quot;&gt;Long
time, no see: Virtual Lunch Roulette&lt;/a&gt; considered the probability of
being assigned into the same group as someone, you already were in the
same group with the last time (aka. a re-union) when using simple random
sampling to assign the groups. This probability proved to be
surprisingly high.&lt;/p&gt;
&lt;p&gt;In this post we develop the subject further by introducing the R
package &lt;a
href=&quot;https://hoehleatsu.github.io/socialroulette/&quot;&gt;&lt;code&gt;socialroulette&lt;/code&gt;&lt;/a&gt;,
which aims at being helpful in making better group assignments based on
solutions of the &lt;a
href=&quot;http://grafo.etsii.urjc.es/optsicom/mdgp/&quot;&gt;&lt;strong&gt;maximally
diverse grouping problem&lt;/strong&gt;&lt;/a&gt; (MDGP) known from operations
research.&lt;/p&gt;
&lt;h3 id=&quot;the-problem&quot;&gt;The Problem&lt;/h3&gt;
&lt;p&gt;The aim is to partition &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;
participants into groups of size at least &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;. We shall denote the resulting
groupings a &lt;a
href=&quot;https://en.wikipedia.org/wiki/Partition_of_a_set&quot;&gt;&lt;strong&gt;partition&lt;/strong&gt;&lt;/a&gt;
of the set of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; participants. If
&lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; is not a divisor of &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; then some of the groups have to contain
more than &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; participants. As an
example consider the case that 5 individuals are to be divided into
groups of size at least 2. We shall adopt the convention, that group
size shall be as close to &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; as
possible and the group sizes should be as equal as possible. In the
specific toy example this means that we will need 2 groups, one with 3
participants and one with 2 participants.&lt;/p&gt;
&lt;p&gt;When assigning such groups repeatedly, e.g. one a weekly basis, an
additional criterion can be to form the groups, such that as few
participants as possible are assigned into groups with individuals they
were already in the same group with previously. This can, e.g., be done
by rejection sampling. However, as situations can occur where such
re-unions are unavoidable, it can instead be natural to formulate a
metric to maximize, which quantifies penalities due to such re-unions.
As an example: If one has to decide between assigning two individuals to
the same group who met 7 days or 14 days ago, it might be preferable to
choose the pair which met 14 days ago. Such optimization is known as
solving the &lt;a
href=&quot;http://grafo.etsii.urjc.es/optsicom/mdgp/&quot;&gt;&lt;strong&gt;maximally
diverse grouping problem&lt;/strong&gt;&lt;/a&gt; (see appendix).&lt;/p&gt;
&lt;h2 id=&quot;the-r-package-socialroulette&quot;&gt;The R package socialroulette&lt;/h2&gt;
&lt;p&gt;We illustrate the package by considering a use-case, where a class of
students repeatably for every lecture have be assigned into breakout
rooms. First, we install and load the &lt;a
href=&quot;https://hoehleatsu.github.io/socialroulette/&quot;&gt;&lt;code&gt;socialroulette&lt;/code&gt;&lt;/a&gt;
package available from &lt;a
href=&quot;https://github.com/hoehleatsu/socialroulette/&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Install package&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;devtools&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;install_github&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;hoehleatsu/socialroulette&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;library&lt;/span&gt;(socialroulette)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note: A binary package version is available from my &lt;a
href=&quot;https://hoehleatsu.r-universe.dev&quot;&gt;r-universe&lt;/a&gt;, which is a
pipeline automatically compiling the package through GitHub actions.&lt;/p&gt;
&lt;p&gt;Say the class consists of 100 students, which for a weekly virtual
lab exercise class need to be divided into groups of at least 4. Since
for various reasons not all students show up for each class, the
sampling frame of individuals to be partitioned each week changes
accordingly. Still, we would like to make the partitioning of the
current week s.t. students get as many new acquaintances as
possible.&lt;/p&gt;
&lt;p&gt;We first create a history of the previous 4 weeks’ groupings as well
as the frame of participants for the current lecture.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Class of 100 students with 4 previous lectures&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;students &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; tibble&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;id%.3d@student.su.se&amp;quot;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;partition_dates &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;seq&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2021-03-31&amp;quot;&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;1 week&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Simulate changing participation each week for the last 4 weeks (70% attendance)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;frames &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;( partition_dates, &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            students &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice_sample&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rbinom&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(.), &lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.7&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                         &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;date=&lt;/span&gt;.x))&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Generate some past partitions using simple random sampling&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;past_partitions &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; frames &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;group_split&lt;/span&gt;(date) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rsocialroulette&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;current_frame=&lt;/span&gt;.x, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;algorithm=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;srs&amp;quot;&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(partition_dates)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## Partitioning 72 individuals into groups of at least 4 (no past partitions).
## Created 18 groups of sizes 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4.
## Partitioning 74 individuals into groups of at least 4 (no past partitions).
## Created 18 groups of sizes 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4.
## Partitioning 71 individuals into groups of at least 4 (no past partitions).
## Created 17 groups of sizes 5 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4.
## Partitioning 69 individuals into groups of at least 4 (no past partitions).
## Created 17 groups of sizes 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We pretend that each of the above previous partitions has been saved
as a .csv file. For example like:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Simulate the storage of each partition as a .csv file to disk&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# with 3 columns: date, id1 and id2, i.e. all pairs&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;temp_dir &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tempdir&lt;/span&gt;() &lt;span class=&quot;co&quot;&gt;#adjust path to your setting if needed&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partitions_to_pairs&lt;/span&gt;( past_partitions ) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_split&lt;/span&gt;(date) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;walk&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;  &lt;span class=&quot;fu&quot;&gt;write_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;x=&lt;/span&gt;.x, &lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;file.path&lt;/span&gt;(temp_dir, stringr&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;socialroulette-&amp;quot;&lt;/span&gt;, .&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;date[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;], &lt;span class=&quot;st&quot;&gt;&amp;quot;.csv&amp;quot;&lt;/span&gt;))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We thus read the partitions from disk and convert from the stored
pair-format (i.e. a &lt;code&gt;data.frame&lt;/code&gt; listing each pair being in
the same group as &lt;code&gt;id1&lt;/code&gt;, &lt;code&gt;id2&lt;/code&gt; together with the
corresponding &lt;code&gt;date&lt;/code&gt; of the partition) back to the
list-format (i.e. a list of character vectors, where each vector denotes
a group and the vector contains the ids of all members of that group).
This can be done as follows:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Read again from file&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;pairs &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map_df&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;list.files&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;path=&lt;/span&gt;temp_dir, &lt;span class=&quot;at&quot;&gt;pattern=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;socialroulette.*&amp;quot;&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;full.names=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;), &lt;span class=&quot;sc&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;read_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;.x))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As a next step we sample the students who are in the next class to
group.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;current_frame &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt;  students &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;slice_sample&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;n =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rbinom&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(.), &lt;span class=&quot;at&quot;&gt;prob=&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.7&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;date=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;max&lt;/span&gt;(partition_dates) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;diff&lt;/span&gt;(partition_dates) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;mean&lt;/span&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our goal is now to partition the 71 students in
&lt;code&gt;current_frame&lt;/code&gt;. For each of the &lt;span
class=&quot;math inline&quot;&gt;\({71 \choose 2 }= 2485\)&lt;/span&gt; possible pairs of
students in that class, we determine how long ago it has been, since
they were in the same group the last time. This can be done using the
internal package function &lt;code&gt;partitions_to_distance&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dist &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partitions_to_distance&lt;/span&gt;(current_frame, past_partitions)&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dist &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 4
##   id1                 id2                 date        dist
##   &amp;lt;chr&amp;gt;               &amp;lt;chr&amp;gt;               &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;
## 1 id078@student.su.se id100@student.su.se 2021-04-28    35
## 2 id078@student.su.se id092@student.su.se 2021-04-28    35
## 3 id078@student.su.se id098@student.su.se 2021-04-28    35
## 4 id078@student.su.se id093@student.su.se 2021-04-28    35
## 5 id078@student.su.se id083@student.su.se 2021-04-28    35
## 6 id078@student.su.se id095@student.su.se 2021-04-28    35&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-05-12-socroulette/unnamed-chunk-11-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Since the past partitions contain the last 4 weeks, students who have
not been in a group so far are assigned a value of one time difference
more than the last possible meeting opportunity. In the specific example
this corresponds to &lt;span class=&quot;math inline&quot;&gt;\(7\cdot (4 + 1) =
35\)&lt;/span&gt; days. It thus seems natural to choose the groups, s.t. they
do not contain pairs, which have already met in the past. However, for
given size of the population, group sizes and meeting histories, this
might not be possible to achieve altogether, so a more flexible
criterion is to maximize the sum of distance since the last meet over
all pairs in the same group.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Make the partition using a mdgp solver&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;partition &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt;  &lt;span class=&quot;fu&quot;&gt;rsocialroulette&lt;/span&gt;(current_frame, past_partitions, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;algorithm=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;mdgp&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The partition can be visualized using the &lt;code&gt;igraph&lt;/code&gt;
package:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-05-12-socroulette/unnamed-chunk-14-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Of course the partition can also be stored to file as before, in
order to include it in the set of past partitions when doing the
partitioning next week:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;(partition) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;setNames&lt;/span&gt;(current_frame &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(date)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partitions_to_pairs&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb10-4&quot;&gt;&lt;a href=&quot;#cb10-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;write_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;file.path&lt;/span&gt;(temp_dir, stringr&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;socialroulette-&amp;quot;&lt;/span&gt;, .&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;date[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;],&lt;span class=&quot;st&quot;&gt;&amp;quot;.csv&amp;quot;&lt;/span&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;or can be stored in a Zoom compatible breakout room specification
format:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;partition &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  socialroulette&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;partition_to_frame&lt;/span&gt;() &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;rename&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;email=&lt;/span&gt;id) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;room =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;room%.03d&amp;quot;&lt;/span&gt;,group)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-5&quot;&gt;&lt;a href=&quot;#cb11-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(room, email) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb11-6&quot;&gt;&lt;a href=&quot;#cb11-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;write_csv&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;file=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;file.path&lt;/span&gt;(temp_dir, stringr&lt;span class=&quot;sc&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;zoom-breakoutrooms.csv&amp;quot;&lt;/span&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We provide functionality to create better groupings than obtained by
simple random sampling. However, as mathematically convincing the MDGP
solution might be, reunions can have their charm.&lt;/p&gt;
&lt;h3 id=&quot;acknowledgements&quot;&gt;Acknowledgements&lt;/h3&gt;
&lt;p&gt;We thank Xiangjing Lai and &lt;a
href=&quot;http://www.info.univ-angers.fr/pub/hao/&quot;&gt;Jin-Kao Hao&lt;/a&gt; for
contributing their C++ source code of the MDGP solver in &lt;span
class=&quot;citation&quot; data-cites=&quot;lai_hao2016&quot;&gt;Lai and Hao (2016)&lt;/span&gt;
under a GPL-3 license for the &lt;a
href=&quot;https://hoehleatsu.github.io/socialroulette/&quot;&gt;&lt;code&gt;socialroulette&lt;/code&gt;&lt;/a&gt;
package.&lt;/p&gt;
&lt;h2 id=&quot;appendix-maximally-diverse-grouping-problem&quot;&gt;Appendix: Maximally
diverse grouping problem&lt;/h2&gt;
&lt;p&gt;In this appendix we provide a few more mathematically details about
the maximally diverse grouping problem, which is about partitioning
&lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into groups of size
at least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; while maximizing a sum
of utility values computed by summing the utility &lt;span
class=&quot;math inline&quot;&gt;\(u(i,j)\)&lt;/span&gt; over all individuals &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt;
partitioned into the same group.&lt;/p&gt;
&lt;p&gt;More formally, let &lt;span class=&quot;math inline&quot;&gt;\(d_{ij}\)&lt;/span&gt; denote
the number of time units (typically days) ago, that individual &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; were in the same group. Note: This
distance is derived by looking at the previous partitions. It is a
matter of definition what this value should be, if &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; have not previously been in the same
group. Let &lt;span class=&quot;math inline&quot;&gt;\(G=n\&amp;gt; \text{div}\&amp;gt;
m\)&lt;/span&gt; denote the resulting number of groups where &lt;span
class=&quot;math inline&quot;&gt;\(\text{div}\)&lt;/span&gt; denotes integer division. For
a given partition let &lt;span class=&quot;math inline&quot;&gt;\(x_{ig}\)&lt;/span&gt; be an
indicator variable, which is 1, if &lt;span
class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; is assigned into group &lt;span
class=&quot;math inline&quot;&gt;\(g\)&lt;/span&gt; and zero otherwise.&lt;/p&gt;
&lt;p&gt;A solver of the maximally diverse grouping problem now tries to
maximize &lt;span class=&quot;math display&quot;&gt;\[
\sum_{g=1}^G \sum_{i=1}^n \sum_{j=i+1}^n d_{ij} x_{ig} x_{jg},
\]&lt;/span&gt; subject to the conditions &lt;span class=&quot;math display&quot;&gt;\[
\begin{align*}
&amp;amp;\sum_{g=1}^{G} x_{ig} = 1,&amp;amp;&amp;amp;  i=1,\ldots,n, \\
&amp;amp;\sum_{i=1}^n x_{ig} = n_g,&amp;amp;&amp;amp; g=1,\ldots,G, \\
&amp;amp;x_{ig} \in \{0,1\}, &amp;amp;&amp;amp; i=1,\ldots,n;\quad g=1,\ldots,G, \\
\end{align*}
\]&lt;/span&gt; where &lt;span class=&quot;math inline&quot;&gt;\(n_g\)&lt;/span&gt; is the size of
group &lt;span class=&quot;math inline&quot;&gt;\(g\)&lt;/span&gt;, i.e. &lt;span
class=&quot;math inline&quot;&gt;\(\sum_{g=1}^G n_g = n\)&lt;/span&gt;. We shall adopt the
convention that group sizes are determined by assigning the labels &lt;span
class=&quot;math inline&quot;&gt;\(1,\ldots,G\)&lt;/span&gt; to the participants by
starting from the first to the last, e.g., as &lt;span
class=&quot;math inline&quot;&gt;\(((\text{index} - 1) \&amp;gt; \text{mod}\&amp;gt; m) +
1\)&lt;/span&gt; and then count how often each label occurs. This means, e.g.,
that for &lt;span class=&quot;math inline&quot;&gt;\(n=7\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt; we get &lt;span
class=&quot;math inline&quot;&gt;\(n_g=7\&amp;gt; \text{div}\&amp;gt; 4=1\)&lt;/span&gt; group with
7 members.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;socialroulette&lt;/code&gt; package uses as backend a C++
implementation of MDGP solver of &lt;span class=&quot;citation&quot;
data-cites=&quot;lai_hao2016&quot;&gt;Lai and Hao (2016)&lt;/span&gt;.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-lai_hao2016&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Lai, Xiangjing, and Jin-Kao Hao. 2016. &lt;span&gt;“Iterated Maxima Search for
the Maximally Diverse Grouping Problem.”&lt;/span&gt; &lt;em&gt;European Journal of
Operational Research&lt;/em&gt; 254 (3): 780–800. https://doi.org/&lt;a
href=&quot;https://doi.org/10.1016/j.ejor.2016.05.018&quot;&gt;https://doi.org/10.1016/j.ejor.2016.05.018&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Wed, 12 May 2021 00:00:00 +0200</pubDate>
        <link>http://mhoehle.github.io/blog/2021/05/12/socroulette.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2021/05/12/socroulette.html</guid>
        
        <category>rstats</category>
        
        <category>combinatorics</category>
        
        <category>R</category>
        
        
      </item>
    
      <item>
        <title>Long time, no see: Virtual Lunch Roulette</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;When distributing individuals into groups every week for a virtual
social mixer, e.g. using Zoom breakout rooms, it’s boring to end up in a
group with someone, who you already met last week. We compute the
probility for this to happen and state a simple rejection sampling
proposal for how to increase social diversity in such groupings.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_meetagain-1.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;As a pandemic replacement for the cross-division-chance-encounter in
the coffee kitchen, it has become common to use a virtual social mixer
format, where the &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; participants
are randomly divided into groups of at least &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; people, e.g., for a video meeting or
Zoom breakout rooms. Software exists to institutionalize such &lt;a
href=&quot;https://de.wikipedia.org/wiki/Random_Lunch&quot;&gt;Random Lunches&lt;/a&gt;
for, e.g., &lt;a href=&quot;https://lunchroulette.co/&quot;&gt;Slack&lt;/a&gt;. In this post
we shall be interested in the properties of such group assignment
algorithms.&lt;/p&gt;
&lt;p&gt;A practical experience is that all too often, the algorithm assigns
me to a group where at least one of the participants was already in my
group the last time. Before accusing the programmers of writing a poor
grouping algorithm: can we determine mathematically what the probability
for such a “reunion” is? How can we modify the algorithm to avoid
this?&lt;/p&gt;
&lt;h4 id=&quot;survey-of-the-field&quot;&gt;Survey of the field&lt;/h4&gt;
&lt;p&gt;Arranging a fixed set of &lt;span class=&quot;math inline&quot;&gt;\(n=k\times
m\)&lt;/span&gt; individuals into &lt;span class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt;
groups of size &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; in subsequent
rounds ensuring that no overlap occurs between the groups for as many
rounds as possible is also known as the &lt;a
href=&quot;http://www.mathpuzzle.com/MAA/54-Golf%20Tournaments/mathgames_08_14_07.html&quot;&gt;social
golfer problem&lt;/a&gt; or round robin scheduling in combinatorics - and can
be solved using &lt;a href=&quot;https://www.metalevel.at/mst.pdf&quot;&gt;constraint
programming&lt;/a&gt;. Compared to the social golfer problem, we have the
additional challenge that the group of people between rounds may be
subject to change. Furthermore, &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;
might not be a divisor of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;. Hence,
somewhat closer to our problem is the so called &lt;a
href=&quot;http://grafo.etsii.urjc.es/index.php/category/maximally-diverse-grouping/&quot;&gt;maximally
diverse grouping problem&lt;/a&gt;, where the grouping is to be done such that
the requirements on group size are met and a diversity score over the
elements in each group is maximized. For our setup, the score could,
e.g., be time since the last meet between individuals. Integer
programming can be used to solve the NP-complete problem.&lt;/p&gt;
&lt;p&gt;However, in our application we will either ignore the diversity score
altogether (i.e. set it to 1 always) or use a 0/1 diversity score (met
last time or not). Furthermore, we are interested in random assignment
algorithms selecting uniformly among the valid configurations. As a
consequence, we choose a more probabilistic approach and instead use a
custom group assignment algorithm as described in the next section.&lt;/p&gt;
&lt;h3 id=&quot;the-grouping&quot;&gt;The Grouping&lt;/h3&gt;
&lt;p&gt;We want to split the &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;
individuals into groups of preferably &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; members. However, if &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; is not a divisor of &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; then after making &lt;span
class=&quot;math inline&quot;&gt;\(\lfloor n/m \rfloor\)&lt;/span&gt; groups of &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; members we would have &lt;span
class=&quot;math inline&quot;&gt;\(l = n - \lfloor n/m \rfloor\)&lt;/span&gt; individuals
left. Instead of assigning these to a single leftover group, which would
be of size less than &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;
(particularly critical is size 1), we assign the remaining individuals
to the &lt;span class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; groups in round robin
fashion. This ensures that each group has size at least &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;. Note: Depending on &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; the resulting sizes might be larger
&lt;span class=&quot;math inline&quot;&gt;\(m+1\)&lt;/span&gt;, but the difference in the
resulting group size will never be larger than 1&lt;a href=&quot;#fn1&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.
Let &lt;code&gt;people&lt;/code&gt; be a tibble with a column &lt;code&gt;id&lt;/code&gt;
denoting a primary identifier key - this could, e.g., be the people’s
email address. An R function to perform a random assignment of the &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;=&lt;code&gt;nrow(people)&lt;/code&gt; individuals
into groups of at least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; could
look like:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; Sample people into groups (original algorithm)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param people tibble containing name and email of available ppl&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @param m requested group size. If m not a divisor of nrow(people) then put leftovers in existing groups&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39; @return A list of vectors where each vector containing the ids (row number in ppl) of those belonging to the same group&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;sample_groups &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(people, m) {&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Number of groups needed&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  n_g &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(people) &lt;span class=&quot;sc&quot;&gt;%/%&lt;/span&gt; m&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Group membership indicator&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  g &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n_g), &lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(people))&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Permutation order&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  perm &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;nrow&lt;/span&gt;(people)))&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb1-16&quot;&gt;&lt;a href=&quot;#cb1-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Make a list of ids in each group&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-17&quot;&gt;&lt;a href=&quot;#cb1-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  groups &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n_g), &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(i) {&lt;/span&gt;
&lt;span id=&quot;cb1-18&quot;&gt;&lt;a href=&quot;#cb1-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    idx &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; perm[&lt;span class=&quot;fu&quot;&gt;which&lt;/span&gt;(g &lt;span class=&quot;sc&quot;&gt;==&lt;/span&gt; i)]&lt;/span&gt;
&lt;span id=&quot;cb1-19&quot;&gt;&lt;a href=&quot;#cb1-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    people &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;slice&lt;/span&gt;(idx) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pull&lt;/span&gt;(id)&lt;/span&gt;
&lt;span id=&quot;cb1-20&quot;&gt;&lt;a href=&quot;#cb1-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  })&lt;/span&gt;
&lt;span id=&quot;cb1-21&quot;&gt;&lt;a href=&quot;#cb1-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb1-22&quot;&gt;&lt;a href=&quot;#cb1-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(groups)&lt;/span&gt;
&lt;span id=&quot;cb1-23&quot;&gt;&lt;a href=&quot;#cb1-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Example: Let &lt;code&gt;people&lt;/code&gt; denote the population of 47
individuals to be assigned into groups of at least &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt; according to the above
description.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;n &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;47&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;people &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;id =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;str_c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;fu&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;%0.2d&amp;quot;&lt;/span&gt;,&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n)))) &lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;m &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;groups &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_groups&lt;/span&gt;(people, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This leads to 11 groups with between 4 and 5 members. We can
visualize the group allocation as a graph, where each group will
correspond to a fully connected sub-graph, but with no connections
between the sub-graphs.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/unnamed-chunk-4-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h3 id=&quot;mathematical-formulation&quot;&gt;Mathematical Formulation&lt;/h3&gt;
&lt;p&gt;The mathematical question is now: Given you were in the group with
&lt;span class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; other persons the last time, what
is the probability that after assigning &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into groups of preferred
size &lt;span class=&quot;math inline&quot;&gt;\(m\geq 2\)&lt;/span&gt;, that you will be in
the same group with at least one of them again this time&lt;a href=&quot;#fn2&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.
Let &lt;span class=&quot;math inline&quot;&gt;\(m \leq k\)&lt;/span&gt; be the size of your
group in the current assignment. Combinatorical considerations tell us
the probability to meet at least one of the &lt;span
class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; persons again is:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
p(k, l, n) = 1 - \frac{1\cdot\prod_{i=2}^{k}
(n-(l+i-1))}{1\cdot\prod_{i=2}^{k} (n-i+1)}.
\]&lt;/span&gt; In order to determine the overall probability for a reunion
after assignment, we need to determine the PMF &lt;span
class=&quot;math inline&quot;&gt;\(f_{n,m}\)&lt;/span&gt; of the group size, i.e. what is
the probability that the algorithm dividing &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into groups of size at
least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; will assign me to a group
of size &lt;span class=&quot;math inline&quot;&gt;\(k, k\geq m\)&lt;/span&gt;. The probability
of interest is then: &lt;span class=&quot;math display&quot;&gt;\[
p(n,m,l) = \sum_{k=1}^\infty p(k,l,n) f_{n,m}(k)
\]&lt;/span&gt; Note: Even though we write the summation to be from 1 to &lt;span
class=&quot;math inline&quot;&gt;\(\infty\)&lt;/span&gt;, the PMF will only have support on
at most two integers.&lt;/p&gt;
&lt;p&gt;The calculations in R and verified by 1000 Monte Carlo
simulations:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Group membership indicator for the n individuals&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;g &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(n &lt;span class=&quot;sc&quot;&gt;%/%&lt;/span&gt; m), &lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;n)&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Which previous group sizes to consider. Note:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# can be way beyond m, even if m was selected&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;p_groupsize &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;prop.table&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;table&lt;/span&gt;(g)))&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;p_kln &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sapply&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;names&lt;/span&gt;(p_groupsize)), prob_reunion, &lt;span class=&quot;at&quot;&gt;l=&lt;/span&gt;l, &lt;span class=&quot;at&quot;&gt;n=&lt;/span&gt;n)&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;p_analytical =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(p_kln &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; p_groupsize), &lt;span class=&quot;at&quot;&gt;p_mc =&lt;/span&gt; p_reunion_mc) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## p_analytical         p_mc 
##    0.2024913    0.2010000&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can illustrate this reunion probability as a function of &lt;span
class=&quot;math inline&quot;&gt;\(k\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_reunion-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;As a next step we need to marginalise out the previous group size
&lt;span class=&quot;math inline&quot;&gt;\(l+1\)&lt;/span&gt;. For simplicity, we will assume
that exactly the same participants participate in each round. Hence, we
can use the same group size PMF as before when summing out &lt;span
class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt;: &lt;span class=&quot;math display&quot;&gt;\[
p(n,m) = \sum_{l=1}^\infty \sum_{k=1}^\infty p(k,l,n) f_{n,m}(k)
f_{n,m}(l+1)
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The result thus denotes the probability that you in two consecutive
assigments of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; individuals into
groups of at least &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; individuals
will be in the same group with someone twice. We will denote this the
&lt;em&gt;reunion probability&lt;/em&gt;. The graph below shows this probability as
a function of &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; and is also available in a &lt;a
href=&quot;/blog/figure/source/2021-04-04-socialsamp/p_meetagain_log.png&quot;&gt;log-x
axis version&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_meetagain-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Why are the curves not decreasing monotonically?&lt;a href=&quot;#fn3&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref3&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;
This is due to the minimum size &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;
restriction on the group size. If &lt;span
class=&quot;math inline&quot;&gt;\(m=6\)&lt;/span&gt; and you have &lt;span
class=&quot;math inline&quot;&gt;\(n=12\)&lt;/span&gt; people then there are two groups.
But if &lt;span class=&quot;math inline&quot;&gt;\(n=17\)&lt;/span&gt; while &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; is still 6, then we will still only
have two groups as one would need 18 people for 3 groups. However, there
are now 8 and 9 people in the two groups instead of 6 and 6 so the
probability of reunion increases. Altogether, the probability increases
from 12 and 17 until it decreases again at &lt;span
class=&quot;math inline&quot;&gt;\(n=18\)&lt;/span&gt;. Consequently, for &lt;span
class=&quot;math inline&quot;&gt;\(m=2\)&lt;/span&gt; the peaks would be at the even &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; and the troughs would be the odd &lt;span
class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Given our &lt;span class=&quot;math inline&quot;&gt;\(n=47\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt; we also note the high probability of
22% for a reunion, which confirms our empirical experience. Thus there
seems to be a need to impose some additional constraints on the grouping
in order to optimize social diversity. For a translation of &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; into the number of breakout rooms used
in Zoom, see Appendix A.&lt;/p&gt;
&lt;h3 id=&quot;grouping-with-avoidance&quot;&gt;Grouping with avoidance&lt;/h3&gt;
&lt;p&gt;Let &lt;code&gt;pairs&lt;/code&gt; be a tibble with columns &lt;code&gt;id1&lt;/code&gt; and
&lt;code&gt;id2&lt;/code&gt; denoting all pairs of individuals who were placed in
the same group the last time. We now want to enhance our group
allocation algorithm to only assign people into groups, if they were not
in the same group the last time. We do this by a simple rejection
sampling algorithm, where we draw a configuration with
&lt;code&gt;sample_groups&lt;/code&gt;, check if it has overlaps with the last
allocation, and if so, draw again. This method is not very efficient and
might take a while. Even worse: it might not finish at all, if no
configuration satisfying the constraint exist. An example is, if 9
individuals are to be divided into groups of at least 4 two times
without any reunions. The corresponding code of such a
&lt;code&gt;sample_groups_avoid&lt;/code&gt; function is available in the &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;R
code&lt;/a&gt; from GitHub. This can then be used to generate the desired
grouping without reunions:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Sampling in round1 and round2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;groups_r1 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_groups&lt;/span&gt;(people, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m)&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;groups_r2 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sample_groups_avoid&lt;/span&gt;(people, &lt;span class=&quot;at&quot;&gt;m=&lt;/span&gt;m, &lt;span class=&quot;at&quot;&gt;avoid_pairs =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;make_pairs&lt;/span&gt;(groups_r1))&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Check if there are any re-unions. Note: There should be none.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-6&quot;&gt;&lt;a href=&quot;#cb5-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;inner_join&lt;/span&gt;( &lt;span class=&quot;fu&quot;&gt;make_pairs&lt;/span&gt;(groups_r1) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(hash), &lt;span class=&quot;fu&quot;&gt;make_pairs&lt;/span&gt;(groups_r2) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;select&lt;/span&gt;(hash), &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;hash&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 0 x 1
## # … with 1 variable: hash &amp;lt;chr&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In other words: No reunions, just as we wanted.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We considered random groupings used, e.g., in lunch roulette or when
distributing students into breakout rooms. Depending on the number of
people to group and the anticipated group size the probability for a
reunion with somebody from last weeks grouping is surprisingly high.
Hence, we use rejection sampling to propose a configuration, where no
reunion occurs. The resulting grouping can easily be exported to a CSV
file for import when making &lt;a
href=&quot;https://support.zoom.us/hc/en-us/articles/360032752671-Pre-assigning-Participants-to-Breakout-Rooms&quot;&gt;pre-assigned
Zoom breakout rooms&lt;/a&gt; (example in the &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;R
code&lt;/a&gt; on GitHub). Even better allocations might be possible as part
of solving the maximally diverse grouping problem. For further
combinatorics posts, see also my work on the &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2017/02/13/bday.html&quot;&gt;birthday
problem with unequal probabilities&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&quot;acknowledgments&quot;&gt;Acknowledgments&lt;/h4&gt;
&lt;p&gt;Thanks to Dirk, Titus and Filip for the challenge.&lt;/p&gt;
&lt;h2 id=&quot;appendix-a&quot;&gt;Appendix A&lt;/h2&gt;
&lt;p&gt;Since the Zoom grouping does not work by specifying the number of
individuals in each group, but instead the number of groups, we show an
equivalent representation of the reunion probability graph as a function
of the number of groups, i.e. &lt;span class=&quot;math inline&quot;&gt;\(\lfloor
n/m\rfloor\)&lt;/span&gt;. Since we did the math in &lt;span
class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt;, not every breakout room size is found.
This also means that the shown graph is only an approximation, because
the Zoom allocation algorithm is likely to work slightly different to
our proposed &lt;code&gt;sample_groups&lt;/code&gt; algorithm.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-04-04-socialsamp/plot_p_breakout_rooms-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;appendix-b&quot;&gt;Appendix B&lt;/h2&gt;
&lt;p&gt;As a consequence from the calculation and functions from this post we
can now answer the following question from our &lt;a
href=&quot;https://www.math.su.se/english/research/research-groups/research-group-in-mathematical-statistics-1.330441&quot;&gt;SU
Mathematical Statistics&lt;/a&gt; Zoom Christmas Party announcement:&lt;/p&gt;
&lt;div class=&quot;framedbox&quot;&gt;
&lt;em&gt;At 15:00 We will use the breakout room Zoom function that randomly
divides the participants into smaller groups (5 persons). At 15:15 and
15:30 we will randomize to form new groups. The natural question that
arises is: what is the probability that you and some other colleague
spend the entire 45 minutes together?&lt;/em&gt;
&lt;/div&gt;
&lt;p&gt;
&lt;p&gt;Through simulations (details in the &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-04-04-socialsamp.Rmd&quot;&gt;code&lt;/a&gt;)
built on top of the &lt;code&gt;sample_groups&lt;/code&gt; function we determine
that the requested probability when &lt;span
class=&quot;math inline&quot;&gt;\(n=30\)&lt;/span&gt; participate in the X-mas party is
7.6%.&lt;/p&gt;
&lt;h2 id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;As an example consider the case &lt;span
class=&quot;math inline&quot;&gt;\(n=7\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\(m=4\)&lt;/span&gt;, where we according to our
specification would form 1 group with 7 members.&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;We will assume that the &lt;span
class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; individuals you met last week all
participate again this week.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Thanks to &lt;a
href=&quot;https://www.reddit.com/r/math/comments/mjy7nx/probability_to_meet_someone_again_when_assigning/gtd33xi?utm_source=share&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;u/antichain&lt;/a&gt;
for the question and to &lt;a
href=&quot;https://www.reddit.com/r/math/comments/mjy7nx/probability_to_meet_someone_again_when_assigning/gtd4c8t?utm_source=share&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;u/assiraN&lt;/a&gt;
for the nice answer with examples, which I’ve integrated into the
post.&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Sun, 04 Apr 2021 00:00:00 +0200</pubDate>
        <link>http://mhoehle.github.io/blog/2021/04/04/socialsamp.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2021/04/04/socialsamp.html</guid>
        
        <category>rstats</category>
        
        <category>combinatorics</category>
        
        <category>R</category>
        
        
      </item>
    
      <item>
        <title>Age-Structure Adjusted All-Cause Mortality</title>
        <description>&lt;!-- bibliography: ~/Literature/Bibtex/jabref.bib --&gt;
&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;This page is an updated version of the 2020-12-28 blog post &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2020/12/28/mort.html&quot;&gt;Age
Stratified All-Cause and COVID-19 Associated Mortality&lt;/a&gt;. The post
considers the age stratified all-cause and COVID-19 associated mortality
in Germany during 2020 based on numbers provided by the Federal
Statistical Office and the Robert Koch Institute. Important extensions
compared to the original post are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;an improved population adjusted expected mortality calculation&lt;/li&gt;
&lt;li&gt;an update of the analysis containing the 2020 numbers as of
2021-03-13&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note: The present analyses were previously kept in a separate updated
R-Markdown file, which was updated until 2021-01-29. The present text is
a conversion of this document into a blog post including a treamtnet of
week 53, but does not contain any updated interpretations compared to
the 2021-01-29 version.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/sterbefaelle_incidence.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-03-01-mortadj.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;All-cause mortality is one of indicators used to measure the impact
of the COVID-19 pandemic, because this indicator is less biased by the
testing strategy needed to identify cases to have died while having a
recent COVID-19 diagnosis. Several ressources (&lt;a
href=&quot;https://ourworldindata.org/covid-excess-mortality&quot;&gt;OurWorldInData&lt;/a&gt;,
&lt;a
href=&quot;https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938&quot;&gt;Financial
Times&lt;/a&gt;, &lt;span class=&quot;citation&quot; data-cites=&quot;aburto_etal2021&quot;&gt;Aburto et
al. (2021)&lt;/span&gt;) have used this indicator to compare the COVID-19
response between countries. Since both death and COVID-19 have a strong
age component, it appears crucial to take an age-stratified view on both
all-cause mortality as well as deaths associated with COVID-19. The &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2021-03-01-mortadj.Rmd&quot;&gt;R-markdown
source code&lt;/a&gt; of this blog is available from GitHub.&lt;/p&gt;
&lt;h2 id=&quot;age-stratified-mortality&quot;&gt;Age Stratified Mortality&lt;/h2&gt;
&lt;p&gt;Real-time mortality monitoring is not common in Germany, as can be
seen from the coverage of the &lt;a
href=&quot;https://www.euromomo.eu/&quot;&gt;EuroMoMo monitoring&lt;/a&gt; for Germany,
where only the two federal states Hesse and Berlin participate. However,
as part of the COVID-19 response, the Federal Statistical Office
(Destatis) now provides weekly updated &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Querschnitt/Corona/Gesellschaft/kontextinformationen-gesellschaft.html#Sterbe&quot;&gt;preliminary
mortality statistics of all-cause mortality in 2020&lt;/a&gt;. The methodology
behind the numbers as well as age-stratified additional analyses are
described in an accompanying &lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;publication&lt;/a&gt;
&lt;span class=&quot;citation&quot; data-cites=&quot;zurnieden_etal2020&quot;&gt;(zur Nieden,
Sommer, and Lüken 2020)&lt;/span&gt;. The age-stratified analyses are
unfortunately not continuously updated, however, up-to-date data are
made publicly &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Gesellschaft-Umwelt/Bevoelkerung/Sterbefaelle-Lebenserwartung/Tabellen/sonderauswertung-sterbefaelle.html?nn=209016&quot;&gt;available&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The age-stratified reported COVID-19 associated deaths (by week of
death) are obtained from an &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;export
of the RKI&lt;/a&gt;. In order to compensate for reporting delays of deaths,
the Destatis analysis only goes until 4 weeks before the time point of
analysis, but in this post we shall only be interested in the 2020
results. As additional data source we use the &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;age-stratified
weekly time series by time of death&lt;/a&gt; reported by RKI.&lt;/p&gt;
&lt;h2 id=&quot;preliminary-destatis-mortality-data&quot;&gt;Preliminary Destatis
Mortality Data&lt;/h2&gt;
&lt;p&gt;Available all-cause deaths (by week of death) are available from &lt;a
href=&quot;https://www.destatis.de/EN/Home/_node.html&quot;&gt;Destatis&lt;/a&gt; until
2021-W07. Hwoever, we will only use the data until the end of 2020 in
this post. Note that Destatis stresses the &lt;a
href=&quot;https://twitter.com/FlorianBurg2/status/1343903541849681922?s=20&quot;&gt;preliminary
character of the data&lt;/a&gt; - the numbers might change as further deaths
arrive, however, as of 2021-03-13 changes are expected to be small.
Stratified by age the times series for 2020 compared to the years
2016-2019 looks as follows - please beware of the different y-axes for
the age-groups in the plot:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/AGEMORT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Note: Because the years 2016-2019 do not contain a week 53, we obtain
a hypothetical week 53 value for year &lt;span class=&quot;math inline&quot;&gt;\(Y,
Y=2016,\ldots, 2019\)&lt;/span&gt;, for comparison in the plot by averaging
the observed counts in &lt;span class=&quot;math inline&quot;&gt;\(Y\)&lt;/span&gt;-W52 and
&lt;span class=&quot;math inline&quot;&gt;\((Y+1)\)&lt;/span&gt;-W01.&lt;/p&gt;
&lt;p&gt;Since the age-groups contain different population sizes and - as
pointed out by &lt;span class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz
(2021)&lt;/span&gt; - population sizes of the age-groups changed relevantly
2016-2019, a better comparison between age-groups instead of absolute
numbers is by &lt;a href=&quot;sterbefaelle_incidence.png&quot;&gt;incidence rate&lt;/a&gt;
(i.e. deaths per 100,000 population in the age group). For this, the
yearly Destatis &lt;a
href=&quot;https://www-genesis.destatis.de/genesis//online?operation=table&amp;amp;code=12411-0012&amp;amp;bypass=true&amp;amp;levelindex=0&amp;amp;levelid=1610148266727#abreadcrumb&quot;&gt;age-specific
population data&lt;/a&gt; available for the cut-off-date Dec 31st for
2015-2019 are linearly interpolated for the weeks. An estimate of the
2020 population is obtained from the 2020 value of the &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Gesellschaft-Umwelt/Bevoelkerung/Bevoelkerungsvorausberechnung/Publikationen/Downloads-Vorausberechnung/bevoelkerung-bundeslaender-2060-5124205199024.html&quot;&gt;destatis
population projection&lt;/a&gt; (Variant G2-L2-W2).&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/POPDYNAMICS-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;We notice the strong increase in size of the [80,90) year old age
group (increase by 26%) and the noticable decline in the groups of
[40,50) (-12%) and [70,80) (-9%) in just 5 years. Although not large in
absolute size compared to the other age groups, the [90,Inf) group
increased by 18%. These changes, and in particular those in the higher
age groups, will be relevant for the analysis of excess mortality.&lt;/p&gt;
&lt;p&gt;Once we have the weekly age-specific population estimates available
we can compute the incidence per week and age-group. Below the weekly
mortality incidence rate (per 100 000 population) is shown for 2020
compared to the minimum, mean and maximum of the corresponding week for
the years 2016-2019.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/AGEMORTINC-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Compared to the graphic with the absolute number of deaths, one
notices that the population adjustment leads to a smaller excess in the
[80-90) group (because the population in this group became larger). On
the other hand, the Nov-Dec 2020 curve in the [70-80) group now is
clearer in excess of the expected. For further insights see also &lt;span
class=&quot;citation&quot; data-cites=&quot;kauermann_etal2021&quot;&gt;Kauermann et al.
(2021)&lt;/span&gt; and &lt;span class=&quot;citation&quot;
data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz (2021)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;To underline the age-gradient of all-cause mortality: 56% of the
deaths 2016-2019 occured in the age group of 80+ years (90% in the age
group of 60+). It becomes clear that the 2020 mortality in the 80+ age
groups was rather low during the first 10-12 weeks and then had a spike
in connection with the first COVID-19 wave (March-April). Subsequently,
a summer peak (possibly associated with heat) is followed by an
increasing and ongoing upward trend in December. One challenge for a
statistical analysis of these numbers is to figure out how much of the
upward trend is “catch-up mortality” due to the lower mortality in the
beginning of the year and how much is excess related to COVID-19.
However, both &lt;span class=&quot;citation&quot;
data-cites=&quot;kauermann_etal2021&quot;&gt;Kauermann et al. (2021)&lt;/span&gt; and &lt;span
class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz (2021)&lt;/span&gt; show
that the excess can be well explained by COVID-19 associated deaths.&lt;/p&gt;
&lt;p&gt;An initial analysis of this question consists of summing the
all-cause mortalities from W1 until W53 for 2020 (observed) and compare
this to the summation of the weekly mean of 2016-2019 for the
corresponding time period (expected). Since both 2021-W01 and 2020-W53
contains days outside the year 2020 we weight these two weeks in the
summation according to the number of days in 2020 (i.e. 5/7 and 4/7). As
a consequence, our number of deaths deviates slightly against a more
exact calculation based on daily deaths (which however does not have
age-strata publically available). Note: This calculation method ignores
the population changes in the years 2016-2020. Furthermore:&lt;/p&gt;
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;border-bottom: 0;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Age group
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
observed_2020
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
expected_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Percent change
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
min_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
max_20162019
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[00,30)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7285
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7781
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7508
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
8116
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[30,40)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6811
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6445
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6371
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6512
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[40,50)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15658
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
16917
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-7%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15505
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
18557
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[50,60)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
57485
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
58060
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-1%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
56823
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
58943
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[60,70)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
118313
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
111742
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
107755
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
114922
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[70,80)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
201411
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
211212
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-5%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
202435
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
216055
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[80,90)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
378011
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
340670
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
11%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
325392
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
349797
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[90,Inf)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
199646
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
178355
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
12%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
165384
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
185617
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr grouplength=&quot;1&quot;&gt;
&lt;td colspan=&quot;6&quot; style=&quot;border-bottom: 0;&quot;&gt;
&lt;strong&gt;Total&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;padding-left: 2em;color: black !important;background-color: lightgray !important;&quot; indentlevel=&quot;1&quot;&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
984621
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
931182
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
906309
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
984621
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&quot;padding: 0; &quot; colspan=&quot;100%&quot;&gt;
&lt;sup&gt;a&lt;/sup&gt; Min and max for row ‘Total’ is obtained by first summing
each of the years 2016-2019 and then take the min and max.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;Note: The exact mortality count for 2020 by Destatis using daily data
is 985145, hence, the weighted weekly summation does produce a small
discrepancy from this value. The total proportion of 2020-W1 to 2020-W53
mortalities in the 80+ age group is currently 59%, i.e. a slightly
higher proportion than in the previous years.&lt;/p&gt;
&lt;p&gt;A population age-structure adjusted estimate can be obtained using an
indirect standardization approach &lt;span class=&quot;citation&quot;
data-cites=&quot;keiding_clayton2014&quot;&gt;(Keiding and Clayton 2014)&lt;/span&gt;: For
each age group we compute the weekly incidence rates 2016-2019, then for
each week we take the min, mean and max of the 2016-2020 incidences. If
we for a given age-group and week want an expected number of deaths
based on the 2016-2019 data, we would multiply the 2016-2019 mean
incidence on the corresponding 2020 population in order to get the
expected number of deaths in the corresponding age-group and week of
2020. Because the estimated incidence rates for 2016-2019 are based on
slightly different population sizes, one could acknowledge this in the
mean-calculation by instead computing an inverse variance weighted mean
(or use logistic regression). However, numerical differences are
neglible so we proceed with the equal weighting of the mean. The
computations lead to the following table for the age-population adjusted
2020 mortality:&lt;/p&gt;
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Age group
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
observed_2020
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
expected_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Percent change
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[00,30)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7285
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7770
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-6%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[30,40)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6811
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6732
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
1%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[40,50)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15658
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15990
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-2%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[50,60)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
57485
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
58709
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-2%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[60,70)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
118313
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
118596
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
0%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[70,80)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
201411
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
202851
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-1%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[80,90)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
378011
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
387314
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-2%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[90,Inf)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
199646
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
194453
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
3%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr grouplength=&quot;1&quot;&gt;
&lt;td colspan=&quot;4&quot; style=&quot;border-bottom: 0;&quot;&gt;
&lt;strong&gt;Total&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;padding-left: 2em;color: black !important;background-color: lightgray !important;&quot; indentlevel=&quot;1&quot;&gt;
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
984621
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
992416
&lt;/td&gt;
&lt;td style=&quot;text-align:right;color: black !important;background-color: lightgray !important;&quot;&gt;
-1%
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;What looked like a small excess in the raw calculations becomes a
small negative excess after population adjustment by the proposed
method. This shows the importance of computing the expected number of
cases in a population adjustment way, which was the point of &lt;span
class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz (2021)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/weekly_smr-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Altogether, the mild mortality in the older age groups during the
first weeks (e.g. due to a mild influenza season) so far balances the
continuing excess in the higher age-groups since Mar-Apr, which
coincides with the start of the COVID-19 pandemic. If one is interested
in COVID-19 associated deaths an alternative might be to focus on the
period since Mar 2020, but then one would ignore the low influenza
season in the beginning of the year, which is IMO relevant for all-cause
mortality excess analysis. For comparison, excess mortality computations
for influenza are in the northern hemisphere often done not by calendar
year but by season, i.e. for the period from July in Year &lt;span
class=&quot;math inline&quot;&gt;\(X\)&lt;/span&gt; to June in Year &lt;span
class=&quot;math inline&quot;&gt;\(X+1\)&lt;/span&gt; &lt;span class=&quot;citation&quot;
data-cites=&quot;nielsen_etal2011&quot;&gt;(Nielsen et al. 2011)&lt;/span&gt;. In this case
one would associate the first COVID-19 peak to the analysis of the
season 2019/2020 and the ongoing 2nd wave to an analysis of the ongoing
season 2020/2021. The present analysis, however, focused on the calendar
year 2020 following the Destatis presentation of the data.&lt;/p&gt;
&lt;p&gt;When interpreting the above results it is important to realize that
the 2020 population numbers are currently projections. In a recent &lt;a
href=&quot;https://www.destatis.de/DE/Presse/Pressemitteilungen/2021/01/PD21_016_12411.html&quot;&gt;press
release&lt;/a&gt; Destatis announced that the population in 2020 might not
have increases as projected, because of a smaller migration surplus,
higher mortality and lower birth numbers. As a consequence, Destatis now
estimates that the 2020 population consisted of 83.20 mio (no population
increase compared to 2019) individuals whereas in the G2-L2-W2
projection variant the projection was 83.38 mio (population increase by
0.3% compared to 2019). Final figures, including more detailed
age-stratified data, will be available mid 2021 and it will be
interesting to see how these impact the excess mortality
calculations.&lt;/p&gt;
&lt;p&gt;Furthermore, it is important to realize that the current observed
2020 mortality numbers contain the consequences of all type of effects
from the pandemic management, which includes changes in the population
behavior due to interventions. Disentangling the complex effects of
all-cause mortality and the COVID-19 pandemic is a delicate matter,
which takes experts in several disciplines (demographers, statisticians,
epidemiologists) to solve. However, should you based on the above
numbers happen to think that COVID-19 is not a serious problem, it is
insightful to think about the &lt;a
href=&quot;https://en.wikipedia.org/wiki/Prevention_paradox&quot;&gt;prevention
paradox&lt;/a&gt; and take a look at the &lt;a
href=&quot;https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938&quot;&gt;all-cause
mortality statistics&lt;/a&gt; from other countries and consider a more
regional analysis as done in the next section.&lt;/p&gt;
&lt;h3 id=&quot;analysis-for-the-16-federal-states&quot;&gt;Analysis for the 16 Federal
States&lt;/h3&gt;
&lt;p&gt;The preliminary all-cause mortality data are also available for each
of the 16 federal states, however, with a coarser age discretization. We
show for each of the two age-groups the weekly population adjusted
mortality relative to the same week in 2016-2019. Note that since the
age-groups are also coarser, i.e. the data contains only the two groups
[00,65) and [65,Inf), the effect of the changing populations on the
estimates is less pronounced.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/MORTBLREL-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
The plot can also be compared to the recently introduced &lt;a
href=&quot;https://service.destatis.de/DE/bevoelkerung/sterbefallzahlen_bundeslaender.html&quot;&gt;Destatis
visualization of absolute case numbers on state level&lt;/a&gt;. We note the
strong regional differences in the plot. As an example, the highest
mortality in the 65+ age-group occurs in 2020-W52 in the federal state
of Sachsen, where the poulation adjusted mortality is 122% above the
mean of 2016-2019. Note that for Sachsen, even the &amp;lt;65 age-group has
a visible excess. The 3 federal states with the highest excess mortality
week in the 65+ age-group are:
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Federal state
&lt;/th&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Week
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Excess mortality
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
Sachsen
&lt;/td&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
2020-W52
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
122%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
Brandenburg
&lt;/td&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
2020-W53
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
72%
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
Thüringen
&lt;/td&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
2020-W52
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
68%
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;!-- Furthermore, for the [00,65) series for Berlin it looks like not all all cases up to week W53 are available. This underlines the preliminary character of the Destatis data. --&gt;
&lt;h3 id=&quot;all-cause-mortality-and-covid-19-associated-deaths&quot;&gt;All-Cause
Mortality and COVID-19 Associated Deaths&lt;/h3&gt;
&lt;p&gt;To see, how much of the all-cause mortality is directly contributed
by deaths in association with COVID-19, we match the age-stratified
all-cause mortality data with the age-stratified COVID-19 deaths
reported by the RKI. As of 2020-01-14 the RKI provides &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;weekly
time series of date of death in age groups of 10 years&lt;/a&gt;. Hence, the
previous rough extrapolation from day of report used in the original
blog post is not needed anymore.&lt;/p&gt;
&lt;p&gt;We note that a large part of the increase in mortality can be
explained by COVID-19, i.e. after subtracting the COVID-19 associated
deaths the remainder of the mortality seems comparable with previous
years. This is good news, because deviations would be early signs of
possible secondary adverse health effects due to the COVID-19 pandemic,
i.e. patients trying to avoid the hospital, or care for emergencies
which cannot be given due to lack of ressources.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2021-03-01-mortadj/AGEMORTWCOVID-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;We note that the COVID-19 associated deaths in the most recent weeks
in the [80,90) age groups make up approximately &lt;a
href=&quot;deaths_covid19_proportion.png&quot;&gt;25% of all deaths reported in the
week&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Considering all-cause mortality and COVID-19 associated mortality as
a measure for the impact of an pandemic is a rather simplistic view of
the pandemic. COVID-19 infections can be very mild, but complicated
progressions can occur without leading to death (see, e.g., &lt;a
href=&quot;https://en.wikipedia.org/wiki/Long_COVID&quot;&gt;long COVID&lt;/a&gt;). Looking
at mortality also ignores the complex interplay between age-groups,
where it can be beneficial to reduce infections in a
not-so-affected-by-the-disease age-group in order to protect the
higher-risk groups. The motivation of this post was primarily to put
COVID-19 associated mortality in relation to all-cause mortality in
order to get a better understanding of the daily number of COVID-19
deaths. An age-stratified view is necessary for this. Furthermore, as
pointed out by &lt;span class=&quot;citation&quot; data-cites=&quot;ragnitz2021&quot;&gt;Ragnitz
(2021)&lt;/span&gt;, excess mortality calculations should take the changing
population structure into account.&lt;/p&gt;
&lt;p&gt;For a more modelling based analysis of the German COVID-19 associated
mortality data based on reported infections see also the work by &lt;span
class=&quot;citation&quot; data-cites=&quot;linden_etal2020&quot;&gt;Linden et al.
(2020)&lt;/span&gt; (&lt;a
href=&quot;https://twitter.com/matthiaslinden/status/1344088091020165125?s=20&quot;&gt;updated
analysis&lt;/a&gt;). More information on real-time mortality monitoring can be
obtained from the &lt;a
href=&quot;https://www.euromomo.eu/how-it-works/methods/&quot;&gt;EuroMoMo
methodology&lt;/a&gt; page or &lt;span class=&quot;citation&quot;
data-cites=&quot;hoehle_mazick2010&quot;&gt;Höhle and Mazick (2010)&lt;/span&gt;. Comments
and feedback to the analysis in this blog post are much appretiated.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-aburto_etal2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Aburto, José Manuel, Jonas Schöley, Luyin Zhang, Ilya Kashnitsky,
Charles Rahal, Trifon I. Missov, Melinda C. Mills, Jennifer B. Dowd, and
Ridhi Kashyap. 2021. &lt;span&gt;“Recent Gains in Life Expectancy Reversed by
the COVID-19 Pandemic.”&lt;/span&gt; &lt;em&gt;medRxiv&lt;/em&gt;. &lt;a
href=&quot;https://doi.org/10.1101/2021.03.02.21252772&quot;&gt;https://doi.org/10.1101/2021.03.02.21252772&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-hoehle_mazick2010&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Höhle, M., and A. Mazick. 2010. &lt;span&gt;“Aberration Detection in
&lt;span&gt;R&lt;/span&gt; Illustrated by &lt;span&gt;D&lt;/span&gt;anish Mortality
Monitoring.”&lt;/span&gt; In &lt;em&gt;Biosurveillance: A Health Protection
Priority&lt;/em&gt;, edited by T. Kass-Hout and X. Zhang, 215–38. CRC Press.
&lt;a
href=&quot;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&quot;&gt;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-kauermann_etal2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Kauermann, G., M. Schneble, G. De Nicola, and U. Berger. 2021.
&lt;span&gt;“Übersterblichkeit in Deutschland - Große Unterschiede Zwischen
Den Bundesländern- in Sachsen Sehr Starke Übersterblichkeit Mit Und Ohne
Corona-Todesfälle.”&lt;/span&gt; Department of Statistics, University of
Munich. &lt;a
href=&quot;https://www.covid19.statistik.uni-muenchen.de/pdfs/codag_bericht_6.pdf&quot;&gt;https://www.covid19.statistik.uni-muenchen.de/pdfs/codag_bericht_6.pdf&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-keiding_clayton2014&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Keiding, N., and D. Clayton. 2014. &lt;span&gt;“Standardization and Control
for Confounding in Observational Studies: A Historical
Perspective.”&lt;/span&gt; &lt;em&gt;Statistical Science&lt;/em&gt; 29 (4): 529–58. &lt;a
href=&quot;http://www.jstor.org/stable/43288498&quot;&gt;http://www.jstor.org/stable/43288498&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-linden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Linden, M., J Dehning, SB Mohr, J Mohring, M Meyer-Hermann, I Pigeot, A
Schöbel, and V Priesemann. 2020. &lt;span&gt;“Case Numbers Beyond Contact
Tracing Capacity Are Endangering the Containment of COVID-19.”&lt;/span&gt;
&lt;em&gt;Dtsch Arztebl Int&lt;/em&gt; 117: 790–91. &lt;a
href=&quot;https://doi.org/10.3238/arztebl.2020.0790&quot;&gt;https://doi.org/10.3238/arztebl.2020.0790&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-nielsen_etal2011&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Nielsen, J., A. Mazick, S. Glismann, and K. Mølbak. 2011. &lt;span&gt;“Excess
Mortality Related to Seasonal Influenza and Extreme Temperatures in
Denmark, 1994-2010.”&lt;/span&gt; &lt;em&gt;BMC Infectious Diseases&lt;/em&gt; 11 (1):
350.
&lt;/div&gt;
&lt;div id=&quot;ref-ragnitz2021&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Ragnitz, J. 2021. &lt;span&gt;“Hat Die Corona-Pandemie Zu Einer
Übersterblichkeit in Deutschland Geführt? - Aktualisierung
15.1.2020.”&lt;/span&gt; ifo Institute. &lt;a
href=&quot;https://www.ifo.de/publikationen/2021/monographie-autorenschaft/corona-pandemie-uebersterblichkeit-aktualisierung&quot;&gt;https://www.ifo.de/publikationen/2021/monographie-autorenschaft/corona-pandemie-uebersterblichkeit-aktualisierung&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-zurnieden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
zur Nieden, F., B. Sommer, and S. Lüken. 2020. &lt;span&gt;“Sonderauswertung
Der Sterbefallzahlen 2020.”&lt;/span&gt; &lt;em&gt;WISTA – Wirtschaft Und Statistik
– Amtliche Statistik in Zeiten von Corona&lt;/em&gt;, no. 4 (August): 38–50.
&lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 01 Mar 2021 00:00:00 +0100</pubDate>
        <link>http://mhoehle.github.io/blog/2021/03/01/mortadj.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2021/03/01/mortadj.html</guid>
        
        <category>rstats</category>
        
        <category>dataviz</category>
        
        <category>R</category>
        
        <category>COVID-19</category>
        
        <category>SARS-CoV-2</category>
        
        <category>demography</category>
        
        
      </item>
    
      <item>
        <title>Age Stratified All-Cause and COVID-19 Associated Mortality</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;We consider the age stratified all-cause and COVID-19 associated
mortality in Germany during 2020 based on numbers provided by the
Federal Statistical Office and the Robert Koch Institute.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 2021-03-01&lt;/strong&gt;: An up-to-date and methodologocial
improved version of the post, including population adjusted excess
mortality calculations for 2020 based on the most recent Destatis and
RKI data is available &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2021/03/01/mortadj.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/AGEMORTWCOVID-1.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The
markdown+Rknitr source code of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from github.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;All-cause mortality is one of indicators used to measure the impact
of the COVID-19 pandemic, because this indicator is less biased by the
testing strategy needed to identify cases to have died while having a
recent COVID-19 diagnosis. Since both death and COVID-19 have a strong
age component, it appears crucial to take an age-stratified view on both
all-cause mortality as well as deaths associated with COVID-19. This
will also help to put age-related COVID-19 mortality in a bigger
picture.&lt;/p&gt;
&lt;h2 id=&quot;age-stratified-mortality&quot;&gt;Age Stratified Mortality&lt;/h2&gt;
&lt;p&gt;Real-time mortality monitoring is not common in Germany, as can be
seen from the coverage of the &lt;a
href=&quot;https://www.euromomo.eu/&quot;&gt;EuroMoMo monitoring&lt;/a&gt; for Germany,
where only the two federal states Hesse and Berlin participate. However,
as part of the COVID-19 response, the Federal Statistical Office
(Destatis) now provides weekly updated &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Querschnitt/Corona/Gesellschaft/kontextinformationen-gesellschaft.html#Sterbe&quot;&gt;preliminary
mortality statistics of all-cause mortality in 2020&lt;/a&gt;. The methodology
behind the numbers as well as age-stratified additional analyses are
described in an accompanying &lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;publication&lt;/a&gt;
&lt;span class=&quot;citation&quot; data-cites=&quot;zurnieden_etal2020&quot;&gt;(zur Nieden,
Sommer, and Lüken 2020)&lt;/span&gt;. The age-stratified analyses are
unfortunately not continuously updated, however, up-to-date data are
made publicly &lt;a
href=&quot;https://www.destatis.de/DE/Themen/Gesellschaft-Umwelt/Bevoelkerung/Sterbefaelle-Lebenserwartung/Tabellen/sonderauswertung-sterbefaelle.html?nn=209016&quot;&gt;available&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/destatis.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;The reported COVID-19 associated deaths (by week of death) are
obtained from an &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Projekte_RKI/COVID-19_Todesfaelle.html&quot;&gt;export
of the RKI&lt;/a&gt;. However, the COVID-19 deaths are not available in
age-stratified form. Furthermore, in order to compensate for reporting
delays of deaths, the Destatis analysis only goes until 4 weeks before
the time point of analysis, i.e. the 2020-12-18 version shown in the
above image only reaches ISO week 47 (spanning the time period
2020-11-16 - 2020-11-22).&lt;/p&gt;
&lt;p&gt;The aim of the present blog post is to provide an &lt;strong&gt;up-to-date
age-stratified view including COVID-19 associated deaths&lt;/strong&gt;. As
additional data source we use the age-stratified cumulative number of
deaths reported every Tuesday in the RKI &lt;a
href=&quot;https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Situationsberichte/Dez_2020/2020-12-22-en.pdf?__blob=publicationFile&quot;&gt;situational
report&lt;/a&gt; (p.7).&lt;/p&gt;
&lt;h2 id=&quot;data-io&quot;&gt;Data I/O&lt;/h2&gt;
&lt;p&gt;This section consists of data wrangling the above mentioned data
sources. One challenge is for example to align the age classes used in
the different sources. See the R code on &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2020-12-28-mort.Rmd&quot;&gt;GitHub&lt;/a&gt;
for the gory details.&lt;/p&gt;
&lt;h2 id=&quot;up-to-date-age-stratified-all-cause-mortality&quot;&gt;Up-to-date
age-stratified all-cause mortality&lt;/h2&gt;
&lt;p&gt;Available all-cause deaths (by week of death) are available until
2020-W47. Note that Destatis stresses the &lt;a
href=&quot;https://twitter.com/FlorianBurg2/status/1343903541849681922?s=20&quot;&gt;preliminary
character of the data&lt;/a&gt; - the numbers might change as further deaths
arrive. Stratified by age the times series for 2020 compared to the
years 2016-2019 looks as follows - please beware of the different y-axes
for the age-groups in the plot:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/AGEMORT-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Since the age-groups also contain different population sizes, a
better comparison between age-groups instead of absolute numbers is by
&lt;a
href=&quot;/blog/figure/source/2020-12-28-mort/sterbefaelle_incidence.png&quot;&gt;incidence
rate&lt;/a&gt; (i.e. deaths per 100,000 population in the age group). To
underline the age-gradient of mortality: 56% of the deaths 2016-2019
occured in the age group of 80+ years (90% in the age group of 60+). It
becomes clear that 2020 mortality in the 80+ age groups was rather low
during the first 10-12 weeks and then had a spike in connection with the
first COVID-19 wave (March-April). Subsequently, a summer peak (possibly
associated with heat) is followed by an increasing and ongoing upward
trend. One challenge for a statistical analysis of these numbers is to
figure out how much of the upwards trend is “catch-up mortality” due to
the lower mortality in the beginning of the year and how much is excess
related to COVID-19.&lt;/p&gt;
&lt;p&gt;An initial analysis of this question consists of summing the
all-cause mortalities from W1 until W47 for 2020 (observed) and compare
this to the summation of the weekly mean of 2016-2019 for the
corresponding time period (expected)&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot;
id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;. When we do this by
age-group we obtain:&lt;/p&gt;
&lt;table class=&quot; lightable-classic&quot; style=&quot;font-family: &amp;quot;Arial Narrow&amp;quot;, &amp;quot;Source Sans Pro&amp;quot;, sans-serif; margin-left: auto; margin-right: auto;border-bottom: 0;&quot;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left;&quot;&gt;
Age group
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
observed
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
expected_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
Percent change
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
min_20162019
&lt;/th&gt;
&lt;th style=&quot;text-align:right;&quot;&gt;
max_20162019
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[00,30)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6533
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7057
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-7%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6802
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7346
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[30,40)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6053
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
5829
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
4%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
5755
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
5869
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[40,50)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
13976
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
15348
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-9%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
14093
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
16766
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[50,60)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
51060
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
52527
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-3%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
51445
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
53455
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[60,70)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
104426
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
100734
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
4%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
96860
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
104023
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[70,80)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
176047
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
190420
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
-8%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
182443
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
193917
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[80,90)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
325530
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
306112
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
6%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
290587
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
315843
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left;&quot;&gt;
[90,Inf)
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
171684
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
160108
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
7%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
147177
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
167511
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr grouplength=&quot;1&quot;&gt;
&lt;td colspan=&quot;6&quot; style=&quot;border-bottom: 0;&quot;&gt;
&lt;strong&gt;Total&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left; padding-left:  2em;&quot; indentlevel=&quot;1&quot;&gt;
Total
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
855309
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
838136
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
2%
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
811365
&lt;/td&gt;
&lt;td style=&quot;text-align:right;&quot;&gt;
860975
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style=&quot;padding: 0; &quot; colspan=&quot;100%&quot;&gt;
&lt;sup&gt;a&lt;/sup&gt; Min and max for row ‘Total’ is obtained by first summing
each of the years 2016-2019 and then take the min and max.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;
&lt;p&gt;
&lt;p&gt;So in these numbers the mild mortality in the older age groups during
the first weeks balances some, but not all, of the excess in these
age-groups since Mar-Apr. The total proportion of 2020-W1 to 2020-W47
mortalities in the 80+ age group is currently 58%. However, it is also
important to realize that the current observed 2020 numbers contain the
consequences of all type of effects from the pandemic management, which
includes changes in the population behavior due to interventions.
Disentangling the complex effects of all-cause mortality and the
COVID-19 pandemic is a delicate matter, which takes experts in several
disciplines (demographers, statisticians, epidemiologists) to solve.
However, should you based on the above numbers happen to think that
COVID-19 is not a serious problem, it is insightful to think about the
&lt;a href=&quot;https://en.wikipedia.org/wiki/Prevention_paradox&quot;&gt;prevention
paradox&lt;/a&gt; and take a look at the &lt;a
href=&quot;https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938&quot;&gt;all-cause
mortality statistics&lt;/a&gt; from other countries.&lt;/p&gt;
&lt;h3 id=&quot;all-cause-mortality-and-covid-19-associated-deaths&quot;&gt;All-Cause
Mortality and COVID-19 Associated Deaths&lt;/h3&gt;
&lt;p&gt;To see, how much of the all-cause mortality is directly contributed
by deaths in association with COVID-19, we match the age-stratified
all-cause mortality data with the age-stratified COVID-19 deaths
reported by the RKI since Sep 2020 (2020-W35). One complication of this
matching is that the RKI deaths are reported by the week that the
information about the death reached the RKI and not the week of death.
In order to match it with the Destatis all-cause mortality time series,
we extrapolate week of death from the week of report by the simple
assumption that the death occurred 2 weeks before the report&lt;a
href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Furthermore, to avoid a downward bias in the observed numbers by
observed-but-not-yet-reported deaths, the previously shown Destatis
analyses of all-cause mortality does not include the most recent weeks,
where COVID-19 associated mortality increased substantially in Germany:
the analysis is only done until 2020-W47, even though the date of
analysis was 2020-12-18. At this time the RKI in their situational
report of 2020-12-22 already reported a total of 26964 COVID-19
associated deaths - only 15686 have their time of death up to 2020-W47.
We thus expect the reported excess mortality to increase within the
coming weeks. As a simple extrapolation, we assume that all COVID-19
associated mortality in the subsequent weeks above the level in
2020-W47, is directly summable to the 2020 all-cause mortality&lt;a
href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;. With this simple extrapolation, the
excess mortality computations can be extended until 2020-W50 and leads
to the following predictions:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/figure/source/2020-12-28-mort/AGEMORTWCOVID-1.png&quot; style=&quot;display: block; margin: auto;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;We note that the COVID-19 associated deaths in the most recent weeks
in the 80+ age groups make up more than &lt;a
href=&quot;/blog/figure/source/2020-12-28-mort/deaths_covid19_proportion.png&quot;&gt;30%
of all deaths reported on average over the years 2016-2019&lt;/a&gt;. This
would mean an excess of mortality for the period of 2020-W01 to 2020-W50
of 5%, which is likely to increase even further as the remaining weeks
of 2020 are added&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Considering all-cause mortality and COVID-19 associated mortality as
a measure for the impact of an pandemic is a rather simplistic view of
the pandemic. COVID-19 infections can be very mild, but complicated
progressions can occur without leading to death (see, e.g., &lt;a
href=&quot;https://en.wikipedia.org/wiki/Long_COVID&quot;&gt;long COVID&lt;/a&gt;). Looking
at mortality also ignores the complex interplay between age-groups,
where it can be beneficial to reduce infections in a
not-so-affected-by-the-disease age-group in order to protect the
higher-risk groups. The motivation of this post was primarily to put
COVID-19 associated mortality in relation to all-cause mortality in
order to get a better understanding of the daily number of COVID-19
deaths. An age-stratified view is necessary for this.&lt;/p&gt;
&lt;p&gt;We showed that the Destatis reported excess-mortality are expected to
increase in the coming weeks. The extrapolations used in the present
analysis are simplistic and could be improved by a &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2016/07/19/nowCast.html&quot;&gt;nowcasting
approach&lt;/a&gt;, which extrapolates not-yet-reported deaths from knowledge
about the reporting delay &lt;span class=&quot;citation&quot;
data-cites=&quot;schneble_etal2020&quot;&gt;(Schneble et al. 2020)&lt;/span&gt;. For a more
modelling based analysis of the German COVID-19 associated mortality
data see also the work by &lt;span class=&quot;citation&quot;
data-cites=&quot;linden_etal2020&quot;&gt;Linden et al. (2020)&lt;/span&gt; (&lt;a
href=&quot;https://twitter.com/matthiaslinden/status/1338984728209338369?s=20&quot;&gt;updated
analysis&lt;/a&gt;). More information on real-time mortality monitoring can be
obtained from the &lt;a
href=&quot;https://www.euromomo.eu/how-it-works/methods/&quot;&gt;EuroMoMo
methodology&lt;/a&gt; page or &lt;span class=&quot;citation&quot;
data-cites=&quot;hoehle_mazick2010&quot;&gt;Höhle and Mazick (2010)&lt;/span&gt;. Comments
and feedback to the analysis in this blog post are much appretiated.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 2020-03-01&lt;/strong&gt;: An up-to-date version of this
post, including an analysis of the most recent Destatis and RKI data is
available &lt;a
href=&quot;https://staff.math.su.se/hoehle/blog/2021/03/01/mortadj.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 class=&quot;unnumbered&quot; id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;div id=&quot;refs&quot; class=&quot;references csl-bib-body hanging-indent&quot;
role=&quot;list&quot;&gt;
&lt;div id=&quot;ref-hoehle_mazick2010&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Höhle, M., and A. Mazick. 2010. &lt;span&gt;“Aberration Detection in
&lt;span&gt;R&lt;/span&gt; Illustrated by &lt;span&gt;D&lt;/span&gt;anish Mortality
Monitoring.”&lt;/span&gt; In &lt;em&gt;Biosurveillance: A Health Protection
Priority&lt;/em&gt;, edited by T. Kass-Hout and X. Zhang, 215–38. CRC Press.
&lt;a
href=&quot;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&quot;&gt;https://staff.math.su.se/hoehle/pubs/hoehle_mazick2009-preprint.pdf&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-linden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Linden, M., J Dehning, SB Mohr, J Mohring, M Meyer-Hermann, I Pigeot, A
Schöbel, and V Priesemann. 2020. &lt;span&gt;“Case Numbers Beyond Contact
Tracing Capacity Are Endangering the Containment of COVID-19.”&lt;/span&gt;
&lt;em&gt;Dtsch Arztebl Int&lt;/em&gt; 117: 790–91. &lt;a
href=&quot;https://doi.org/10.3238/arztebl.2020.0790&quot;&gt;https://doi.org/10.3238/arztebl.2020.0790&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-schneble_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
Schneble, M., G. De Nicola G, G. Kauermann, and U. Berger. 2020.
&lt;span&gt;“Nowcasting Fatal COVID-19 Infections on a Regional Level in
Germany.”&lt;/span&gt; &lt;em&gt;Biometrical Journal&lt;/em&gt;. &lt;a
href=&quot;https://doi.org/10.1002/bimj.202000143&quot;&gt;https://doi.org/10.1002/bimj.202000143&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&quot;ref-zurnieden_etal2020&quot; class=&quot;csl-entry&quot; role=&quot;listitem&quot;&gt;
zur Nieden, F., B. Sommer, and S. Lüken. 2020. &lt;span&gt;“Sonderauswertung
Der Sterbefallzahlen 2020.”&lt;/span&gt; &lt;em&gt;WISTA – Wirtschaft Und Statistik
– Amtliche Statistik in Zeiten von Corona&lt;/em&gt;, no. 4 (August): 38–50.
&lt;a
href=&quot;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&quot;&gt;https://www.destatis.de/DE/Methoden/WISTA-Wirtschaft-und-Statistik/2020/04/sonderauswertung-sterbefallzahlen-042020.pdf?__blob=publicationFile&lt;/a&gt;.
&lt;/div&gt;
&lt;/div&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;More involved ways to compute excess-mortality are
imaginable.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Using two weeks provided the best fit to the
unstratified number of observed cases by week of death. More advanced
transformation schemes than simply subtracting two week are
imaginable.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Note: This is really a guesstimate and might produce a
slight excess, because some of the individuals who would have died in
this week in a COVID-free year, by chance now happen to die this week
with COVID-19. However, part of inferential statistics is to make
predictions (which can be wrong) in timely fashion. If you want the
&lt;em&gt;true numbers&lt;/em&gt;, you will have to wait to end of Jan 2021 or even
to mid-2021 (when the official mortality statistics is released). This
is not helpful for situational awareness during a pandemic.&lt;a
href=&quot;#fnref3&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;Note that 2020 has an ISO week 53 spanning 2020-12-28 to
2021-01-03, whereas none of years 2016-2019 had an ISO week 53. It will
be interesting to see how this week will be handled by Destatis for the
excess mortality calculations.&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Mon, 28 Dec 2020 00:00:00 +0100</pubDate>
        <link>http://mhoehle.github.io/blog/2020/12/28/mort.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2020/12/28/mort.html</guid>
        
        <category>rstats</category>
        
        <category>dataviz</category>
        
        <category>R</category>
        
        <category>COVID-19</category>
        
        <category>SARS-CoV-2</category>
        
        <category>demography</category>
        
        
      </item>
    
      <item>
        <title>The Mathematics and Statistics of Infectious Disease Outbreaks</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
&lt;p&gt;Slides, R code and video lectures of our 2020 &lt;em&gt;The Mathematics and
Statistics of Infectious Disease Outbreaks&lt;/em&gt; summer course at
Stockholm University are made available to a wider audience.&lt;/p&gt;
&lt;p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2020-11-20-infepi/youtube.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The
markdown+Rknitr source code of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from github.&lt;/p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;During the 2020 summer &lt;a
href=&quot;https://staff.math.su.se/tom.britton/&quot;&gt;Tom Britton&lt;/a&gt; and I gave
a course on &lt;em&gt;The Mathematics and Statistics of Infectious Disease
Outbreaks&lt;/em&gt; at the &lt;a href=&quot;https://www.math.su.se&quot;&gt;Department of
Mathematics, Stockholm University, Sweden&lt;/a&gt;. Pre-requisites for the
course were undergraduate knowledge of mathematics (e.g. differential
equations, optimization) and statistics (e.g. random variables,
distributions, maximum likelihood inference) as well as some programming
skills in a language with a data science component (python, R, Julia,
matlab, …).&lt;/p&gt;
Now the course is done, we have decided to share all our course
material, consisting of slides, R code and video lectures. The main page
for navigating the material is on GitHub:
&lt;p&gt;
&lt;center&gt;
&lt;a
href=&quot;https://github.com/hoehleatsu/mt3002-summer2020&quot;&gt;https://github.com/hoehleatsu/mt3002-summer2020&lt;/a&gt;
&lt;/center&gt;
&lt;p&gt;
&lt;p&gt;which, e.g., links to the &lt;a
href=&quot;https://www.youtube.com/playlist?list=PLl_ncesshp_C-URStf-LwhYCbFGE70_jq&quot;&gt;Youtube
playlist&lt;/a&gt; containing the videos.&lt;/p&gt;
&lt;h2 id=&quot;course-content&quot;&gt;Course content&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Introduction to the Course [&lt;a
href=&quot;https://video.su.se/media/Introduction+to+the+Course+%28Tom+Britton%29/0_scrd1q6o/356471&quot;&gt;Tom
Britton&lt;/a&gt; | &lt;a href=&quot;https://video.su.se/media/t/0_rqwxd9zg&quot;&gt;Michael
Höhle&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L01: Mathematical Modelling [&lt;a
href=&quot;https://video.su.se/media/L01+-+Mathematical+Modelling+%281+2%29/0_g9pf4rnh/356471&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L01+-+Mathematical+Modelling+%282+2%29/0_qdurs7hj&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L02: Simulation and Fitting of Epidemic Models [&lt;a
href=&quot;https://video.su.se/media/L02+-+Simulation+and+Fitting+of+Epidemic+Models+%281+3%29/0_j0v2lslj&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L02+-+Simulation+and+Fitting+of+Epidemic+Models+%282+3%29/0_p4629rt7&quot;&gt;Part
2&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L02+-+Simulation+and+Fitting+of+Epidemic+Models+%283+3%29/0_3yjyzq0q&quot;&gt;Part
3&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L03: Timing and observations + Endemic models [&lt;a
href=&quot;https://video.su.se/media/L03+-+Timing+and+observations+%2B+Endemic+models+%281+2%29/0_10homfzz&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L03+-+Timing+and+observations+%2B+Endemic+models+%282+2%29/0_1p5i3vsj/356471&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L04: Estimating Reproduction Numbers [&lt;a
href=&quot;https://video.su.se/media/L04+-+Estimation+reproduction+numbers+%281+2%29/0_w12jeszk&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L04+-+Estimating+Reproduction+Numbers+%282+2%29/0_bopogny5&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L05: Effective Reproduction Number [&lt;a
href=&quot;https://video.su.se/media/L05+-+Effective+Reproduction+Number+%281+2%29/0_u3b1j7rk&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L05+-+Effective+Reproduction+Number+%282+2%29/0_38cwcho8&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L06: Latencies and Delays [&lt;a
href=&quot;https://video.su.se/media/+L06+-+Latencies+and+Delays+%281+2%29/0_vrzkcn4s&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L06+-+Latencies+and+Delays+%282+2%29/0_0xu0jgzy&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L07: Vaccination, other Preventive Measures and Uncertainties [&lt;a
href=&quot;https://video.su.se/media/L07+-+Vaccination%2C+other+preventive+measures+and+uncertainties+%281+2%29/0_9oson513/356471&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L07+-+Vaccination%2C+other+preventive+measures+and+uncertainties+%282+2%29/0_7rrq3ug7/356471&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L08: Modeling using Networks and other Heterogeneities [&lt;a
href=&quot;https://video.su.se/media/L08+-+Modeling+using+networks+and+other+heterogeneities+%281+2%29/0_y4jqv270/356471&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L08+-+Modeling+using+networks+and+other+heterogeneities+%282+2%29/0_0mweom9s/356471&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L09: Univariate Outbreak Detection [&lt;a
href=&quot;https://video.su.se/media/L09+-+Univariate+outbreak+detection+%281+2%29/0_imgomlwy/356471&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L09+-+Univariate+outbreak+detection+%282+2%29/0_ifu44eas/356471&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L10: Multivariate Outbreak Detection [&lt;a
href=&quot;https://video.su.se/media/L10+-+Multivariate+outbreak+detection+%281+2%29/0_uithqyum&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L10+-+Multivariate+outbreak+detection+%282+2%29/0_mmol88iy&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L11: COVID-19 (I): Reproduction Number and Herd Immunity [&lt;a
href=&quot;https://video.su.se/media/L11+-+COVID-19+%281+2%29/0_dk0ztmz6/356471&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L11+-+COVID-19+%282+2%29/0_j1xks7xm&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;li&gt;L12: COVID-19 (II): Digital Contact Tracing [&lt;a
href=&quot;https://video.su.se/media/L12+-+Digital+Contact+Tracing+%281+2%29/0_9chh75x5&quot;&gt;Part
1&lt;/a&gt; | &lt;a
href=&quot;https://video.su.se/media/L12+-+Digital+Contact+Tracing+%282+2%29/0_pbdfeaov&quot;&gt;Part
2&lt;/a&gt;]&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;We hope the material can be of value for those interested in the
field, e.g., new Ph.D. students in epidemic modelling, infectious
disease epidemiologists with a like for the quantitative side of
matters, and for those who just want to improve their armchair
epidemiology skills.&lt;/p&gt;
</description>
        <pubDate>Fri, 20 Nov 2020 00:00:00 +0100</pubDate>
        <link>http://mhoehle.github.io/blog/2020/11/20/infepi.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2020/11/20/infepi.html</guid>
        
        <category>rstats</category>
        
        <category>COVID-19</category>
        
        <category>SARS-CoV-2</category>
        
        <category>mathematical modelling</category>
        
        
      </item>
    
      <item>
        <title>Risk Scoring in Digital Contact Tracing Apps</title>
        <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract:&lt;/h2&gt;
We attempt a mathematical description of the risk scoring algorithm used
in the Google and Apple exposure notification framework (v1). This
algorithm is used in many digital contact tracing apps for COVID-19,
e.g., in Germany or Switzerland.
&lt;p&gt;
&lt;center&gt;
&lt;img src=&quot;/blog/figure/source/2020-09-17-gaen_riskscoring/classifier3.png&quot; width=&quot;550&quot;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;
&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;&lt;img alt=&quot;Creative Commons License&quot; style=&quot;border-width:0&quot; src=&quot;https://i.creativecommons.org/l/by-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;
This work is licensed under a &lt;a rel=&quot;license&quot;
href=&quot;http://creativecommons.org/licenses/by-sa/4.0/&quot;&gt;Creative Commons
Attribution-ShareAlike 4.0 International License&lt;/a&gt;. The
markdown+Rknitr source code of this blog is available under a &lt;a
href=&quot;https://www.gnu.org/licenses/gpl-3.0.html&quot;&gt;GNU General Public
License (GPL v3)&lt;/a&gt; license from github.&lt;/p&gt;
&lt;h2 id=&quot;motivation&quot;&gt;Motivation&lt;/h2&gt;
&lt;p&gt;My phone runs a digital COVID-19 contact tracing app based on the
Apple and Google exposure notification (GAEN) framework [&lt;a
href=&quot;https://developer.apple.com/exposure-notification/&quot;&gt;Apple&lt;/a&gt;| &lt;a
href=&quot;https://www.google.com/covid19/exposurenotifications/&quot;&gt;Google&lt;/a&gt;|
&lt;a
href=&quot;https://en.wikipedia.org/wiki/Exposure_Notification&quot;&gt;Wikipedia&lt;/a&gt;].
Since my future health might depend on it, I am interested in the risk
classification algorithm of the framework: when does it warn me about a
possible exposure risk? Since algorithmic transparency is a key
component in gaining acceptance for digital contact tracing apps, this
blog post tries to give a mathematical description of the risk scoring
algorithm in the GAEN framework - as far as I have been able to
understand it. The description is accompanied by a small case study
implemented in R.&lt;/p&gt;
&lt;p&gt;The GAEN is used by country specific COVID-19 Apps in &lt;a
href=&quot;https://github.com/PersonalDataIO/CoronaRiskScoring&quot;&gt;several
countries&lt;/a&gt;, e.g., Switzerland, Latvia, Denmark, Italy, Poland. In
this post special focus is on the German &lt;a
href=&quot;https://www.coronawarn.app/en/&quot;&gt;Corona-Warn-App&lt;/a&gt; (CWA), which
comes with a special commitment to transparency:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Corona-Warn-App is an app that helps trace infection chains of
SARS-CoV-2 (which can cause COVID-19) in Germany. The app is based on
technologies with a decentralized approach and notifies users if they
have been exposed to SARS-CoV-2. Transparency is key to both protect the
app’s end-users and to encourage adoption.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This means that all code and documentation of the CWA is available
under an open-source license through &lt;a
href=&quot;https://github.com/corona-warn-app&quot;&gt;GitHub&lt;/a&gt;. A good overview of
the technical foundation of the app is provided &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-documentation/blob/master/solution_architecture.md&quot;&gt;here&lt;/a&gt;.
However, important parts of the CWA risk scoring are taken from the GAEN
framework, which is less transparent&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot;
id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;. In particular I was
interested in the &lt;a
href=&quot;https://developer.apple.com/documentation/exposurenotification/enexposureconfiguration/calculating_the_exposure_risk_value_in_exposurenotification_version_1&quot;&gt;API
v1&lt;/a&gt; form of the risk scoring, because this forms the basis of the CWA
and also provides epidemiological flexibility through the use of the
transmission risk level parameter.&lt;/p&gt;
&lt;h2 id=&quot;the-risk-scoring&quot;&gt;The Risk Scoring&lt;/h2&gt;
&lt;p&gt;A phone using the GAEN framework scans the immediate surroundings in
regular time intervals&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; using the &lt;a
href=&quot;https://en.wikipedia.org/wiki/Bluetooth_Low_Energy&quot;&gt;BLE&lt;/a&gt;
protocol. Doing so, the phone collects anonymous identifier keys of the
devices running BLE near you. If a GAEN user is tested positive, they
can voluntarily decide to upload their anonymous identifier keys to a
server. With regular intervals the app on your phone downloads these
keys and investigates whether there is a match between the keys you
encountered and those available on the server. If there is a match, an
algorithm decides based on attributes of the contact, e.g. duration,
distance and infectiousness of the potential infector, whether the user
should be displayed a warning about an increased risk for infection. It
is this classification algorithm I am interested in.&lt;/p&gt;
&lt;p&gt;Introducing mathematical notation, let &lt;span
class=&quot;math inline&quot;&gt;\(E\)&lt;/span&gt; be the set of encounters recorded by
your phone during the last 14 days. We assume each entry &lt;span
class=&quot;math inline&quot;&gt;\(e\in E\)&lt;/span&gt; consists of attributes&lt;a
href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;
role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; containing the identifier key - also
known as &lt;em&gt;temporary exposure key&lt;/em&gt; (TEK) - of the phone you met,
i.e. &lt;span class=&quot;math inline&quot;&gt;\(\text{key}(e)\)&lt;/span&gt;, the calendar
day the contact happened, &lt;span
class=&quot;math inline&quot;&gt;\(\text{date}(e)\)&lt;/span&gt;, the duration of the
contact, &lt;span class=&quot;math inline&quot;&gt;\(\text{duration}(e)\)&lt;/span&gt;, and
the average attenuation of the signal during the contact, &lt;span
class=&quot;math inline&quot;&gt;\(\text{antennuation}(e)\)&lt;/span&gt;. The later serves
as proxy for the distance between the two phones.&lt;/p&gt;
&lt;p&gt;Furthermore, the server contains the set of uploaded keys by CWA
users, who tested positive for COVID-19 and who gave consent to upload
their keys. Uploaded keys of test positives are also called
&lt;em&gt;diagnosis keys&lt;/em&gt; - technically they are just TEKs. For simplicity
we shall assume in this document that phones are using one key per
calendar day and that an upload of keys consists of the keys used on the
day of upload and the previous 13 days&lt;a href=&quot;#fn4&quot;
class=&quot;footnote-ref&quot; id=&quot;fnref4&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;.
Let &lt;span class=&quot;math inline&quot;&gt;\(S\)&lt;/span&gt; denote the set of uploaded
keys on the server and for &lt;span class=&quot;math inline&quot;&gt;\(s\in S\)&lt;/span&gt;
let &lt;span class=&quot;math inline&quot;&gt;\(\text{key}(s)\)&lt;/span&gt; denote the
diagnosis key, &lt;span class=&quot;math inline&quot;&gt;\(\text{day_valid}(s)\)&lt;/span&gt;
the calendar day the key was in use and &lt;span
class=&quot;math inline&quot;&gt;\(\text{TRL}(s)\)&lt;/span&gt; the transmission risk. The
later is a numerical value for how infectious the potential infector was
on &lt;span class=&quot;math inline&quot;&gt;\(\text{day_valid}(s)\)&lt;/span&gt;. For
simplicity, in what follows, we shall consider only the so called
&lt;strong&gt;level&lt;/strong&gt; of the duration, attenuation and transmission
risk, which in the GAEN framework is a discretized version of the
continuous quantity represented by an integer between 0-8.&lt;/p&gt;
&lt;p&gt;We shall denote by &lt;span class=&quot;math inline&quot;&gt;\(I\)&lt;/span&gt; the subset
of &lt;span class=&quot;math inline&quot;&gt;\(E\)&lt;/span&gt;, which consists of keys known
to have been positively tested for COVID-19, that is, the key was
uploaded to the server. For simplicity we shall extend the elements of
&lt;span class=&quot;math inline&quot;&gt;\(E\)&lt;/span&gt; with additional information
provided by the server about the key, i.e. we let &lt;span
class=&quot;math display&quot;&gt;\[
I = \{ (e, s) : e \in E , s \in S , \text{key}(s) = \text{key}(e) \}.
\]&lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;case-study-with-aisha-anton-and-betty&quot;&gt;Case Study with Aisha,
Anton and Betty&lt;/h2&gt;
&lt;p&gt;We shall illustrate the above using an example inspired by the &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-documentation/blob/master/cwa-risk-assessment.md&quot;&gt;CWA
documentation&lt;/a&gt;. In the example the CWA user Betty travels with Anton
and Aisha together by bus to and from work on the 9th and the 16th of
the month. Each trip lasts 10 minutes. Anton sat one meter away from
Betty, while Aisha sat two meters away. Both Anton and Aisha become test
positive on the 20th and decide to upload their keys to the server on
the 20th and 21st, respectively. We perform Betty’s risk calculation on
the 20th and 21st, respectively. To make the example clearer, the
original trip length of 10 minutes is changed to 11 minutes.&lt;/p&gt;
&lt;h3 id=&quot;gaen-configuration&quot;&gt;GAEN Configuration&lt;/h3&gt;
&lt;p&gt;Configuration of the risk scoring parameters as done for the CWA:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;do&quot;&gt;## Transmission risk level provided at key upload - see https://github.com/corona-warn-app/cwa-app-android/blob/fe9128fdb28384640d0a248b7ff46701d6a04f0e/Corona-Warn-App/src/main/java/de/rki/coronawarnapp/util/ProtoFormatConverterExtensions.kt#L12 for the google App&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;trl &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;structure&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;fu&quot;&gt;rep&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;7&lt;/span&gt;)), &lt;span class=&quot;at&quot;&gt;names=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;13&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Breaks in dB for the attenuation - see https://github.com/google/exposure-notifications-internals/blob/e953a09dd3c20c04dfa29e362eef461890dac25c/exposurenotification/src/main/java/com/google/samples/exposurenotification/features/ContactTracingFeature.java#L515 &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;attenuation_breaks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;15&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;27&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;33&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;51&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;63&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;73&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;Inf&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;attenuation_include_lowest &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Level for each attenuation bucket, see https://github.com/corona-warn-app/cwa-server/blob/master/services/distribution/src/main/resources/master-config/exposure-config.yaml&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;attenuation_lvl    &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;bucket =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;[0,10]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(10,15]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(15,27]&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;(27,33]&amp;quot;&lt;/span&gt;,  &lt;span class=&quot;st&quot;&gt;&amp;quot;(33,51]&amp;quot;&lt;/span&gt;,  &lt;span class=&quot;st&quot;&gt;&amp;quot;(51,63]&amp;quot;&lt;/span&gt;,  &lt;span class=&quot;st&quot;&gt;&amp;quot;(63,73]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(73,Inf]&amp;quot;&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;lvl=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Bucket limits in https://github.com/google/exposure-notifications-internals/blob/e953a09dd3c20c04dfa29e362eef461890dac25c/exposurenotification/src/main/java/com/google/samples/exposurenotification/features/ContactTracingFeature.java#L502 (note that the buckets are closed to the right)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;duration_breaks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Inf&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;15&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;25&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;30&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;Inf&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;duration_include_lowest &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Levels - see https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/exposure-config.yaml#L50&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;duration_lvl    &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;bucket =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;(-Inf,0]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(0,5]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(5,10]&amp;quot;&lt;/span&gt; , &lt;span class=&quot;st&quot;&gt;&amp;quot;(10,15]&amp;quot;&lt;/span&gt;,  &lt;span class=&quot;st&quot;&gt;&amp;quot;(15,20]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(20,25]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(25,30]&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;(30, Inf]&amp;quot;&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;lvl=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,  &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-16&quot;&gt;&lt;a href=&quot;#cb1-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Days parameters - see https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/exposure-config.yaml#L40&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-17&quot;&gt;&lt;a href=&quot;#cb1-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;days_lvl &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-18&quot;&gt;&lt;a href=&quot;#cb1-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-19&quot;&gt;&lt;a href=&quot;#cb1-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Time_attenuation_buckets (to be used later)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-20&quot;&gt;&lt;a href=&quot;#cb1-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;time_attenuation_bucket_breaks &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;55&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;63&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;Inf&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-21&quot;&gt;&lt;a href=&quot;#cb1-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;time_attenuation_buckets &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;levels&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;cut&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;breaks=&lt;/span&gt;time_attenuation_bucket_breaks, &lt;span class=&quot;at&quot;&gt;include.lowest=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;right=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;span class=&quot;math inline&quot;&gt;\(\text{days}(e)\)&lt;/span&gt; parameter of
an &lt;span class=&quot;math inline&quot;&gt;\(e\in E\)&lt;/span&gt; exposure reflects the
possibility to provide additional risk relevant information about the
CWA user at the day of the contact. However, the CWA currently keeps it
at a fixed value of &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/exposure-config.yaml#L40&quot;&gt;5&lt;/a&gt;
and, hence, it plays little role in the risk calculations.&lt;/p&gt;
&lt;h4 id=&quot;part-1-uploaded-keys-on-the-server&quot;&gt;Part 1: Uploaded keys on the
server&lt;/h4&gt;
&lt;p&gt;Anton had his CWA running since 2020-09-13, while Aisha has been
running her app since 2020-09-01. For each of the two we build a tibble
containing the uploaded keys at the day of transmission, i.e. on the
20th and 21st, respectively&lt;a href=&quot;#fn5&quot; class=&quot;footnote-ref&quot;
id=&quot;fnref5&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;5&lt;/sup&gt;&lt;/a&gt;. Furthermore, we
construct two tibbles mimicking the state of the diagnosis key server on
2020-09-20 and 2020-09-21, respectively.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Upload of Anton on the 2020-09-20 where his app has been running for 8 days&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;anton_ndays &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2020-09-20&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; cwa_start_anton &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;anton &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rkey&lt;/span&gt;(anton_ndays),&lt;span class=&quot;at&quot;&gt;valid=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;seq&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2020-09-20&amp;quot;&lt;/span&gt;),&lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;anton_ndays,&lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;-1 day&amp;quot;&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;trl=&lt;/span&gt;trl[&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(anton_ndays)])&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Upload of Aisha on the 2020-09-21 where her app has been running for 14 days&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;aisha_ndays &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;min&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2020-09-20&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; cwa_start_aisha &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;aisha &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;rkey&lt;/span&gt;(aisha_ndays),&lt;span class=&quot;at&quot;&gt;valid=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;seq&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2020-09-21&amp;quot;&lt;/span&gt;),&lt;span class=&quot;at&quot;&gt;length.out=&lt;/span&gt;aisha_ndays,&lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;-1 day&amp;quot;&lt;/span&gt;), &lt;span class=&quot;at&quot;&gt;trl=&lt;/span&gt;trl[&lt;span class=&quot;fu&quot;&gt;seq_len&lt;/span&gt;(aisha_ndays)])&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#  Upload to server consists of keys for the last 13 days (note: day zero caveat is ignored). Hence dk&amp;lt;date&amp;gt; consists of all keys who were active during the last  13 days within &amp;lt;date&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dk20200920 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; anton &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(valid &lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2020-09-20&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;13&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dk20200921 &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;rbind&lt;/span&gt;(anton, aisha) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(valid &lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.Date&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;2020-09-21&amp;quot;&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;13&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Show diagnosis keys of 2020-09-20 (these are Anton&amp;#39;s keys)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;dk20200920&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8 x 3
##   key    valid        trl
##   &amp;lt;chr&amp;gt;  &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;
## 1 2a0a87 2020-09-20     5
## 2 051447 2020-09-19     6
## 3 f810f4 2020-09-18     8
## 4 17a0d6 2020-09-17     8
## 5 3d12e3 2020-09-16     8
## 6 aaf590 2020-09-15     5
## 7 22b909 2020-09-14     3
## 8 1be004 2020-09-13     1&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&quot;part-2-bettys-exposure-history&quot;&gt;Part 2: Betty’s exposure
history&lt;/h4&gt;
&lt;p&gt;Betty’s sighting history would look as follows:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 7
##   key    date       attenuation duration attenuation_lvl duration_lvl days_lvl
##   &amp;lt;chr&amp;gt;  &amp;lt;date&amp;gt;           &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
## 1 3d12e3 2020-09-16          40       11               2            1        5
## 2 3d12e3 2020-09-16          40       11               2            1        5
## 3 835292 2020-09-16          60       11               2            1        5
## 4 835292 2020-09-16          60       11               2            1        5
## 5 3d8508 2020-09-09          60       11               2            1        5
## 6 3d8508 2020-09-09          60       11               2            1        5&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hence, Betty’s set of exposures with test positives provided by the
server on the 20th is:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;i_set &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;inner_join&lt;/span&gt;(eh_betty, dk20200920, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;key&amp;quot;&lt;/span&gt;) &lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;i_set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2 x 9
##   key    date       attenuation duration attenuation_lvl duration_lvl days_lvl valid        trl
##   &amp;lt;chr&amp;gt;  &amp;lt;date&amp;gt;           &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;
## 1 3d12e3 2020-09-16          40       11               2            1        5 2020-09-16     8
## 2 3d12e3 2020-09-16          40       11               2            1        5 2020-09-16     8&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;risk-scoring&quot;&gt;Risk scoring&lt;/h2&gt;
&lt;p&gt;The description of the risk scoring in the CWA app is centered around
&lt;a
href=&quot;https://github.com/corona-warn-app/cwa-documentation/blob/master/solution_architecture.md&quot;&gt;Fig.
12 and 13&lt;/a&gt; of the solution architecture documentation. An
illustrative example of how this computation looks can be found &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-documentation/blob/master/cwa-risk-assessment.md&quot;&gt;here&lt;/a&gt;.
For further details the source code for the risk scoring in the CWA can
be consulted [&lt;a
href=&quot;https://github.com/corona-warn-app/cwa-app-android/blob/5240f1baf92b9d3082d38570c4e11a4f72edde6b/Corona-Warn-App/src/main/java/de/rki/coronawarnapp/risk/DefaultRiskLevelCalculation.kt&quot;&gt;Android
version&lt;/a&gt;| &lt;a href=&quot;&quot;&gt;iOS&lt;/a&gt;]. However, for the Android version,
which is the one I checked most, it is &lt;a
href=&quot;https://github.com/google/exposure-notifications-internals/issues/17#issuecomment-692981452&quot;&gt;not
100% transparent&lt;/a&gt; (to me) how the important &lt;a
href=&quot;https://developers.google.com/android/exposure-notifications/exposure-notifications-api#modes&quot;&gt;&lt;code&gt;exposureSummary&lt;/code&gt;&lt;/a&gt;
object is generated by the API. Nevertheless, the computation of the
GAEN risk scoring algorithm consists of two steps: a per-exposure risk
score calculation followed by an aggregation over all exposures. The
best approximation I could find is &lt;a
href=&quot;https://github.com/google/exposure-notifications-internals/blob/413b561f59cd4a63b571cac83821959e6e022ce8/exposurenotification/src/main/java/com/google/samples/exposurenotification/matching/KeyExposureEvaluator.java&quot;&gt;&lt;code&gt;KeyExposureEvaluator.java&lt;/code&gt;&lt;/a&gt;,
which might be from a later release than v1, though.&lt;/p&gt;
&lt;h2 id=&quot;risk-score&quot;&gt;Risk Score&lt;/h2&gt;
&lt;p&gt;We compute the total risk for each exposure with a test positive,
i.e. for each element &lt;span class=&quot;math inline&quot;&gt;\(i\in I\)&lt;/span&gt;, by:
&lt;span class=&quot;math display&quot;&gt;\[
\text{TR}(i) = \text{duration}(i)\times
\text{attenuation}(i) \times
\text{TRL}(i) \times
\text{days}(i)
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Exposure risks with a total risk below the &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/app-config.yaml#L13&quot;&gt;minimum
risk score&lt;/a&gt; of 11 are put to zero:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Minimum risk score - see https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/app-config.yaml#L13&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;minimum_risk_score &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;11&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Compute risk score and filter out those below the minimum&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;risk &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; i_set &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;risk_score =&lt;/span&gt; attenuation_lvl &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; duration_lvl &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; trl &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; days_lvl) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(risk_score &lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt; minimum_risk_score)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;risk&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2 x 10
##   key    date       attenuation duration attenuation_lvl duration_lvl days_lvl valid        trl risk_score
##   &amp;lt;chr&amp;gt;  &amp;lt;date&amp;gt;           &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
## 1 3d12e3 2020-09-16          40       11               2            1        5 2020-09-16     8         80
## 2 3d12e3 2020-09-16          40       11               2            1        5 2020-09-16     8         80&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;From this we can compute the the so called &lt;strong&gt;Normalized Total
Risk Score&lt;/strong&gt; defined as &lt;span class=&quot;math display&quot;&gt;\[
\text{Normalized Total Risk Score} := \frac{\max_{i\in I}
\text{TR}(i)}{50}.
\]&lt;/span&gt; I’m guessing, but the value of 50 appears to be a “baseline”
for the transmission risk given by the risk test positives have on the
day they upload their keys ( first element of &lt;code&gt;trl&lt;/code&gt; is 5 and,
hence, &lt;span class=&quot;math inline&quot;&gt;\(1 \times 2 \times 5 \times 5 =
50\)&lt;/span&gt;).&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Derive the normalized total risk score&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;maxTR &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;max&lt;/span&gt;(risk&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;risk_score)&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;ntrs &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; maxTR &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;50&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(maxTR, ntrs)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 80.0  1.6&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In order to reflect that the accumulation of several exposures with a
test positive increases your risk, a weighted summation of time spent in
three 3 attenuation buckets (distance: far, intermediate and close) is
computed.&lt;/p&gt;
&lt;p&gt;For each class &lt;span class=&quot;math inline&quot;&gt;\(j=1,2,3\)&lt;/span&gt; (signal
strength is low, mid and high) a weighted time in the class is computed
&lt;span class=&quot;math display&quot;&gt;\[
\begin{align}
wt_j = \max\left(30, \sum_{i\in  I^*} \mathcal{I}\left(l_j  \leq
\text{attenuation}(i) &amp;lt; u_j \right) \times \text{duration}(i) \times
w_{j}\right)
\end{align}
\]&lt;/span&gt; where &lt;span class=&quot;math inline&quot;&gt;\(\mathcal{I}(A)\)&lt;/span&gt;
denotes the indicator function which is 1 if the condition &lt;span
class=&quot;math inline&quot;&gt;\(A\)&lt;/span&gt; is fulfilled and zero otherwise.
Furthermore, &lt;span class=&quot;math inline&quot;&gt;\(I^* = \{ i \in I :
\text{TR}(i)&amp;gt;0\}\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(w_1=0,
w_2=0.5\)&lt;/span&gt; and &lt;span class=&quot;math inline&quot;&gt;\(w_3=1\)&lt;/span&gt; and the
limits &lt;span class=&quot;math inline&quot;&gt;\((l_j, u_j)\)&lt;/span&gt; of the three
classes are &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/attenuation-duration.yaml#L13&quot;&gt;chosen&lt;/a&gt;
as &lt;span class=&quot;math inline&quot;&gt;\([63, \infty)\)&lt;/span&gt;, &lt;span
class=&quot;math inline&quot;&gt;\([55,63)\)&lt;/span&gt; and &lt;span
class=&quot;math inline&quot;&gt;\([0,55)\)&lt;/span&gt; dB. Note that for reasons beyond
my knowledge, the time in each class is capped at 30 minutes. The total
time is then calculated as as &lt;span class=&quot;math display&quot;&gt;\[
\text{Total time} = \sum_{j=1}^4 wt_j,
\]&lt;/span&gt; where &lt;span class=&quot;math inline&quot;&gt;\(wt_4\geq 0\)&lt;/span&gt; is
denoted a bucket offset value, which is currently set to 0 in the CWA.
Hence, the largest possible total time is &lt;span
class=&quot;math inline&quot;&gt;\(0\times 30 + 0.5\times 30 + 1\times 30 + 0 =
45\)&lt;/span&gt; minutes.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Accumulate time in the 3 attenuation buckets&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;ta_buckets &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; risk &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb14-3&quot;&gt;&lt;a href=&quot;#cb14-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;time_attenuation_bucket =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cut&lt;/span&gt;(attenuation, &lt;span class=&quot;at&quot;&gt;breaks=&lt;/span&gt;time_attenuation_bucket_breaks, &lt;span class=&quot;at&quot;&gt;include.lowest=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;right=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb14-4&quot;&gt;&lt;a href=&quot;#cb14-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(time_attenuation_bucket) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;  &lt;/span&gt;
&lt;span id=&quot;cb14-5&quot;&gt;&lt;a href=&quot;#cb14-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;time =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(duration)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb14-6&quot;&gt;&lt;a href=&quot;#cb14-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Cap at 30 minutes&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-7&quot;&gt;&lt;a href=&quot;#cb14-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;time =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pmin&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;30&lt;/span&gt;, time, &lt;span class=&quot;at&quot;&gt;na.rm=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb14-8&quot;&gt;&lt;a href=&quot;#cb14-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-9&quot;&gt;&lt;a href=&quot;#cb14-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Define the weights - https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/attenuation-duration.yaml#L15&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-10&quot;&gt;&lt;a href=&quot;#cb14-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;weights &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;time_attenuation_bucket=&lt;/span&gt;time_attenuation_buckets, &lt;span class=&quot;at&quot;&gt;weight=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb14-11&quot;&gt;&lt;a href=&quot;#cb14-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;ta_buckets_w &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;right_join&lt;/span&gt;( ta_buckets, weights, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;time_attenuation_bucket&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb14-12&quot;&gt;&lt;a href=&quot;#cb14-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-13&quot;&gt;&lt;a href=&quot;#cb14-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Do the weighted summation and add the bucket offset&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-14&quot;&gt;&lt;a href=&quot;#cb14-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;exposure_score &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; ta_buckets_w &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;total =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(time&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;weight, &lt;span class=&quot;at&quot;&gt;na.rm=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The combined risk score is now given as &lt;span class=&quot;math display&quot;&gt;\[
\text{Combined Risk Score} = \text{Exposure Score } \times
\text{Normalized Total Risk Score}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;A warning is given by the app, if the combined risk is above a
threshold value of &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/risk-score-classification.yaml#L24&quot;&gt;15&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In code:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Compute combined risk score and classify&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(combined_risk_score &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; exposure_score &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; ntrs)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] 35.2&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb17&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb17-1&quot;&gt;&lt;a href=&quot;#cb17-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;(alarm &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; combined_risk_score &lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;15&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hence, Betty receives an alarm on the 20th.&lt;/p&gt;
&lt;h4 id=&quot;the-classifier-in-a-nutshell&quot;&gt;The classifier in a nutshell&lt;/h4&gt;
&lt;p&gt;To summarise, the resulting binary risk classifier of the CWA can be
expressed mathematically by the single formula&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
\begin{align*}
\mathcal{I}\left\{\left[\sum_{j=1}^ 3 \max\left(30, \sum_{i\in  I^*}
\mathcal{I}\left( \text{attenuation}(i) \in [l_j,u_j) \right) \times
\text{duration}(i) \times w_{j}\right)\right] \times \\
\quad\quad\quad\quad\quad \max_{i\in I} \{\text{duration}(i)\times
\text{attenuation}(i) \times
\text{TRL}(i) \times
\text{days}(i)\} \geq 15\cdot 50 \right\}.
\end{align*}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The formula can also be assembled into one classifier function, which
we will use to repeat the risk classification based on the available
server information on 2020-09-21:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb19&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb19-1&quot;&gt;&lt;a href=&quot;#cb19-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;cwa_classifier &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;cf&quot;&gt;function&lt;/span&gt;(i_set) {&lt;/span&gt;
&lt;span id=&quot;cb19-2&quot;&gt;&lt;a href=&quot;#cb19-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Compute risk score and filter out those below the minimum&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-3&quot;&gt;&lt;a href=&quot;#cb19-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  risk &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; i_set &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-4&quot;&gt;&lt;a href=&quot;#cb19-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;risk_score =&lt;/span&gt; attenuation_lvl &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; duration_lvl &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; trl &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; days_lvl) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb19-5&quot;&gt;&lt;a href=&quot;#cb19-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt;(risk_score &lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt; minimum_risk_score)&lt;/span&gt;
&lt;span id=&quot;cb19-6&quot;&gt;&lt;a href=&quot;#cb19-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb19-7&quot;&gt;&lt;a href=&quot;#cb19-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Derive the normalized total risk score&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-8&quot;&gt;&lt;a href=&quot;#cb19-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  maxTR &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;max&lt;/span&gt;(risk&lt;span class=&quot;sc&quot;&gt;$&lt;/span&gt;risk_score)&lt;/span&gt;
&lt;span id=&quot;cb19-9&quot;&gt;&lt;a href=&quot;#cb19-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  ntrs &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; maxTR &lt;span class=&quot;sc&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;50&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-10&quot;&gt;&lt;a href=&quot;#cb19-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb19-11&quot;&gt;&lt;a href=&quot;#cb19-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Accumulate time in the 3 attenuation buckets&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-12&quot;&gt;&lt;a href=&quot;#cb19-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  ta_buckets &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; risk &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb19-13&quot;&gt;&lt;a href=&quot;#cb19-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;time_attenuation_bucket =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cut&lt;/span&gt;(attenuation, &lt;span class=&quot;at&quot;&gt;breaks=&lt;/span&gt;time_attenuation_bucket_breaks, &lt;span class=&quot;at&quot;&gt;include.lowest=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;, &lt;span class=&quot;at&quot;&gt;right=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;FALSE&lt;/span&gt;)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb19-14&quot;&gt;&lt;a href=&quot;#cb19-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;group_by&lt;/span&gt;(time_attenuation_bucket) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt;  &lt;/span&gt;
&lt;span id=&quot;cb19-15&quot;&gt;&lt;a href=&quot;#cb19-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;time =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(duration)) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb19-16&quot;&gt;&lt;a href=&quot;#cb19-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Cap at 30 minutes&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-17&quot;&gt;&lt;a href=&quot;#cb19-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;mutate&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;time =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;pmin&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;30&lt;/span&gt;, time, &lt;span class=&quot;at&quot;&gt;na.rm=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb19-18&quot;&gt;&lt;a href=&quot;#cb19-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb19-19&quot;&gt;&lt;a href=&quot;#cb19-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Define the weights - https://github.com/corona-warn-app/cwa-server/blob/f3d66840ef59e2ced10fb9b42f08a8938e76075a/services/distribution/src/main/resources/master-config/attenuation-duration.yaml#L15&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-20&quot;&gt;&lt;a href=&quot;#cb19-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  weights &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tibble&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;time_attenuation_bucket=&lt;/span&gt;time_attenuation_buckets, &lt;span class=&quot;at&quot;&gt;weight=&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb19-21&quot;&gt;&lt;a href=&quot;#cb19-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  ta_buckets_w &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;right_join&lt;/span&gt;( ta_buckets, weights, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;time_attenuation_bucket&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb19-22&quot;&gt;&lt;a href=&quot;#cb19-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb19-23&quot;&gt;&lt;a href=&quot;#cb19-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Do the weighted summation and add the bucket offset&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-24&quot;&gt;&lt;a href=&quot;#cb19-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  exposure_score &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; ta_buckets_w &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;summarise&lt;/span&gt;(&lt;span class=&quot;at&quot;&gt;total =&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sum&lt;/span&gt;(time&lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt;weight, &lt;span class=&quot;at&quot;&gt;na.rm=&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;TRUE&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;sc&quot;&gt;%&amp;gt;%&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;as.numeric&lt;/span&gt;()&lt;/span&gt;
&lt;span id=&quot;cb19-25&quot;&gt;&lt;a href=&quot;#cb19-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb19-26&quot;&gt;&lt;a href=&quot;#cb19-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Compute combined risk score and classify&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-27&quot;&gt;&lt;a href=&quot;#cb19-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  (combined_risk_score &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; exposure_score &lt;span class=&quot;sc&quot;&gt;*&lt;/span&gt; ntrs)&lt;/span&gt;
&lt;span id=&quot;cb19-28&quot;&gt;&lt;a href=&quot;#cb19-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  (alarm &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; combined_risk_score &lt;span class=&quot;sc&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;15&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb19-29&quot;&gt;&lt;a href=&quot;#cb19-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb19-30&quot;&gt;&lt;a href=&quot;#cb19-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;# Return individals elements of the risk classification&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-31&quot;&gt;&lt;a href=&quot;#cb19-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;return&lt;/span&gt;(&lt;span class=&quot;fu&quot;&gt;list&lt;/span&gt;( &lt;span class=&quot;at&quot;&gt;risk=&lt;/span&gt;risk, &lt;span class=&quot;at&quot;&gt;ta_buckets_w=&lt;/span&gt;ta_buckets_w,  &lt;span class=&quot;at&quot;&gt;exposure_score=&lt;/span&gt;exposure_score, &lt;span class=&quot;at&quot;&gt;ntrs=&lt;/span&gt;ntrs, &lt;span class=&quot;at&quot;&gt;combined_risk_score=&lt;/span&gt;combined_risk_score, &lt;span class=&quot;at&quot;&gt;alarm=&lt;/span&gt;alarm))&lt;/span&gt;
&lt;span id=&quot;cb19-32&quot;&gt;&lt;a href=&quot;#cb19-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that the server information on 2020-09-21 is slightly different
from 2020-09-20, because now also Aisha’s keys are available:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb20&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;span id=&quot;cb20-1&quot;&gt;&lt;a href=&quot;#cb20-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;i_set &lt;span class=&quot;ot&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;left_join&lt;/span&gt;(eh_betty, dk20200921, &lt;span class=&quot;at&quot;&gt;by=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;key&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb20-2&quot;&gt;&lt;a href=&quot;#cb20-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;cwa_classifier&lt;/span&gt;(i_set)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;## $risk
## # A tibble: 4 x 10
##   key    date       attenuation duration attenuation_lvl duration_lvl days_lvl valid        trl risk_score
##   &amp;lt;chr&amp;gt;  &amp;lt;date&amp;gt;           &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;           &amp;lt;dbl&amp;gt;        &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
## 1 3d12e3 2020-09-16          40       11               2            1        5 2020-09-16     8         80
## 2 3d12e3 2020-09-16          40       11               2            1        5 2020-09-16     8         80
## 3 835292 2020-09-16          60       11               2            1        5 2020-09-16     5         50
## 4 835292 2020-09-16          60       11               2            1        5 2020-09-16     5         50
## 
## $ta_buckets_w
## # A tibble: 3 x 3
##   time_attenuation_bucket  time weight
##   &amp;lt;chr&amp;gt;                   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;
## 1 [0,55)                     22    1  
## 2 [55,63)                    22    0.5
## 3 [63,Inf]                   NA    0  
## 
## $exposure_score
## [1] 33
## 
## $ntrs
## [1] 1.6
## 
## $combined_risk_score
## [1] 52.8
## 
## $alarm
## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In other words and not so surprising: we also get an alarm, if Betty
runs the risk scoring on the 21st. However, the combined risk score is
now also higher due to the multiple exposures.&lt;/p&gt;
&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;Despite an honest effort to try to understand the code and the
documentation, there are still specific details, which I’m unsure about.
One reason is that only parts of the code of the GAEN framework v1 are
public - this should be improved. Another reason is that I lack the
technical skills to really build and execute the CWA from source on my
phone or to evaluate he GAEN snippets. This would allow me to test
different scenarios and gain insight based on a reverse engineering
approach. A mathematical and high-level implementation documentation as
the one attempted in this post is not easy to understand either, but
math is a universal language with enough abstraction to not get lost in
the nitty-gritty details of source code. If the source code is public,
however, a ground truth can always be established - it may just take
time… This post mixes the two approaches by supplementing the math with
an illustrative example using R code - the source of this is available
from &lt;a
href=&quot;https://raw.githubusercontent.com/hoehleatsu/hoehleatsu.github.io/master/_source/2020-09-17-gaen_riskscoring.Rmd&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;More details on the use of mathematics in digital contact tracing can
be found in my lecture given as part of the 2020 summer course on “The
Mathematics and Statistics of Infectious Disease Outbreaks” at Stockholm
University [&lt;a
href=&quot;https://github.com/hoehleatsu/mt3002-summer2020/blob/master/Lectures/Lecture12/lecture12.pdf&quot;&gt;slides&lt;/a&gt;
| &lt;a href=&quot;https://youtu.be/KdY62_KmJEE&quot;&gt;video part 1&lt;/a&gt; | &lt;a
href=&quot;https://youtu.be/DvS6-S3S6vc&quot;&gt;video part 2&lt;/a&gt;].&lt;/p&gt;
&lt;center&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/KdY62_KmJEE&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;
&lt;/iframe&gt;
&lt;/center&gt;
&lt;h2 id=&quot;literature&quot;&gt;Literature&lt;/h2&gt;
&lt;section id=&quot;footnotes&quot; class=&quot;footnotes footnotes-end-of-document&quot;
role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;Code snippets have recently been published [&lt;a
href=&quot;https://github.com/google/exposure-notifications-internals&quot;&gt;google&lt;/a&gt;
| &lt;a href=&quot;https://developer.apple.com/exposure-notification/&quot;&gt;apple&lt;/a&gt;
| &lt;a
href=&quot;https://github.com/rettichschnidi/ExposureNotification&quot;&gt;inofficial
GitHub of the apple code&lt;/a&gt;]. Unfortunately, most of the published code
appears to cover later releases of the GAEN. Furthermore, as far as I
can tell, both the Google and the Apple snippets don’t cover the full
code used for the risk scoring in v1. Hence, some of my above
explanations deduced from the code may fail to truly capture the state
and functioning of the v1 risk scoring.&lt;a href=&quot;#fnref1&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Approximately every 5 minutes.&lt;a href=&quot;#fnref2&quot;
class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;This description is a simplification. In reality the &lt;a
href=&quot;https://en.wikipedia.org/wiki/Bluetooth_Low_Energy&quot;&gt;BLE&lt;/a&gt;
protocol consists of a series of scans where it is recorded which keys
can be found. These series sightings of a key are then aggregated to
exposures periods by the GAEN, which have a beginning and an end.&lt;a
href=&quot;#fnref3&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;In practice the TEKs change frequently each day to
preserve anonymity, but it’s possible to deduce all corresponding TEK
from one uploaded diagnosis key.&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;
role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn5&quot;&gt;&lt;p&gt;For this post we ignore the fact that the key active on
the day of upload is not uploaded until tomorrow, but see also this &lt;a
href=&quot;https://github.com/corona-warn-app/cwa-server/issues/723#issuecomment-684814760&quot;&gt;issue&lt;/a&gt;.&lt;a
href=&quot;#fnref5&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
        <pubDate>Thu, 17 Sep 2020 00:00:00 +0200</pubDate>
        <link>http://mhoehle.github.io/blog/2020/09/17/gaen_riskscoring.html</link>
        <guid isPermaLink="true">http://mhoehle.github.io/blog/2020/09/17/gaen_riskscoring.html</guid>
        
        <category>rstats</category>
        
        <category>COVID-19</category>
        
        <category>SARS-CoV-2</category>
        
        <category>digital epidemiology</category>
        
        <category>contact tracing</category>
        
        
      </item>
    
  </channel>
</rss>
