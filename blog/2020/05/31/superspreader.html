<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Superspreading and the Gini Coefficient</title>
  <meta name="description" content="Abstract:">

  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="http://mhoehle.github.io/blog/2020/05/31/superspreader.html">
  <link rel="alternate" type="application/rss+xml" title="Theory meets practice..." href="http://mhoehle.github.io/blog/feed.xml">
</head>

<!-- https://docs.mathjax.org/en/v2.7-latest/start.html -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>




  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/blog/">Theory meets practice...</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/blog/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Superspreading and the Gini Coefficient</h1>
    <p class="post-meta"><time datetime="2020-05-31T00:00:00+02:00" itemprop="datePublished">May 31, 2020</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="abstract">Abstract:</h2>
<p>We look at superspreading in infectious disease transmission from a
statistical point of view. We characterise heterogeneity in the
offspring distribution by the Gini coefficient instead of the usual
dispersion parameter of the negative binomial distribution. This allows
us to consider more flexible offspring distributions.</p>
<center>
<img src="/blog/figure/source/2020-05-31-superspreader/PLOTMODIFIEDLORENZ-1.png" width="550">
</center>
<p><br>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"/></a>
This work is licensed under a <a rel="license"
href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons
Attribution-ShareAlike 4.0 International License</a>. The
markdown+Rknitr source code of this blog is available under a <a
href="https://www.gnu.org/licenses/gpl-3.0.html">GNU General Public
License (GPL v3)</a> license from github.</p>
<h2 id="motivation">Motivation</h2>
<p>The recent Science report on <a
href="https://www.sciencemag.org/news/2020/05/why-do-some-covid-19-patients-infect-many-others-whereas-most-don-t-spread-virus-all">Superspreading
during the COVID-19 pandemic</a> by Kai Kupferschmidt has made the
dispersion parameter <span class="math inline">\(k\)</span> of the
negative binomial distribution a hot quantity<a href="#fn1"
class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in
the discussions of how to determine effective interventions. This short
blog post aims at understanding the math behind statements such as
“Probably about 10% of cases lead to 80% of the spread” and replicate
them with computations in <a href="https://www.r-project.org">R</a>.</p>
<p><strong>Warning</strong>: This post reflects more my own learning
process of what is superspreading than trying to make any statements of
importance.</p>
<h2 id="superspreading">Superspreading</h2>
<p><span class="citation" data-cites="lloydsmith_etal2005">Lloyd-Smith
et al. (2005)</span> show that the 2002-2004 SARS-CoV-1 epidemic was
driven by a small number of events where one case directly infected a
large number of secondary cases - a so called superspreading event. This
means that for SARS-CoV-1 the distribution of how many secondary cases
each primary case generates is heavy tailed. More specifically, the <a
href="https://staff.math.su.se/hoehle/blog/2020/04/15/effectiveR0.html">effective
reproduction number</a> describes the mean number of secondary cases a
primary case generates during the outbreak, i.e. it is the mean of the
offspring distribution. In order to address dispersion around this mean,
<span class="citation" data-cites="lloydsmith_etal2005">Lloyd-Smith et
al. (2005)</span> use the <a
href="https://en.wikipedia.org/wiki/Negative_binomial_distribution">negative
binomial distribution</a> with mean <span
class="math inline">\(R(t)\)</span> and over-dispersion parameter <span
class="math inline">\(k\)</span> as a probability model for the
offspring distribution. The number of offspring that case <span
class="math inline">\(i\)</span>, which got infected at time <span
class="math inline">\(t_i\)</span>, causes is given by <span
class="math display">\[
Y_{i} \sim \operatorname{NegBin}(R(t_i), k),
\]</span> s.t. <span class="math inline">\(\operatorname{E}(Y_{i}) =
R(t_i)\)</span> and <span
class="math inline">\(\operatorname{Var}(Y_{i}) = R(t_i) (1 +
\frac{1}{k} R(t_i))\)</span>. This parametrisation makes it easy to see
that the negative binomial model has an additional factor <span
class="math inline">\(1 + \frac{1}{k} R(t_i)\)</span> for the variance,
which allows it to have excess variance (aka. over-dispersion) compared
to the Poisson distribution, which has <span
class="math inline">\(\operatorname{Var}(Y_{i}) = R(t_i)\)</span>. If
<span class="math inline">\(k\rightarrow \infty\)</span> we get the
Poisson distribution and the closer <span
class="math inline">\(k\)</span> is to zero the larger the variance,
i.e. the heterogeneity, in the distribution is. Note the deliberate use
of the effective reproduction number <span
class="math inline">\(R(t_i)\)</span> instead of the basic reproduction
number <span class="math inline">\(R_0\)</span> (as done in <span
class="citation" data-cites="lloydsmith_etal2005">Lloyd-Smith et al.
(2005)</span>) in the model. This is to highlight, that one is likely to
observe clusters in the context of interventions and depletion of
susceptibles.</p>
<p>That the dispersion parameter <span class="math inline">\(k\)</span>
is making epidemiological fame is a little surprising, because it is a
parameter in a specific parametric model. A parametric model, which
might be inadequate for the observed data. A secondary objective of this
post is thus to focus more on describing the heterogeneity of the
offspring distribution using classical statistical concepts such as the
<a href="https://en.wikipedia.org/wiki/Gini_coefficient"><strong>Gini
coefficient</strong></a>.</p>
<h2
id="negative-binomial-distributed-number-of-secondary-cases">Negative
binomial distributed number of secondary cases</h2>
<p>Let’s assume <span class="math inline">\(k=0.45\)</span> as done in
<span class="citation" data-cites="adam_etal2020">Adam et al.
(2020)</span>. This is a slightly higher estimate than the <span
class="math inline">\(k=0.1\)</span> estimate by <span class="citation"
data-cites="endo_etal2020">Endo et al. (2020)</span><a href="#fn2"
class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>
quoted in the Science article. We want to derive statements like “the x%
most active spreaders infected y% of all cases” as a function of <span
class="math inline">\(k\)</span>. The PMF of the offspring distribution
with mean 2.5 and dispersion 0.45 looks as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Rt <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>k  <span class="ot">&lt;-</span> <span class="fl">0.45</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on a larger enough grid, so E(Y_t) is determined accurate enough</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We also include -1 in the grid to get a point (0,0) needed for the Lorenz curve</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pmf=</span> <span class="fu">dnbinom</span>(x, <span class="at">mu=</span>Rt, <span class="at">size=</span>k))</span></code></pre></div>
<p><img src="/blog/figure/source/2020-05-31-superspreader/PMFNEGBIN-1.png" style="display: block; margin: auto;" /></p>
<p>So we observe that 43% of the cases never manage to infect a
secondary case, whereas some cases manage to generate more than 10 new
cases. The mean of the distribution is checked empirically to equal the
specified <span class="math inline">\(R(t)\)</span> of 2.5:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(df<span class="sc">$</span>x <span class="sc">*</span> df<span class="sc">$</span>pmf)</span></code></pre></div>
<pre><code>## [1] 2.5</code></pre>
<p><span class="citation" data-cites="lloydsmith_etal2005">Lloyd-Smith
et al. (2005)</span> define a <strong>superspreader</strong> to be a
primary case, which generates more secondary cases than the 99th
quantile of the Poisson distribution with mean <span
class="math inline">\(R(t)\)</span>. We use this to compute the
proportion of superspreaders in our distribution:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(superspreader_threshold <span class="ot">&lt;-</span> <span class="fu">qpois</span>(<span class="fl">0.99</span>, <span class="at">lambda=</span>Rt))</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(p_superspreader <span class="ot">&lt;-</span> <span class="fu">pnbinom</span>(superspreader_threshold, <span class="at">mu=</span>Rt, <span class="at">size=</span>k, <span class="at">lower.tail=</span><span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## [1] 0.09539277</code></pre>
<p>So 10% of the cases will generate more than 7 new cases. To get to
statements such as “10% generate 80% of the cases” we also need to know
how many cases those 10% generate out of the 2.5 average.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportion of the overall expected number of new cases</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cdf =</span> <span class="fu">pnbinom</span>(x, <span class="at">mu=</span>Rt, <span class="at">size=</span>k), </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expected_cases=</span>x<span class="sc">*</span>pmf, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">prop_of_Rt=</span>expected_cases<span class="sc">/</span>Rt,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cum_prop_of_Rt =</span> <span class="fu">cumsum</span>(prop_of_Rt))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>info <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;</span> superspreader_threshold) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">expected_cases =</span> <span class="fu">sum</span>(expected_cases), <span class="at">prop_of_Rt =</span> <span class="fu">sum</span>(prop_of_Rt))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>info</span></code></pre></div>
<pre><code>##   expected_cases prop_of_Rt
## 1       1.192786  0.4771144</code></pre>
<p>In other words, the superspreaders generate (on average) 1.19 of the
2.5 new cases of a generation, i.e. 48%.</p>
<p>These statements can also be made without formulating a superspreader
threshold by graphing the cumulative share of primary cases against the
cumulative share of secondary cases these primary cases generate. This
is exactly what the <a
href="https://en.wikipedia.org/wiki/Lorenz_curve">Lorenz curve</a> is
doing. However, for outbreak analysis it appears clearer to graph the
cumulative distribution in decreasing order of the number of offspring
generated, i.e. following <span class="citation"
data-cites="lloydsmith_etal2005">Lloyd-Smith et al. (2005)</span> we
plot the cumulative share as <span class="math inline">\(P(Y\geq
y)\)</span> instead of <span class="math inline">\(P(Y \leq y)\)</span>.
This is a variation of the Lorenz curve, but allows statements such as
“the %x cases with highest number of offspring generate %y of the
secondary cases”.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add information for plotting the modified Lorenz curve</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cdf_decreasing =</span> <span class="fu">pnbinom</span>(x<span class="dv">-1</span>, <span class="at">mu=</span>Rt, <span class="at">size=</span>k, <span class="at">lower.tail=</span><span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(x)) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cum_prop_of_Rt_decreasing =</span> <span class="fu">cumsum</span>(prop_of_Rt))</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the modified Lorenz curve as in Fig 1b of Lloyd-Smith et al. (2005)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cdf_decreasing, <span class="at">y=</span>cum_prop_of_Rt_decreasing)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Proportion of the infectious cases (cases with most secondary cases first)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Proportion of the secondary cases&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y=</span>x), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">&quot;Scenario: R(t) = &quot;</span>, Rt, <span class="st">&quot;, k = &quot;</span>, k))</span></code></pre></div>
<p><img src="/blog/figure/source/2020-05-31-superspreader/PLOTMODIFIEDLORENZ-1.png" style="display: block; margin: auto;" /></p>
<p><strong>Update 2020-06-01</strong>: <a
href="https://twitter.com/cortinah">Hernando Cortina</a> made me aware
that plotting the Lorenz curve for decreasing values is easily done
using the <a
href="https://cran.r-project.org/web/packages/gglorenz/index.html"><code>gglorenz</code></a>
package. However, it requires a sample. So a quick way to do all the
above for the negative binomial without thinking about CDFs, proportions
of <span class="math inline">\(R(t)\)</span> etc. is to just generate a
sample of arbitrary size from the PMF and then plot the decreasing
Lorenz curve.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample an articial population so we can use the empirical lorenz curve</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>outbreak <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">secondary_cases=</span><span class="fu">rnbinom</span>(<span class="dv">10000</span>, <span class="at">mu=</span>Rt, <span class="at">size=</span>k))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outbreak, <span class="fu">aes</span>(secondary_cases)) <span class="sc">+</span> gglorenz<span class="sc">::</span><span class="fu">stat_lorenz</span>(<span class="at">desc=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Proportion of the infectious cases (cases with most secondary cases first)&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Proportion of the secondary cases&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent, <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y=</span>x), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">str_c</span>(<span class="st">&quot;Scenario: R(t) = &quot;</span>, Rt, <span class="st">&quot;, k = &quot;</span>, k))</span></code></pre></div>
<p><img src="/blog/figure/source/2020-05-31-superspreader/GGLORENZ-1.png" style="display: block; margin: auto;" /></p>
<h3 id="gini-coefficient">Gini Coefficient</h3>
<p>Using the standard formulas to compute the <a
href="https://en.wikipedia.org/wiki/Gini_coefficient#Discrete_probability_distribution">Gini
coefficient</a> for a discrete distribution with support on the
non-negative integers, i.e.  <span class="math display">\[
G = \frac{1}{2\mu} \sum_{y=0}^\infty \sum_{z=0}^\infty f(y) f(z) |y-z|,
\]</span> where <span class="math inline">\(f(y)\)</span>, <span
class="math inline">\(y=0,1,\ldots\)</span> denotes the PMF of the
distribution and <span class="math inline">\(\mu=\sum_{y=0}^\infty y
f(y)\)</span> is the mean of the distribution. In our case <span
class="math inline">\(\mu=R(t)\)</span>. From this we get</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gini index for a discrete probability distribution</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>gini_coeff <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>x <span class="sc">*</span> df<span class="sc">$</span>pmf)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> df<span class="sc">$</span>pmf[i] <span class="sc">*</span> df<span class="sc">$</span>pmf[j] <span class="sc">*</span> <span class="fu">abs</span>(df<span class="sc">$</span>x[i] <span class="sc">-</span> df<span class="sc">$</span>x[j])</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sum<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>mu))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">gini_coeff</span>(df)  </span></code></pre></div>
<pre><code>## [1] 0.704049</code></pre>
<p>A plot of the relationship between the dispersion parameter and the
Gini index, given a fixed value of <span
class="math inline">\(R(t)=2.5\)</span>, looks as follows
<img src="/blog/figure/source/2020-05-31-superspreader/PLOTGINIKRELATIONSHIP-1.png" style="display: block; margin: auto;" /></p>
<p>We see that the Gini index converges from above to the Gini index of
the Poisson distribution with mean <span
class="math inline">\(R(t)\)</span>. In our case this limit is</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gini_coeff</span>( <span class="fu">data.frame</span>(<span class="at">x=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">250</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pmf =</span> <span class="fu">dpois</span>(x, <span class="at">lambda=</span>Rt)))</span></code></pre></div>
<pre><code>## [1] 0.3475131</code></pre>
<h3 id="red-marble-toy-example">Red Marble Toy Example</h3>
<p>For the <a href="https://youtu.be/fOHB6PtcoMU?t=1259">toy example
offspring distribution</a> used by <a
href="https://twitter.com/c_drosten">Christian Drosten</a> in his
Coronavirus Update podcast on COVID-19 superspreading (episode 44, in
German). The described hypothetical scenario is translated to an
offspring distribution, where a primary case either generates 1 (with
probability 9/10) or 10 (with probability 1/10) secondary cases:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Offspring distribution</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_toyoffspring <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>), <span class="at">pmf=</span><span class="fu">c</span>(<span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Hypothetical outbreak with 10000 cases from this offspring distribution</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>y_obs <span class="ot">&lt;-</span> <span class="fu">sample</span>(df_toyoffspring<span class="sc">$</span>x, <span class="at">size=</span><span class="dv">10000</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span>df_toyoffspring<span class="sc">$</span>pmf)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the negative binomial distribution to the observed offspring distribution</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Note It would be better to fit the PMF directly instead of to the hypothetical</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># outbreak data</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>(fit <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">fitdistr</span>(y_obs, <span class="st">&quot;negative binomial&quot;</span>))</span></code></pre></div>
<pre><code>##       size          mu    
##   1.73380924   1.87481616 
##  (0.03857807) (0.01975387)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: different parametrisation of the k parameter</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>(k.hat <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>fit<span class="sc">$</span>estimate[<span class="st">&quot;size&quot;</span>])</span></code></pre></div>
<pre><code>##      size 
## 0.5767647</code></pre>
<p>In other words, when fitting a negative binomial distribution to
these data (probably not a good idea) we get a dispersion parameter of
0.58.
<img src="/blog/figure/source/2020-05-31-superspreader/PLOTNEGBINTOYPMF-1.png" style="display: block; margin: auto;" />
The Gini coefficient of this fitted negative distribution is 0.68. If we
instead compute the Gini coefficient for the distribution directly we
get</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gini_coeff</span>(df_toyoffspring) </span></code></pre></div>
<pre><code>## [1] 0.4263158</code></pre>
<p>Altogether, it can be discussed how much gain there is in using more
flexible distributions to model the COVID-19 offspring distribution. The
distribution is likely to center around 0-5, but with some mass above
10+. Too many additional parameters probably do not make sense. However,
one consequnce of assuming negative binomial distributed offspring
distribution is that we accept Poisson-offspring as the minimum lvl of
heterogeneity. This might be theoretically justified, but the Gini index
would allow for a unified reporting of heterogeneity independent of
assumptions about the parametric shape of the offspring distribution. In
the toy example case, a negative binomial distribution was certainly not
an adequate distribution, but of course this is just a toy example.</p>
<h3 id="simulation">Simulation</h3>
<p>We can use the <code>R0::sim.epid</code> function to simulate 1000
trajectories of an outbreak with negative binomial offspring
distribution (c.f. <a
href="https://staff.math.su.se/hoehle/blog/2020/04/15/effectiveR0.html">effective
reproduction number</a> post) having mean 2.5 and dispersion parameter
0.45. For ease of exposition we use a constant generation time of 1 day,
start with 1 infectious case at generation time 0, and then simulate the
epidemic for 10 additional generations.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixed generation time GT, for simplicity time scale is equal to GT, i.e. GT=1</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>gt <span class="ot">&lt;-</span> R0<span class="sc">::</span><span class="fu">generation.time</span>(<span class="at">type=</span><span class="st">&quot;empirical&quot;</span>, <span class="at">val=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 10 epidemics, </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>raw_sims <span class="ot">&lt;-</span> R0<span class="sc">::</span><span class="fu">sim.epid</span>(<span class="at">epid.nb=</span><span class="dv">1000</span>, <span class="at">GT=</span>gt, <span class="at">R0=</span>Rt, <span class="at">epid.length=</span><span class="dv">10</span>, <span class="at">peak.value=</span><span class="fl">1e5</span>, <span class="at">family=</span><span class="st">&quot;negbin&quot;</span>, <span class="at">negbin.size=</span>k)</span></code></pre></div>
<p><img src="/blog/figure/source/2020-05-31-superspreader/PLOTSIMS-1.png" style="display: block; margin: auto;" />
Note that the plot uses a log-10 logarithmic y-axis. Furthermore, we see
that 44% of the simulations become extinct in generation 1, because the
initial case does not manage to generate any new cases. This matches the
<span class="math inline">\(P(Y_i=0)\)</span> probability under the
corresponding negative binomial distribution. Furthermore, 59% of the
simulations have a final size of 10 or less cases.</p>
<h2 id="discussion">Discussion</h2>
<p>The effect of superspreaders underlines the stochastic nature of the
dynamics of an person-to-person transmitted disease in a population. The
dispersion parameter <span class="math inline">\(k\)</span> is
conditional on the assumption of a given parametric model for the
offspring distribution (negative binomial). The Gini index is an
alternative characterisation to measure heterogeneity. However, in both
cases the parameters are to be interpreted together with the expectation
of the distribution. Estimation of the dispersion parameter is
orthogonal to the mean in the negative binomial and its straightforward
to also get confidence intervals for it. This is less straightforward
for the Gini index.</p>
<p>A heavy tailed offspring distribution can make the disease easier to
control by targeting intervention measures to restrict superspreading
<span class="citation" data-cites="lloydsmith_etal2005">(Lloyd-Smith et
al. 2005)</span>. The hope is that such interventions are “cheaper” than
interventions which target the entire population of infectious contacts.
However, the success of such a targeted strategy also depends on how
large the contribution of superspreaders really is. Hence, some effort
is needed to quantify the effect of superspreaders. Furthermore, the
above treatment also underlines that heterogeneity can be a helpful
feature to exploit when trying to control a disease. Another aspect of
such heterogeneity, namely its influence on the threshold of herd
immunity, has recently been invested by my colleagues at Stockholm
University <span class="citation"
data-cites="britton_etal2020">(Britton, Ball, and Trapman
2020)</span>.</p>
<h2 class="unnumbered" id="literature">Literature</h2>
<div id="refs" class="references csl-bib-body hanging-indent"
role="list">
<div id="ref-adam_etal2020" class="csl-entry" role="listitem">
Adam, DC, P Wu, J Wong, E Lau, T Tsang, S Cauchemez, G Leung, and B
Cowling. 2020. <span>“Clustering and Superspreading Potential of Severe
Acute Respiratory Syndrome Coronavirus 2 (SARS-CoV-2) Infections in Hong
Kong.”</span> Research Square. <a
href="https://doi.org/10.21203/rs.3.rs-29548/v1">https://doi.org/10.21203/rs.3.rs-29548/v1</a>.
</div>
<div id="ref-britton_etal2020" class="csl-entry" role="listitem">
Britton, T, F Ball, and P Trapman. 2020. <span>“The Disease-Induced Herd
Immunity Level for Covid-19 Is Substantially Lower Than the Classical
Herd Immunity Level.”</span> <a
href="https://arxiv.org/abs/2005.03085">https://arxiv.org/abs/2005.03085</a>.
</div>
<div id="ref-endo_etal2020" class="csl-entry" role="listitem">
Endo, A, Centre for the Mathematical Modelling of Infectious Diseases
COVID-19 Working Group, S Abbott, AJ Kucharski, and S Funk. 2020.
<span>“Estimating the Overdispersion in COVID-19 Transmission Using
Outbreak Sizes Outside China [Version 1; Peer Review: 1 Approved, 1
Approved with Reservations].”</span> Wellcome Open Res. <a
href="https://doi.org/10.12688/wellcomeopenres.15842.1">https://doi.org/10.12688/wellcomeopenres.15842.1</a>.
</div>
<div id="ref-lloydsmith_etal2005" class="csl-entry" role="listitem">
Lloyd-Smith, J. O., S. J. Schreiber, P. E. Kopp, and W. M. Getz. 2005.
<span>“Superspreading and the Effect of Individual Variation on Disease
Emergence.”</span> <em>Nature</em> 438 (7066): 355–59. <a
href="https://doi.org/10.1038/nature04153">https://doi.org/10.1038/nature04153</a>.
</div>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>To be added to the list of characterising quantities
such as doubling time, reproduction number, generation time, serial
interval, …<a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><span class="citation"
data-cites="lloydsmith_etal2005">Lloyd-Smith et al. (2005)</span>
estimated <span class="math inline">\(k=0.16\)</span> for SARS-CoV-1.<a
href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

  </div>

</article>

	

<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     **/
    /**
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    **/
    var disqus_config = function () {
      this.page.url = "http://mhoehle.github.io/blog/2020/05/31/superspreader.html";
      this.page.identifier = "/2020/05/31/superspreader";
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//hoehle.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Theory meets practice...</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Theory meets practice...</li>
          <li><a href="https://math-inf.uni-greifswald.de/en/michael-hoehle/">Michael Höhle</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mhoehle"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mhoehle</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/m_hoehle"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">m_hoehle</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A blog about statistics in theory and practice. Not always serious, not always flawless, but definitely a statistically flavoured bean.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
